<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  AIRCTT ÏàúÌôòÍµ¨Ï°∞ ÏôÑÏÑ± Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ (Í∏∞Ìöç ÏûëÏóÖÏã§ÌñâÍ≥ÑÌöç)                    ‚ïë
‚ïë  ARÎ©ãÏ∞êÍ≤åÏûÑ ‚Üí Ïª§Î®∏Ïä§ ÏáºÌïë ‚Üí Íµ¨Î¶ÑÏû•ÌÑ∞ ‚Üí ÏôÑÎ≤ΩÌïú ÏàúÌôòÍµ¨Ï°∞               ‚ïë
‚ïë  ÏµúÏ¢Ö ÏàòÏ†ï: 2026-02-24 (ÎåÄÍ∏∞ÏóÖÍ∏â UX ÏóÖÍ∑∏Î†àÏù¥Îìú ÏôÑÎ£å!)              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
 üîÑ AIRCTT ÏàúÌôòÍµ¨Ï°∞ (CIRCULAR FLOW)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  [ÏÜåÎπÑÏûê]                                    [ÏÇ¨ÏóÖÏûê]
     ‚îÇ                                           ‚îÇ
     ‚ñº                                           ‚ñº
  ‚ë† Î°úÍ∑∏Ïù∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ë° Îß§Ïû• ÏûÖÏ†ê Ïã†Ï≤≠
     ‚îÇ                                           ‚îÇ
     ‚ñº                                           ‚ñº
  ‚ë¢ AR 3D Ïø†Ìè∞Í≤åÏûÑ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ë£ Ïø†Ìè∞ Î∞úÍ∏â (Ïû•Îãπ‚Ç©100)
     ‚îÇ (Ïø†Ìè∞ ÌöçÎìù!)                              ‚îÇ
     ‚ñº                                           ‚ñº
  ‚ë§ Ïø†Ìè∞ ÏßÄÍ∞ë ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ë• Í¥ÄÎ¶¨Ïûê ÏäπÏù∏
     ‚îÇ (Ïø†Ìè∞ ÌôïÏù∏/Í¥ÄÎ¶¨)                           ‚îÇ
     ‚ñº                                           ‚ñº
  ‚ë¶ Îß§Ïû• Ï£ºÎ¨∏ (Ïø†Ìè∞ Ï†ÅÏö©) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ëß Ï£ºÎ¨∏ Ï†ëÏàò (Ï†êÏ£º)
     ‚îÇ                                           ‚îÇ
     ‚ñº                                           ‚ñº
  ‚ë® Í≤∞Ï†ú (Ïπ¥Îìú/ÌòÑÍ∏à/Ïπ¥Ïπ¥Ïò§) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ë© Îß§Ï∂ú/ÏÑ∏Î¨¥ Í¥ÄÎ¶¨
     ‚îÇ                                           ‚îÇ
     ‚ñº                                           ‚ñº
  ‚ë™ Íµ¨Î¶ÑÏû•ÌÑ∞ (ÎßàÏºìÌîåÎ†àÏù¥Ïä§) ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ë´ Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ ÎπåÎçî
     ‚îÇ                                           ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ Îã§Ïãú Í≤åÏûÑ ‚Üí Ïø†Ìè∞ ÌöçÎìù ‚Üí Ï£ºÎ¨∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
 ‚úÖ = ÏôÑÎ£å  |  üîß = Í∏∞Îä• ÏûàÏúºÎÇò Î≥¥Í∞ï ÌïÑÏöî  |  ‚ùå = ÎØ∏Íµ¨ÌòÑ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚îÄ‚îÄ A. ÏÜåÎπÑÏûê ÌùêÎ¶Ñ (Consumer Flow) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[‚úÖ] A1. ÏÜåÏÖú Î°úÍ∑∏Ïù∏ (Íµ¨Í∏Ä/Ïπ¥Ïπ¥Ïò§/ÎÑ§Ïù¥Î≤Ñ/Ïù¥Î©îÏùº)
       - showPage('login'), handleLogin(), loginWithGoogle/Kakao/Naver
       - Mock Î°úÍ∑∏Ïù∏ ÎèôÏûë OK

[‚úÖ] A2. AR 3D Ïø†Ìè∞ Í≤åÏûÑ
       - Three.js Í∏∞Î∞ò 3D Ïø†Ìè∞ ÎÇôÌïò Í≤åÏûÑ
       - startGame(), initGame(), createCoupons(), catchCoupon()
       - ÏäπÏù∏Îêú Îß§Ïû• Ïø†Ìè∞Îßå Í≤åÏûÑÏóê Î∞∞Ìè¨ (gameIssuedCoupons)
       - Ìù¨Í∑ÄÎèÑ ÏãúÏä§ÌÖú: common/rare/epic/legendary/mythic
       - Ïø†Ìè∞ ÏûîÏó¨ÏàòÎüâ Ïã§ÏãúÍ∞Ñ Ï∞®Í∞ê
       - Î¨¥Ìïú ÏãúÍ∞Ñ Î™®Îìú

[‚úÖ] A3. Ïø†Ìè∞ ÏßÄÍ∞ë (wallet-page)
       - Ïø†Ìè∞ Î™©Î°ù ÌëúÏãú (3DÏù¥ÎØ∏ÏßÄ, Ìù¨Í∑ÄÎèÑ Î±ÉÏßÄ, Îß§Ïû• ÎßÅÌÅ¨)
       - ÌïÑÌÑ∞: Ï†ÑÏ≤¥/ÏÇ¨Ïö©Í∞ÄÎä•/ÏÇ¨Ïö©ÏôÑÎ£å
       - Í∞úÎ≥Ñ ÏÇ≠Ï†ú & Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
       - Í≤åÏûÑ ÌöçÎìù Ïø†Ìè∞ + Mock Ïø†Ìè∞ + Î†àÍ±∞Ïãú Ïø†Ìè∞ Î≥ëÌï©
       - localStorage Ïó∞Îèô (allCoupons ÌÇ§)

[‚úÖ] A4. Îß§Ïû• Ï£ºÎ¨∏ (store-page)
       - ÏïÑÎØ∏ ÌïúÏ†ïÏãù Î©îÎâ¥ 6Ï¢Ö (MENU_ITEMS)
       - ÏàòÎüâ Ï°∞Ï†à (+/-), Ïû•Î∞îÍµ¨Îãà Ïã§ÏãúÍ∞Ñ Ìï©Í≥Ñ
       - Ïø†Ìè∞ Ï†ÅÏö© (selectCouponForStore)
       - Ï£ºÎ¨∏ ÌÉÄÏûÖ: Î∞∞Îã¨/ÌîΩÏóÖ/ÏòàÏïΩ
       - Í≤∞Ï†ú ÏàòÎã®: Ïπ¥Îìú/ÌòÑÍ∏à/Í≥ÑÏ¢åÏù¥Ï≤¥/Ïπ¥Ïπ¥Ïò§ÌéòÏù¥
       - Ï£ºÎ¨∏ ÏïåÎ¶ºÏùå (Ï†êÏ£ºÏóêÍ≤å)
       - localStorageÏóê Ï£ºÎ¨∏ Í∏∞Î°ù

[‚úÖ] A5. Í≤∞Ï†ú ÏãúÏä§ÌÖú ‚Äî Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ PG ÏãúÎÆ¨Î†àÏù¥ÏÖò Íµ¨ÌòÑÏôÑÎ£å!
       - showPGPaymentPopup(): Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ VAN ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ UI
       - 3Îã®Í≥Ñ ÏßÑÌñâÎ∞î (Ïπ¥ÎìúÏÇ¨ ÏäπÏù∏‚ÜíÏäπÏù∏ÏôÑÎ£å‚ÜíÍ≤∞Ï†úÏôÑÎ£å)
       - Í±∞ÎûòÎ≤àÌò∏(DAOU-ÎÇ†Ïßú-ÏãúÌÄÄÏä§) ÏûêÎèô ÏÉùÏÑ±
       - Supabase orders ÌÖåÏù¥Î∏î Ï†ÄÏû• Ïó∞Îèô
       - Ïã§ PG Ïó∞Îèô Ïãú Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ APIÎßå ÍµêÏ≤¥ÌïòÎ©¥ ÏôÑÏÑ±

[‚úÖ] A6. Íµ¨Î¶ÑÏû•ÌÑ∞ (ÎßàÏºìÌîåÎ†àÏù¥Ïä§) ‚òÖ ÏàúÌôòÍµ¨Ï°∞ ÌïµÏã¨ ÌóàÎ∏å ‚Äî Íµ¨ÌòÑÏôÑÎ£å!
       - market-page: 5Í∞ú Îß§Ïû• Í∑∏Î¶¨Îìú (ÌïúÏãù/Ïπ¥Ìéò/ÏπòÌÇ®/ÏñëÏãù/Ìå®ÏÖò)
       - Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ (7Ï¢Ö) + Í≤ÄÏÉâ + Ï†ïÎ†¨ (Ï∂îÏ≤ú/Ìï†Ïù∏/Í±∞Î¶¨/ÌèâÏ†ê)
       - ÎÇ¥ Î≥¥Ïú† Ïø†Ìè∞ ÏöîÏïΩ + ÎØ∏Îãà Ïä¨ÎùºÏù¥Îçî
       - Ïù∏Í∏∞ Ïø†Ìè∞ ÏÑπÏÖò (gameIssuedCoupons Ïó∞Îèô)
       - Îß§Ïû• Ïπ¥Îìú: ÌèâÏ†ê, Î¶¨Î∑∞Ïàò, Í±∞Î¶¨, ÏòÅÏóÖÏÉÅÌÉú, Ïù∏Í∏∞Î©îÎâ¥, ÌÉúÍ∑∏
       - Îß§Ïû• ÌÅ¥Î¶≠ ‚Üí store-page Ïù¥Îèô (ROUNZÎäî Ïô∏Î∂Ä AR ÎßÅÌÅ¨)
       - ÏÇ¨ÏóÖÏûê Îì±Î°ù Ïú†ÎèÑ Î∞∞ÎÑà ‚Üí business-page Ïó∞Îèô
       - Nav + Home Î≤ÑÌäº + showPage('market') ÏôÑÏ†Ñ Ïó∞Îèô

‚îÄ‚îÄ B. ÏÇ¨ÏóÖÏûê ÌùêÎ¶Ñ (Business Flow) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[‚úÖ] B1. Îß§Ïû• ÏûÖÏ†ê Ïã†Ï≤≠ (4Îã®Í≥Ñ ÏúÑÏûêÎìú)
       - Step1: Í∏∞Î≥∏Ï†ïÎ≥¥ (Îß§Ïû•Î™Ö, ÏóÖÏ¢Ö, ÏÇ¨ÏóÖÏûêÎ≤àÌò∏, ÎåÄÌëúÏûê)
       - Step2: Ïö¥ÏòÅÏ†ïÎ≥¥ (Ï£ºÏÜå, Ï†ÑÌôî, ÏòÅÏóÖÏãúÍ∞Ñ)
       - Step3: ÏïΩÍ¥ÄÎèôÏùò (ÏÑúÎπÑÏä§/Í∞úÏù∏Ï†ïÎ≥¥/ÏàòÏàòÎ£å/Ïö¥ÏòÅÍ∑úÏ†ï)
       - Step4: ÏôÑÎ£å ‚Üí Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞
       - localStorageÏóê pendingStores Ï†ÄÏû•

[‚úÖ] B2. ÎÇ¥ Îß§Ïû• Í¥ÄÎ¶¨ (business-mystore-tab)
       - ÏäπÏù∏Îêú Îß§Ïû• Î™©Î°ù (Ïò§Îäò Ï£ºÎ¨∏/Îß§Ï∂ú)
       - ÎåÄÍ∏∞Ï§ë Îß§Ïû• Lock ÌëúÏãú
       - Îß§Ïû• ÎåÄÏãúÎ≥¥Îìú: Ï£ºÎ¨∏Í¥ÄÎ¶¨/Îß§Ï∂ú/Ïø†Ìè∞/Íæ∏ÎØ∏Í∏∞
       - Ï£ºÎ¨∏ Ï†ëÏàò/Í±∞Ï†à/ÏôÑÎ£å

[‚úÖ] B3. Ïø†Ìè∞ Î∞úÍ∏â (business-coupon-issue-tab)
       - Ïø†Ìè∞Î™Ö/Ìï†Ïù∏/Ïú†Ìòï/ÏàòÎüâ/Ïú†Ìö®Í∏∞Í∞Ñ/Ï°∞Í±¥
       - Î∞úÍ∏âÎπÑÏö© ÏûêÎèôÍ≥ÑÏÇ∞ (Ïû•Îãπ ‚Ç©100)
       - Í≤∞Ï†ú ÌôïÏù∏ ‚Üí Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞
       - Ïø†Ìè∞Í¥ÄÎ¶¨ Î™©Î°ù (Enhanced v2 ÏãúÏä§ÌÖú)
       - ÏÉà Ïø†Ìè∞ Î™®Îã¨ (2Îã®Í≥Ñ: Ï†ïÎ≥¥‚ÜíÍ≤∞Ï†ú)
       - Î∞∞Ìè¨ Î∞òÍ≤Ω ÏßÄÎèÑ (Leaflet.js)
       - AI ÏûêÎèô ÏÉùÏÑ±

[‚úÖ] B4. ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ (business-promo-tab)
       - 20ÌéòÏù¥ÏßÄÍπåÏßÄ Îì±Î°ù
       - YouTube ÏòÅÏÉÅ Îì±Î°ù/ÎØ∏Î¶¨Î≥¥Í∏∞
       - ÌååÏùº ÏóÖÎ°úÎìú (Ïù¥ÎØ∏ÏßÄ/ÎèôÏòÅÏÉÅ/Î¨∏ÏÑú)

[‚úÖ] B5. Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ ÎπåÎçî (store-builder-page)
       - Í∏∞Î≥∏Ï†ïÎ≥¥/ÌÖåÎßà/SNS Ìé∏Ïßë
       - ÏòÅÏóÖÏãúÍ∞Ñ ÏÑ§Ï†ï
       - Î©îÎâ¥ Í¥ÄÎ¶¨ (Ï∂îÍ∞Ä/ÏÇ≠Ï†ú/ÏàòÏ†ï)
       - Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞
       - Supabase Ï†ÄÏû• Ïó∞Îèô
       - Ï†ÑÏ≤¥ÌôîÎ©¥ ÎØ∏Î¶¨Î≥¥Í∏∞

[‚úÖ] B6. Golden Rabbit CFO (üê∞ AI ÎπÑÏÑú) ‚Äî Gemini AI Ïã§Ïó∞Îèô!
       - Îß§Ï∂ú Î∂ÑÏÑù / ÏÑ∏Î¨¥ ÏïàÎÇ¥ / ÎßàÏºÄÌåÖ Ï†ÑÎûµ
       - ÏûêÏú† ÏßàÎ¨∏ Ï±ÑÌåÖ
       - Google Gemini 2.0 Flash API Ïã§ÏãúÍ∞Ñ Ïó∞Îèô!
       - Fallback: API Ïã§Ìå® Ïãú Î°úÏª¨ ÏùëÎãµ ÏûêÎèô Ï†ÑÌôò

‚îÄ‚îÄ C. Í¥ÄÎ¶¨Ïûê ÌùêÎ¶Ñ (Admin Flow) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[‚úÖ] C1. ÏµúÍ≥†Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú (admin-super)
       - ÏäπÏù∏ ÎåÄÍ∏∞/ÏôÑÎ£å ÌÜµÍ≥Ñ
       - Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏãúÏä§ÌÖú (ÏïåÎ¶ºÏùå)
       - ÏÉà Ïã†Ï≤≠ ÏïåÎ¶º Î∞∞ÎÑà

[‚úÖ] C2. Îß§Ïû• Í¥ÄÎ¶¨ (admin-store)
       - Îß§Ïû• ÏäπÏù∏/Í±∞Î∂Ä/Í≤ÄÌÜ†Ï§ë
       - Îß§Ïû• ON/OFF ÌÜ†Í∏Ä
       - ÏÇ¨ÏóÖÏûêÎì±Î°ùÏ¶ù ÌôïÏù∏

[‚úÖ] C3. ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ (admin-users)
       - ÏÇ¨Ïö©Ïûê ÌôúÏÑ±/ÎπÑÌôúÏÑ±
       - ÏÇ¨Ïö©Ïûê Í≤ÄÏÉâ

[‚úÖ] C4. Ïø†Ìè∞ ÏäπÏù∏ (admin-coupons)
       - ÎåÄÍ∏∞ Ïø†Ìè∞ Î™©Î°ù (Ìù¨Í∑ÄÎèÑ, ÏàòÎüâ, ÎπÑÏö© ÌëúÏãú)
       - ÏäπÏù∏ ‚Üí Í≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨ (gameIssuedCoupons.push)
       - Í±∞Î∂Ä ‚Üí ÏÇ¨Ïú† ÏûÖÎ†•
       - Í≤ÄÌÜ†Ï§ë ÏÉÅÌÉú

[‚úÖ] C5. ÏäπÏù∏ Í∏∞Î°ù (admin-history)
       - ÎÇ†Ïßú/Ïú†Ìòï/ÏÉÅÌÉú Í∏∞Î°ù
       - ÌïÑÌÑ∞ (Ï†ÑÏ≤¥/Îß§Ïû•/Ïø†Ìè∞/ÏäπÏù∏/Í±∞Î∂Ä)
       - localStorage ÏòÅÏÜç Ï†ÄÏû•
       - ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú

‚îÄ‚îÄ D. Í∏∞Ïà† Ïù∏ÌîÑÎùº ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[‚úÖ] D1. 3D Î∞∞Í≤Ω (Three.js ÌååÌã∞ÌÅ¥)
[‚úÖ] D2. Tailwind CSS (CDN)
[‚úÖ] D3. GSAP/ScrollTrigger Ïï†ÎãàÎ©îÏù¥ÏÖò
[‚úÖ] D4. Supabase Ïó∞Îèô (Îß§Ïû•ÎπåÎçî + Íµ¨Î¶ÑÏû•ÌÑ∞ + Ï£ºÎ¨∏ + Ïø†Ìè∞)
[üîß] D5. localStorage Îç∞Ïù¥ÌÑ∞ (Supabase Î≥ëÌñâ ‚Äî Ï†êÏßÑ Ï†ÑÌôò Ï§ë)
[‚úÖ] D6. Î∞±ÏóîÎìú API Ïó∞Îèô ‚Äî Supabase PostgREST ÏßÅÏ†ë Ïó∞Îèô ÏôÑÎ£å!
       - API_URL = Supabase REST API
       - sbFetch() Í≥µÌÜµ Ìó¨Ìçº Ìï®Ïàò
       - Íµ¨Î¶ÑÏû•ÌÑ∞: stores + coupons Ïã§ÏãúÍ∞Ñ DB Î°úÎìú
       - Í≤åÏûÑ: DB ÏäπÏù∏ Ïø†Ìè∞ ÏûêÎèô Î≥ëÌï©
       - Ï£ºÎ¨∏: Supabase orders ÌÖåÏù¥Î∏î Ï†ÄÏû•
       - Google Auth: Supabase Auth Ïó∞Îèô
[‚úÖ] D7. ÏÜåÏÖú Î°úÍ∑∏Ïù∏ Ïã§ÌÇ§ Ï†ÅÏö© ÏôÑÎ£å!
       - Google: 673992676128-xxx.apps.googleusercontent.com
       - Kakao: 83d9c34ecc23c2afbe38942083db7338
       - Naver: Yj5T9606wVLFNlOPBBtR
       - Gemini AI: Golden Rabbit CFO Ïã§ Ïó∞Îèô!
[‚úÖ] D8. Ïô∏Î∂Ä ÏûÖÏ†ê Îß§Ïû• (ROUNZ AR ÏïàÍ≤ΩÏ†ê Îì± URL Ïó∞Îèô)

‚îÄ‚îÄ E. ÎåÄÍ∏∞ÏóÖÍ∏â UX ÏóÖÍ∑∏Î†àÏù¥Îìú (Î∞∞ÎØº/ÌÜ†Ïä§/Ïø†Ìå°/ÎãπÍ∑º ÏàòÏ§Ä) ‚îÄ‚îÄ

[‚úÖ] E1. ÌïòÎã® ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò + Î∞∞ÏßÄ
       - 5ÌÉ≠: Ìôàüè†/Í≤åÏûÑüéÆ/Ïû•ÌÑ∞‚òÅÔ∏è/ÏßÄÍ∞ëüí∞/Myüë§
       - Î∞∞ÏßÄ(Ïø†Ìè∞ Ïàò ÌëúÏãú), ÏïåÎ¶º dot, ÌôúÏÑ± ÌÉ≠ ÎèôÍ∏∞Ìôî
       - Í≤åÏûÑ/Ïä§ÌÜ†Ïñ¥ÎπåÎçî Îì±ÏóêÏÑú ÏûêÎèô Ïà®ÍπÄ
[‚úÖ] E2. Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© (Î∞∞ÎØº/Ïø†Ìå° Ïä§ÌÉÄÏùº)
       - card/coupon/store 3Í∞ÄÏßÄ ÌÉÄÏûÖ
       - Íµ¨Î¶ÑÏû•ÌÑ∞, Î©îÎâ¥, ÏßÄÍ∞ë Î°úÎìú Ïãú shimmer Ìö®Í≥º
[‚úÖ] E3. ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º (ÌÜ†Ïä§ Ïä§ÌÉÄÏùº)
       - showToast(): 9Í∞ÄÏßÄ ÏïÑÏù¥ÏΩò ÌÉÄÏûÖ
       - ÏûêÎèô ÏÇ¨ÎùºÏßê, ÌïòÎã® ÌëúÏãú, blur Î∞∞Í≤Ω
[‚úÖ] E4. Ïò®Î≥¥Îî© Ï∫êÎü¨ÏÖÄ (3Ïä¨ÎùºÏù¥Îìú ÌäúÌÜ†Î¶¨Ïñº)
       - Ï≤´ Î∞©Î¨∏ ÏûêÎèô ÌëúÏãú (localStorage Ï≤¥ÌÅ¨)
       - Ïä§ÏôÄÏù¥ÌîÑ dots, Ïù¥Ï†Ñ/Îã§Ïùå Î≤ÑÌäº
[‚úÖ] E5. Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏ (4Îã®Í≥Ñ)
       - Ï£ºÎ¨∏Ï†ëÏàò‚ÜíÏ°∞Î¶¨Ï§ë‚ÜíÎ∞∞Îã¨Ï§ë‚ÜíÏôÑÎ£å
       - Ïã§ÏãúÍ∞Ñ ÏßÑÌñâ ÏãúÎÆ¨Î†àÏù¥ÏÖò, pulse Ïï†ÎãàÎ©îÏù¥ÏÖò
[‚úÖ] E6. Î¶¨Î∑∞/ÌèâÏ†ê ÏãúÏä§ÌÖú
       - Î≥ÑÏ†ê ÏÑ†ÌÉù UI + ÌÖçÏä§Ìä∏ Î¶¨Î∑∞
       - localStorage Ï†ÄÏû•, Îß§Ïû•Î≥Ñ ÌèâÍ∑†Ï†ê
       - ÏµúÍ∑º Î¶¨Î∑∞ 5Í∞ú ÌëúÏãú
[‚úÖ] E7. Pull-to-Refresh
       - ÌÑ∞Ïπò Ïä§ÏôÄÏù¥ÌîÑ Í∞êÏßÄ
       - ÎãπÍ≤®ÏÑú ÏÉàÎ°úÍ≥†Ïπ® Ïù∏ÎîîÏºÄÏù¥ÌÑ∞
[‚úÖ] E8. Empty State UI
       - emoji + ÏÑ§Î™Ö + CTA Î≤ÑÌäº
       - ÏßÄÍ∞ë/Í≤ÄÏÉâ Îì± Îπà ÌôîÎ©¥ ÎåÄÏùë
[‚úÖ] E9. ÎåÄÍ∏∞ÏóÖ ÎπÑÍµêÌëú
       - AIRCTT vs Î∞∞ÎØº/ÎãπÍ∑º/Ïø†Ìå°/ÌÜ†Ïä§/ÎÑ§Ïù¥Î≤Ñ 15Ìï≠Î™© ÎπÑÍµê
       - ÎèÖÏûê Í∏∞Îä• 3Í∞ú: ARÍ≤åÏûÑ, AI CFO, Îß§Ïû•ÎπåÎçî

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
 üèÜ ÏµúÏ¢Ö ÌòÑÌô©
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  üìä Ï¥ù 34Í∞ú Ìï≠Î™© Ï§ë 33Í∞ú ‚úÖ ÏôÑÎ£å, 1Í∞ú üîß Î≥¥Í∞ïÏ§ë (D5 Ï†êÏßÑÏ†ÑÌôò)

  üè¢ ÎåÄÍ∏∞ÏóÖ ÎπÑÍµê: AIRCTT 15/15 Í∏∞Îä• | ÎåÄÍ∏∞ÏóÖ ÌèâÍ∑† 9.6/15
  üê∞ ÎèÖÏûê Í∏∞Îä•: AR 3D Ïø†Ìè∞ Í≤åÏûÑ / AI CFO (Gemini) / Îß§Ïû• ÌôàÎπåÎçî

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
-->
<!DOCTYPE html>\n<html lang="ko"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIRCTT - AI Reality CouponTalkTalk</title>
  
  <!-- CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  
  <!-- ÏÜåÏÖú Î°úÍ∑∏Ïù∏ SDK -->
  <script src="https://accounts.google.com/gsi/client" async="" defer=""></script>
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js" integrity="sha384-l+xbElFSnPZ2rOaPrU//2FF5B4LB8FiX5q4fXYTlfcG4PGpMkE1vcL7kNXI6Cci0" crossorigin="anonymous"></script>
  <script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.2.js" charset="utf-8"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&amp;family=Noto+Sans+KR:wght@300;400;700;900&amp;display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #0a0a0a;
      color: #ffffff;
      overflow-x: hidden;
    }
    
    h1, h2, h3 { font-family: 'Orbitron', monospace; }
    
    #canvas-3d {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }
    
    .content { position: relative; z-index: 1; }
    
    .grid-bg {
      background-image: 
        linear-gradient(rgba(168, 85, 247, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(168, 85, 247, 0.05) 1px, transparent 1px);
      background-size: 50px 50px;
    }
    
    .glow-border {
      border: 1px solid rgba(168, 85, 247, 0.3);
      box-shadow: 0 0 20px rgba(168, 85, 247, 0.2), inset 0 0 20px rgba(168, 85, 247, 0.1);
    }
    
    .neon-text {
      text-shadow: 0 0 10px rgba(168, 85, 247, 0.8), 0 0 20px rgba(168, 85, 247, 0.6), 0 0 30px rgba(168, 85, 247, 0.4);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #a855f7 0%, #22d3ee 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #a855f7 0%, #22d3ee 100%);
      color: white;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-weight: bold;
      transition: transform 0.3s ease;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
      border: none;
      font-size: 1rem;
    }
    
    .btn-primary:hover { transform: translateY(-2px); }
    
    /* ÏÜåÏÖú Î°úÍ∑∏Ïù∏ Î≤ÑÌäº */
    .social-btn {
      width: 100%;
      padding: 1rem;
      border-radius: 0.5rem;
      font-weight: bold;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.3s;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    
    .social-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }
    
    .btn-google {
      background: #ffffff;
      color: #333333;
      border: 1px solid #dddddd;
    }
    
    .btn-kakao {
      background: #FEE500;
      color: #000000;
    }
    
    .btn-naver {
      background: #03C75A;
      color: #ffffff;
    }
    
    .divider {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 1.5rem 0;
      color: #888;
    }
    
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid #444;
    }
    
    .divider span {
      padding: 0 1rem;
    }
    
    .card {
      background: rgba(26, 10, 46, 0.3);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 2rem;
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(168, 85, 247, 0.3);
    }
    
    .page { display: none; }
    .page.active { display: block; }
    
    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(10, 10, 10, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(168, 85, 247, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
    }
    
    nav .nav-left { display: flex; }
    
    nav a {
      color: white;
      text-decoration: none;
      padding: 1rem 1.5rem;
      display: inline-block;
      transition: all 0.3s;
    }
    
    nav a:hover {
      background: rgba(168, 85, 247, 0.2);
      color: #a855f7;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 1rem;
      background: rgba(168, 85, 247, 0.2);
      border-radius: 2rem;
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #a855f7, #22d3ee);
    }

    #game-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: none;
    }
    
    #game-container.active { display: block; }
    
    #game-canvas {
      width: 100%;
      height: 100%;
      cursor: crosshair;
    }
    
    .game-hud {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 2rem;
      z-index: 1001;
    }
    
    .hud-item {
      background: rgba(10, 10, 10, 0.8);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(34, 211, 238, 0.5);
      border-radius: 15px;
      padding: 1rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 120px;
    }
    
    .hud-label {
      font-size: 0.9rem;
      color: #22d3ee;
      text-transform: uppercase;
      font-weight: bold;
    }
    
    .hud-value {
      font-size: 2rem;
      font-weight: bold;
      color: #ffffff;
      text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
    }

    /* ‚ïê‚ïê‚ïê üéÆ Stage 1 Î≥¥Í∞ï CSS ‚ïê‚ïê‚ïê */

    /* ÏΩ§Î≥¥ Í≤åÏù¥ÏßÄ Î∞î */
    .combo-gauge-container {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .combo-gauge-container.visible { opacity: 1; }
    .combo-gauge-label {
      color: #fbbf24;
      font-size: 0.85rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 4px;
      text-shadow: 0 0 8px rgba(251,191,36,0.6);
    }
    .combo-gauge-bar {
      width: 100%;
      height: 12px;
      background: rgba(30,30,30,0.8);
      border-radius: 6px;
      border: 1px solid rgba(251,191,36,0.3);
      overflow: hidden;
    }
    .combo-gauge-fill {
      height: 100%;
      width: 0%;
      border-radius: 6px;
      transition: width 0.3s ease, background 0.3s ease;
      background: linear-gradient(90deg, #22d3ee, #a855f7);
    }
    .combo-gauge-fill.hot {
      background: linear-gradient(90deg, #fbbf24, #ef4444);
      box-shadow: 0 0 12px rgba(251,191,36,0.6);
    }
    .combo-gauge-fill.fever {
      background: linear-gradient(90deg, #ef4444, #ec4899, #a855f7);
      box-shadow: 0 0 20px rgba(239,68,68,0.8);
      animation: feverPulse 0.3s infinite alternate;
    }
    @keyframes feverPulse {
      from { filter: brightness(1); }
      to { filter: brightness(1.4); }
    }

    /* ÏΩ§Î≥¥ Î∞∞Ïú® ÌëúÏãú */
    .combo-multiplier {
      position: absolute;
      bottom: 100px;
      right: 30px;
      font-size: 2.5rem;
      font-weight: 900;
      color: #fbbf24;
      text-shadow: 0 0 20px rgba(251,191,36,0.8), 0 0 40px rgba(251,191,36,0.4);
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
      transform: scale(0.5);
    }
    .combo-multiplier.visible {
      opacity: 1;
      transform: scale(1);
    }
    .combo-multiplier.mega {
      color: #ef4444;
      text-shadow: 0 0 20px rgba(239,68,68,0.8), 0 0 40px rgba(239,68,68,0.4);
      animation: megaCombo 0.5s ease infinite alternate;
    }
    @keyframes megaCombo {
      from { transform: scale(1) rotate(-3deg); }
      to { transform: scale(1.15) rotate(3deg); }
    }

    /* ÌîºÎ≤Ñ Î™®Îìú Ïò§Î≤ÑÎ†àÏù¥ */
    .fever-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .fever-overlay.active {
      opacity: 1;
      border: 4px solid;
      border-image: linear-gradient(45deg, #ef4444, #fbbf24, #22c55e, #3b82f6, #a855f7) 1;
      animation: feverBorder 1s linear infinite;
    }
    @keyframes feverBorder {
      0% { border-image: linear-gradient(0deg, #ef4444, #fbbf24, #22c55e, #3b82f6, #a855f7) 1; }
      25% { border-image: linear-gradient(90deg, #ef4444, #fbbf24, #22c55e, #3b82f6, #a855f7) 1; }
      50% { border-image: linear-gradient(180deg, #ef4444, #fbbf24, #22c55e, #3b82f6, #a855f7) 1; }
      75% { border-image: linear-gradient(270deg, #ef4444, #fbbf24, #22c55e, #3b82f6, #a855f7) 1; }
      100% { border-image: linear-gradient(360deg, #ef4444, #fbbf24, #22c55e, #3b82f6, #a855f7) 1; }
    }

    /* ÌîºÎ≤Ñ Î™®Îìú ÌÖçÏä§Ìä∏ */
    .fever-text {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 4rem;
      font-weight: 900;
      color: #fbbf24;
      text-shadow: 0 0 30px rgba(251,191,36,1), 0 0 60px rgba(251,191,36,0.5), 0 4px 0 #b45309;
      z-index: 9999;
      pointer-events: none;
      white-space: nowrap;
      animation: feverTextPop 1.2s ease forwards;
    }
    @keyframes feverTextPop {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
      20% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
      40% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
      80% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(2) rotate(0deg); opacity: 0; }
    }

    /* Í≥®Îì† Î≥¥ÎÑàÏä§ Ïø†Ìè∞ ÌëúÏãúÍ∏∞ */
    .golden-indicator {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1001;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: #1a0a2e;
      padding: 6px 20px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.85rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      box-shadow: 0 0 20px rgba(251,191,36,0.5);
    }
    .golden-indicator.visible { opacity: 1; }

    /* Í≤åÏûÑ Í≤∞Í≥º Î™®Îã¨ */
    .game-result-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(10px);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.5s ease;
    }
    .game-result-card {
      background: linear-gradient(135deg, #1a0a2e, #0f172a);
      border: 2px solid rgba(34,211,238,0.3);
      border-radius: 24px;
      padding: 2rem;
      width: 90%;
      max-width: 360px;
      text-align: center;
      animation: slideUp 0.5s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .game-result-grade {
      font-size: 6rem;
      font-weight: 900;
      line-height: 1;
      margin: 0.5rem 0;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .grade-S { background: linear-gradient(135deg, #fbbf24, #ef4444, #ec4899); -webkit-background-clip: text; animation: gradeGlow 1s infinite alternate; }
    .grade-A { background: linear-gradient(135deg, #fbbf24, #f97316); -webkit-background-clip: text; }
    .grade-B { background: linear-gradient(135deg, #a855f7, #6366f1); -webkit-background-clip: text; }
    .grade-C { background: linear-gradient(135deg, #22d3ee, #3b82f6); -webkit-background-clip: text; }
    .grade-D { background: linear-gradient(135deg, #9ca3af, #6b7280); -webkit-background-clip: text; }
    @keyframes gradeGlow {
      from { filter: brightness(1) drop-shadow(0 0 10px rgba(251,191,36,0.5)); }
      to { filter: brightness(1.3) drop-shadow(0 0 30px rgba(251,191,36,0.8)); }
    }
    .game-result-score {
      font-size: 2.5rem;
      font-weight: bold;
      color: #22d3ee;
      text-shadow: 0 0 15px rgba(34,211,238,0.5);
    }
    .game-result-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      margin: 1rem 0;
    }
    .result-stat {
      background: rgba(34,211,238,0.1);
      border-radius: 12px;
      padding: 0.6rem;
    }
    .result-stat-label { font-size: 0.75rem; color: #94a3b8; }
    .result-stat-value { font-size: 1.2rem; font-weight: bold; color: #e2e8f0; }
    .game-result-rarity-bar {
      display: flex;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 0.8rem 0;
    }
    .rarity-segment { transition: width 0.5s ease; }

    @keyframes screenFlash {
      from { opacity: 1; } to { opacity: 0; }
    }
    @keyframes catchPopup {
      0% { transform: translate(-50%, 0) scale(0.5); opacity: 0; }
      20% { transform: translate(-50%, -20px) scale(1.2); opacity: 1; }
      40% { transform: translate(-50%, -30px) scale(1); opacity: 1; }
      100% { transform: translate(-50%, -80px) scale(0.8); opacity: 0; }
    }

    .coupon-card {
      background: rgba(26, 10, 46, 0.5);
      border-left: 4px solid;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .coupon-card:hover {
      transform: translateX(10px);
      box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
    }
    
    .coupon-card.common { border-color: #888888; }
    .coupon-card.rare { border-color: #4a9eff; }
    .coupon-card.epic { border-color: #a855f7; }
    .coupon-card.legendary { border-color: #fbbf24; }
    .coupon-card.mythic { border-color: #ff0000; }
    
    .rarity-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 12px;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.8rem;
      display: inline-block;
      margin-right: 0.5rem;
    }
    
    .rarity-badge.common { background: #888888; }
    .rarity-badge.rare { background: #4a9eff; }
    .rarity-badge.epic { background: #a855f7; }
    .rarity-badge.legendary { background: #fbbf24; color: #000; }
    .rarity-badge.mythic { background: #ff0000; }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active { display: flex; }
    
    .modal-content {
      background: rgba(26, 10, 46, 0.95);
      border: 2px solid rgba(168, 85, 247, 0.5);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    @keyframes rabbitJump {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-20px) scale(1.1); }
    }
    
    .rabbit-animation {
      animation: rabbitJump 0.6s ease-in-out;
    }

    @media (max-width: 768px) {
      nav { flex-direction: column; padding: 0.5rem; }
      .game-hud { gap: 1rem; }
      .hud-item { padding: 0.8rem 1rem; min-width: 80px; }
      .hud-value { font-size: 1.5rem; }
    }

    /* ===== üî• ÎåÄÍ∏∞ÏóÖÍ∏â UX ÏóÖÍ∑∏Î†àÏù¥Îìú ===== */

    /* ÌïòÎã® ÌÉ≠Î∞î (Î∞∞ÎØº/ÌÜ†Ïä§/Ïø†Ìå° Ïä§ÌÉÄÏùº) */
    .bottom-tab-bar {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 3000;
      background: rgba(10, 10, 20, 0.95);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(168, 85, 247, 0.2);
      display: flex; justify-content: space-around; align-items: center;
      padding: 6px 0 max(6px, env(safe-area-inset-bottom));
      height: 64px;
    }
    .tab-item {
      display: flex; flex-direction: column; align-items: center;
      gap: 2px; cursor: pointer; padding: 4px 12px;
      transition: all 0.2s ease; position: relative;
      -webkit-tap-highlight-color: transparent;
    }
    .tab-item .tab-icon { font-size: 22px; transition: transform 0.2s; }
    .tab-item .tab-label { font-size: 10px; color: #888; font-weight: 600; transition: color 0.2s; }
    .tab-item.active .tab-icon { transform: scale(1.15); }
    .tab-item.active .tab-label { color: #a855f7; }
    .tab-item .tab-badge {
      position: absolute; top: 0; right: 4px;
      background: #ef4444; color: white; font-size: 9px; font-weight: 800;
      min-width: 16px; height: 16px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      padding: 0 4px; line-height: 1;
    }
    .tab-item .tab-dot {
      position: absolute; top: 4px; right: 10px;
      width: 7px; height: 7px; background: #ef4444; border-radius: 50%;
      animation: tabDotPulse 2s infinite;
    }
    @keyframes tabDotPulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

    /* Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© (Î∞∞ÎØº/Ïø†Ìå° Ïä§ÌÉÄÏùº) */
    .skeleton { background: linear-gradient(90deg, #1a1a2e 25%, #252545 50%, #1a1a2e 75%); background-size: 200% 100%; animation: skeletonShimmer 1.5s infinite; border-radius: 8px; }
    @keyframes skeletonShimmer { 0%{background-position:200% 0;} 100%{background-position:-200% 0;} }

    /* ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º (ÌÜ†Ïä§ Ïä§ÌÉÄÏùº) */
    .toast-container {
      position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
      z-index: 5000; display: flex; flex-direction: column; gap: 8px;
      pointer-events: none; width: 90%; max-width: 380px;
    }
    .toast {
      background: rgba(30, 30, 50, 0.95); backdrop-filter: blur(20px);
      border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px;
      padding: 12px 16px; display: flex; align-items: center; gap: 10px;
      animation: toastSlideUp 0.3s ease, toastFadeOut 0.3s ease 2.7s forwards;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4); pointer-events: auto;
    }
    .toast-icon { font-size: 20px; flex-shrink: 0; }
    .toast-text { font-size: 13px; color: #e0e0e0; flex: 1; }
    @keyframes toastSlideUp { from{transform:translateY(20px);opacity:0;} to{transform:translateY(0);opacity:1;} }
    @keyframes toastFadeOut { to{transform:translateY(-10px);opacity:0;} }

    /* Ïò®Î≥¥Îî© Î™®Îã¨ */
    .onboarding-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.92); z-index: 10000;
      display: flex; align-items: center; justify-content: center;
    }
    .onboarding-card {
      width: 90%; max-width: 380px; text-align: center; padding: 40px 24px;
      background: linear-gradient(180deg, rgba(26,10,46,0.98), rgba(10,10,30,0.98));
      border: 1px solid rgba(168,85,247,0.3); border-radius: 24px;
    }
    .onboarding-dots { display: flex; gap: 8px; justify-content: center; margin-top: 24px; }
    .onboarding-dots .dot { width: 8px; height: 8px; border-radius: 4px; background: #444; transition: all 0.3s; }
    .onboarding-dots .dot.active { width: 24px; background: linear-gradient(135deg,#a855f7,#22d3ee); }

    /* Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏ */
    .order-timeline { padding: 0; list-style: none; }
    .order-timeline li {
      position: relative; padding: 0 0 24px 36px;
      border-left: 2px solid #333;
    }
    .order-timeline li:last-child { border-left-color: transparent; padding-bottom: 0; }
    .order-timeline li::before {
      content: ''; position: absolute; left: -7px; top: 2px;
      width: 12px; height: 12px; border-radius: 50%;
      background: #333; border: 2px solid #1a1a2e;
    }
    .order-timeline li.completed { border-left-color: #22c55e; }
    .order-timeline li.completed::before { background: #22c55e; }
    .order-timeline li.current::before { background: #a855f7; box-shadow: 0 0 12px rgba(168,85,247,0.5); animation: timelinePulse 2s infinite; }
    @keyframes timelinePulse { 0%,100%{box-shadow:0 0 8px rgba(168,85,247,0.4);} 50%{box-shadow:0 0 20px rgba(168,85,247,0.8);} }

    /* contentÏóê ÌïòÎã® ÌÉ≠Î∞î ÎÜíÏù¥ÎßåÌÅº Ìå®Îî© */
    .content { padding-bottom: 80px !important; }
  </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0px}.bottom-2{bottom:0.5rem}.left-2{left:0.5rem}.right-2{right:0.5rem}.top-2{top:0.5rem}.left-3{left:0.75rem}.top-1\/2{top:50%}.top-0{top:0px}.left-1{left:0.25rem}.top-1{top:0.25rem}.right-4{right:1rem}.top-4{top:1rem}.z-10{z-index:10}.z-\[9999\]{z-index:9999}.z-\[10000\]{z-index:10000}.mx-auto{margin-left:auto;margin-right:auto}.mx-2{margin-left:0.5rem;margin-right:0.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.my-2{margin-top:0.5rem;margin-bottom:0.5rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mb-1{margin-bottom:0.25rem}.mb-3{margin-bottom:0.75rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-3{margin-top:0.75rem}.ml-1{margin-left:0.25rem}.ml-2{margin-left:0.5rem}.ml-auto{margin-left:auto}.mt-8{margin-top:2rem}.mb-5{margin-bottom:1.25rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.aspect-video{aspect-ratio:16 / 9}.h-full{height:100%}.h-1{height:0.25rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-4{height:1rem}.h-48{height:12rem}.h-5{height:1.25rem}.h-8{height:2rem}.h-0\.5{height:0.125rem}.h-16{height:4rem}.h-\[250px\]{height:250px}.h-1\.5{height:0.375rem}.h-20{height:5rem}.max-h-\[300px\]{max-height:300px}.max-h-32{max-height:8rem}.max-h-\[90vh\]{max-height:90vh}.min-h-screen{min-height:100vh}.min-h-\[100px\]{min-height:100px}.min-h-\[120px\]{min-height:120px}.w-full{width:100%}.w-10{width:2.5rem}.w-32{width:8rem}.w-12{width:3rem}.w-5{width:1.25rem}.w-8{width:2rem}.w-16{width:4rem}.w-20{width:5rem}.min-w-\[200px\]{min-width:200px}.min-w-0{min-width:0px}.max-w-4xl{max-width:56rem}.max-w-6xl{max-width:72rem}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-7xl{max-width:80rem}.max-w-md{max-width:28rem}.max-w-lg{max-width:32rem}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.-translate-y-1\/2{--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.resize-y{resize:vertical}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-1{gap:0.25rem}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.space-y-1 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.25rem * var(--tw-space-y-reverse))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.rounded{border-radius:0.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.rounded-2xl{border-radius:1rem}.border{border-width:1px}.border-2{border-width:2px}.border-t{border-top-width:1px}.border-b{border-bottom-width:1px}.border-dashed{border-style:dashed}.border-gray-700{--tw-border-opacity:1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.border-cyan-500{--tw-border-opacity:1;border-color:rgb(6 182 212 / var(--tw-border-opacity, 1))}.border-cyan-500\/30{border-color:rgb(6 182 212 / 0.3)}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-pink-500\/30{border-color:rgb(236 72 153 / 0.3)}.border-purple-500\/30{border-color:rgb(168 85 247 / 0.3)}.border-yellow-500\/30{border-color:rgb(234 179 8 / 0.3)}.border-blue-500{--tw-border-opacity:1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-gray-700\/50{border-color:rgb(55 65 81 / 0.5)}.border-green-400{--tw-border-opacity:1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity:1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-green-500\/30{border-color:rgb(34 197 94 / 0.3)}.border-pink-400{--tw-border-opacity:1;border-color:rgb(244 114 182 / var(--tw-border-opacity, 1))}.border-pink-500{--tw-border-opacity:1;border-color:rgb(236 72 153 / var(--tw-border-opacity, 1))}.border-red-500{--tw-border-opacity:1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1))}.border-red-500\/30{border-color:rgb(239 68 68 / 0.3)}.border-transparent{border-color:transparent}.border-yellow-500{--tw-border-opacity:1;border-color:rgb(234 179 8 / var(--tw-border-opacity, 1))}.border-cyan-500\/50{border-color:rgb(6 182 212 / 0.5)}.border-purple-500\/50{border-color:rgb(168 85 247 / 0.5)}.border-orange-500\/30{border-color:rgb(249 115 22 / 0.3)}.border-cyan-400\/30{border-color:rgb(34 211 238 / 0.3)}.border-gray-800{--tw-border-opacity:1;border-color:rgb(31 41 55 / var(--tw-border-opacity, 1))}.bg-cyan-600{--tw-bg-opacity:1;background-color:rgb(8 145 178 / var(--tw-bg-opacity, 1))}.bg-gray-700\/50{background-color:rgb(55 65 81 / 0.5)}.bg-gray-800\/50{background-color:rgb(31 41 55 / 0.5)}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-blue-500\/20{background-color:rgb(59 130 246 / 0.2)}.bg-cyan-500{--tw-bg-opacity:1;background-color:rgb(6 182 212 / var(--tw-bg-opacity, 1))}.bg-cyan-500\/10{background-color:rgb(6 182 212 / 0.1)}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-green-500\/20{background-color:rgb(34 197 94 / 0.2)}.bg-pink-500\/10{background-color:rgb(236 72 153 / 0.1)}.bg-purple-500{--tw-bg-opacity:1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-500\/10{background-color:rgb(168 85 247 / 0.1)}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-yellow-500\/10{background-color:rgb(234 179 8 / 0.1)}.bg-yellow-500\/20{background-color:rgb(234 179 8 / 0.2)}.bg-black\/30{background-color:rgb(0 0 0 / 0.3)}.bg-cyan-500\/20{background-color:rgb(6 182 212 / 0.2)}.bg-gray-500\/10{background-color:rgb(107 114 128 / 0.1)}.bg-gray-500\/20{background-color:rgb(107 114 128 / 0.2)}.bg-gray-900\/50{background-color:rgb(17 24 39 / 0.5)}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-500\/10{background-color:rgb(34 197 94 / 0.1)}.bg-green-500\/50{background-color:rgb(34 197 94 / 0.5)}.bg-indigo-500{--tw-bg-opacity:1;background-color:rgb(99 102 241 / var(--tw-bg-opacity, 1))}.bg-orange-500\/10{background-color:rgb(249 115 22 / 0.1)}.bg-purple-500\/20{background-color:rgb(168 85 247 / 0.2)}.bg-red-500\/10{background-color:rgb(239 68 68 / 0.1)}.bg-red-500\/20{background-color:rgb(239 68 68 / 0.2)}.bg-red-500\/50{background-color:rgb(239 68 68 / 0.5)}.bg-white\/20{background-color:rgb(255 255 255 / 0.2)}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.bg-gray-800\/80{background-color:rgb(31 41 55 / 0.8)}.bg-orange-500\/20{background-color:rgb(249 115 22 / 0.2)}.bg-pink-500\/20{background-color:rgb(236 72 153 / 0.2)}.bg-purple-500\/30{background-color:rgb(168 85 247 / 0.3)}.bg-black\/70{background-color:rgb(0 0 0 / 0.7)}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-red-500\/90{background-color:rgb(239 68 68 / 0.9)}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gradient-to-r{background-image:linear-gradient(to right, var(--tw-gradient-stops))}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.from-cyan-500\/10{--tw-gradient-from:rgb(6 182 212 / 0.1) var(--tw-gradient-from-position);--tw-gradient-to:rgb(6 182 212 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500{--tw-gradient-from:#a855f7 var(--tw-gradient-from-position);--tw-gradient-to:rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-cyan-500{--tw-gradient-from:#06b6d4 var(--tw-gradient-from-position);--tw-gradient-to:rgb(6 182 212 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-cyan-500\/20{--tw-gradient-from:rgb(6 182 212 / 0.2) var(--tw-gradient-from-position);--tw-gradient-to:rgb(6 182 212 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-green-500\/10{--tw-gradient-from:rgb(34 197 94 / 0.1) var(--tw-gradient-from-position);--tw-gradient-to:rgb(34 197 94 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-green-500\/20{--tw-gradient-from:rgb(34 197 94 / 0.2) var(--tw-gradient-from-position);--tw-gradient-to:rgb(34 197 94 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-pink-500\/20{--tw-gradient-from:rgb(236 72 153 / 0.2) var(--tw-gradient-from-position);--tw-gradient-to:rgb(236 72 153 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500\/10{--tw-gradient-from:rgb(168 85 247 / 0.1) var(--tw-gradient-from-position);--tw-gradient-to:rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-500\/20{--tw-gradient-from:rgb(168 85 247 / 0.2) var(--tw-gradient-from-position);--tw-gradient-to:rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-red-500\/20{--tw-gradient-from:rgb(239 68 68 / 0.2) var(--tw-gradient-from-position);--tw-gradient-to:rgb(239 68 68 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-yellow-400{--tw-gradient-from:#facc15 var(--tw-gradient-from-position);--tw-gradient-to:rgb(250 204 21 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-yellow-500\/20{--tw-gradient-from:rgb(234 179 8 / 0.2) var(--tw-gradient-from-position);--tw-gradient-to:rgb(234 179 8 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-600{--tw-gradient-from:#9333ea var(--tw-gradient-from-position);--tw-gradient-to:rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-900\/60{--tw-gradient-from:rgb(88 28 135 / 0.6) var(--tw-gradient-from-position);--tw-gradient-to:rgb(88 28 135 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.to-pink-500{--tw-gradient-to:#ec4899 var(--tw-gradient-to-position)}.to-purple-500\/10{--tw-gradient-to:rgb(168 85 247 / 0.1) var(--tw-gradient-to-position)}.to-blue-500\/20{--tw-gradient-to:rgb(59 130 246 / 0.2) var(--tw-gradient-to-position)}.to-cyan-500\/10{--tw-gradient-to:rgb(6 182 212 / 0.1) var(--tw-gradient-to-position)}.to-cyan-600\/10{--tw-gradient-to:rgb(8 145 178 / 0.1) var(--tw-gradient-to-position)}.to-emerald-500\/10{--tw-gradient-to:rgb(16 185 129 / 0.1) var(--tw-gradient-to-position)}.to-emerald-500\/20{--tw-gradient-to:rgb(16 185 129 / 0.2) var(--tw-gradient-to-position)}.to-green-600\/10{--tw-gradient-to:rgb(22 163 74 / 0.1) var(--tw-gradient-to-position)}.to-orange-500{--tw-gradient-to:#f97316 var(--tw-gradient-to-position)}.to-orange-500\/20{--tw-gradient-to:rgb(249 115 22 / 0.2) var(--tw-gradient-to-position)}.to-pink-500\/20{--tw-gradient-to:rgb(236 72 153 / 0.2) var(--tw-gradient-to-position)}.to-pink-600\/10{--tw-gradient-to:rgb(219 39 119 / 0.1) var(--tw-gradient-to-position)}.to-purple-500{--tw-gradient-to:#a855f7 var(--tw-gradient-to-position)}.to-purple-600\/10{--tw-gradient-to:rgb(147 51 234 / 0.1) var(--tw-gradient-to-position)}.to-blue-900\/60{--tw-gradient-to:rgb(30 58 138 / 0.6) var(--tw-gradient-to-position)}.to-cyan-500{--tw-gradient-to:#06b6d4 var(--tw-gradient-to-position)}.to-blue-500{--tw-gradient-to:#3b82f6 var(--tw-gradient-to-position)}.object-cover{object-fit:cover}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-2{padding:0.5rem}.p-8{padding:2rem}.p-5{padding:1.25rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-20{padding-top:5rem;padding-bottom:5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-12{padding-left:3rem;padding-right:3rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\.5{padding-top:0.125rem;padding-bottom:0.125rem}.py-1\.5{padding-top:0.375rem;padding-bottom:0.375rem}.py-8{padding-top:2rem;padding-bottom:2rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-2\.5{padding-top:0.625rem;padding-bottom:0.625rem}.px-1\.5{padding-left:0.375rem;padding-right:0.375rem}.pt-4{padding-top:1rem}.pb-4{padding-bottom:1rem}.pt-3{padding-top:0.75rem}.pl-10{padding-left:2.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-6xl{font-size:3.75rem;line-height:1}.text-8xl{font-size:6rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-5xl{font-size:3rem;line-height:1}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.text-cyan-400{--tw-text-opacity:1;color:rgb(34 211 238 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-purple-400{--tw-text-opacity:1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity:1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-400{--tw-text-opacity:1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.text-amber-400{--tw-text-opacity:1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.text-green-300{--tw-text-opacity:1;color:rgb(134 239 172 / var(--tw-text-opacity, 1))}.text-indigo-400{--tw-text-opacity:1;color:rgb(129 140 248 / var(--tw-text-opacity, 1))}.text-orange-400{--tw-text-opacity:1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.text-pink-400{--tw-text-opacity:1;color:rgb(244 114 182 / var(--tw-text-opacity, 1))}.text-purple-300{--tw-text-opacity:1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.text-yellow-300{--tw-text-opacity:1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-green-200{--tw-text-opacity:1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.accent-purple-500{accent-color:#a855f7}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.drop-shadow-lg{--tw-drop-shadow:drop-shadow(0 10px 8px rgb(0 0 0 / 0.04)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-500{transition-duration:500ms}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:scale-110:hover{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-purple-500:hover{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.hover\:border-white:hover{--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.hover\:border-purple-400:hover{--tw-border-opacity:1;border-color:rgb(192 132 252 / var(--tw-border-opacity, 1))}.hover\:border-purple-500\/50:hover{border-color:rgb(168 85 247 / 0.5)}.hover\:bg-purple-600\/30:hover{background-color:rgb(147 51 234 / 0.3)}.hover\:bg-cyan-600:hover{--tw-bg-opacity:1;background-color:rgb(8 145 178 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-600:hover{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600:hover{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-cyan-700:hover{--tw-bg-opacity:1;background-color:rgb(14 116 144 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-800:hover{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500:hover{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600:hover{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-600:hover{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500\/20:hover{background-color:rgb(168 85 247 / 0.2)}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-red-500:hover{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.hover\:bg-red-500\/40:hover{background-color:rgb(239 68 68 / 0.4)}.hover\:text-cyan-300:hover{--tw-text-opacity:1;color:rgb(103 232 249 / var(--tw-text-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:text-red-300:hover{--tw-text-opacity:1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.hover\:text-purple-300:hover{--tw-text-opacity:1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.hover\:text-red-400:hover{--tw-text-opacity:1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.hover\:underline:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.hover\:opacity-90:hover{opacity:0.9}.focus\:border-cyan-400:focus{--tw-border-opacity:1;border-color:rgb(34 211 238 / var(--tw-border-opacity, 1))}.focus\:border-purple-500:focus{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-cyan-400\/20:focus{--tw-ring-color:rgb(34 211 238 / 0.2)}.focus\:ring-cyan-400\/50:focus{--tw-ring-color:rgb(34 211 238 / 0.5)}.focus\:ring-purple-400\/50:focus{--tw-ring-color:rgb(192 132 252 / 0.5)}.focus\:ring-pink-400\/50:focus{--tw-ring-color:rgb(244 114 182 / 0.5)}@media (min-width: 768px){.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\:text-8xl{font-size:6rem;line-height:1}}@media (min-width: 1024px){.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}</style><style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;color:#202124;direction:ltr;-webkit-touch-callout:none;font-family:"Roboto-Regular",arial,sans-serif;-webkit-font-smoothing:antialiased;font-weight:400;margin:0;overflow:hidden;-webkit-text-size-adjust:100%}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{overflow-wrap:break-word;word-break:break-word}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-u2z5K{height:36px;width:36px}.Bz112c-uaxL4e{border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf{border:none;margin:0;padding:0}.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u{-webkit-transition:height linear .2s;transition:height linear .2s}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important;-webkit-transition:width linear .3s;transition:width linear .3s}.P1ekSe-ZMv3u>div:nth-child(2){background-image:-webkit-gradient(linear,left top,right top,from(rgba(255,255,255,.7)),to(rgba(255,255,255,.7))),-webkit-gradient(linear,left top,right top,from(#1a73e8),to(#1a73e8))!important;background-image:-webkit-linear-gradient(left,rgba(255,255,255,.7),rgba(255,255,255,.7)),-webkit-linear-gradient(left,#1a73e8,#1a73e8)!important;background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.P1ekSe-ZMv3u>div:nth-child(3){background-image:-webkit-gradient(linear,left top,right top,from(rgba(255,255,255,.7)),to(rgba(255,255,255,.7))),-webkit-gradient(linear,left top,right top,from(#1a73e8),to(#1a73e8))!important;background-image:-webkit-linear-gradient(left,rgba(255,255,255,.7),rgba(255,255,255,.7)),-webkit-linear-gradient(left,#1a73e8,#1a73e8)!important;background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;-webkit-transition:background-color .218s,border-color .218s;transition:background-color .218s,border-color .218s;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;-webkit-appearance:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}@media screen and (preferes-contrast:more){.nsm7Bb-HzV7m-LgbsSe{color:#000}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{color:#fff}}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;-webkit-box-align:center;align-items:center;-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:1;-webkit-box-flex:1;flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:0;-webkit-box-flex:0;flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{-webkit-transition:background-color .218s;transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:rgb(210,227,252);outline:none}.nsm7Bb-HzV7m-LgbsSe:focus-within{outline:2px solid #00639b;border-color:transparent}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.08)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;-webkit-box-align:center;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff,.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#000;fill:#000}}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><style id="claude-agent-animation-styles">
      @keyframes claude-pulse {
        0% {
          box-shadow: 
            inset 0 0 10px rgba(217, 119, 87, 0.5),
            inset 0 0 20px rgba(217, 119, 87, 0.3),
            inset 0 0 30px rgba(217, 119, 87, 0.1);
        }
        50% {
          box-shadow: 
            inset 0 0 15px rgba(217, 119, 87, 0.7),
            inset 0 0 25px rgba(217, 119, 87, 0.5),
            inset 0 0 35px rgba(217, 119, 87, 0.2);
        }
        100% {
          box-shadow: 
            inset 0 0 10px rgba(217, 119, 87, 0.5),
            inset 0 0 20px rgba(217, 119, 87, 0.3),
            inset 0 0 30px rgba(217, 119, 87, 0.1);
        }
      }
    </style><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script></head>
<body class="grid-bg">
  <nav>
    <div class="nav-left">
      <a href="#" onclick="event.preventDefault(); showPage('home')">üè† Ìôà</a>
      <a href="#" onclick="event.preventDefault(); showPage('wallet')">üí∞ Ïø†Ìè∞ ÏßÄÍ∞ë</a>
      <a href="#" onclick="event.preventDefault(); showPage('business')">üíº ÏÇ¨ÏóÖÏûê</a>
      <a href="#" onclick="event.preventDefault(); showPage('market')" style="color:#22d3ee;">‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞</a>
      <a href="#" onclick="event.preventDefault(); showPage('store-builder')">üé® Îß§Ïû•Íæ∏ÎØ∏Í∏∞</a>
      <a href="#" onclick="event.preventDefault(); showPage('admin')">üîê Í¥ÄÎ¶¨Ïûê</a>
      <a href="#" onclick="event.preventDefault(); startGame()">üéÆ Í≤åÏûÑ</a>
    </div>
    <div id="nav-user">
          <div class="user-info">
            <div class="user-avatar">üë§</div>
            <span>Ïπ¥Ïπ¥Ïò§ÏÇ¨Ïö©Ïûê</span>
            <button onclick="event.preventDefault(); logout()" class="text-red-400 hover:text-red-300">Î°úÍ∑∏ÏïÑÏõÉ</button>
          </div>
        </div>
  </nav>

  <!-- ‚ïê‚ïê‚ïê ÌïòÎã® ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò (Î∞∞ÎØº/ÌÜ†Ïä§ Ïä§ÌÉÄÏùº) ‚ïê‚ïê‚ïê -->
  <div class="bottom-tab-bar" id="bottom-tab-bar">
    <div class="tab-item active" data-tab="home" onclick="switchTab('home')">
      <span class="tab-icon">üè†</span>
      <span class="tab-label">Ìôà</span>
    </div>
    <div class="tab-item" data-tab="game" onclick="switchTab('game')">
      <span class="tab-icon">üéÆ</span>
      <span class="tab-label">Í≤åÏûÑ</span>
      <span class="tab-dot" id="tab-dot-game"></span>
    </div>
    <div class="tab-item" data-tab="market" onclick="switchTab('market')">
      <span class="tab-icon">‚òÅÔ∏è</span>
      <span class="tab-label">Ïû•ÌÑ∞</span>
      <span class="tab-badge" id="tab-badge-market" style="display:none;">0</span>
    </div>
    <div class="tab-item" data-tab="wallet" onclick="switchTab('wallet')">
      <span class="tab-icon">üí∞</span>
      <span class="tab-label">ÏßÄÍ∞ë</span>
      <span class="tab-badge" id="tab-badge-wallet" style="display:none;">0</span>
    </div>
    <div class="tab-item" data-tab="my" onclick="switchTab('my')">
      <span class="tab-icon">üë§</span>
      <span class="tab-label">My</span>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º Ïª®ÌÖåÏù¥ÎÑà ‚ïê‚ïê‚ïê -->
  <div class="toast-container" id="toast-container"></div>

  <!-- ‚ïê‚ïê‚ïê Ïò®Î≥¥Îî© Ï∫êÎü¨ÏÖÄ (Ï≤´ Î∞©Î¨∏ ÌäúÌÜ†Î¶¨Ïñº) ‚ïê‚ïê‚ïê -->
  <div class="onboarding-overlay" id="onboarding-overlay" style="display:none;">
    <div class="onboarding-card">
      <button onclick="closeOnboarding()" style="position:absolute;top:12px;right:16px;background:none;border:none;color:#888;font-size:20px;cursor:pointer;">‚úï</button>
      <div id="onboarding-slide" class="text-center">
        <!-- slide content injected by JS -->
      </div>
      <div class="onboarding-dots" id="onboarding-dots"></div>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:16px;">
        <button id="onboarding-prev" onclick="onboardingPrev()" style="padding:8px 20px;border-radius:8px;border:1px solid #444;background:transparent;color:#ccc;font-size:13px;cursor:pointer;">Ïù¥Ï†Ñ</button>
        <button id="onboarding-next" onclick="onboardingNext()" style="padding:8px 28px;border-radius:8px;border:none;background:linear-gradient(135deg,#a855f7,#06b6d4);color:white;font-size:13px;font-weight:700;cursor:pointer;">Îã§Ïùå</button>
      </div>
    </div>
  </div>

  <canvas id="canvas-3d" width="921" height="803" style="width: 983px; height: 857px;"></canvas>

  <div class="content" style="padding-top: 60px;">
    
    <!-- Ìôà ÌéòÏù¥ÏßÄ -->
    <div id="home-page" class="page">
      <section class="min-h-screen flex items-center justify-center px-4">
        <div class="text-center max-w-4xl mx-auto">
          <div class="mb-8">
            <span id="rabbit-emoji" class="text-8xl filter drop-shadow-lg">üê∞</span>
          </div>
          <h1 class="text-6xl md:text-8xl font-black mb-6 neon-text">AIRCTT</h1>
          <p class="text-2xl md:text-3xl mb-4 gradient-text font-bold">AI Reality CouponTalkTalk</p>
          <p class="text-xl mb-8 text-gray-300">Ïà´ÏûêÍ∞Ä ÏïÑÎãå ÏÇ¨ÎûåÏùÑ ÏßÄÌÇ§Îäî Î©îÌÉÄÎ≤ÑÏä§ Í≤ΩÏ†ú OS</p>
          <div class="flex gap-4 justify-center flex-wrap">
            <button onclick="startGame()" class="btn-primary">üéÆ 3D Ïø†Ìè∞ Í≤åÏûÑ</button>
            <button onclick="showPage('store')" class="btn-primary">üçΩÔ∏è Ï£ºÎ¨∏ÌïòÍ∏∞</button>
            <button onclick="showPage('wallet')" class="btn-primary">üí∞ Ïø†Ìè∞ ÏßÄÍ∞ë</button>
            <button onclick="showPage('market')" class="btn-primary" style="background:linear-gradient(135deg,#22d3ee,#a855f7);">‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞</button>
          </div>
          <!-- ÎåÄÍ∏∞ÏóÖ ÎπÑÍµêÌëú Î≤ÑÌäº -->
          <div style="margin-top:20px;">
            <button onclick="showComparisonTable()" style="padding:10px 24px;background:rgba(251,191,36,0.15);border:1px solid rgba(251,191,36,0.4);border-radius:12px;color:#fbbf24;font-size:13px;font-weight:700;cursor:pointer;">üèÜ ÎåÄÍ∏∞ÏóÖ ÎπÑÍµêÌëú Î≥¥Í∏∞ (Î∞∞ÎØº/Ïø†Ìå°/ÌÜ†Ïä§/ÎãπÍ∑º/ÎÑ§Ïù¥Î≤Ñ)</button>
          </div>
        </div>
      </section>
    </div>

    <!-- ÏïÑÎØ∏ ÌïúÏ†ïÏãù Ïä§ÌÜ†Ïñ¥ -->
    <div id="store-page" class="page">
      <div class="max-w-6xl mx-auto px-4 py-20">
        <div class="card glow-border mb-8">
          <div class="flex items-center gap-6">
            <div class="text-6xl">üç±</div>
            <div class="flex-1">
              <h2 class="text-4xl font-black gradient-text mb-2">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</h2>
              <p class="text-gray-400 mb-2">üìç ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123</p>
              <p class="text-gray-400">‚≠ê 4.8 (1,234Í∞ú) | üöö Î∞∞Îã¨ 30-40Î∂Ñ</p>
              <div class="flex gap-2 mt-4">
                <span class="px-3 py-1 bg-purple-600 rounded-full text-sm">ÌïúÏ†ïÏãù</span>
                <span class="px-3 py-1 bg-cyan-600 rounded-full text-sm">Î¨¥Î£åÎ∞∞Îã¨</span>
                <span class="px-3 py-1 bg-green-600 rounded-full text-sm">Ïø†Ìè∞ÏÇ¨Ïö©Í∞ÄÎä•</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card glow-border mb-8">
          <h3 class="text-2xl font-bold mb-4">üí∞ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïø†Ìè∞</h3>
          <div id="available-coupons-list">
            <p class="text-gray-400">Ïø†Ìè∞ÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Ìï†Ïù∏Ïù¥ Ï†ÅÏö©Îê©ÎãàÎã§</p>
          </div>
        </div>

        <div class="card glow-border mb-8">
          <h3 class="text-2xl font-bold mb-6">üìã Î©îÎâ¥</h3>
          <div id="menu-list" class="grid md:grid-cols-2 gap-4"></div>
        </div>

        <div class="card glow-border mb-8">
          <h3 class="text-2xl font-bold mb-4">üõí Ï£ºÎ¨∏ ÏòµÏÖò</h3>
          <div class="flex gap-4 mb-6">
            <button onclick="setOrderType('delivery')" id="btn-delivery" class="btn-primary flex-1">üöö Î∞∞Îã¨</button>
            <button onclick="setOrderType('pickup')" id="btn-pickup" class="btn-primary flex-1">üèÉ Ìè¨Ïû•</button>
            <button onclick="setOrderType('reservation')" id="btn-reservation" class="btn-primary flex-1">üìÖ ÏòàÏïΩ</button>
          </div>
          
          <div id="delivery-form" style="display:none;">
            <div class="mb-4">
              <label class="block mb-2">Î∞∞Îã¨ Ï£ºÏÜå</label>
              <input type="text" id="delivery-address" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨...">
            </div>
            <div class="mb-4">
              <label class="block mb-2">Ï†ÑÌôîÎ≤àÌò∏</label>
              <input type="tel" id="delivery-phone" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="010-1234-5678">
            </div>
            <div class="mb-4">
              <label class="block mb-2">ÏöîÏ≤≠ÏÇ¨Ìï≠</label>
              <textarea id="delivery-request" class="w-full p-3 rounded bg-gray-900 border border-purple-500" rows="3" placeholder="Î¨∏ ÏïûÏóê ÎÜìÏïÑÏ£ºÏÑ∏Ïöî"></textarea>
            </div>
          </div>

          <div id="pickup-form" style="display:none;">
            <div class="mb-4">
              <label class="block mb-2">ÌîΩÏóÖ ÏãúÍ∞Ñ</label>
              <input type="time" id="pickup-time" class="w-full p-3 rounded bg-gray-900 border border-purple-500">
            </div>
            <div class="mb-4">
              <label class="block mb-2">Ï†ÑÌôîÎ≤àÌò∏</label>
              <input type="tel" id="pickup-phone" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="010-1234-5678">
            </div>
          </div>

          <div id="reservation-form" style="display:none;">
            <div class="mb-4">
              <label class="block mb-2">ÏòàÏïΩ ÎÇ†Ïßú</label>
              <input type="date" id="reservation-date" class="w-full p-3 rounded bg-gray-900 border border-purple-500">
            </div>
            <div class="mb-4">
              <label class="block mb-2">ÏòàÏïΩ ÏãúÍ∞Ñ</label>
              <input type="time" id="reservation-time" class="w-full p-3 rounded bg-gray-900 border border-purple-500">
            </div>
            <div class="mb-4">
              <label class="block mb-2">Ïù∏ÏõêÏàò</label>
              <input type="number" id="reservation-people" class="w-full p-3 rounded bg-gray-900 border border-purple-500" min="1" value="2">
            </div>
            <div class="mb-4">
              <label class="block mb-2">Ï†ÑÌôîÎ≤àÌò∏</label>
              <input type="tel" id="reservation-phone" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="010-1234-5678">
            </div>
          </div>
        </div>

        <div id="checkout-section" class="card glow-border">
          <h3 class="text-2xl font-bold mb-4">üßæ Ï£ºÎ¨∏ ÏöîÏïΩ</h3>
          <div id="cart-summary">
            <p class="text-gray-400">Î©îÎâ¥Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</p>
          </div>
          <div class="border-t border-gray-700 mt-4 pt-4">
            <div class="flex justify-between mb-2">
              <span>Ï£ºÎ¨∏Í∏àÏï°</span>
              <span id="subtotal">‚Ç©0</span>
            </div>
            <div class="flex justify-between mb-2 text-cyan-400">
              <span>Ïø†Ìè∞Ìï†Ïù∏</span>
              <span id="discount">-‚Ç©0</span>
            </div>
            <div class="flex justify-between mb-2">
              <span>Î∞∞Îã¨Î£å</span>
              <span id="delivery-fee">‚Ç©0</span>
            </div>
            <div class="flex justify-between text-2xl font-bold text-purple-400 mt-4">
              <span>Ï¥ù Í≤∞Ï†úÍ∏àÏï°</span>
              <span id="total">‚Ç©0</span>
            </div>
          </div>
          
          <!-- üí≥ Í≤∞Ï†ú ÏàòÎã® ÏÑ†ÌÉù -->
          <div class="mt-6 p-4 bg-gray-800/50 rounded-lg">
            <h4 class="text-lg font-bold mb-4">üí≥ Í≤∞Ï†ú ÏàòÎã®</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <label class="flex items-center gap-2 p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-purple-600/30 transition">
                <input type="radio" name="payment-method" value="card" checked="" class="accent-purple-500">
                <span>üí≥ Ïπ¥Îìú</span>
              </label>
              <label class="flex items-center gap-2 p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-purple-600/30 transition">
                <input type="radio" name="payment-method" value="cash" class="accent-purple-500">
                <span>üíµ ÌòÑÍ∏à</span>
              </label>
              <label class="flex items-center gap-2 p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-purple-600/30 transition">
                <input type="radio" name="payment-method" value="transfer" class="accent-purple-500">
                <span>üè¶ Í≥ÑÏ¢åÏù¥Ï≤¥</span>
              </label>
              <label class="flex items-center gap-2 p-3 bg-gray-700/50 rounded-lg cursor-pointer hover:bg-purple-600/30 transition">
                <input type="radio" name="payment-method" value="kakao" class="accent-purple-500">
                <span>üü° Ïπ¥Ïπ¥Ïò§ÌéòÏù¥</span>
              </label>
            </div>
          </div>
          
          <button onclick="checkout()" class="btn-primary w-full mt-6 text-xl py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
            üí≥ Ï¶âÏãú Í≤∞Ï†úÌïòÍ∏∞ (Îß§Ïû•ÏóêÏÑú Ìï†Ïù∏ Ï†ÅÏö©)
          </button>
        </div>

        <!-- Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏ (Í≤∞Ï†ú ÌõÑ ÌëúÏãú) -->
        <div id="order-timeline-area" style="display:none;margin-top:16px;"></div>

        <!-- Î¶¨Î∑∞ ÏÑπÏÖò -->
        <div class="card glow-border mb-8" style="margin-top:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <h3 class="text-xl font-bold">‚≠ê Î¶¨Î∑∞</h3>
            <button onclick="showReviewForm('ami-hansik')" style="padding:6px 14px;background:linear-gradient(135deg,#a855f7,#06b6d4);border:none;border-radius:8px;color:white;font-size:12px;font-weight:700;cursor:pointer;">‚úçÔ∏è Î¶¨Î∑∞Ïì∞Í∏∞</button>
          </div>
          <div id="store-reviews-area"></div>
        </div>
      </div>
    </div>

    <!-- Ïø†Ìè∞ ÏßÄÍ∞ë ÌéòÏù¥ÏßÄ -->
    <div id="wallet-page" class="page">
      <div class="max-w-4xl mx-auto px-4 py-20">
        <h2 class="text-4xl font-black mb-8 gradient-text">üí∞ ÎÇ¥ Ïø†Ìè∞ ÏßÄÍ∞ë</h2>
        
        <div class="flex gap-4 mb-8 flex-wrap">
          <button onclick="filterCoupons('all')" class="btn-primary">Ï†ÑÏ≤¥</button>
          <button onclick="filterCoupons('available')" class="btn-primary">ÏÇ¨Ïö©Í∞ÄÎä•</button>
          <button onclick="filterCoupons('used')" class="btn-primary">ÏÇ¨Ïö©ÏôÑÎ£å</button>
          <button onclick="deleteAllCoupons()" class="btn-primary" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">üóëÔ∏è Î™®Îì† Ïø†Ìè∞ ÏÇ≠Ï†ú</button>
        </div>
        
        <div id="coupon-list"></div>
      </div>
    </div>

    <!-- Îß§Ïû• Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ (ÏÇ¨ÏóÖÏûê ‚Üí Îß§Ïû•ÏúºÎ°ú Î≥ÄÍ≤Ω) -->
    <div id="business-page" class="page active">
      <div class="max-w-6xl mx-auto px-4 py-20">
        <h2 class="text-4xl font-black mb-8 gradient-text">üè™ Îß§Ïû• Í¥ÄÎ¶¨</h2>
        
        <div class="flex gap-4 mb-8 flex-wrap">
          <button onclick="showBusinessTab('list')" id="btn-business-list" class="btn-primary" style="opacity: 0.6;">üìã Îß§Ïû• Î™©Î°ù</button>
          <button onclick="showBusinessTab('register')" id="btn-business-register" class="btn-primary" style="background: linear-gradient(135deg, rgb(16, 185, 129) 0%, rgb(5, 150, 105) 100%); opacity: 1;">üöÄ Îß§Ïû• ÏûÖÏ†êÌïòÍ∏∞</button>
          <button onclick="showBusinessTab('mystore')" id="btn-business-mystore" class="btn-primary" style="background: linear-gradient(135deg, rgb(6, 182, 212) 0%, rgb(8, 145, 178) 100%); opacity: 0.6;">üçΩÔ∏è ÎÇ¥ Îß§Ïû•</button>
          <button onclick="showBusinessTab('coupon-issue')" id="btn-business-coupon" class="btn-primary" style="background: linear-gradient(135deg, rgb(245, 158, 11) 0%, rgb(217, 119, 6) 100%); opacity: 0.6;">üé´ Ïø†Ìè∞ Î∞úÍ∏â</button>
          <button onclick="showBusinessTab('promo')" id="btn-business-promo" class="btn-primary" style="background: linear-gradient(135deg, rgb(236, 72, 153) 0%, rgb(219, 39, 119) 100%); opacity: 0.6;">üì∫ ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ</button>
        </div>

        <!-- Îß§Ïû• Î™©Î°ù -->
        <div id="business-list-tab" style="display: none;">
          <div class="grid md:grid-cols-3 gap-6" id="store-list-container">
            <div class="card glow-border cursor-pointer" onclick="goToStore('store-001')">
              <!-- ÌôçÎ≥¥ ÏòÅÏÉÅ ÏÑπÏÖò -->
              <div id="store-001-video" class="aspect-video bg-gray-900 rounded-lg mb-4 overflow-hidden relative">
                <iframe id="store-001-iframe" src="https://www.youtube.com/embed/vdr2KcGD23g" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" style="display: block;"></iframe>
                <div id="store-001-placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-500" style="display: none;">
                  <span class="text-4xl mb-2">üé¨</span>
                  <span class="text-sm">ÌôçÎ≥¥ ÏòÅÏÉÅ</span>
                  <button onclick="event.stopPropagation(); openVideoRegister('store-001')" class="mt-2 px-3 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">ÏòÅÏÉÅ Îì±Î°ù</button>
                </div>
              </div>
              <div class="flex items-center gap-3 mb-3">
                <div class="text-4xl">üç±</div>
                <div>
                  <h3 class="text-xl font-bold">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</h3>
                  <p class="text-gray-400 text-sm">üìç ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨</p>
                </div>
              </div>
              <p class="text-cyan-400 mb-2">‚≠ê 4.8 | Ïø†Ìè∞ 127Í∞ú</p>
              <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ÏòÅÏóÖÏ§ë</span>
            </div>
            <div class="card glow-border cursor-pointer" onclick="goToStore('store-002')">
              <div class="text-6xl mb-4">‚òï</div>
              <h3 class="text-2xl font-bold mb-2">ÏïÑÎØ∏ Îã§Î∞©</h3>
              <p class="text-gray-400 mb-2">üìç ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨</p>
              <p class="text-cyan-400">‚≠ê 4.6 | Ïø†Ìè∞ 89Í∞ú</p>
              <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ÏòÅÏóÖÏ§ë</span>
            </div>
            <div class="card glow-border cursor-pointer" onclick="goToStore('store-003')">
              <div class="text-6xl mb-4">üçó</div>
              <h3 class="text-2xl font-bold mb-2">Ìô©Í∏àÏò¨Î¶¨Î∏å ÏπòÌÇ®</h3>
              <p class="text-gray-400 mb-2">üìç ÏÑúÏö∏Ïãú ÏÜ°ÌååÍµ¨</p>
              <p class="text-cyan-400">‚≠ê 4.5 | Ïø†Ìè∞ 56Í∞ú</p>
              <span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">ÏäπÏù∏ÎåÄÍ∏∞</span>
            </div>
            <div class="card glow-border cursor-pointer" onclick="goToStore('store-004')">
              <div class="text-6xl mb-4">ü•©</div>
              <h3 class="text-2xl font-bold mb-2">ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë</h3>
              <p class="text-gray-400 mb-2">üìç ÏÑúÏö∏Ïãú Ï§ëÎûëÍµ¨</p>
              <p class="text-cyan-400">‚≠ê 4.7 | Ïø†Ìè∞ 45Í∞ú</p>
              <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ÏòÅÏóÖÏ§ë</span>
            </div>

            <!-- üï∂Ô∏è ROUNZ ÏïàÍ≤ΩÏ†ê - Ïô∏Î∂Ä ÏûÖÏ†ê Îß§Ïû• + AR Ï≤¥Ìóò -->
            <div class="card glow-border relative overflow-hidden" style="border-color: #ec4899;">
              <!-- ÏûÖÏ†ê Î∞∞ÏßÄ -->
              <div class="absolute top-2 right-2 px-2 py-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold rounded-full animate-pulse">
                üîÆ AR Ï≤¥Ìóò
              </div>
              <!-- Îß§Ïû• ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ -->
              <div class="aspect-video bg-gray-900 rounded-lg mb-4 overflow-hidden relative cursor-pointer" onclick="window.open('https://rounz.com/collection.php?collectionIndex=3755', '_blank')">
                <img src="https://image.rounz.com/_data/product/TARTOPTICAL/ARNEL-HERITAGE-BLACK(45)/ARNEL-HERITAGE-BLACK(45)_03.JPG" alt="ROUNZ ÏïàÍ≤ΩÏ†ê" class="w-full h-full object-cover hover:scale-105 transition duration-500">
                <div class="absolute bottom-2 left-2 flex gap-1">
                  <span class="px-2 py-1 bg-red-500 text-white text-xs font-bold rounded">Ïó∞ÎßêÌäπÍ∞Ä</span>
                  <span class="px-2 py-1 bg-purple-500 text-white text-xs font-bold rounded">ARÏßÄÏõê</span>
                </div>
              </div>
              <div class="flex items-center gap-3 mb-3">
                <div class="text-4xl">üëì</div>
                <div>
                  <h3 class="text-xl font-bold">ROUNZ ÏïàÍ≤ΩÏ†ê</h3>
                  <p class="text-gray-400 text-sm">üëó ÏùòÎ•ò/Ìå®ÏÖò ¬∑ ÏïàÍ≤ΩÌÖå Ï†ÑÎ¨∏</p>
                </div>
              </div>
              <p class="text-cyan-400 mb-2">‚≠ê 4.95 | ÌõÑÍ∏∞ 42Í∞ú | üöö Î¨¥Î£åÎ∞∞ÏÜ°</p>
              <div class="flex gap-2 flex-wrap mb-3">
                <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ÏòÅÏóÖÏ§ë</span>
                <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-sm">Í≥µÏãùÏûÖÏ†ê</span>
              </div>
              <a href="https://rounz.com/collection.php?collectionIndex=3755" target="_blank" class="block w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-bold text-center text-lg hover:opacity-90 mb-2">
                üëì ÏïàÍ≤Ω Î≥¥Îü¨Í∞ÄÍ∏∞
              </a>
              <div class="flex gap-2">
                <a href="https://play.google.com/store/apps/details?id=com.rounz.app" target="_blank" class="flex-1 py-2 bg-green-600 text-white rounded text-center text-sm">
                  ü§ñ Android
                </a>
                <a href="https://apps.apple.com/kr/app/rounz/id1489227547" target="_blank" class="flex-1 py-2 bg-gray-800 text-white rounded text-center text-sm">
                  üçé iOS
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- üöÄ Îß§Ïû• ÏûÖÏ†êÌïòÍ∏∞ (Step-by-Step ÌîåÎ°úÏö∞) -->
        <div id="business-register-tab" style="display: block;">
          
          <!-- Step 1: ÏûÖÏ†ê ÌôòÏòÅ & ÏãúÏûë Î≤ÑÌäº -->
          <!-- üöÄ ÏßÑÌñâ ÌëúÏãúÍ∏∞ -->
          <div id="register-progress" class="mb-8" style="display:none;">
            <div class="flex justify-between items-center max-w-2xl mx-auto">
              <div class="step-indicator" id="step-ind-1">
                <div class="w-10 h-10 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">1</div>
                <span class="text-xs mt-1 text-purple-400">Í∏∞Î≥∏Ï†ïÎ≥¥</span>
              </div>
              <div class="flex-1 h-1 bg-gray-700 mx-2"><div class="step-line h-full bg-purple-500" style="width:0%"></div></div>
              <div class="step-indicator" id="step-ind-2">
                <div class="w-10 h-10 rounded-full bg-gray-700 text-gray-400 flex items-center justify-center font-bold">2</div>
                <span class="text-xs mt-1 text-gray-400">Ïö¥ÏòÅÏ†ïÎ≥¥</span>
              </div>
              <div class="flex-1 h-1 bg-gray-700 mx-2"><div class="step-line h-full bg-purple-500" style="width:0%"></div></div>
              <div class="step-indicator" id="step-ind-3">
                <div class="w-10 h-10 rounded-full bg-gray-700 text-gray-400 flex items-center justify-center font-bold">3</div>
                <span class="text-xs mt-1 text-gray-400">ÏïΩÍ¥ÄÎèôÏùò</span>
              </div>
              <div class="flex-1 h-1 bg-gray-700 mx-2"><div class="step-line h-full bg-purple-500" style="width:0%"></div></div>
              <div class="step-indicator" id="step-ind-4">
                <div class="w-10 h-10 rounded-full bg-gray-700 text-gray-400 flex items-center justify-center font-bold">4</div>
                <span class="text-xs mt-1 text-gray-400">ÏôÑÎ£å</span>
              </div>
            </div>
          </div>

          <!-- Step 0: ÌôòÏòÅ ÌôîÎ©¥ -->
          <div id="register-step-welcome" class="card glow-border text-center py-12" style="display: block;">
            <div class="text-8xl mb-6">üöÄ</div>
            <h3 class="text-3xl font-black mb-4 gradient-text">AIRCTT Îß§Ïû• ÏûÖÏ†ê</h3>
            <p class="text-xl text-gray-300 mb-2">AR Ïø†Ìè∞ Í≤åÏûÑÏúºÎ°ú Í≥†Í∞ùÏùÑ ÎßåÎÇòÏÑ∏Ïöî!</p>
            <p class="text-gray-400 mb-8">ÏûÖÏ†ê ÌõÑ Ïø†Ìè∞ Î∞úÍ∏â ‚Üí Í≤åÏûÑ Î∞∞Ìè¨ ‚Üí Í≥†Í∞ù Î∞©Î¨∏ ‚Üí Îß§Ï∂ú Ï¶ùÎåÄ!</p>
            
            <div class="grid md:grid-cols-3 gap-6 max-w-3xl mx-auto mb-8 text-left">
              <div class="bg-purple-500/10 p-4 rounded-lg border border-purple-500/30">
                <div class="text-3xl mb-2">üéÆ</div>
                <h4 class="font-bold mb-1">Í≤åÏûÑ Ïó∞Îèô</h4>
                <p class="text-sm text-gray-400">Í≥†Í∞ùÏù¥ AR Í≤åÏûÑÏóêÏÑú Îß§Ïû• Ïø†Ìè∞ ÌöçÎìù</p>
              </div>
              <div class="bg-cyan-500/10 p-4 rounded-lg border border-cyan-500/30">
                <div class="text-3xl mb-2">üìä</div>
                <h4 class="font-bold mb-1">Ïã§ÏãúÍ∞Ñ ÎåÄÏãúÎ≥¥Îìú</h4>
                <p class="text-sm text-gray-400">Ï£ºÎ¨∏ ÌòÑÌô©, Îß§Ï∂ú ÌÜµÍ≥Ñ Ïã§ÏãúÍ∞Ñ ÌôïÏù∏</p>
              </div>
              <div class="bg-pink-500/10 p-4 rounded-lg border border-pink-500/30">
                <div class="text-3xl mb-2">üí∞</div>
                <h4 class="font-bold mb-1">Ïø†Ìè∞ Î∞úÍ∏â</h4>
                <p class="text-sm text-gray-400">Ïû•Îãπ 100ÏõêÏúºÎ°ú Ìö®Ïú®Ï†Å ÎßàÏºÄÌåÖ</p>
              </div>
            </div>
            
            <button onclick="startRegistration()" class="btn-primary text-xl px-12 py-4">üöÄ Îß§Ïû• ÏûÖÏ†ê ÏãúÏûëÌïòÍ∏∞</button>
          </div>
          
          <!-- Step 1: Í∏∞Î≥∏Ï†ïÎ≥¥ (ÏÇ¨ÏóÖÏûê/Îã¥ÎãπÏûê) - ÌöåÏÇ¨ÏÜåÍ∞úÏÑú Ïä§ÌÉÄÏùº -->
          <div id="register-step-basic" style="display:none;" class="card glow-border">
            <h3 class="text-2xl font-bold mb-2">üìù STEP 1. Í∏∞Î≥∏ Ï†ïÎ≥¥ (ÏÇ¨ÏóÖÏûê/Îã¥ÎãπÏûê)</h3>
            <p class="text-gray-400 mb-6">Îß§Ïû•Ïùò ÏÇ¨ÏóÖÏûê Ï†ïÎ≥¥ÏôÄ Îã¥ÎãπÏûê Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</p>
            
            <!-- ÌïÑÏàò Ï†ïÎ≥¥ ÏÑπÏÖò -->
            <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4 mb-6">
              <h4 class="font-bold text-purple-400 mb-4 flex items-center gap-2">
                <span class="text-red-400">*</span> ÌïÑÏàò Ï†ïÎ≥¥
              </h4>
              
              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block mb-2 font-bold">ÏÉÅÌò∏(Îß§Ïû•Î™Ö) <span class="text-red-400">*</span></label>
                  <input type="text" id="reg-store-name" class="w-full p-3 rounded bg-gray-900 border border-purple-500 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 transition" placeholder="Ïòà: ÏïÑÎØ∏ ÌïúÏ†ïÏãù" required="">
                </div>
                <div>
                  <label class="block mb-2 font-bold">ÎåÄÌëúÏûêÎ™Ö <span class="text-red-400">*</span></label>
                  <input type="text" id="reg-owner-name" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="ÌôçÍ∏∏Îèô" required="">
                </div>
              </div>
              
              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block mb-2 font-bold">Îã¥ÎãπÏûêÎ™Ö <span class="text-red-400">*</span></label>
                  <input type="text" id="reg-manager-name" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="ÍπÄÎã¥Îãπ" required="">
                </div>
                <div>
                  <label class="block mb-2 font-bold">Ìú¥ÎåÄÌè∞ <span class="text-red-400">*</span></label>
                  <input type="tel" id="reg-owner-phone" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="010-1234-5678" required="">
                </div>
              </div>
              
              <div class="mb-4">
                <label class="block mb-2 font-bold">Ïù¥Î©îÏùº <span class="text-red-400">*</span></label>
                <input type="email" id="reg-email" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="store@example.com" required="">
              </div>
              
              <div class="mb-4">
                <label class="block mb-2 font-bold">ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏ <span class="text-red-400">*</span></label>
                <input type="text" id="reg-biz-number" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="123-45-67890" required="">
                <p class="text-xs text-gray-500 mt-1">'-' Ìè¨Ìï®ÌïòÏó¨ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</p>
              </div>
              
              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block mb-2 font-bold">Î≤ïÏù∏Î™Ö <span class="text-gray-500">(Ìï¥Îãπ Ïãú)</span></label>
                  <input type="text" id="reg-corp-name" class="w-full p-3 rounded bg-gray-900 border border-gray-600" placeholder="(Ï£º)Î∞úÎ°úÎ†à">
                </div>
                <div>
                  <label class="block mb-2 font-bold">Î≤ïÏù∏Îì±Î°ùÎ≤àÌò∏ <span class="text-gray-500">(Ìï¥Îãπ Ïãú)</span></label>
                  <input type="text" id="reg-corp-number" class="w-full p-3 rounded bg-gray-900 border border-gray-600" placeholder="110111-1234567">
                </div>
              </div>
              
              <div class="mb-4">
                <label class="block mb-2 font-bold">ÏÇ¨ÏóÖÏû• ÏÜåÏû¨ÏßÄ <span class="text-red-400">*</span></label>
                <div class="flex gap-2 mb-2">
                  <input type="text" id="reg-zipcode" class="w-32 p-3 rounded bg-gray-900 border border-purple-500" placeholder="Ïö∞Ìé∏Î≤àÌò∏" readonly="">
                  <button type="button" onclick="searchAddress()" class="px-4 py-2 bg-cyan-500 rounded font-bold hover:bg-cyan-600 transition">üîç Ï£ºÏÜå Í≤ÄÏÉâ</button>
                </div>
                <input type="text" id="reg-address" class="w-full p-3 rounded bg-gray-900 border border-purple-500 mb-2" placeholder="Í∏∞Î≥∏ Ï£ºÏÜå" required="">
                <input type="text" id="reg-address-detail" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="ÏÉÅÏÑ∏ Ï£ºÏÜå (Ï∏µ, Ìò∏Ïàò Îì±)">
              </div>
              
              <div>
                <label class="block mb-2 font-bold">ÏóÖÏ¢Ö ÏÑ†ÌÉù <span class="text-red-400">*</span></label>
                <select id="reg-category" class="w-full p-3 rounded bg-gray-900 border border-purple-500" required="" multiple="" size="5" style="scrollbar-width: thin;">
                  <optgroup label="üçΩÔ∏è ÏùåÏãùÏ†ê">
                    <option value="korean">ÌïúÏãù</option>
                    <option value="chinese">Ï§ëÏãù</option>
                    <option value="japanese">ÏùºÏãù</option>
                    <option value="western">ÏñëÏãù</option>
                    <option value="cafe">Ïπ¥Ìéò</option>
                    <option value="chicken">ÏπòÌÇ®</option>
                    <option value="snack">Î∂ÑÏãù</option>
                    <option value="bakery">Î≤†Ïù¥Ïª§Î¶¨</option>
                  </optgroup>
                  <optgroup label="üõí Ïú†ÌÜµ">
                    <option value="mart">ÎßàÌä∏</option>
                    <option value="market">Ïû¨ÎûòÏãúÏû•</option>
                    <option value="convenience">Ìé∏ÏùòÏ†ê</option>
                  </optgroup>
                  <optgroup label="üëó Ìå®ÏÖò/Î∑∞Ìã∞">
                    <option value="clothing">ÏùòÎ•ò</option>
                    <option value="shoes">Ïã†Î∞ú/Ïû°Ìôî</option>
                    <option value="accessories">Ïï°ÏÑ∏ÏÑúÎ¶¨</option>
                    <option value="beauty">Î∑∞Ìã∞/ÎØ∏Ïö©</option>
                  </optgroup>
                  <optgroup label="üéØ Í∏∞ÌÉÄ">
                    <option value="sports">Ïä§Ìè¨Ï∏†/Ìó¨Ïä§</option>
                    <option value="education">ÍµêÏú°</option>
                    <option value="service">ÏÑúÎπÑÏä§ÏóÖ</option>
                    <option value="etc">Í∏∞ÌÉÄ</option>
                  </optgroup>
                </select>
                <p class="text-xs text-gray-500 mt-1">Ctrl+ÌÅ¥Î¶≠ÏúºÎ°ú Ïó¨Îü¨ ÏóÖÏ¢Ö ÏÑ†ÌÉù Í∞ÄÎä•</p>
              </div>
            </div>
            
            <!-- ÏÑ†ÌÉù Ï†ïÎ≥¥ ÏÑπÏÖò -->
            <div class="bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-4 mb-6">
              <h4 class="font-bold text-cyan-400 mb-4">üìã ÏÑ†ÌÉù Ï†ïÎ≥¥</h4>
              
              <div class="mb-4">
                <label class="block mb-2 font-bold">Í≥†Í∞ùÏÑºÌÑ∞ Ï†ÑÌôî</label>
                <input type="tel" id="reg-cs-phone" class="w-full p-3 rounded bg-gray-900 border border-gray-600" placeholder="02-1234-5678">
              </div>
              
              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block mb-2 font-bold">Ï†ïÏÇ∞ ÏùÄÌñâ</label>
                  <select id="reg-bank" class="w-full p-3 rounded bg-gray-900 border border-gray-600">
                    <option value="">ÏÑ†ÌÉù</option>
                    <option value="kb">Íµ≠ÎØºÏùÄÌñâ</option>
                    <option value="shinhan">Ïã†ÌïúÏùÄÌñâ</option>
                    <option value="woori">Ïö∞Î¶¨ÏùÄÌñâ</option>
                    <option value="hana">ÌïòÎÇòÏùÄÌñâ</option>
                    <option value="nh">ÎÜçÌòë</option>
                    <option value="ibk">Í∏∞ÏóÖÏùÄÌñâ</option>
                    <option value="kakao">Ïπ¥Ïπ¥Ïò§Î±ÖÌÅ¨</option>
                    <option value="toss">ÌÜ†Ïä§Î±ÖÌÅ¨</option>
                  </select>
                </div>
                <div>
                  <label class="block mb-2 font-bold">Í≥ÑÏ¢åÎ≤àÌò∏</label>
                  <input type="text" id="reg-account" class="w-full p-3 rounded bg-gray-900 border border-gray-600" placeholder="123-456-789012">
                </div>
                <div>
                  <label class="block mb-2 font-bold">ÏòàÍ∏àÏ£º</label>
                  <input type="text" id="reg-account-holder" class="w-full p-3 rounded bg-gray-900 border border-gray-600" placeholder="ÌôçÍ∏∏Îèô">
                </div>
              </div>
            </div>
            
            <!-- ‚úÖ ÌîåÎû´Ìèº Ïö¥ÏòÅÏûê Ï†ïÎ≥¥ (Í≥†Ï†ï ÌëúÏãú) -->
            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-6">
              <h4 class="font-bold text-yellow-400 mb-3 flex items-center gap-2">
                <span>üè¢</span> ÌîåÎû´Ìèº Ïö¥ÏòÅÏûê Ï†ïÎ≥¥
              </h4>
              <div class="grid md:grid-cols-2 gap-4 text-sm">
                <div class="space-y-2">
                  <p><span class="text-gray-400">ÏÉÅÌò∏:</span> <span class="text-white font-bold">Ï£º)Î∞úÎ°úÎ†à</span></p>
                  <p><span class="text-gray-400">Í¥ÄÎ¶¨Ïûê:</span> <span class="text-white">Ïò§ÌòÑÏã§</span></p>
                  <p><span class="text-gray-400">Ïó∞ÎùΩÏ≤ò:</span> <span class="text-cyan-400">010-2187-8890</span></p>
                </div>
                <div class="space-y-2">
                  <p><span class="text-gray-400">Ïù¥Î©îÏùº:</span> <span class="text-cyan-400">zeus1404@gmail.com</span></p>
                  <p><span class="text-gray-400">ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏:</span> <span class="text-white">123-45-67890</span></p>
                  <p><span class="text-gray-400">ÌÜµÏã†ÌåêÎß§ÏóÖ:</span> <span class="text-white">Ï†ú2025-ÏÑúÏö∏Í∞ïÎÇ®-00001Ìò∏</span></p>
                </div>
              </div>
            </div>
            
            <div class="flex gap-4">
              <button type="button" onclick="showRegisterStep('welcome')" class="px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition">‚Üê Ïù¥Ï†Ñ</button>
              <button type="button" onclick="goToStep2()" class="btn-primary flex-1 text-lg py-4">Îã§Ïùå Îã®Í≥Ñ ‚Üí</button>
            </div>
          </div>
          
          <!-- Step 2: Ïö¥ÏòÅÏ†ïÎ≥¥ -->
          <div id="register-step-operation" style="display:none;" class="card glow-border">
            <h3 class="text-2xl font-bold mb-2">üè™ STEP 2. Ïö¥ÏòÅ Ï†ïÎ≥¥</h3>
            <p class="text-gray-400 mb-6">Îß§Ïû• Ïö¥ÏòÅÏóê ÌïÑÏöîÌïú Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</p>
            
            <div class="mb-4">
              <label class="block mb-2 font-bold">Îß§Ïû• Ï£ºÏÜå <span class="text-red-400">*</span></label>
              <div class="flex gap-2 mb-2">
                <input type="text" id="reg-zipcode" class="w-32 p-3 rounded bg-gray-900 border border-purple-500" placeholder="Ïö∞Ìé∏Î≤àÌò∏" readonly="">
                <button type="button" onclick="searchAddress()" class="px-4 py-2 bg-cyan-500 rounded font-bold hover:bg-cyan-600 transition">üîç Ï£ºÏÜå Í≤ÄÏÉâ</button>
              </div>
              <input type="text" id="reg-address" class="w-full p-3 rounded bg-gray-900 border border-purple-500 mb-2" placeholder="Í∏∞Î≥∏ Ï£ºÏÜå" required="">
              <input type="text" id="reg-address-detail" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="ÏÉÅÏÑ∏ Ï£ºÏÜå (Ï∏µ, Ìò∏Ïàò Îì±)">
            </div>
            
            <div class="mb-4">
              <label class="block mb-2 font-bold">Îß§Ïû• Ï†ÑÌôîÎ≤àÌò∏ <span class="text-red-400">*</span></label>
              <input type="tel" id="reg-store-phone" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="02-1234-5678" required="">
            </div>
            
            <div class="grid md:grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block mb-2 font-bold">ÏòÅÏóÖÏãúÍ∞Ñ</label>
                <input type="text" id="reg-hours" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="10:00 - 22:00">
              </div>
              <div>
                <label class="block mb-2 font-bold">Ìú¥Î¨¥Ïùº</label>
                <input type="text" id="reg-closed" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="Îß§Ï£º ÏùºÏöîÏùº">
              </div>
            </div>
            
            <div class="mb-4">
              <label class="block mb-2 font-bold">Îß§Ïû• ÏÜåÍ∞ú</label>
              <textarea id="reg-description" class="w-full p-3 rounded bg-gray-900 border border-purple-500 min-h-[100px]" placeholder="Í≥†Í∞ùÏóêÍ≤å Î≥¥Ïó¨Ï§Ñ Îß§Ïû• ÏÜåÍ∞úÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî..."></textarea>
            </div>

            <div class="mb-6">
              <label class="block mb-2 font-bold">Îß§Ïû• ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ</label>
              <div class="border border-dashed border-purple-500 rounded-lg p-6 text-center bg-gray-800/50">
                <input type="file" id="reg-image" accept="image/*" class="hidden" onchange="previewRegImage(this)">
                <div id="reg-image-preview" class="text-5xl mb-2">üì∑</div>
                <button type="button" onclick="document.getElementById('reg-image').click()" class="px-4 py-2 bg-purple-500 rounded hover:bg-purple-600 transition">Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù</button>
                <p class="text-xs text-gray-500 mt-2">Í∂åÏû•: 800x600px, ÏµúÎåÄ 5MB</p>
              </div>
            </div>

            <!-- üîó Ïô∏Î∂Ä Ïó∞Îèô Ï†ïÎ≥¥ ÏÑπÏÖò -->
            <div class="bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/30 rounded-lg p-4 mb-6">
              <h4 class="font-bold text-cyan-400 mb-4 flex items-center gap-2">
                <span>üîó</span> Ïô∏Î∂Ä Ïó∞Îèô Ï†ïÎ≥¥ (ÏÑ†ÌÉù)
              </h4>

              <!-- Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ URL -->
              <div class="mb-4">
                <label class="block mb-2 font-bold">üåê Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ/ÏáºÌïëÎ™∞ URL</label>
                <input type="url" id="reg-homepage-url" class="w-full p-3 rounded bg-gray-900 border border-cyan-500 focus:ring-2 focus:ring-cyan-400/50" placeholder="https://example.com ÎòêÎäî https://smartstore.naver.com/...">
                <p class="text-xs text-gray-500 mt-1">ÎÑ§Ïù¥Î≤Ñ Ïä§ÎßàÌä∏Ïä§ÌÜ†Ïñ¥, Ïø†Ìå°, ÏûêÏÇ¨Î™∞ Îì± Í∏∞Ï°¥ ÏáºÌïëÎ™∞ URL ÏûÖÎ†•</p>
              </div>

              <!-- ÌôçÎ≥¥ ÏòÅÏÉÅ URL -->
              <div class="mb-4">
                <label class="block mb-2 font-bold">üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ URL</label>
                <div class="flex gap-2">
                  <input type="url" id="reg-video-url" class="flex-1 p-3 rounded bg-gray-900 border border-purple-500 focus:ring-2 focus:ring-purple-400/50" placeholder="https://youtube.com/watch?v=... ÎòêÎäî https://youtu.be/...">
                  <button type="button" onclick="previewVideoURL()" class="px-4 py-2 bg-purple-500 rounded font-bold hover:bg-purple-600 transition">ÎØ∏Î¶¨Î≥¥Í∏∞</button>
                </div>
                <p class="text-xs text-gray-500 mt-1">YouTube, Vimeo Îì± ÏòÅÏÉÅ URL ÏûÖÎ†•</p>
                <div id="video-preview-container" class="mt-3 hidden">
                  <div class="aspect-video bg-gray-800 rounded-lg overflow-hidden">
                    <iframe id="video-preview-iframe" class="w-full h-full" frameborder="0" allowfullscreen=""></iframe>
                  </div>
                </div>
              </div>

              <!-- AR/VR Ï≤¥Ìóò URL (ROUNZ Îì±) -->
              <div class="mb-4">
                <label class="block mb-2 font-bold">üîÆ AR/VR Ï≤¥Ìóò URL</label>
                <input type="url" id="reg-ar-url" class="w-full p-3 rounded bg-gray-900 border border-pink-500 focus:ring-2 focus:ring-pink-400/50" placeholder="https://rounz.com/product.php?... ÎòêÎäî AR Ïï± ÎßÅÌÅ¨">
                <p class="text-xs text-gray-500 mt-1">ROUNZ, Í∏∞ÌÉÄ AR Ï≤¥Ìóò ÌéòÏù¥ÏßÄ URL (ÏïàÍ≤Ω, ÌôîÏû•Ìíà Îì±)</p>
              </div>

              <!-- ÌååÏùº Îã§Ïö¥Î°úÎìú URL -->
              <div class="mb-4">
                <label class="block mb-2 font-bold">üì• Ïï±/ÌååÏùº Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨</label>
                <div class="grid md:grid-cols-2 gap-3">
                  <div>
                    <input type="url" id="reg-app-android" class="w-full p-3 rounded bg-gray-900 border border-green-500" placeholder="Google Play Store URL">
                    <p class="text-xs text-gray-500 mt-1">ü§ñ Android Ïï±</p>
                  </div>
                  <div>
                    <input type="url" id="reg-app-ios" class="w-full p-3 rounded bg-gray-900 border border-blue-500" placeholder="App Store URL">
                    <p class="text-xs text-gray-500 mt-1">üçé iOS Ïï±</p>
                  </div>
                </div>
              </div>

              <!-- SNS Ïó∞Îèô -->
              <div>
                <label class="block mb-2 font-bold">üì± SNS Í≥ÑÏ†ï</label>
                <div class="grid md:grid-cols-2 gap-3">
                  <input type="url" id="reg-sns-instagram" class="w-full p-3 rounded bg-gray-900 border border-pink-400" placeholder="Instagram URL">
                  <input type="url" id="reg-sns-youtube" class="w-full p-3 rounded bg-gray-900 border border-red-500" placeholder="YouTube Ï±ÑÎÑê URL">
                  <input type="url" id="reg-sns-naver" class="w-full p-3 rounded bg-gray-900 border border-green-400" placeholder="ÎÑ§Ïù¥Î≤Ñ Î∏îÎ°úÍ∑∏ URL">
                  <input type="url" id="reg-sns-kakao" class="w-full p-3 rounded bg-gray-900 border border-yellow-500" placeholder="Ïπ¥Ïπ¥Ïò§ÌÜ° Ï±ÑÎÑê URL">
                </div>
              </div>
            </div>
            
            <div class="flex gap-4">
              <button type="button" onclick="showRegisterStep('basic')" class="px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition">‚Üê Ïù¥Ï†Ñ</button>
              <button type="button" onclick="goToStep3()" class="btn-primary flex-1 text-lg py-4">Îã§Ïùå Îã®Í≥Ñ ‚Üí</button>
            </div>
          </div>
          
          <!-- Step 3: ÏïΩÍ¥Ä ÎèôÏùò -->
          <div id="register-step-agreement" style="display:none;" class="card glow-border">
            <h3 class="text-2xl font-bold mb-2">üìã STEP 3. ÏïΩÍ¥Ä ÎèôÏùò</h3>
            <p class="text-gray-400 mb-6">AIRCTT ÌîåÎû´Ìèº Ïù¥Ïö©ÏùÑ ÏúÑÌï¥ ÏïÑÎûò ÏïΩÍ¥ÄÏóê ÎèôÏùòÌï¥Ï£ºÏÑ∏Ïöî.</p>
            
            <div class="space-y-4 mb-8">
              <label class="flex items-start gap-3 p-4 bg-gray-800/50 rounded-lg cursor-pointer hover:bg-gray-800 transition">
                <input type="checkbox" id="agree-terms" class="mt-1 w-5 h-5 accent-purple-500">
                <div>
                  <span class="font-bold text-white">ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏïΩÍ¥Ä (ÌïÑÏàò)</span>
                  <p class="text-sm text-gray-400 mt-1">AIRCTT ÌîåÎû´Ìèº ÏÑúÎπÑÏä§ Ïù¥Ïö©Ïóê ÎåÄÌïú Í∏∞Î≥∏ ÏïΩÍ¥ÄÏûÖÎãàÎã§.</p>
                  <button type="button" onclick="showTermsModal('terms')" class="text-cyan-400 text-sm underline mt-1">Ï†ÑÎ¨∏ Î≥¥Í∏∞ ‚Üí</button>
                </div>
              </label>
              
              <label class="flex items-start gap-3 p-4 bg-gray-800/50 rounded-lg cursor-pointer hover:bg-gray-800 transition">
                <input type="checkbox" id="agree-privacy" class="mt-1 w-5 h-5 accent-purple-500">
                <div>
                  <span class="font-bold text-white">Í∞úÏù∏Ï†ïÎ≥¥ Ï≤òÎ¶¨Î∞©Ïπ® (ÌïÑÏàò)</span>
                  <p class="text-sm text-gray-400 mt-1">ÏÇ¨ÏóÖÏûê Î∞è Í≥†Í∞ù Í∞úÏù∏Ï†ïÎ≥¥ ÏàòÏßë/Ïù¥Ïö©Ïóê ÎåÄÌïú Ï†ïÏ±ÖÏûÖÎãàÎã§.</p>
                  <button type="button" onclick="showTermsModal('privacy')" class="text-cyan-400 text-sm underline mt-1">Ï†ÑÎ¨∏ Î≥¥Í∏∞ ‚Üí</button>
                </div>
              </label>
              
              <label class="flex items-start gap-3 p-4 bg-gray-800/50 rounded-lg cursor-pointer hover:bg-gray-800 transition">
                <input type="checkbox" id="agree-fee" class="mt-1 w-5 h-5 accent-purple-500">
                <div>
                  <span class="font-bold text-white">ÏàòÏàòÎ£å Ï†ïÏ±Ö ÎèôÏùò (ÌïÑÏàò)</span>
                  <p class="text-sm text-gray-400 mt-1">Ïø†Ìè∞ Î∞úÍ∏â ÎπÑÏö© (Ïû•Îãπ 100Ïõê) Î∞è Í≤∞Ï†ú ÏàòÏàòÎ£å Ï†ïÏ±ÖÏóê ÎèôÏùòÌï©ÎãàÎã§.</p>
                  <div class="bg-yellow-500/10 p-2 rounded mt-2">
                    <p class="text-yellow-400 text-sm">üí∞ Ïø†Ìè∞ Î∞úÍ∏â: Ïû•Îãπ 100Ïõê | Í≤∞Ï†ú ÏàòÏàòÎ£å: Í±∞ÎûòÍ∏àÏï°Ïùò 3.3%</p>
                  </div>
                </div>
              </label>
              
              <label class="flex items-start gap-3 p-4 bg-gray-800/50 rounded-lg cursor-pointer hover:bg-gray-800 transition">
                <input type="checkbox" id="agree-operation" class="mt-1 w-5 h-5 accent-purple-500">
                <div>
                  <span class="font-bold text-white">Ïö¥ÏòÅ Í∑úÏ†ï ÎèôÏùò (ÌïÑÏàò)</span>
                  <p class="text-sm text-gray-400 mt-1">Îß§Ïû• Ïö¥ÏòÅ Î∞è Ïø†Ìè∞ Í¥ÄÎ¶¨Ïóê ÎåÄÌïú Í∑úÏ†ïÏùÑ Ï§ÄÏàòÌï©ÎãàÎã§.</p>
                </div>
              </label>
              
              <label class="flex items-start gap-3 p-4 bg-purple-500/10 rounded-lg cursor-pointer hover:bg-purple-500/20 transition border border-purple-500/30">
                <input type="checkbox" id="agree-all" class="mt-1 w-5 h-5 accent-purple-500" onchange="toggleAllAgreements(this)">
                <div>
                  <span class="font-bold text-purple-400">‚úÖ Ï†ÑÏ≤¥ ÎèôÏùò</span>
                  <p class="text-sm text-gray-400 mt-1">ÏúÑ Î™®Îì† ÏïΩÍ¥ÄÏóê ÎèôÏùòÌï©ÎãàÎã§.</p>
                </div>
              </label>
            </div>
            
            <div class="flex gap-4">
              <button onclick="showRegisterStep('operation')" class="px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition">‚Üê Ïù¥Ï†Ñ</button>
              <button onclick="submitFinalRegistration()" class="btn-primary flex-1 text-lg py-4">üöÄ ÏûÖÏ†ê Ïã†Ï≤≠ ÏôÑÎ£å</button>
            </div>
          </div>
          
          <!-- Step 4: Ïã†Ï≤≠ ÏôÑÎ£å -->
          <div id="register-step-complete" style="display:none;" class="card glow-border text-center py-12">
            <div class="text-8xl mb-6">üéâ</div>
            <h3 class="text-3xl font-black mb-4 gradient-text">ÏûÖÏ†ê Ïã†Ï≤≠ ÏôÑÎ£å!</h3>
            <p class="text-xl text-gray-300 mb-2">Í¥ÄÎ¶¨Ïûê Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ ÏïàÎÇ¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.</p>
            <p class="text-gray-400 mb-8">Î≥¥ÌÜµ 1-2 ÏòÅÏóÖÏùº ÎÇ¥ Ï≤òÎ¶¨Îê©ÎãàÎã§.</p>
            
            <div class="bg-gray-800/50 p-6 rounded-lg max-w-md mx-auto mb-8">
              <h4 class="font-bold mb-4">üìã Ïã†Ï≤≠ ÌòÑÌô©</h4>
              <div class="text-left space-y-2">
                <p><span class="text-gray-400">ÏÉÅÌò∏Î™Ö:</span> <span id="submitted-store-name">-</span></p>
                <p><span class="text-gray-400">Ïã†Ï≤≠Ïùº:</span> <span id="submitted-date">-</span></p>
                <p><span class="text-gray-400">ÏÉÅÌÉú:</span> <span class="text-yellow-400">‚è≥ ÏäπÏù∏ ÎåÄÍ∏∞Ï§ë</span></p>
              </div>
            </div>
            
            <button onclick="showBusinessTab('mystore')" class="btn-primary text-lg px-8 py-3">ÎÇ¥ Îß§Ïû• ÌôïÏù∏ÌïòÍ∏∞ ‚Üí</button>
          </div>
        </div>

        <!-- üçΩÔ∏è ÎÇ¥ Îß§Ïû• ÌÉ≠ -->
        <div id="business-mystore-tab" style="display:none;">
          
          <!-- üê∞ Golden Rabbit CFO ÏúÑÏ†Ø (ÎÇ¥ Îß§Ïû• ÌÉ≠ ÏµúÏÉÅÎã®) -->
          <div id="golden-rabbit-main" class="card mb-6" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); border: 2px solid #f59e0b; position: relative; overflow: hidden;">
            <!-- Î∞∞Í≤Ω ÌååÌã∞ÌÅ¥ Ìö®Í≥º -->
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at 20% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%); pointer-events: none;"></div>
            
            <div class="flex items-start gap-4 relative z-10">
              <!-- ÌÜ†ÎÅº ÏïÑÎ∞îÌÉÄ -->
              <div class="flex-shrink-0">
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; box-shadow: 0 0 30px rgba(245, 158, 11, 0.6); animation: pulse 2s infinite;">
                  üê∞
                </div>
              </div>
              
              <!-- ÏΩòÌÖêÏ∏† -->
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <h4 class="font-bold text-xl" style="color: #f59e0b;">Golden Rabbit CFO</h4>
                  <span class="px-2 py-0.5 text-xs font-bold rounded" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000;">PRO</span>
                </div>
                <p class="text-sm text-gray-400 mb-3">‚óè Gemini 1.5 Pro Connected</p>
                
                <!-- AI Î∂ÑÏÑù Í≤∞Í≥º -->
                <div id="rabbit-main-analysis" class="bg-black/30 rounded-lg p-4 mb-4">
                  <div class="flex items-center gap-2 mb-3">
                    <span class="text-lg">üê∞</span>
                    <span class="font-bold text-yellow-400">üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑù Í≤∞Í≥º</span>
                  </div>
                  <ul class="space-y-1 text-sm">
                    <li>‚Ä¢ Ï¥ù Îß§Ï∂ú: <span class="text-cyan-400 font-bold">‚Ç©340,000</span> (Ï†ÑÏùº ÎåÄÎπÑ <span class="text-green-400">+12%</span>)</li>
                    <li>‚Ä¢ Ï£ºÎ¨∏ Í±¥Ïàò: <span class="text-white font-bold">12Í±¥</span></li>
                    <li>‚Ä¢ Í∞ùÎã®Í∞Ä: <span class="text-white font-bold">‚Ç©28,333</span></li>
                  </ul>
                  <div class="mt-3 pt-3 border-t border-gray-700">
                    <p class="text-sm">üéØ ÌîºÌÅ¨ ÏãúÍ∞ÑÎåÄ: <span class="text-cyan-400">Ïò§ÌõÑ 12Ïãú~1Ïãú (Ï†êÏã¨)</span></p>
                    <p class="text-sm text-yellow-300">üí° Ï∂îÏ≤ú: Ï†ÄÎÖÅ ÏãúÍ∞ÑÎåÄ ÌîÑÎ°úÎ™®ÏÖò Í∞ïÌôîÌïòÎ©¥ Îß§Ï∂ú 20% ÏÉÅÏäπ ÏòàÏÉÅÎê©ÎãàÎã§!</p>
                  </div>
                </div>
                
                <!-- Îπ†Î•∏ ÏßàÎ¨∏ Î≤ÑÌäº -->
                <div class="flex gap-2 flex-wrap mb-3">
                  <button onclick="askRabbitMain('sales')" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition flex items-center gap-1">
                    üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑùÌï¥Ï§ò
                  </button>
                  <button onclick="askRabbitMain('tax')" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition flex items-center gap-1">
                    üìã ÏÑ∏Î¨¥ Ïã†Í≥† ÎèÑÏôÄÏ§ò
                  </button>
                  <button onclick="askRabbitMain('marketing')" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition flex items-center gap-1">
                    üì¢ ÎßàÏºÄÌåÖ Ï°∞Ïñ∏Ìï¥Ï§ò
                  </button>
                </div>
                
                <!-- Ï±ÑÌåÖ ÏûÖÎ†• -->
                <div class="flex gap-2">
                  <input type="text" id="rabbit-main-input" class="flex-1 px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm" placeholder="Golden RabbitÏóêÍ≤å Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî... üê∞" onkeypress="if(event.key==='Enter')sendToRabbitMain()">
                  <button onclick="sendToRabbitMain()" class="px-4 py-2 rounded-lg font-bold text-sm" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000;">
                    Í≥†ÎßàÏõå üê∞üê∞ü§©üëç
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ÎÇ¥ Îß§Ïû• Î™©Î°ù -->
          <div id="my-store-list" class="mb-8">
            <h3 class="text-2xl font-bold mb-4">üìå ÎÇ¥ Îß§Ïû•</h3>
            <div id="my-stores-container" class="grid md:grid-cols-2 gap-6">
              <!-- ÎèôÏ†Å Î°úÎìú -->
            </div>
          </div>
          
          <!-- ÏÑ†ÌÉùÎêú Îß§Ïû• ÎåÄÏãúÎ≥¥Îìú -->
          <div id="my-store-dashboard" style="display:none;">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-bold"><span id="selected-store-name">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</span> ÎåÄÏãúÎ≥¥Îìú</h3>
              <button onclick="document.getElementById('my-store-dashboard').style.display='none'" class="text-gray-400 hover:text-white">‚úï Îã´Í∏∞</button>
            </div>
            
            <!-- üê∞ Golden Rabbit CFO ÏúÑÏ†Ø -->
            <div id="golden-rabbit-widget" class="card mb-6" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); border: 2px solid #f59e0b; position: relative; overflow: hidden;">
              <!-- Î∞∞Í≤Ω ÌååÌã∞ÌÅ¥ Ìö®Í≥º -->
              <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at 20% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%); pointer-events: none;"></div>
              
              <div class="flex items-start gap-4 relative z-10">
                <!-- ÌÜ†ÎÅº ÏïÑÎ∞îÌÉÄ -->
                <div class="flex-shrink-0">
                  <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);">
                    üê∞
                  </div>
                </div>
                
                <!-- ÏΩòÌÖêÏ∏† -->
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h4 class="font-bold text-lg" style="color: #f59e0b;">Golden Rabbit CFO</h4>
                    <span class="px-2 py-0.5 text-xs font-bold rounded" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000;">PRO</span>
                  </div>
                  <p class="text-sm text-gray-400 mb-3">‚óè Gemini 1.5 Pro Connected</p>
                  
                  <!-- AI Î∂ÑÏÑù Í≤∞Í≥º -->
                  <div id="rabbit-analysis" class="bg-black/30 rounded-lg p-4 mb-4">
                    <div class="flex items-center gap-2 mb-3">
                      <span class="text-lg">üê∞</span>
                      <span class="font-bold text-yellow-400">üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑù Í≤∞Í≥º</span>
                    </div>
                    <ul class="space-y-1 text-sm">
                      <li>‚Ä¢ Ï¥ù Îß§Ï∂ú: <span class="text-cyan-400 font-bold">‚Ç©340,000</span> (Ï†ÑÏùº ÎåÄÎπÑ <span class="text-green-400">+12%</span>)</li>
                      <li>‚Ä¢ Ï£ºÎ¨∏ Í±¥Ïàò: <span class="text-white font-bold">12Í±¥</span></li>
                      <li>‚Ä¢ Í∞ùÎã®Í∞Ä: <span class="text-white font-bold">‚Ç©28,333</span></li>
                    </ul>
                    <div class="mt-3 pt-3 border-t border-gray-700">
                      <p class="text-sm">üéØ ÌîºÌÅ¨ ÏãúÍ∞ÑÎåÄ: <span class="text-cyan-400">Ïò§ÌõÑ 12Ïãú~1Ïãú (Ï†êÏã¨)</span></p>
                      <p class="text-sm text-yellow-300">üí° Ï∂îÏ≤ú: Ï†ÄÎÖÅ ÏãúÍ∞ÑÎåÄ ÌîÑÎ°úÎ™®ÏÖò Í∞ïÌôîÌïòÎ©¥ Îß§Ï∂ú 20% ÏÉÅÏäπ ÏòàÏÉÅÎê©ÎãàÎã§!</p>
                    </div>
                  </div>
                  
                  <!-- Îπ†Î•∏ ÏßàÎ¨∏ Î≤ÑÌäº -->
                  <div class="flex gap-2 flex-wrap mb-3">
                    <button onclick="askRabbit('sales')" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition flex items-center gap-1">
                      üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑùÌï¥Ï§ò
                    </button>
                    <button onclick="askRabbit('tax')" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition flex items-center gap-1">
                      üìã ÏÑ∏Î¨¥ Ïã†Í≥† ÎèÑÏôÄÏ§ò
                    </button>
                    <button onclick="askRabbit('marketing')" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition flex items-center gap-1">
                      üì¢ ÎßàÏºÄÌåÖ Ï°∞Ïñ∏Ìï¥Ï§ò
                    </button>
                  </div>
                  
                  <!-- Ï±ÑÌåÖ ÏûÖÎ†• -->
                  <div class="flex gap-2">
                    <input type="text" id="rabbit-input" class="flex-1 px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm" placeholder="Golden RabbitÏóêÍ≤å Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî... üê∞">
                    <button onclick="sendToRabbit()" class="px-4 py-2 rounded-lg font-bold text-sm" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000;">
                      Í≥†ÎßàÏõå üê∞üê∞ü§©üëç
                    </button>
                  </div>
                </div>
                
                <!-- Îã´Í∏∞ Î≤ÑÌäº -->
                <button onclick="toggleRabbitWidget()" class="text-gray-400 hover:text-white text-xl">√ó</button>
              </div>
            </div>
            
            <!-- Îß§Ïû• ÎåÄÏãúÎ≥¥Îìú ÌÉ≠ -->
            <div class="flex gap-2 mb-6 flex-wrap">
              <button onclick="showMyStoreDashTab('orders')" id="mystore-tab-orders" class="px-4 py-2 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg font-bold">üì¶ Ï£ºÎ¨∏ Ï≤òÎ¶¨</button>
              <button onclick="showMyStoreDashTab('sales')" id="mystore-tab-sales" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">üí∞ Îß§Ï∂ú ÌòÑÌô©</button>
              <button onclick="showMyStoreDashTab('coupons')" id="mystore-tab-coupons" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">üé´ Ïø†Ìè∞ ÌòÑÌô©</button>
              <button onclick="showMyStoreDashTab('decorate')" id="mystore-tab-decorate" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">üé® Îß§Ïû• Íæ∏ÎØ∏Í∏∞</button>
            </div>
            
            <!-- üì¶ Ï£ºÎ¨∏ Ï≤òÎ¶¨ ÎåÄÏãúÎ≥¥Îìú -->
            <div id="mystore-content-orders" class="card glow-border">
              <div class="flex items-center justify-between mb-6">
                <h4 class="text-xl font-bold">üì¶ Ïã§ÏãúÍ∞Ñ Ï£ºÎ¨∏ ÌòÑÌô©</h4>
                <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm animate-pulse">üü¢ Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê®</span>
              </div>
              
              <!-- Ï£ºÎ¨∏ ÏÉÅÌÉú ÌÉ≠ -->
              <div class="flex gap-2 mb-6 flex-wrap">
                <button onclick="filterOrders('new')" class="order-filter-btn active px-4 py-2 bg-red-500 rounded-lg font-bold">
                  üÜï Ïã†Í∑ú <span id="order-count-new" class="ml-1 px-2 py-0.5 bg-white/20 rounded-full text-sm">3</span>
                </button>
                <button onclick="filterOrders('preparing')" class="order-filter-btn px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">
                  üë®‚Äçüç≥ Ï§ÄÎπÑÏ§ë <span id="order-count-preparing" class="ml-1 px-2 py-0.5 bg-white/20 rounded-full text-sm">2</span>
                </button>
                <button onclick="filterOrders('ready')" class="order-filter-btn px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">
                  ‚úÖ ÏôÑÎ£å <span id="order-count-ready" class="ml-1 px-2 py-0.5 bg-white/20 rounded-full text-sm">5</span>
                </button>
                <button onclick="filterOrders('all')" class="order-filter-btn px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">
                  üìã Ï†ÑÏ≤¥
                </button>
              </div>
              
              <!-- Ï£ºÎ¨∏ Î™©Î°ù -->
              <div id="orders-list" class="space-y-4">
                <!-- Ïã†Í∑ú Ï£ºÎ¨∏ ÏòàÏãú -->
                <div class="order-item bg-red-500/10 border border-red-500/30 p-4 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                      <span class="px-2 py-1 bg-red-500 text-white rounded font-bold text-sm animate-pulse">NEW</span>
                      <span class="font-bold">#ORD-001</span>
                      <span class="text-gray-400">| Î∞∞Îã¨</span>
                    </div>
                    <span class="text-gray-400 text-sm">Î∞©Í∏à Ï†Ñ</span>
                  </div>
                  <div class="mb-3">
                    <p class="font-bold">Ï≤≠Íµ≠Ïû• Ï∞åÍ∞ú x1, ÎêúÏû•Ï∞åÍ∞ú x2</p>
                    <p class="text-cyan-400 font-bold">‚Ç©32,000 (Ïø†Ìè∞ 30% Ï†ÅÏö©)</p>
                  </div>
                  <div class="flex gap-2">
                    <button onclick="acceptOrder('ORD-001')" class="flex-1 py-2 bg-green-500 rounded-lg font-bold hover:bg-green-600 transition">‚úÖ Ï†ëÏàò</button>
                    <button onclick="rejectOrder('ORD-001')" class="px-4 py-2 bg-red-500/50 rounded-lg hover:bg-red-500 transition">‚ùå</button>
                  </div>
                </div>
                
                <!-- Ï§ÄÎπÑÏ§ë Ï£ºÎ¨∏ ÏòàÏãú -->
                <div class="order-item bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-lg">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                      <span class="px-2 py-1 bg-yellow-500 text-black rounded font-bold text-sm">Ï§ÄÎπÑÏ§ë</span>
                      <span class="font-bold">#ORD-002</span>
                      <span class="text-gray-400">| Ìè¨Ïû•</span>
                    </div>
                    <span class="text-gray-400 text-sm">5Î∂Ñ Ï†Ñ</span>
                  </div>
                  <div class="mb-3">
                    <p class="font-bold">Î∂àÍ≥†Í∏∞ Ï†ïÏãù x1</p>
                    <p class="text-cyan-400 font-bold">‚Ç©15,000</p>
                  </div>
                  <div class="flex gap-2">
                    <button onclick="completeOrder('ORD-002')" class="flex-1 py-2 bg-green-500 rounded-lg font-bold hover:bg-green-600 transition">‚úÖ Ï§ÄÎπÑ ÏôÑÎ£å</button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- üí∞ Îß§Ï∂ú ÌòÑÌô© -->
            <div id="mystore-content-sales" style="display:none;" class="card glow-border">
              <h4 class="text-xl font-bold mb-6">üí∞ Îß§Ï∂ú ÌòÑÌô©</h4>
              
              <div class="grid md:grid-cols-4 gap-4 mb-8">
                <div class="bg-gradient-to-br from-green-500/20 to-green-600/10 p-4 rounded-lg border border-green-500/30">
                  <p class="text-gray-400 text-sm">Ïò§Îäò Îß§Ï∂ú</p>
                  <p class="text-2xl font-black text-green-400">‚Ç©285,000</p>
                  <p class="text-xs text-green-400">+23% vs Ïñ¥Ï†ú</p>
                </div>
                <div class="bg-gradient-to-br from-cyan-500/20 to-cyan-600/10 p-4 rounded-lg border border-cyan-500/30">
                  <p class="text-gray-400 text-sm">Ïù¥Î≤à Ï£º Îß§Ï∂ú</p>
                  <p class="text-2xl font-black text-cyan-400">‚Ç©1,520,000</p>
                </div>
                <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/10 p-4 rounded-lg border border-purple-500/30">
                  <p class="text-gray-400 text-sm">Ïù¥Î≤à Îã¨ Îß§Ï∂ú</p>
                  <p class="text-2xl font-black text-purple-400">‚Ç©5,840,000</p>
                </div>
                <div class="bg-gradient-to-br from-pink-500/20 to-pink-600/10 p-4 rounded-lg border border-pink-500/30">
                  <p class="text-gray-400 text-sm">Ïø†Ìè∞ ÏÇ¨Ïö©</p>
                  <p class="text-2xl font-black text-pink-400">127Í±¥</p>
                </div>
              </div>
              
              <div class="flex gap-2">
                <button onclick="downloadReport('daily')" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">üìä ÏùºÍ∞Ñ Î¶¨Ìè¨Ìä∏</button>
                <button onclick="downloadReport('weekly')" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">üìà Ï£ºÍ∞Ñ Î¶¨Ìè¨Ìä∏</button>
                <button onclick="downloadReport('monthly')" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">üìâ ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏</button>
              </div>
            </div>
            
            <!-- üé´ Ïø†Ìè∞ ÌòÑÌô© -->
            <div id="mystore-content-coupons" style="display:none;" class="card glow-border">
              <h4 class="text-xl font-bold mb-6">üé´ Î∞úÍ∏âÌïú Ïø†Ìè∞ ÌòÑÌô©</h4>
              <div id="my-coupons-list">
                <!-- ÎèôÏ†Å Î°úÎìú -->
              </div>
            </div>
            
            <!-- üé® Îß§Ïû• Íæ∏ÎØ∏Í∏∞ -->
            <div id="mystore-content-decorate" style="display:none;" class="card glow-border">
              <h4 class="text-xl font-bold mb-6">üé® Îß§Ïû• Íæ∏ÎØ∏Í∏∞</h4>
              
              <div class="grid md:grid-cols-2 gap-6">
                <!-- ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ -->
                <div>
                  <label class="block mb-2 font-bold">üì∑ ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ</label>
                  <div class="border border-dashed border-purple-500 rounded-lg p-8 text-center bg-gray-800/50">
                    <input type="file" id="store-main-image" accept="image/*" class="hidden" onchange="previewStoreImage(this)">
                    <div id="store-image-preview" class="text-6xl mb-2">üñºÔ∏è</div>
                    <button onclick="document.getElementById('store-main-image').click()" class="btn-primary">Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</button>
                  </div>
                </div>
                
                <!-- Î°úÍ≥† -->
                <div>
                  <label class="block mb-2 font-bold">üè∑Ô∏è Îß§Ïû• Î°úÍ≥†</label>
                  <div class="border border-dashed border-cyan-500 rounded-lg p-8 text-center bg-gray-800/50">
                    <input type="file" id="store-logo" accept="image/*" class="hidden">
                    <div class="text-6xl mb-2">üé®</div>
                    <button onclick="document.getElementById('store-logo').click()" class="btn-primary">Î°úÍ≥† ÏóÖÎ°úÎìú</button>
                  </div>
                </div>
              </div>
              
              <div class="mt-6">
                <label class="block mb-2 font-bold">üìù Îß§Ïû• ÏÜåÍ∞úÍ∏Ä</label>
                <textarea id="store-intro-edit" class="w-full p-3 rounded bg-gray-900 border border-purple-500 min-h-[120px]" placeholder="Îß§Ïû• ÏÜåÍ∞úÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî..."></textarea>
              </div>
              
              <div class="grid md:grid-cols-2 gap-4 mt-6">
                <div>
                  <label class="block mb-2 font-bold">üìû Ïó∞ÎùΩÏ≤ò</label>
                  <input type="text" id="store-contact-edit" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="02-1234-5678">
                </div>
                <div>
                  <label class="block mb-2 font-bold">‚è∞ ÏòÅÏóÖÏãúÍ∞Ñ</label>
                  <input type="text" id="store-hours-edit" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="10:00 - 22:00">
                </div>
              </div>
              
              <div class="mt-6">
                <label class="block mb-2 font-bold">üìç Ï£ºÏÜå</label>
                <input type="text" id="store-address-edit" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨...">
              </div>
              
              <!-- Î©îÎâ¥ Í¥ÄÎ¶¨ -->
              <div class="mt-6">
                <label class="block mb-2 font-bold">üçΩÔ∏è Î©îÎâ¥ Í¥ÄÎ¶¨</label>
                <div class="flex gap-2">
                  <button onclick="downloadMenuTemplate()" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">üì• ÏóëÏÖÄ ÌÖúÌîåÎ¶ø Îã§Ïö¥</button>
                  <button onclick="document.getElementById('menu-upload').click()" class="px-4 py-2 bg-cyan-500 rounded hover:bg-cyan-600">üì§ Î©îÎâ¥ ÏóÖÎ°úÎìú</button>
                  <input type="file" id="menu-upload" accept=".xlsx,.xls,.csv" class="hidden">
                </div>
              </div>
              
              <!-- ÌôçÎ≥¥ ÏòÅÏÉÅ -->
              <div class="mt-6">
                <label class="block mb-2 font-bold">üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ</label>
                <div class="border border-dashed border-pink-500 rounded-lg p-8 text-center bg-gray-800/50">
                  <input type="file" id="store-promo-video" accept="video/*" class="hidden" onchange="previewPromoVideo(this)">
                  <div id="promo-video-preview" class="text-6xl mb-2">üé•</div>
                  <button onclick="document.getElementById('store-promo-video').click()" class="btn-primary">ÏòÅÏÉÅ ÏóÖÎ°úÎìú</button>
                </div>
              </div>
              
              <button onclick="saveStoreDecoration()" class="btn-primary w-full mt-8 text-lg py-4">üíæ Ï†ÄÏû•ÌïòÍ∏∞</button>
            </div>
          </div>
        </div>

        <!-- Ïø†Ìè∞ Î∞úÍ∏â ÌÉ≠ -->
        <!-- Ïø†Ìè∞ Î∞úÍ∏â ÌÉ≠ -->
        <div id="business-coupon-issue-tab" style="display: none;">
<!-- Ïø†Ìè∞ Í¥ÄÎ¶¨ Ìó§Îçî -->
<div class="flex justify-between items-center mb-6">
  <div>
    <h2 class="text-3xl font-bold flex items-center gap-2">üé´ Ïø†Ìè∞ Í¥ÄÎ¶¨</h2>
    <p class="text-gray-400 mt-1">Î∞úÍ∏âÌïú Ïø†Ìè∞ÏùÑ Í¥ÄÎ¶¨ÌïòÍ≥† ÏÉàÎ°úÏö¥ Ïù¥Î≤§Ìä∏Î•º ÏãúÏûëÌïòÏÑ∏Ïöî</p>
  </div>
  <button onclick="openNewCouponModal()" class="bg-gradient-to-r from-purple-600 to-cyan-500 px-6 py-3 rounded-lg font-bold hover:opacity-90 transition flex items-center gap-2">
    <span>+</span> ÏÉà Ïø†Ìè∞ ÎßåÎì§Í∏∞
  </button>
</div>

<!-- Ïø†Ìè∞ ÌÜµÍ≥Ñ Ïπ¥Îìú -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-gray-800/80 border border-purple-500/30 rounded-xl p-4">
    <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center mb-3">
      <span class="text-blue-400 text-xl">üé´</span>
    </div>
    <div class="text-2xl font-bold" id="stat-total-coupons">3</div>
    <div class="text-gray-400 text-sm">Ï†ÑÏ≤¥ Ïø†Ìè∞</div>
  </div>
  <div class="bg-gray-800/80 border border-green-500/30 rounded-xl p-4">
    <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center mb-3">
      <span class="text-green-400 text-xl">‚úÖ</span>
    </div>
    <div class="text-2xl font-bold" id="stat-active-coupons">1</div>
    <div class="text-gray-400 text-sm">ÌôúÏÑ± Ïø†Ìè∞</div>
  </div>
  <div class="bg-gray-800/80 border border-orange-500/30 rounded-xl p-4">
    <div class="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center mb-3">
      <span class="text-orange-400 text-xl">üë•</span>
    </div>
    <div class="text-2xl font-bold" id="stat-total-used">57</div>
    <div class="text-gray-400 text-sm">Ï¥ù ÏÇ¨Ïö©</div>
  </div>
  <div class="bg-gray-800/80 border border-pink-500/30 rounded-xl p-4">
    <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center mb-3">
      <span class="text-pink-400 text-xl">üìà</span>
    </div>
    <div class="text-2xl font-bold" id="stat-usage-rate">23%</div>
    <div class="text-gray-400 text-sm">ÏÇ¨Ïö©Î•†</div>
  </div>
</div>

<!-- AI Ïø†Ìè∞ ÏÉùÏÑ± -->
<div class="bg-gradient-to-r from-purple-900/60 to-blue-900/60 border border-purple-500/30 rounded-xl p-5 mb-6 flex items-center justify-between">
  <div class="flex items-center gap-4">
    <div class="w-12 h-12 rounded-full bg-purple-500/30 flex items-center justify-center">
      <span class="text-2xl">ü§ñ</span>
    </div>
    <div>
      <h3 class="font-bold text-lg">AI Ïø†Ìè∞ ÏÉùÏÑ±</h3>
      <p class="text-gray-400 text-sm">Ïù∏Í≥µÏßÄÎä•Ïù¥ ÏµúÏ†ÅÏùò Ïø†Ìè∞ÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§</p>
    </div>
  </div>
  <button onclick="aiGenerateCoupon()" class="bg-gradient-to-r from-purple-600 to-pink-500 px-5 py-2.5 rounded-lg font-bold hover:opacity-90 transition flex items-center gap-2">
    ‚ú® AIÎ°ú Ïø†Ìè∞ ÏûêÎèô ÏÉùÏÑ±
  </button>
</div>

<!-- üí∞ Ïø†Ìè∞ ÎπÑÏö© ÏïàÎÇ¥ -->
<div class="bg-gradient-to-r from-purple-500/10 to-cyan-500/10 border border-purple-500/30 p-4 rounded-lg mb-6">
  <p class="text-lg font-bold text-cyan-400 mb-2">üí∞ Ïø†Ìè∞ Î∞úÍ∏â ÎπÑÏö©: <span class="text-yellow-400">Ïû•Îãπ 100Ïõê</span></p>
  <p class="text-sm text-gray-400">Ïòà) 100Ïû• Î∞úÍ∏â Ïãú ‚Üí 10,000Ïõê / 1,000Ïû• Î∞úÍ∏â Ïãú ‚Üí 100,000Ïõê</p>
</div>

<!-- Ïø†Ìè∞ Í≤ÄÏÉâ & ÌïÑÌÑ∞ -->
<div class="flex flex-wrap items-center gap-4 mb-6">
  <div class="flex-1 min-w-[200px] relative">
    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">üîç</span>
    <input type="text" id="coupon-search" placeholder="Ïø†Ìè∞ Í≤ÄÏÉâ..." class="w-full p-3 pl-10 rounded-lg bg-gray-900 border border-gray-700 focus:border-purple-500 transition" oninput="filterCouponList()">
  </div>
  <div class="flex gap-2">
    <button onclick="setCouponFilter('all')" class="coupon-filter-btn active px-4 py-2 rounded-lg bg-purple-600 text-white font-bold transition" data-filter="all">Ï†ÑÏ≤¥</button>
    <button onclick="setCouponFilter('active')" class="coupon-filter-btn px-4 py-2 rounded-lg bg-gray-800 text-gray-400 font-bold hover:bg-gray-700 transition" data-filter="active">ÌôúÏÑ±</button>
    <button onclick="setCouponFilter('expired')" class="coupon-filter-btn px-4 py-2 rounded-lg bg-gray-800 text-gray-400 font-bold hover:bg-gray-700 transition" data-filter="expired">ÎßåÎ£å</button>
    <button onclick="setCouponFilter('pending')" class="coupon-filter-btn px-4 py-2 rounded-lg bg-gray-800 text-gray-400 font-bold hover:bg-gray-700 transition" data-filter="pending">ÎåÄÍ∏∞</button>
  </div>
</div>

<!-- Î∞úÍ∏âÌïú Ïø†Ìè∞ Î™©Î°ù -->
<div id="coupon-management-list" class="space-y-4"><div class="bg-gray-800/80 border border-gray-700 rounded-xl p-4 flex items-center gap-4 hover:border-purple-500/50 transition"><div class="relative w-20 h-20 rounded-lg bg-gray-700 flex-shrink-0 flex items-center justify-center overflow-hidden"><span class="text-3xl">üé´</span><span class="absolute top-1 left-1 text-xs font-bold px-1.5 py-0.5 rounded 10% bg-red-500/90 text-white">10%</span></div><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="text-xs px-2 py-0.5 rounded font-bold bg-gray-600">COMMON</span><h4 class="font-bold truncate">ÏÉà Ïø†Ìè∞</h4></div><p class="text-sm text-gray-400 truncate">10% discount on ÏÉà Ïø†Ìè∞</p><div class="flex items-center gap-4 text-xs text-gray-500 mt-1"><span>üìÖ 2026-03-22 ÍπåÏßÄ</span><span>üë• 0 / 100 ÏÇ¨Ïö©</span></div><div class="mt-2 h-1.5 bg-gray-700 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-purple-500 to-cyan-500 rounded-full transition-all" style="width:0%"></div></div></div><div class="flex flex-col items-end gap-2 flex-shrink-0"><span class="text-yellow-400 text-sm font-bold">‚è≥ ÎåÄÍ∏∞Ï§ë</span><button onclick="deleteManagedCoupon(1771738302112)" class="text-gray-500 hover:text-red-400 transition" title="ÏÇ≠Ï†ú">üóëÔ∏è</button></div></div><div class="bg-gray-800/80 border border-gray-700 rounded-xl p-4 flex items-center gap-4 hover:border-purple-500/50 transition"><div class="relative w-20 h-20 rounded-lg bg-gray-700 flex-shrink-0 flex items-center justify-center overflow-hidden"><span class="text-3xl">üé´</span><span class="absolute top-1 left-1 text-xs font-bold px-1.5 py-0.5 rounded 30% bg-red-500/90 text-white">30%</span></div><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="text-xs px-2 py-0.5 rounded font-bold bg-purple-600">EPIC</span><h4 class="font-bold truncate">ÏïÑÎØ∏ ÌïúÏ†ïÏãù 30% Ìï†Ïù∏</h4></div><p class="text-sm text-gray-400 truncate">Ï†Ñ Î©îÎâ¥ 30% Ìï†Ïù∏</p><div class="flex items-center gap-4 text-xs text-gray-500 mt-1"><span>üìÖ 2026-05-31 ÍπåÏßÄ</span><span>üë• 45 / 100 ÏÇ¨Ïö©</span></div><div class="mt-2 h-1.5 bg-gray-700 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-purple-500 to-cyan-500 rounded-full transition-all" style="width:45%"></div></div></div><div class="flex flex-col items-end gap-2 flex-shrink-0"><span class="text-green-400 text-sm font-bold">‚óè ÏßÑÌñâÏ§ë</span><button onclick="deleteManagedCoupon(1)" class="text-gray-500 hover:text-red-400 transition" title="ÏÇ≠Ï†ú">üóëÔ∏è</button></div></div><div class="bg-gray-800/80 border border-gray-700 rounded-xl p-4 flex items-center gap-4 hover:border-purple-500/50 transition"><div class="relative w-20 h-20 rounded-lg bg-gray-700 flex-shrink-0 flex items-center justify-center overflow-hidden"><span class="text-3xl">üé´</span><span class="absolute top-1 left-1 text-xs font-bold px-1.5 py-0.5 rounded 50% bg-red-500/90 text-white">50%</span></div><div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="text-xs px-2 py-0.5 rounded font-bold bg-blue-600">RARE</span><h4 class="font-bold truncate">ÏïÑÎØ∏ Îã§Î∞© Ïª§Ìîº 50% Ìï†Ïù∏</h4></div><p class="text-sm text-gray-400 truncate">Ïª§Ìîº Î©îÎâ¥ 50% Ìï†Ïù∏</p><div class="flex items-center gap-4 text-xs text-gray-500 mt-1"><span>üìÖ 2026-03-15 ÍπåÏßÄ</span><span>üë• 12 / 50 ÏÇ¨Ïö©</span></div><div class="mt-2 h-1.5 bg-gray-700 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-purple-500 to-cyan-500 rounded-full transition-all" style="width:24%"></div></div></div><div class="flex flex-col items-end gap-2 flex-shrink-0"><span class="text-yellow-400 text-sm font-bold">‚è≥ ÎåÄÍ∏∞Ï§ë</span><button onclick="deleteManagedCoupon(2)" class="text-gray-500 hover:text-red-400 transition" title="ÏÇ≠Ï†ú">üóëÔ∏è</button></div></div></div>
</div>
          
          <!-- Î∞úÍ∏âÌïú Ïø†Ìè∞ Î™©Î°ù -->
          <div class="card glow-border">
            <h3 class="text-xl font-bold mb-4">üìã Î∞úÍ∏âÌïú Ïø†Ìè∞ Î™©Î°ù</h3>
            <div id="my-issued-coupons">
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div class="flex-1">
                    <span class="rarity-badge epic">EPIC</span>
                    <h4 class="font-bold mt-2">ÏïÑÎØ∏ ÌïúÏ†ïÏãù 30% Ìï†Ïù∏</h4>
                    <p class="text-sm text-gray-400">ÏàòÎüâ: 100Í∞ú | ÏÇ¨Ïö©: 45Í∞ú | Ïú†Ìö®: 2026.05.31</p>
                  </div>
                  <div class="flex gap-2 items-center">
                    <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded">‚úÖ ÏäπÏù∏Îê®</span>
                    <button onclick="deleteCoupon('coupon-001')" class="px-3 py-1 bg-red-500/20 text-red-400 rounded hover:bg-red-500/40">üóëÔ∏è ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div class="flex-1">
                    <span class="rarity-badge rare">RARE</span>
                    <h4 class="font-bold mt-2">ÏïÑÎØ∏ Îã§Î∞© Ïª§Ìîº 50% Ìï†Ïù∏</h4>
                    <p class="text-sm text-gray-400">ÏàòÎüâ: 50Í∞ú | ÏÇ¨Ïö©: 12Í∞ú | Ïú†Ìö®: 2026.03.15</p>
                  </div>
                  <div class="flex gap-2 items-center">
                    <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded">‚è≥ Í≤ÄÌÜ†Ï§ë</span>
                    <button onclick="deleteCoupon('coupon-002')" class="px-3 py-1 bg-red-500/20 text-red-400 rounded hover:bg-red-500/40">üóëÔ∏è ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ ÌÉ≠ -->
        <div id="business-promo-tab" style="display:none;">
          <!-- üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ Îì±Î°ù ÏÑπÏÖò (Í∞ÄÏû• ÏúÑÏóê) -->
          <div class="card glow-border mb-8" style="border-color: #ef4444;">
            <h3 class="text-2xl font-bold mb-4 text-red-400">üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ Îì±Î°ù</h3>
            <p class="text-gray-400 mb-4">YouTube ÏòÅÏÉÅ URLÏùÑ Îì±Î°ùÌïòÎ©¥ Îß§Ïû• Î™©Î°ùÏóê Î∞îÎ°ú ÌëúÏãúÎê©ÎãàÎã§.</p>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- ÏòÅÏÉÅ URL ÏûÖÎ†• -->
              <div>
                <label class="block mb-2 text-sm text-gray-300">YouTube ÏòÅÏÉÅ URL</label>
                <div class="flex gap-2">
                  <input type="url" id="promo-video-url" class="flex-1 p-3 rounded bg-gray-900 border border-red-500" placeholder="https://youtube.com/watch?v=... ÎòêÎäî https://youtu.be/...">
                  <button onclick="registerPromoVideo()" class="px-6 py-3 bg-red-500 text-white font-bold rounded hover:bg-red-600 transition">Îì±Î°ù</button>
                </div>
                <p class="text-xs text-gray-500 mt-2">ÏßÄÏõê: youtube.com, youtu.be, youtube shorts</p>

                <!-- Îì±Î°ùÎêú ÏòÅÏÉÅ Î™©Î°ù -->
                <div id="registered-videos-list" class="mt-4 space-y-2">
        <div class="flex items-center justify-between p-3 bg-gray-800 rounded border border-gray-700">
          <div class="flex items-center gap-3">
            <span class="text-red-400">‚ñ∂Ô∏è</span>
            <div>
              <p class="font-bold text-sm">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</p>
              <p class="text-xs text-gray-400 truncate" style="max-width: 200px;">https://youtu.be/vdr2KcGD23g?si=4PEria7zwqn7j_Rx</p>
            </div>
          </div>
          <button onclick="removeRegisteredVideo('store-001')" class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs hover:bg-red-500/40">ÏÇ≠Ï†ú</button>
        </div>
      </div>
              </div>

              <!-- ÎØ∏Î¶¨Î≥¥Í∏∞ -->
              <div>
                <label class="block mb-2 text-sm text-gray-300">ÎØ∏Î¶¨Î≥¥Í∏∞</label>
                <div id="promo-video-preview" class="aspect-video bg-gray-900 rounded-lg flex items-center justify-center border border-gray-700">
                  <div class="text-center text-gray-500">
                    <span class="text-4xl block mb-2">‚ñ∂Ô∏è</span>
                    <span>URL ÏûÖÎ†• ÌõÑ ÎØ∏Î¶¨Î≥¥Í∏∞</span>
                  </div>
                </div>
                <button onclick="previewPromoVideo()" class="mt-2 w-full py-2 bg-gray-700 text-gray-300 rounded hover:bg-gray-600 transition">ÎØ∏Î¶¨Î≥¥Í∏∞</button>
              </div>
            </div>
          </div>

          <div class="card glow-border mb-8">
            <h3 class="text-2xl font-bold mb-4">üì∫ Îß§Ïû• ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ</h3>
            <p class="text-gray-400 mb-6">ÏµúÎåÄ 20ÌéòÏù¥ÏßÄÍπåÏßÄ ÌôçÎ≥¥ ÏûêÎ£åÎ•º Îì±Î°ùÌï† Ïàò ÏûàÏäµÎãàÎã§. (ÌòÑÏû¨: 3/20)</p>

            <button onclick="addPromoPage()" class="btn-primary mb-6" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">‚ûï ÏÉà ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä</button>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="promo-pages-list">
              <!-- ÌéòÏù¥ÏßÄ 1 -->
              <div class="bg-gray-800/50 p-4 rounded-lg border border-purple-500/30">
                <div class="aspect-video bg-gray-900 rounded mb-3 flex items-center justify-center">
                  <span class="text-4xl">üé¨</span>
                </div>
                <h4 class="font-bold mb-1">Îß§Ïû• ÏÜåÍ∞ú ÏòÅÏÉÅ</h4>
                <p class="text-sm text-gray-400 mb-3">ÏïÑÎØ∏ ÌïúÏ†ïÏãùÏùò Î™®Îì† Í≤É</p>
                <div class="flex gap-2">
                  <button onclick="editPromoPage(1)" class="flex-1 px-3 py-1 bg-blue-500/20 text-blue-400 rounded text-sm">ÏàòÏ†ï</button>
                  <button onclick="deletePromoPage(1)" class="flex-1 px-3 py-1 bg-red-500/20 text-red-400 rounded text-sm">ÏÇ≠Ï†ú</button>
                </div>
              </div>
              
              <!-- ÌéòÏù¥ÏßÄ 2 -->
              <div class="bg-gray-800/50 p-4 rounded-lg border border-purple-500/30">
                <div class="aspect-video bg-gray-900 rounded mb-3 flex items-center justify-center">
                  <span class="text-4xl">üì∑</span>
                </div>
                <h4 class="font-bold mb-1">ÎåÄÌëú Î©îÎâ¥ ÏÇ¨ÏßÑ</h4>
                <p class="text-sm text-gray-400 mb-3">ÌäπÏÑ† ÌïúÏ†ïÏãù ÏΩîÏä§</p>
                <div class="flex gap-2">
                  <button onclick="editPromoPage(2)" class="flex-1 px-3 py-1 bg-blue-500/20 text-blue-400 rounded text-sm">ÏàòÏ†ï</button>
                  <button onclick="deletePromoPage(2)" class="flex-1 px-3 py-1 bg-red-500/20 text-red-400 rounded text-sm">ÏÇ≠Ï†ú</button>
                </div>
              </div>
              
              <!-- ÌéòÏù¥ÏßÄ 3 -->
              <div class="bg-gray-800/50 p-4 rounded-lg border border-purple-500/30">
                <div class="aspect-video bg-gray-900 rounded mb-3 flex items-center justify-center">
                  <span class="text-4xl">üìÑ</span>
                </div>
                <h4 class="font-bold mb-1">Ïù¥Î≤§Ìä∏ ÏïàÎÇ¥</h4>
                <p class="text-sm text-gray-400 mb-3">12Ïõî ÌÅ¨Î¶¨Ïä§ÎßàÏä§ ÌäπÍ∞Ä</p>
                <div class="flex gap-2">
                  <button onclick="editPromoPage(3)" class="flex-1 px-3 py-1 bg-blue-500/20 text-blue-400 rounded text-sm">ÏàòÏ†ï</button>
                  <button onclick="deletePromoPage(3)" class="flex-1 px-3 py-1 bg-red-500/20 text-red-400 rounded text-sm">ÏÇ≠Ï†ú</button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ÌååÏùº ÏóÖÎ°úÎìú ÏÑπÏÖò -->
          <div class="card glow-border">
            <h3 class="text-xl font-bold mb-4">üìÅ ÌôçÎ≥¥ ÏûêÎ£å ÏóÖÎ°úÎìú</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="bg-gray-800/50 p-4 rounded-lg border border-dashed border-purple-500">
                <label class="cursor-pointer block text-center">
                  <span class="text-4xl block mb-2">üñºÔ∏è</span>
                  <span class="text-purple-400">Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</span>
                  <input type="file" class="hidden" accept="image/*" onchange="uploadPromoFile(this, 'image')">
                  <p class="text-xs text-gray-400 mt-1">JPG, PNG, GIF (ÏµúÎåÄ 10MB)</p>
                </label>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-dashed border-cyan-500">
                <label class="cursor-pointer block text-center">
                  <span class="text-4xl block mb-2">üé¨</span>
                  <span class="text-cyan-400">ÎèôÏòÅÏÉÅ ÏóÖÎ°úÎìú</span>
                  <input type="file" class="hidden" accept="video/*" onchange="uploadPromoFile(this, 'video')">
                  <p class="text-xs text-gray-400 mt-1">MP4, MOV (ÏµúÎåÄ 100MB)</p>
                </label>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-dashed border-green-500">
                <label class="cursor-pointer block text-center">
                  <span class="text-4xl block mb-2">üìÑ</span>
                  <span class="text-green-400">Î¨∏ÏÑú ÏóÖÎ°úÎìú</span>
                  <input type="file" class="hidden" accept=".pdf,.doc,.docx" onchange="uploadPromoFile(this, 'document')">
                  <p class="text-xs text-gray-400 mt-1">PDF, DOC (ÏµúÎåÄ 20MB)</p>
                </label>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-dashed border-yellow-500">
                <label class="cursor-pointer block text-center">
                  <span class="text-4xl block mb-2">üéµ</span>
                  <span class="text-yellow-400">Ïò§ÎîîÏò§ ÏóÖÎ°úÎìú</span>
                  <input type="file" class="hidden" accept="audio/*" onchange="uploadPromoFile(this, 'audio')">
                  <p class="text-xs text-gray-400 mt-1">MP3, WAV (ÏµúÎåÄ 30MB)</p>
                </label>
              </div>
            </div>
            
            <!-- ‚≠ê ÏäπÏù∏ Î∞îÎûçÎãàÎã§ Î≤ÑÌäº -->
            <div class="mt-8 p-6 bg-gradient-to-r from-green-500/10 to-emerald-500/10 border border-green-500/30 rounded-lg">
              <h4 class="text-xl font-bold text-green-400 mb-4">‚úÖ Î™®Îì† Ï§ÄÎπÑÍ∞Ä ÏôÑÎ£åÎêòÏÖ®ÎÇòÏöî?</h4>
              <p class="text-gray-400 mb-4">ÌéòÏù¥ÏßÄ Íµ¨ÏÑ±, Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ, ÌôçÎ≥¥ ÏòÅÏÉÅ/ÏÇ¨ÏßÑÏù¥ Î™®Îëê ÏôÑÎ£åÎêòÎ©¥ ÏïÑÎûò Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.</p>
              <ul class="text-sm text-gray-400 mb-6 space-y-1">
                <li>‚úì Îß§Ïû• Ï†ïÎ≥¥ ÏûÖÎ†• ÏôÑÎ£å</li>
                <li>‚úì Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏôÑÎ£å</li>
                <li>‚úì ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ Íµ¨ÏÑ± ÏôÑÎ£å</li>
                <li>‚úì ÏòÅÏÉÅ/ÏÇ¨ÏßÑ ÏûêÎ£å ÏóÖÎ°úÎìú ÏôÑÎ£å</li>
              </ul>
              <button onclick="requestFinalApproval()" class="btn-primary w-full text-lg py-4" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                ‚úÖ ÏäπÏù∏ Î∞îÎûçÎãàÎã§ (ÏµúÏ¢Ö Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Í≤ÄÌÜ† ÏöîÏ≤≠)
              </button>
            </div>
          </div>
        </div>

        <!-- ÎÇ¥ Îß§Ïû• (ÏïÑÎØ∏ ÌïúÏ†ïÏãù) - ÌôïÏû•Îêú ÎåÄÏãúÎ≥¥Îìú -->
        <div id="business-mystore-tab" style="display:none;">
          <div class="card glow-border mb-8">
            <div class="flex items-center gap-6 mb-6 flex-wrap">
              <div class="text-6xl">üç±</div>
              <div class="flex-1">
                <h3 class="text-3xl font-black gradient-text mb-2">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</h3>
                <p class="text-gray-400 mb-2">üìç ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123</p>
                <p class="text-gray-400">üìû 02-1234-5678</p>
                <a href="https://www.airctt.com" target="_blank" class="text-purple-400 hover:underline">üîó ÌôàÌéòÏù¥ÏßÄ Î∞îÎ°úÍ∞ÄÍ∏∞</a>
              </div>
              <div class="flex gap-2 flex-wrap">
                <button onclick="showPage('store')" class="btn-primary">üçΩÔ∏è Îß§Ïû• Î≥¥Í∏∞</button>
                <button onclick="openGoldenRabbitCFO()" class="btn-primary" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">üê∞ AI ÏßÄÎ∞∞Ïù∏</button>
              </div>
            </div>
          </div>

          <!-- üìä Î©îÏù∏ ÎåÄÏãúÎ≥¥Îìú ÌÉ≠ -->
          <div class="mb-6 flex gap-2 flex-wrap">
            <button onclick="showStoreDashboard('overview')" class="px-4 py-2 bg-cyan-500 rounded font-bold" id="dash-tab-overview">üìä Í∞úÏöî</button>
            <button onclick="showStoreDashboard('reservation')" class="px-4 py-2 bg-gray-700 rounded font-bold" id="dash-tab-reservation">üìÖ ÏòàÏïΩ</button>
            <button onclick="showStoreDashboard('sales')" class="px-4 py-2 bg-gray-700 rounded font-bold" id="dash-tab-sales">üí∞ ÌåêÎß§</button>
            <button onclick="showStoreDashboard('purchase')" class="px-4 py-2 bg-gray-700 rounded font-bold" id="dash-tab-purchase">üì¶ Îß§ÏûÖ</button>
            <button onclick="showStoreDashboard('revenue')" class="px-4 py-2 bg-gray-700 rounded font-bold" id="dash-tab-revenue">üìà Îß§Ï∂ú</button>
          </div>

          <!-- Í∞úÏöî ÎåÄÏãúÎ≥¥Îìú -->
          <div id="dash-content-overview">
            <div class="grid md:grid-cols-4 gap-4 mb-8">
              <div class="card glow-border text-center">
                <div class="text-4xl mb-2">üìä</div>
                <h3 class="text-sm text-gray-400 mb-1">Ï¥ù Î∞úÍ∏â Ïø†Ìè∞</h3>
                <p class="text-2xl font-black gradient-text">127</p>
                <button onclick="downloadReport('coupons')" class="text-xs text-purple-400 mt-2 hover:underline">üì• Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="card glow-border text-center">
                <div class="text-4xl mb-2">‚úÖ</div>
                <h3 class="text-sm text-gray-400 mb-1">ÏÇ¨Ïö©Îêú Ïø†Ìè∞</h3>
                <p class="text-2xl font-black gradient-text">89</p>
                <button onclick="downloadReport('used')" class="text-xs text-purple-400 mt-2 hover:underline">üì• Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="card glow-border text-center">
                <div class="text-4xl mb-2">üíµ</div>
                <h3 class="text-sm text-gray-400 mb-1">Ïò§Îäò Îß§Ï∂ú</h3>
                <p class="text-2xl font-black text-green-400">‚Ç©340,000</p>
                <button onclick="downloadReport('today')" class="text-xs text-purple-400 mt-2 hover:underline">üì• Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="card glow-border text-center">
                <div class="text-4xl mb-2">üìà</div>
                <h3 class="text-sm text-gray-400 mb-1">Ï¥ù Îß§Ï∂ú</h3>
                <p class="text-2xl font-black gradient-text">‚Ç©2,340,000</p>
                <button onclick="downloadReport('total')" class="text-xs text-purple-400 mt-2 hover:underline">üì• Îã§Ïö¥Î°úÎìú</button>
              </div>
            </div>
          </div>

          <!-- ÏòàÏïΩ ÎåÄÏãúÎ≥¥Îìú -->
          <div id="dash-content-reservation" style="display:none;">
            <div class="card glow-border mb-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">üìÖ ÏòàÏïΩ ÌòÑÌô©</h3>
                <button onclick="downloadReport('reservation')" class="btn-primary text-sm">üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gray-800">
                    <tr><th class="p-3 text-left">ÏòàÏïΩÏùº</th><th class="p-3">ÏãúÍ∞Ñ</th><th class="p-3">Ïù∏Ïõê</th><th class="p-3">Í≥†Í∞ùÎ™Ö</th><th class="p-3">Ïó∞ÎùΩÏ≤ò</th><th class="p-3">ÏÉÅÌÉú</th></tr>
                  </thead>
                  <tbody>
                    <tr class="border-b border-gray-700"><td class="p-3">2025-12-25</td><td class="p-3 text-center">18:00</td><td class="p-3 text-center">4Î™Ö</td><td class="p-3 text-center">ÍπÄÎØºÏàò</td><td class="p-3 text-center">010-****-1234</td><td class="p-3 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-sm">ÌôïÏ†ï</span></td></tr>
                    <tr class="border-b border-gray-700"><td class="p-3">2025-12-25</td><td class="p-3 text-center">19:30</td><td class="p-3 text-center">6Î™Ö</td><td class="p-3 text-center">Ïù¥ÏòÅÌù¨</td><td class="p-3 text-center">010-****-5678</td><td class="p-3 text-center"><span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-sm">ÎåÄÍ∏∞</span></td></tr>
                    <tr class="border-b border-gray-700"><td class="p-3">2025-12-26</td><td class="p-3 text-center">12:00</td><td class="p-3 text-center">2Î™Ö</td><td class="p-3 text-center">Î∞ïÏ≤†Ïàò</td><td class="p-3 text-center">010-****-9012</td><td class="p-3 text-center"><span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-sm">ÌôïÏ†ï</span></td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- ÌåêÎß§ ÎåÄÏãúÎ≥¥Îìú -->
          <div id="dash-content-sales" style="display:none;">
            <div class="card glow-border mb-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">üí∞ ÌåêÎß§ ÎÇ¥Ïó≠</h3>
                <button onclick="downloadReport('sales')" class="btn-primary text-sm">üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gray-800/50 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Ïò§Îäò ÌåêÎß§</p>
                  <p class="text-2xl font-bold text-green-400">‚Ç©340,000</p>
                  <p class="text-xs text-gray-500">Í±¥Ïàò: 12Í±¥</p>
                </div>
                <div class="bg-gray-800/50 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Ïù¥Î≤àÏ£º ÌåêÎß§</p>
                  <p class="text-2xl font-bold text-cyan-400">‚Ç©1,280,000</p>
                  <p class="text-xs text-gray-500">Í±¥Ïàò: 45Í±¥</p>
                </div>
                <div class="bg-gray-800/50 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Ïù¥Î≤àÎã¨ ÌåêÎß§</p>
                  <p class="text-2xl font-bold text-purple-400">‚Ç©4,560,000</p>
                  <p class="text-xs text-gray-500">Í±¥Ïàò: 187Í±¥</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Îß§ÏûÖ ÎåÄÏãúÎ≥¥Îìú -->
          <div id="dash-content-purchase" style="display:none;">
            <div class="card glow-border mb-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">üì¶ Îß§ÏûÖ ÎÇ¥Ïó≠</h3>
                <button onclick="downloadReport('purchase')" class="btn-primary text-sm">üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gray-800/50 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Ïò§Îäò Îß§ÏûÖ</p>
                  <p class="text-2xl font-bold text-red-400">‚Ç©120,000</p>
                </div>
                <div class="bg-gray-800/50 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Ïù¥Î≤àÏ£º Îß§ÏûÖ</p>
                  <p class="text-2xl font-bold text-orange-400">‚Ç©450,000</p>
                </div>
                <div class="bg-gray-800/50 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Ïù¥Î≤àÎã¨ Îß§ÏûÖ</p>
                  <p class="text-2xl font-bold text-yellow-400">‚Ç©1,800,000</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Îß§Ï∂ú ÎåÄÏãúÎ≥¥Îìú -->
          <div id="dash-content-revenue" style="display:none;">
            <div class="card glow-border mb-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">üìà Îß§Ï∂ú Î∂ÑÏÑù</h3>
                <button onclick="downloadReport('revenue')" class="btn-primary text-sm">üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
              </div>
              <div class="grid md:grid-cols-2 gap-4 mb-6">
                <div class="bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-6 rounded-lg border border-green-500/30">
                  <p class="text-gray-400 text-sm mb-2">ÏàúÏù¥Ïùµ (Îß§Ï∂ú - Îß§ÏûÖ)</p>
                  <p class="text-3xl font-black text-green-400">‚Ç©2,760,000</p>
                  <p class="text-sm text-green-300 mt-2">‚Üë 15% Ï†ÑÏõî ÎåÄÎπÑ</p>
                </div>
                <div class="bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-6 rounded-lg border border-purple-500/30">
                  <p class="text-gray-400 text-sm mb-2">Ïø†Ìè∞ Í∏∞Ïó¨ Îß§Ï∂ú</p>
                  <p class="text-3xl font-black text-purple-400">‚Ç©1,890,000</p>
                  <p class="text-sm text-purple-300 mt-2">Ï†ÑÏ≤¥ Îß§Ï∂úÏùò 41%</p>
                </div>
              </div>
            </div>
          </div>

          <!-- üìÅ ÌååÏùº Í¥ÄÎ¶¨Ïûê -->
          <div class="card glow-border mb-8">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-bold">üìÅ ÌååÏùº Í¥ÄÎ¶¨Ïûê</h3>
              <div class="flex gap-2">
                <button onclick="uploadFile()" class="px-3 py-2 bg-purple-600 rounded text-sm hover:bg-purple-700">üì§ ÌååÏùº ÏóÖÎ°úÎìú</button>
                <button onclick="createDocument()" class="px-3 py-2 bg-cyan-600 rounded text-sm hover:bg-cyan-700">üìù ÏÉà Î¨∏ÏÑú</button>
              </div>
            </div>
            
            <!-- ÌååÏùº Î™©Î°ù -->
            <div class="grid md:grid-cols-3 gap-4 mb-6" id="file-list">
              <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 hover:border-purple-500 transition cursor-pointer" onclick="openFileEditor('Îß§Ïû•ÏÜåÍ∞ú.txt')">
                <div class="flex items-center gap-3 mb-2">
                  <span class="text-2xl">üìÑ</span>
                  <div class="flex-1">
                    <p class="font-bold">Îß§Ïû•ÏÜåÍ∞ú.txt</p>
                    <p class="text-xs text-gray-400">2.3 KB ¬∑ 12/19 ÏàòÏ†ï</p>
                  </div>
                  <button onclick="event.stopPropagation(); downloadFile('Îß§Ïû•ÏÜåÍ∞ú.txt')" class="text-cyan-400 hover:text-cyan-300">üì•</button>
                </div>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 hover:border-purple-500 transition cursor-pointer" onclick="openFileEditor('Î©îÎâ¥Ìåê.xlsx')">
                <div class="flex items-center gap-3 mb-2">
                  <span class="text-2xl">üìä</span>
                  <div class="flex-1">
                    <p class="font-bold">Î©îÎâ¥Ìåê.xlsx</p>
                    <p class="text-xs text-gray-400">15.8 KB ¬∑ 12/18 ÏàòÏ†ï</p>
                  </div>
                  <button onclick="event.stopPropagation(); downloadFile('Î©îÎâ¥Ìåê.xlsx')" class="text-cyan-400 hover:text-cyan-300">üì•</button>
                </div>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 hover:border-purple-500 transition cursor-pointer" onclick="openFileEditor('Îß§Ï∂úÎ≥¥Í≥†ÏÑú.pdf')">
                <div class="flex items-center gap-3 mb-2">
                  <span class="text-2xl">üìï</span>
                  <div class="flex-1">
                    <p class="font-bold">Îß§Ï∂úÎ≥¥Í≥†ÏÑú.pdf</p>
                    <p class="text-xs text-gray-400">1.2 MB ¬∑ 12/15 ÏàòÏ†ï</p>
                  </div>
                  <button onclick="event.stopPropagation(); downloadFile('Îß§Ï∂úÎ≥¥Í≥†ÏÑú.pdf')" class="text-cyan-400 hover:text-cyan-300">üì•</button>
                </div>
              </div>
            </div>

            <!-- ÏòÅÏÉÅ Îì±Î°ù -->
            <div class="mt-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
              <h4 class="font-bold text-red-400 mb-3">üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ Îì±Î°ù</h4>
              <div class="flex gap-2 mb-3">
                <input type="url" id="file-video-url" class="flex-1 p-3 rounded bg-gray-900 border border-red-500" placeholder="YouTube URL ÏûÖÎ†• (https://youtube.com/watch?v=...)">
                <button onclick="registerFileVideo()" class="px-4 py-2 bg-red-500 rounded font-bold hover:bg-red-600">Îì±Î°ù</button>
              </div>
              <div id="file-video-preview"></div>
              <div id="file-video-list" class="mt-3 space-y-2"></div>
            </div>

            <!-- ÌååÏùº ÏóÖÎ°úÎìú -->
            <div class="mt-4 p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-lg">
              <h4 class="font-bold text-cyan-400 mb-3">üì§ ÌååÏùº ÏóÖÎ°úÎìú</h4>
              <input type="file" id="file-upload-input" class="hidden" onchange="handleFileUpload(this)" multiple="">
              <button onclick="document.getElementById('file-upload-input').click()" class="w-full py-3 bg-cyan-500 rounded font-bold hover:bg-cyan-600">
                üìÅ ÌååÏùº ÏÑ†ÌÉù (ÏòÅÏÉÅ, Ïù¥ÎØ∏ÏßÄ, Î¨∏ÏÑú)
              </button>
              <p class="text-xs text-gray-400 mt-2">ÏßÄÏõê ÌòïÏãù: MP4, MOV, JPG, PNG, PDF, XLSX, DOCX</p>
              <div id="upload-file-list" class="mt-3 space-y-2"></div>
            </div>

            <!-- ÌååÏùº Ìé∏ÏßëÍ∏∞ -->
            <div id="file-editor" class="bg-gray-900 rounded-lg border border-purple-500/30 p-4" style="display:none;">
              <div class="flex justify-between items-center mb-4">
                <h4 class="font-bold text-cyan-400" id="editor-filename">üìù ÌååÏùº Ìé∏Ïßë</h4>
                <div class="flex gap-2">
                  <button onclick="saveFileContent()" class="px-3 py-1 bg-green-600 rounded text-sm hover:bg-green-700">üíæ Ï†ÄÏû•</button>
                  <button onclick="closeFileEditor()" class="px-3 py-1 bg-gray-700 rounded text-sm hover:bg-gray-600">‚úï Îã´Í∏∞</button>
                </div>
              </div>
              <textarea id="file-content" class="w-full h-48 p-4 bg-gray-800 rounded border border-gray-700 font-mono text-sm resize-none" placeholder="ÌååÏùº ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
              <p class="text-xs text-gray-500 mt-2">üí° ÌåÅ: Ctrl+SÎ°ú Ï†ÄÏû•, ÏûêÎèô Ï†ÄÏû• ÏßÄÏõê</p>
            </div>
          </div>

          <!-- üê∞ Golden Rabbit CFO AI ÏßÄÎ∞∞Ïù∏ -->
          <div id="golden-rabbit-cfo" class="card mb-8" style="display:none; background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%); border: 2px solid #f59e0b;">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-12 h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center text-2xl">üê∞</div>
              <div>
                <h3 class="text-xl font-bold text-yellow-400">Golden Rabbit CFO <span class="bg-yellow-500 text-black px-2 py-0.5 rounded text-xs font-bold ml-2">PRO</span></h3>
                <p class="text-sm text-gray-400">‚óè Gemini 1.5 Pro Connected</p>
              </div>
              <button onclick="closeGoldenRabbitCFO()" class="ml-auto text-gray-400 hover:text-white">‚úï</button>
            </div>
            
            <div class="bg-gray-900/50 rounded-lg p-4 mb-4 max-h-[300px] overflow-y-auto" id="cfo-chat-messages">
              <div class="flex gap-3 mb-4">
                <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-sm">üê∞</div>
                <div class="flex-1 bg-gray-800 p-3 rounded-lg">
                  <p class="text-sm">ÏïàÎÖïÌïòÏÑ∏Ïöî, ÏÇ¨Ïû•Îãò!</p>
                  <p class="text-sm mt-2">AIRCTT Í≥µÏãù Í≤ΩÏòÅÎπÑÏÑú "Í≥®Îì† ÎûòÎπó"ÏûÖÎãàÎã§. üê∞ ‚ú®</p>
                  <p class="text-sm mt-2">ÏÇ¨Ïû•ÎãòÏùò Îß§Ïû• Îç∞Ïù¥ÌÑ∞Î•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§.<br>Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?</p>
                </div>
              </div>
            </div>
            
            <div class="flex gap-2 mb-4 flex-wrap">
              <button onclick="askCFO('sales')" class="px-3 py-2 bg-gray-800 rounded text-sm hover:bg-gray-700">üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑùÌï¥Ï§ò</button>
              <button onclick="askCFO('tax')" class="px-3 py-2 bg-gray-800 rounded text-sm hover:bg-gray-700">üìã ÏÑ∏Î¨¥ Ïã†Í≥† ÎèÑÏôÄÏ§ò</button>
              <button onclick="askCFO('marketing')" class="px-3 py-2 bg-gray-800 rounded text-sm hover:bg-gray-700">üì¢ ÎßàÏºÄÌåÖ Ï°∞Ïñ∏Ìï¥Ï§ò</button>
            </div>
            
            <div class="flex gap-2">
              <input type="text" id="cfo-input" class="flex-1 p-3 rounded bg-gray-900 border border-yellow-500" placeholder="Î¨¥ÏóáÏù¥Îì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî... (Ïòà: ÏßÄÎÇúÎã¨Î≥¥Îã§ Îß§Ï∂ú Ïñ¥Îïå?)">
              <button onclick="sendToCFO()" class="btn-primary" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">‚ú®</button>
            </div>
          </div>

          <button onclick="showCouponIssueForm()" class="btn-primary mb-8">üé´ ÏÉà Ïø†Ìè∞ Î∞úÍ∏â</button>

          <!-- Ïø†Ìè∞ Î∞úÍ∏â Ìèº -->
          <div id="coupon-issue-form" class="card glow-border mb-8" style="display:none;">
            <h3 class="text-2xl font-bold mb-6">üé´ Ïø†Ìè∞ Î∞úÍ∏âÌïòÍ∏∞</h3>
            <form onsubmit="issueCoupon(event)">
              <div class="mb-4">
                <label class="block mb-2">Ïø†Ìè∞ Ï†úÎ™© *</label>
                <input type="text" id="coupon-title" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="Ïòà: ÌäπÏÑ† ÌïúÏ†ïÏãù 20% Ìï†Ïù∏" required="">
              </div>

              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block mb-2">Ìï†Ïù∏ Î∞©Ïãù *</label>
                  <select id="coupon-discount-type" class="w-full p-3 rounded bg-gray-900 border border-purple-500" onchange="toggleDiscountInput()" required="">
                    <option value="percentage">ÌçºÏÑºÌä∏ Ìï†Ïù∏ (%)</option>
                    <option value="fixed">Í∏àÏï° Ìï†Ïù∏ (‚Ç©)</option>
                  </select>
                </div>
                <div>
                  <label class="block mb-2">Ìï†Ïù∏Í∞í *</label>
                  <input type="number" id="coupon-discount-value" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="20" required="">
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block mb-2">Ìù¨Í∑ÄÎèÑ *</label>
                  <select id="coupon-rarity" class="w-full p-3 rounded bg-gray-900 border border-purple-500" required="">
                    <option value="common">Common (ÏùºÎ∞ò)</option>
                    <option value="rare">Rare (Î†àÏñ¥)</option>
                    <option value="epic" selected="">Epic (ÏóêÌîΩ)</option>
                    <option value="legendary">Legendary (Ï†ÑÏÑ§)</option>
                    <option value="mythic">Mythic (Ïã†Ìôî)</option>
                  </select>
                </div>
                <div>
                  <label class="block mb-2">Î∞úÍ∏â ÏàòÎüâ *</label>
                  <input type="number" id="coupon-quantity" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="100" required="">
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block mb-2">ÏÇ¨Ïö© Í∏∞Ìïú *</label>
                  <input type="date" id="coupon-expiry" class="w-full p-3 rounded bg-gray-900 border border-purple-500" required="">
                </div>
                <div>
                  <label class="block mb-2">Î∞∞Ìè¨ Î∞òÍ≤Ω (km)</label>
                  <input type="number" id="coupon-radius" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="5" value="5">
                </div>
              </div>

              <div class="mb-6">
                <label class="block mb-2">Ïø†Ìè∞ ÏÑ§Î™Ö</label>
                <textarea id="coupon-description" class="w-full p-3 rounded bg-gray-900 border border-purple-500" rows="3" placeholder="Ïø†Ìè∞ ÏÇ¨Ïö© Ï°∞Í±¥ Îì±ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
              </div>

              <div class="flex gap-4">
                <button type="submit" class="btn-primary flex-1">üöÄ Ïø†Ìè∞ Î∞úÍ∏â</button>
                <button type="button" onclick="hideCouponIssueForm()" class="btn-primary flex-1" style="opacity: 0.6;">Ï∑®ÏÜå</button>
              </div>
            </form>
          </div>

          <div class="card glow-border">
            <h3 class="text-2xl font-bold mb-4">Î∞úÍ∏âÌïú Ïø†Ìè∞ Î™©Î°ù</h3>
            <div id="business-coupon-list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ -->
    <div id="admin-page" class="page">
      <div class="max-w-6xl mx-auto px-4 py-20">
        <h2 class="text-4xl font-black mb-8 gradient-text">üîê Í¥ÄÎ¶¨Ïûê ÏãúÏä§ÌÖú</h2>
        
        <!-- Í¥ÄÎ¶¨Ïûê ÌÉÄÏûÖ ÏÑ†ÌÉù ÌÉ≠ -->
        <div class="flex gap-4 mb-8 flex-wrap">
          <button onclick="showAdminTab('super')" id="tab-super" class="btn-primary" style="background: linear-gradient(135deg, rgb(239, 68, 68) 0%, rgb(220, 38, 38) 100%); opacity: 0.5;">üëë ÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê</button>
          <button onclick="showAdminTab('store')" id="tab-store" class="btn-primary" style="background: linear-gradient(135deg, rgb(34, 197, 94) 0%, rgb(16, 185, 129) 100%); opacity: 1;">üè™ Îß§Ïû• Í¥ÄÎ¶¨Ïûê</button>
          <button onclick="showAdminTab('users')" id="tab-users" class="btn-primary" style="opacity: 0.5;">üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</button>
          <button onclick="showAdminTab('coupons')" id="tab-coupons" class="btn-primary" style="opacity: 0.5;">üé´ Ïø†Ìè∞ ÏäπÏù∏</button>
        </div>
        
        <!-- ========== üëë ÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê (Super Admin) ========== -->
        <div id="admin-super" class="admin-section" style="display: none;">
          <div class="card glow-border mb-8" style="border-color: #ef4444;">
            <h3 class="text-2xl font-bold mb-4 text-red-400">üëë ÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</h3>
            <p class="text-gray-400 mb-6">ÌîåÎû´Ìèº Ï†ÑÏ≤¥ Í¥ÄÎ¶¨ ¬∑ Îß§Ïû• ÏäπÏù∏ ¬∑ ÏãúÏä§ÌÖú ÏÑ§Ï†ï</p>
            
            <div class="grid md:grid-cols-4 gap-4 mb-8">
              <div class="bg-gradient-to-br from-red-500/20 to-orange-500/20 p-4 rounded-lg text-center border border-red-500/30">
                <p class="text-3xl font-bold text-red-400" id="super-total-stores">23</p>
                <p class="text-sm text-gray-400">Îì±Î°ù Îß§Ïû•</p>
              </div>
              <div class="bg-gradient-to-br from-green-500/20 to-emerald-500/20 p-4 rounded-lg text-center border border-green-500/30">
                <p class="text-3xl font-bold text-green-400" id="super-active-stores">18</p>
                <p class="text-sm text-gray-400">ÌôúÏÑ± Îß§Ïû•</p>
              </div>
              <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 p-4 rounded-lg text-center border border-purple-500/30">
                <p class="text-3xl font-bold text-purple-400" id="super-total-users">1,247</p>
                <p class="text-sm text-gray-400">Ï¥ù ÏÇ¨Ïö©Ïûê</p>
              </div>
              <div class="bg-gradient-to-br from-cyan-500/20 to-blue-500/20 p-4 rounded-lg text-center border border-cyan-500/30">
                <p class="text-3xl font-bold text-cyan-400" id="super-total-revenue">‚Ç©12,450,000</p>
                <p class="text-sm text-gray-400">Ï¥ù Í±∞ÎûòÏï°</p>
              </div>
            </div>
          </div>
          
          <!-- Îß§Ïû• ÏäπÏù∏ Í¥ÄÎ¶¨ -->
          <div class="card glow-border mb-8" style="border-color: #ef4444;">
            <h3 class="text-xl font-bold mb-4">üè™ Îß§Ïû• ÏäπÏù∏ ÎåÄÍ∏∞</h3>
            <div id="super-pending-stores">
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div>
                    <h4 class="text-lg font-bold">‚òï ÏïÑÎØ∏ Îã§Î∞©</h4>
                    <p class="text-sm text-gray-400">Ïπ¥Ìéò ¬∑ ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ¬∑ Ïã†Ï≤≠Ïùº: 2025-12-18</p>
                    <p class="text-sm text-yellow-400">ÎåÄÌëú: ÍπÄÎã§Î∞© ¬∑ 010-1234-5678</p>
                  </div>
                  <div class="flex gap-2 flex-wrap">
                    <button onclick="approveStore('store-002')" class="px-4 py-2 bg-green-500 rounded text-white font-bold">‚úì ÏäπÏù∏</button>
                    <button onclick="reviewStore('store-002')" class="px-4 py-2 bg-yellow-500 rounded text-white font-bold">üîç Í≤ÄÌÜ†Ï§ë</button>
                    <button onclick="rejectStore('store-002')" class="px-4 py-2 bg-red-500 rounded text-white font-bold">‚úï ÏäπÏù∏Ï∑®ÏÜå</button>
                  </div>
                </div>
              </div>
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div>
                    <h4 class="text-lg font-bold">üçó Ìô©Í∏àÏò¨Î¶¨Î∏å ÏπòÌÇ®</h4>
                    <p class="text-sm text-gray-400">ÏπòÌÇ® ¬∑ ÏÑúÏö∏ ÏÜ°ÌååÍµ¨ ¬∑ Ïã†Ï≤≠Ïùº: 2025-12-17</p>
                    <p class="text-sm text-yellow-400">ÎåÄÌëú: Î∞ïÏπòÌÇ® ¬∑ 010-9876-5432</p>
                  </div>
                  <div class="flex gap-2 flex-wrap">
                    <button onclick="approveStore('store-003')" class="px-4 py-2 bg-green-500 rounded text-white font-bold">‚úì ÏäπÏù∏</button>
                    <button onclick="reviewStore('store-003')" class="px-4 py-2 bg-yellow-500 rounded text-white font-bold">üîç Í≤ÄÌÜ†Ï§ë</button>
                    <button onclick="rejectStore('store-003')" class="px-4 py-2 bg-red-500 rounded text-white font-bold">‚úï ÏäπÏù∏Ï∑®ÏÜå</button>
                  </div>
                </div>
              </div>
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div>
                    <h4 class="text-lg font-bold">ü•© ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë</h4>
                    <p class="text-sm text-gray-400">ÏñëÏãù ¬∑ ÏÑúÏö∏ Ï§ëÎûëÍµ¨ Î©¥Î™©Îèô ¬∑ Ïã†Ï≤≠Ïùº: 2025-12-19</p>
                    <p class="text-sm text-yellow-400">ÎåÄÌëú: Ïù¥ÌòÑÏã§ ¬∑ 010-5555-1234</p>
                  </div>
                  <div class="flex gap-2 flex-wrap">
                    <button onclick="approveStore('store-004')" class="px-4 py-2 bg-green-500 rounded text-white font-bold">‚úì ÏäπÏù∏</button>
                    <button onclick="reviewStore('store-004')" class="px-4 py-2 bg-yellow-500 rounded text-white font-bold">üîç Í≤ÄÌÜ†Ï§ë</button>
                    <button onclick="rejectStore('store-004')" class="px-4 py-2 bg-red-500 rounded text-white font-bold">‚úï ÏäπÏù∏Ï∑®ÏÜå</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Ï†ÑÏ≤¥ Îß§Ïû• Î™©Î°ù -->
          <div class="card glow-border" style="border-color: #ef4444;">
            <h3 class="text-xl font-bold mb-4">üìã Ï†ÑÏ≤¥ Îß§Ïû• Î™©Î°ù</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-left">
                <thead>
                  <tr class="border-b border-gray-700">
                    <th class="p-3">Îß§Ïû•Î™Ö</th>
                    <th class="p-3">ÏóÖÏ¢Ö</th>
                    <th class="p-3">ÎåÄÌëú</th>
                    <th class="p-3">ÏÉÅÌÉú</th>
                    <th class="p-3">Îì±Í∏â</th>
                    <th class="p-3">Í¥ÄÎ¶¨</th>
                  </tr>
                </thead>
                <tbody id="super-store-list">
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3 font-bold">üçö ÏïÑÎØ∏ ÌïúÏ†ïÏãù</td>
                    <td class="p-3">ÌïúÏãù</td>
                    <td class="p-3">ÎÖ∏Ïö©Ìò∏</td>
                    <td class="p-3"><span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ON</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-sm">Grade 1</span></td>
                    <td class="p-3">
                      <button onclick="toggleStoreActive('store-001')" class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button>
                    </td>
                  </tr>
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3 font-bold">‚òï ÏïÑÎØ∏ Îã§Î∞©</td>
                    <td class="p-3">Ïπ¥Ìéò</td>
                    <td class="p-3">ÍπÄÎã§Î∞©</td>
                    <td class="p-3"><span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">Í≤ÄÌÜ†Ï§ë</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-gray-500/20 text-gray-400 rounded text-sm">Grade 0</span></td>
                    <td class="p-3">
                      <button onclick="toggleStoreActive('store-002')" class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button>
                    </td>
                  </tr>
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3 font-bold">ü•© ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë</td>
                    <td class="p-3">ÏñëÏãù</td>
                    <td class="p-3">Ïù¥ÌòÑÏã§</td>
                    <td class="p-3"><span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">ÎåÄÍ∏∞</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-gray-500/20 text-gray-400 rounded text-sm">Grade 0</span></td>
                    <td class="p-3">
                      <button onclick="toggleStoreActive('store-004')" class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- ========== üè™ Îß§Ïû• Í¥ÄÎ¶¨Ïûê (Store Admin) ========== -->
        <div id="admin-store" class="admin-section" style="display: block;">
          <div class="card glow-border mb-8" style="border-color: #22c55e;">
            <h3 class="text-2xl font-bold mb-4 text-green-400">üè™ Îß§Ïû• Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</h3>
            <p class="text-gray-400 mb-6">ÎÇ¥ Îß§Ïû• Í¥ÄÎ¶¨ ¬∑ Ïø†Ìè∞ Î∞úÍ∏â ¬∑ Ï£ºÎ¨∏ Í¥ÄÎ¶¨ ¬∑ Îß§Ï∂ú Î∂ÑÏÑù</p>
            
            <!-- Îß§Ïû• Ï†ïÎ≥¥ -->
            <div class="bg-gradient-to-r from-green-500/10 to-emerald-500/10 p-6 rounded-lg border border-green-500/30 mb-6">
              <div class="flex items-center gap-4 mb-4">
                <span class="text-6xl">üçö</span>
                <div>
                  <h4 class="text-2xl font-bold">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</h4>
                  <p class="text-gray-400">ÌïúÏãù ¬∑ ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123</p>
                  <p class="text-green-400">‚≠ê 4.8 (1,234Í∞ú Î¶¨Î∑∞) ¬∑ ÏòÅÏóÖÏ§ë</p>
                </div>
              </div>
            </div>
            
            <div class="grid md:grid-cols-4 gap-4">
              <div class="bg-gradient-to-br from-green-500/20 to-emerald-500/20 p-4 rounded-lg text-center border border-green-500/30">
                <p class="text-3xl font-bold text-green-400" id="store-today-orders">47</p>
                <p class="text-sm text-gray-400">Ïò§Îäò Ï£ºÎ¨∏</p>
              </div>
              <div class="bg-gradient-to-br from-cyan-500/20 to-blue-500/20 p-4 rounded-lg text-center border border-cyan-500/30">
                <p class="text-3xl font-bold text-cyan-400" id="store-today-revenue">‚Ç©892,000</p>
                <p class="text-sm text-gray-400">Ïò§Îäò Îß§Ï∂ú</p>
              </div>
              <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 p-4 rounded-lg text-center border border-purple-500/30">
                <p class="text-3xl font-bold text-purple-400" id="store-active-coupons">127</p>
                <p class="text-sm text-gray-400">ÌôúÏÑ± Ïø†Ìè∞</p>
              </div>
              <div class="bg-gradient-to-br from-yellow-500/20 to-orange-500/20 p-4 rounded-lg text-center border border-yellow-500/30">
                <p class="text-3xl font-bold text-yellow-400" id="store-coupon-used">89</p>
                <p class="text-sm text-gray-400">Ïø†Ìè∞ ÏÇ¨Ïö©</p>
              </div>
            </div>
          </div>
          
          <!-- Ïã§ÏãúÍ∞Ñ Ï£ºÎ¨∏ ÌòÑÌô© -->
          <div class="card glow-border mb-8" style="border-color: #22c55e;">
            <h3 class="text-xl font-bold mb-4">üì¶ Ïã§ÏãúÍ∞Ñ Ï£ºÎ¨∏ ÌòÑÌô©</h3>
            <div id="store-orders-list">
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div>
                    <span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-sm">üöö Î∞∞Îã¨</span>
                    <h4 class="text-lg font-bold mt-2">Ï£ºÎ¨∏Î≤àÌò∏: ORD-2024121801</h4>
                    <p class="text-sm text-gray-400">Î∂àÍ≥†Í∏∞ Ï†ïÏãù x2, ÎêúÏû•Ï∞åÍ∞ú x1</p>
                    <p class="text-sm text-cyan-400">Ï¥ùÏï°: ‚Ç©59,000 (Ïø†Ìè∞ -‚Ç©11,800 = ‚Ç©47,200)</p>
                  </div>
                  <div class="flex gap-2">
                    <button onclick="acceptOrder('ORD-001')" class="px-4 py-2 bg-green-500 rounded text-white font-bold">‚úì Ï†ëÏàò</button>
                    <button onclick="rejectOrder('ORD-001')" class="px-4 py-2 bg-red-500 rounded text-white font-bold">‚úï Í±∞Ï†à</button>
                  </div>
                </div>
              </div>
              <div class="border-b border-gray-700 pb-4 mb-4">
                <div class="flex justify-between items-center flex-wrap gap-4">
                  <div>
                    <span class="px-2 py-1 bg-cyan-500/20 text-cyan-400 rounded text-sm">üèÉ Ìè¨Ïû•</span>
                    <h4 class="text-lg font-bold mt-2">Ï£ºÎ¨∏Î≤àÌò∏: ORD-2024121802</h4>
                    <p class="text-sm text-gray-400">ÏïÑÎØ∏ Ï†ïÏãù x1, ÏôïÍ∞àÎπÑÌÉï x1</p>
                    <p class="text-sm text-cyan-400">Ï¥ùÏï°: ‚Ç©40,000 (Ïø†Ìè∞ -‚Ç©20,000 = ‚Ç©20,000)</p>
                  </div>
                  <div class="flex gap-2">
                    <span class="px-4 py-2 bg-blue-500/20 text-blue-400 rounded font-bold">üç≥ Ï°∞Î¶¨Ï§ë</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Î©îÎâ¥ Í¥ÄÎ¶¨ -->
          <div class="card glow-border mb-8" style="border-color: #22c55e;">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-bold">üìã Î©îÎâ¥ Í¥ÄÎ¶¨</h3>
              <button onclick="showAddMenuForm()" class="px-4 py-2 bg-green-500 rounded text-white font-bold">+ Î©îÎâ¥ Ï∂îÍ∞Ä</button>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="store-menu-list">
              <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">üçö</span>
                  <div class="flex-1">
                    <h4 class="font-bold">ÏïÑÎØ∏ Ï†ïÏãù</h4>
                    <p class="text-cyan-400 font-bold">‚Ç©22,000</p>
                  </div>
                  <div class="flex flex-col gap-1">
                    <button onclick="editMenu('menu-001')" class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs">ÏàòÏ†ï</button>
                    <button onclick="deleteMenu('menu-001')" class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">üçñ</span>
                  <div class="flex-1">
                    <h4 class="font-bold">ÏôïÍ∞àÎπÑÌÉï</h4>
                    <p class="text-cyan-400 font-bold">‚Ç©18,000</p>
                  </div>
                  <div class="flex flex-col gap-1">
                    <button onclick="editMenu('menu-002')" class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs">ÏàòÏ†ï</button>
                    <button onclick="deleteMenu('menu-002')" class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
              <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                <div class="flex items-center gap-3">
                  <span class="text-4xl">ü•©</span>
                  <div class="flex-1">
                    <h4 class="font-bold">Î∂àÍ≥†Í∏∞ Ï†ïÏãù</h4>
                    <p class="text-cyan-400 font-bold">‚Ç©25,000</p>
                  </div>
                  <div class="flex flex-col gap-1">
                    <button onclick="editMenu('menu-003')" class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs">ÏàòÏ†ï</button>
                    <button onclick="deleteMenu('menu-003')" class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Îß§Ï∂ú Î∂ÑÏÑù -->
          <div class="card glow-border" style="border-color: #22c55e;">
            <h3 class="text-xl font-bold mb-4">üìä Îß§Ï∂ú Î∂ÑÏÑù</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="font-bold mb-3 text-gray-400">Ïù¥Î≤à Ï£º Îß§Ï∂ú</h4>
                <div class="space-y-2">
                  <div class="flex justify-between items-center">
                    <span>Ïõî</span>
                    <div class="flex-1 mx-4 bg-gray-700 rounded h-4">
                      <div class="bg-green-500 h-4 rounded" style="width:70%"></div>
                    </div>
                    <span class="text-green-400">‚Ç©756,000</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span>Ìôî</span>
                    <div class="flex-1 mx-4 bg-gray-700 rounded h-4">
                      <div class="bg-green-500 h-4 rounded" style="width:85%"></div>
                    </div>
                    <span class="text-green-400">‚Ç©892,000</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span>Ïàò</span>
                    <div class="flex-1 mx-4 bg-gray-700 rounded h-4">
                      <div class="bg-green-500 h-4 rounded" style="width:60%"></div>
                    </div>
                    <span class="text-green-400">‚Ç©634,000</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span>Î™©</span>
                    <div class="flex-1 mx-4 bg-gray-700 rounded h-4">
                      <div class="bg-cyan-500 h-4 rounded" style="width:95%"></div>
                    </div>
                    <span class="text-cyan-400">‚Ç©1,023,000</span>
                  </div>
                </div>
              </div>
              <div>
                <h4 class="font-bold mb-3 text-gray-400">Ïù∏Í∏∞ Î©îÎâ¥ TOP 5</h4>
                <div class="space-y-2">
                  <div class="flex justify-between items-center p-2 bg-yellow-500/10 rounded">
                    <span>ü•á Î∂àÍ≥†Í∏∞ Ï†ïÏãù</span>
                    <span class="text-yellow-400">127Í±¥</span>
                  </div>
                  <div class="flex justify-between items-center p-2 bg-gray-500/10 rounded">
                    <span>ü•à ÏïÑÎØ∏ Ï†ïÏãù</span>
                    <span class="text-gray-400">98Í±¥</span>
                  </div>
                  <div class="flex justify-between items-center p-2 bg-orange-500/10 rounded">
                    <span>ü•â ÏôïÍ∞àÎπÑÌÉï</span>
                    <span class="text-orange-400">76Í±¥</span>
                  </div>
                  <div class="flex justify-between items-center p-2 rounded">
                    <span>4. Ìï¥Î¨ºÌååÏ†Ñ</span>
                    <span class="text-gray-400">54Í±¥</span>
                  </div>
                  <div class="flex justify-between items-center p-2 rounded">
                    <span>5. ÎêúÏû•Ï∞åÍ∞ú</span>
                    <span class="text-gray-400">43Í±¥</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ========== üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ ========== -->
        <div id="admin-users" class="admin-section" style="display:none;">
          <div class="card glow-border mb-8">
            <h3 class="text-2xl font-bold mb-4">üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h3>
            <p class="text-gray-400 mb-6">Îì±Î°ùÎêú ÏÇ¨Ïö©Ïûê Î™©Î°ù Î∞è Í∂åÌïú Í¥ÄÎ¶¨</p>
            
            <div class="flex gap-4 mb-6">
              <input type="text" placeholder="ÏÇ¨Ïö©Ïûê Í≤ÄÏÉâ..." class="flex-1 p-3 rounded bg-gray-900 border border-purple-500">
              <select class="p-3 rounded bg-gray-900 border border-purple-500">
                <option>Ï†ÑÏ≤¥</option>
                <option>ÏùºÎ∞ò ÏÇ¨Ïö©Ïûê</option>
                <option>Îß§Ïû• Í¥ÄÎ¶¨Ïûê</option>
                <option>ÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê</option>
              </select>
            </div>
            
            <div class="overflow-x-auto">
              <table class="w-full text-left">
                <thead>
                  <tr class="border-b border-gray-700">
                    <th class="p-3">ID</th>
                    <th class="p-3">Ïù¥Î¶Ñ</th>
                    <th class="p-3">Ïù¥Î©îÏùº</th>
                    <th class="p-3">Îì±Í∏â</th>
                    <th class="p-3">ÏÉÅÌÉú</th>
                    <th class="p-3">Í∞ÄÏûÖÏùº</th>
                    <th class="p-3">Í¥ÄÎ¶¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3">admin001</td>
                    <td class="p-3 font-bold">ÎÖ∏Ïö©Ìò∏</td>
                    <td class="p-3">admin@airctt.com</td>
                    <td class="p-3"><span class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-sm">Grade 3 (Super)</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ON</span></td>
                    <td class="p-3">2025-01-01</td>
                    <td class="p-3">-</td>
                  </tr>
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3">store001</td>
                    <td class="p-3 font-bold">ÍπÄÎã§Î∞©</td>
                    <td class="p-3">store@amidabang.com</td>
                    <td class="p-3"><span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">Grade 2 (Store)</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ON</span></td>
                    <td class="p-3">2025-06-15</td>
                    <td class="p-3"><button onclick="modifyUserActive('store001')" class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button></td>
                  </tr>
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3">user001</td>
                    <td class="p-3 font-bold">ÌôçÍ∏∏Îèô</td>
                    <td class="p-3">user@example.com</td>
                    <td class="p-3"><span class="px-2 py-1 bg-gray-500/20 text-gray-400 rounded text-sm">Grade 1 (User)</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-sm">ON</span></td>
                    <td class="p-3">2025-12-01</td>
                    <td class="p-3"><button onclick="modifyUserActive('user001')" class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button></td>
                  </tr>
                  <tr class="border-b border-gray-700/50">
                    <td class="p-3">user002</td>
                    <td class="p-3 font-bold">Ïù¥ÏòÅÌù¨</td>
                    <td class="p-3">lee@example.com</td>
                    <td class="p-3"><span class="px-2 py-1 bg-gray-500/20 text-gray-400 rounded text-sm">Grade 1 (User)</span></td>
                    <td class="p-3"><span class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-sm">OFF</span></td>
                    <td class="p-3">2025-11-20</td>
                    <td class="p-3"><button onclick="modifyUserActive('user002')" class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs">ÏÉÅÌÉúÎ≥ÄÍ≤Ω</button></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- ========== üé´ Ïø†Ìè∞ ÏäπÏù∏ (ÏµúÏ¢ÖÍ¥ÄÎ¶¨Ïûê) ========== -->
        <div id="admin-coupons" class="admin-section" style="display: none;">
          <!-- Ïã§ÏãúÍ∞Ñ ÌÜµÍ≥Ñ Ïπ¥Îìú 5Í∞ú -->
          <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <div class="card glow-border text-center p-4">
              <div class="text-3xl mb-2">‚è≥</div>
              <h3 class="text-sm font-bold text-gray-400 mb-1">ÏäπÏù∏ ÎåÄÍ∏∞</h3>
              <p class="text-2xl font-black text-yellow-400" id="admin-pending">0</p>
            </div>
            <div class="card glow-border text-center p-4">
              <div class="text-3xl mb-2">‚úÖ</div>
              <h3 class="text-sm font-bold text-gray-400 mb-1">ÏäπÏù∏ ÏôÑÎ£å</h3>
              <p class="text-2xl font-black text-green-400" id="admin-approved">0</p>
            </div>
            <div class="card glow-border text-center p-4">
              <div class="text-3xl mb-2">üéÆ</div>
              <h3 class="text-sm font-bold text-gray-400 mb-1">Í≤åÏûÑ Î∞∞Ìè¨</h3>
              <p class="text-2xl font-black text-blue-400" id="admin-deployed">0</p>
            </div>
            <div class="card glow-border text-center p-4">
              <div class="text-3xl mb-2">üëõ</div>
              <h3 class="text-sm font-bold text-gray-400 mb-1">Í≥†Í∞ù ÏßÄÍ∞ë</h3>
              <p class="text-2xl font-black text-purple-400" id="admin-in-wallet">0</p>
            </div>
            <div class="card glow-border text-center p-4 col-span-2 md:col-span-1">
              <div class="text-3xl mb-2">üí∞</div>
              <h3 class="text-sm font-bold text-gray-400 mb-1">Ï¥ù ÏàòÏùµ</h3>
              <p class="text-2xl font-black gradient-text" id="admin-revenue">‚Ç©0</p>
            </div>
          </div>

          <!-- üî¥ ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù (ÎØ∏Î¶¨Î≥¥Í∏∞ Ìè¨Ìï®) -->
          <div class="card glow-border mb-8" style="border-color: #f59e0b;">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-2xl font-bold text-yellow-400">‚è≥ ÏµúÏ¢Ö ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù</h3>
              <button onclick="refreshAdminCouponQueue()" class="px-3 py-1.5 bg-yellow-500/20 text-yellow-400 rounded-lg text-sm font-bold hover:bg-yellow-500/30 transition">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
            </div>
            <div id="admin-pending-list"><p class="text-gray-400 text-center py-8">ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ëÏù∏ Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.</p></div>
          </div>

          <!-- ‚úÖ ÏäπÏù∏ ÏôÑÎ£å Ïø†Ìè∞ + Ïã§ÏãúÍ∞Ñ Ïà´Ïûê -->
          <div class="card glow-border">
            <h3 class="text-2xl font-bold mb-4 text-green-400">‚úÖ ÏäπÏù∏ ÏôÑÎ£å Ïø†Ìè∞ (Ïã§ÏãúÍ∞Ñ ÌòÑÌô©)</h3>
            <div id="admin-approved-list"><p class="text-gray-400 text-center py-8">ÏäπÏù∏Îêú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.</p></div>
          </div>
        </div>
        
        <!-- ========== üìú ÏäπÏù∏ Í∏∞Î°ù ========== -->
        <div id="admin-history" class="admin-section" style="display:none;">
          <div class="card glow-border mb-8" style="border-color: #6366f1;">
            <h3 class="text-2xl font-bold mb-4 text-indigo-400">üìú ÏäπÏù∏/Í±∞Î∂Ä Í∏∞Î°ù</h3>
            <p class="text-gray-400 mb-6">Î™®Îì† ÏäπÏù∏ Î∞è Í±∞Î∂Ä ÎÇ¥Ïó≠Ïù¥ Í∏∞Î°ùÎê©ÎãàÎã§.</p>
            
            <!-- ÌïÑÌÑ∞ -->
            <div class="flex gap-2 mb-6 flex-wrap">
              <button onclick="filterHistory('all')" class="px-4 py-2 bg-indigo-500 rounded-lg font-bold">Ï†ÑÏ≤¥</button>
              <button onclick="filterHistory('store')" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">Îß§Ïû• Ïã†Ï≤≠</button>
              <button onclick="filterHistory('coupon')" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">Ïø†Ìè∞ Ïã†Ï≤≠</button>
              <button onclick="filterHistory('approved')" class="px-4 py-2 bg-green-500/50 rounded-lg hover:bg-green-500">ÏäπÏù∏</button>
              <button onclick="filterHistory('rejected')" class="px-4 py-2 bg-red-500/50 rounded-lg hover:bg-red-500">Í±∞Î∂Ä</button>
            </div>
            
            <!-- Í∏∞Î°ù Î™©Î°ù -->
            <div id="approval-history-list" class="space-y-3">
              <!-- ÏÉòÌîå Í∏∞Î°ù -->
              <div class="bg-green-500/10 border border-green-500/30 p-4 rounded-lg">
                <div class="flex items-center justify-between flex-wrap gap-2">
                  <div class="flex items-center gap-3">
                    <span class="text-2xl">‚úÖ</span>
                    <div>
                      <p class="font-bold">ÏïÑÎØ∏ ÌïúÏ†ïÏãù - Îß§Ïû• ÏäπÏù∏</p>
                      <p class="text-sm text-gray-400">Ï≤òÎ¶¨Ïûê: Í¥ÄÎ¶¨Ïûê | ÏÇ¨Ïú†: ÏÑúÎ•ò ÌôïÏù∏ ÏôÑÎ£å</p>
                    </div>
                  </div>
                  <span class="text-sm text-gray-400">2025-12-18 14:30</span>
                </div>
              </div>
              
              <div class="bg-green-500/10 border border-green-500/30 p-4 rounded-lg">
                <div class="flex items-center justify-between flex-wrap gap-2">
                  <div class="flex items-center gap-3">
                    <span class="text-2xl">‚úÖ</span>
                    <div>
                      <p class="font-bold">ÏïÑÎØ∏ ÌïúÏ†ïÏãù 30% Ìï†Ïù∏ Ïø†Ìè∞ - ÏäπÏù∏</p>
                      <p class="text-sm text-gray-400">Ï≤òÎ¶¨Ïûê: Í¥ÄÎ¶¨Ïûê | Î∞úÍ∏âÏàòÎüâ: 100Ïû•</p>
                    </div>
                  </div>
                  <span class="text-sm text-gray-400">2025-12-18 15:45</span>
                </div>
              </div>
              
              <div class="bg-red-500/10 border border-red-500/30 p-4 rounded-lg">
                <div class="flex items-center justify-between flex-wrap gap-2">
                  <div class="flex items-center gap-3">
                    <span class="text-2xl">‚ùå</span>
                    <div>
                      <p class="font-bold">ÌÖåÏä§Ìä∏ Îß§Ïû• - Í±∞Î∂Ä</p>
                      <p class="text-sm text-gray-400">Ï≤òÎ¶¨Ïûê: Í¥ÄÎ¶¨Ïûê | ÏÇ¨Ïú†: ÏÇ¨ÏóÖÏûêÎì±Î°ùÏ¶ù ÎØ∏Ï†úÏ∂ú</p>
                    </div>
                  </div>
                  <span class="text-sm text-gray-400">2025-12-17 10:20</span>
                </div>
              </div>
              
              <div class="bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-lg">
                <div class="flex items-center justify-between flex-wrap gap-2">
                  <div class="flex items-center gap-3">
                    <span class="text-2xl">üîç</span>
                    <div>
                      <p class="font-bold">Ìô©Í∏àÏò¨Î¶¨Î∏å ÏπòÌÇ® - Í≤ÄÌÜ†Ï§ë</p>
                      <p class="text-sm text-gray-400">Ï≤òÎ¶¨Ïûê: Í¥ÄÎ¶¨Ïûê | Î©îÎ™®: Ï∂îÍ∞Ä ÏÑúÎ•ò ÏöîÏ≤≠</p>
                    </div>
                  </div>
                  <span class="text-sm text-gray-400">2025-12-19 09:00</span>
                </div>
              </div>
            </div>
            
            <!-- ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú -->
            <div class="mt-6 flex gap-2">
              <button onclick="downloadReport('history')" class="px-4 py-2 bg-indigo-500 rounded hover:bg-indigo-600">üì• Í∏∞Î°ù Îã§Ïö¥Î°úÎìú</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- ‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞ (Cloud Market) ÌéòÏù¥ÏßÄ            -->
    <!-- ÏàúÌôòÍµ¨Ï°∞ ÌïµÏã¨ ÌóàÎ∏å: Í≤åÏûÑ‚ÜíÏßÄÍ∞ë‚ÜíÍµ¨Î¶ÑÏû•ÌÑ∞‚ÜíÎß§Ïû•Ï£ºÎ¨∏ -->
    <!-- ============================================ -->
    <div id="market-page" class="page">
      <div class="max-w-7xl mx-auto px-4 py-20">

        <!-- Íµ¨Î¶ÑÏû•ÌÑ∞ Ìó§Îçî -->
        <div class="text-center mb-10">
          <h2 class="text-5xl font-black mb-3" style="background:linear-gradient(135deg,#22d3ee,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞</h2>
          <p class="text-xl text-gray-300 mb-2">Cloud Market ‚Äî AR Ïø†Ìè∞ÏúºÎ°ú ÎßåÎÇòÎäî ÎèôÎÑ§ Í∞ÄÍ≤å</p>
          <p class="text-sm text-gray-500">Í≤åÏûÑÏóêÏÑú ÌöçÎìùÌïú Ïø†Ìè∞ÏùÑ Ïó¨Í∏∞ÏÑú ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî!</p>
        </div>

        <!-- ÏàúÌôò ÌùêÎ¶Ñ ÏïàÎÇ¥ Î∞∞ÎÑà -->
        <div class="mb-8 p-4 rounded-xl border border-cyan-500/30" style="background:linear-gradient(135deg,rgba(34,211,238,0.08),rgba(168,85,247,0.08));">
          <div class="flex items-center justify-center gap-3 flex-wrap text-sm md:text-base">
            <span class="cursor-pointer hover:scale-110 transition" onclick="startGame()">üéÆ ARÍ≤åÏûÑ</span>
            <span class="text-cyan-400">‚Üí</span>
            <span class="cursor-pointer hover:scale-110 transition" onclick="showPage('wallet')">üí∞ Ïø†Ìè∞ÌöçÎìù</span>
            <span class="text-cyan-400">‚Üí</span>
            <span class="font-bold text-cyan-300 text-lg">‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞</span>
            <span class="text-cyan-400">‚Üí</span>
            <span class="cursor-pointer hover:scale-110 transition" onclick="showPage('store')">üõí Îß§Ïû•Ï£ºÎ¨∏</span>
            <span class="text-cyan-400">‚Üí</span>
            <span class="text-purple-400">üîÑ Ïû¨Î∞©Î¨∏</span>
          </div>
        </div>

        <!-- ÎÇ¥ Ïø†Ìè∞ ÏöîÏïΩ -->
        <div id="market-my-coupons" class="mb-8 p-5 rounded-xl card glow-border">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div>
              <h3 class="text-lg font-bold text-cyan-300">üí∞ ÎÇ¥ Î≥¥Ïú† Ïø†Ìè∞</h3>
              <p class="text-sm text-gray-400 mt-1">Í≤åÏûÑÏóêÏÑú ÌöçÎìùÌïú Ïø†Ìè∞ÏùÑ Îß§Ïû•ÏóêÏÑú ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî</p>
            </div>
            <div class="flex items-center gap-4">
              <div class="text-center">
                <span id="market-coupon-count" class="text-3xl font-black text-cyan-300">0</span>
                <p class="text-xs text-gray-400">Î≥¥Ïú† Ïø†Ìè∞</p>
              </div>
              <button onclick="showPage('wallet')" class="px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-500 text-sm font-bold">ÏßÄÍ∞ë Î≥¥Í∏∞ ‚Üí</button>
            </div>
          </div>
          <!-- Ïø†Ìè∞ ÎØ∏Îãà Ïä¨ÎùºÏù¥Îçî -->
          <div id="market-coupon-slider" class="mt-4 flex gap-3 overflow-x-auto pb-2" style="scrollbar-width:thin;"></div>
        </div>

        <!-- Í≤ÄÏÉâ & Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ -->
        <div class="mb-6">
          <div class="flex gap-3 mb-4 flex-wrap">
            <div class="flex-1 min-w-[200px]">
              <input type="text" id="market-search" placeholder="üîç Îß§Ïû•Î™Ö ¬∑ Î©îÎâ¥ ¬∑ Ïø†Ìè∞ Í≤ÄÏÉâ..."
                class="w-full p-3 rounded-xl bg-gray-900/80 border border-purple-500/50 focus:border-cyan-400 focus:outline-none transition"
                oninput="filterMarket()">
            </div>
            <select id="market-sort" class="p-3 rounded-xl bg-gray-900/80 border border-purple-500/50" onchange="filterMarket()">
              <option value="recommend">Ï∂îÏ≤úÏàú</option>
              <option value="discount">Ìï†Ïù∏Ïú®Ïàú</option>
              <option value="distance">Í±∞Î¶¨Ïàú</option>
              <option value="rating">ÌèâÏ†êÏàú</option>
            </select>
          </div>
          <div id="market-categories" class="flex gap-2 overflow-x-auto pb-2" style="scrollbar-width:thin;">
            <button onclick="filterMarketCategory('all')" class="market-cat-btn active px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap" style="background:linear-gradient(135deg,#22d3ee,#a855f7);">Ï†ÑÏ≤¥</button>
            <button onclick="filterMarketCategory('ÌïúÏãù')" class="market-cat-btn px-4 py-2 rounded-full bg-gray-800 text-sm font-bold whitespace-nowrap hover:bg-gray-700">üç± ÌïúÏãù</button>
            <button onclick="filterMarketCategory('Ïπ¥Ìéò')" class="market-cat-btn px-4 py-2 rounded-full bg-gray-800 text-sm font-bold whitespace-nowrap hover:bg-gray-700">‚òï Ïπ¥Ìéò</button>
            <button onclick="filterMarketCategory('ÏπòÌÇ®')" class="market-cat-btn px-4 py-2 rounded-full bg-gray-800 text-sm font-bold whitespace-nowrap hover:bg-gray-700">üçó ÏπòÌÇ®</button>
            <button onclick="filterMarketCategory('ÏñëÏãù')" class="market-cat-btn px-4 py-2 rounded-full bg-gray-800 text-sm font-bold whitespace-nowrap hover:bg-gray-700">üçù ÏñëÏãù</button>
            <button onclick="filterMarketCategory('Ìå®ÏÖò')" class="market-cat-btn px-4 py-2 rounded-full bg-gray-800 text-sm font-bold whitespace-nowrap hover:bg-gray-700">üëì Ìå®ÏÖò</button>
            <button onclick="filterMarketCategory('Î∑∞Ìã∞')" class="market-cat-btn px-4 py-2 rounded-full bg-gray-800 text-sm font-bold whitespace-nowrap hover:bg-gray-700">üíá Î∑∞Ìã∞</button>
          </div>
        </div>

        <!-- üî• Ïù∏Í∏∞ Ïø†Ìè∞ ÏÑπÏÖò -->
        <div class="mb-8">
          <h3 class="text-xl font-bold mb-4 text-yellow-400">üî• ÏßÄÍ∏à Ïù∏Í∏∞ Ïø†Ìè∞</h3>
          <div id="market-hot-coupons" class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <!-- JSÎ°ú ÎèôÏ†Å Î†åÎçîÎßÅ -->
          </div>
        </div>

        <!-- Îß§Ïû• Î™©Î°ù Í∑∏Î¶¨Îìú -->
        <div class="mb-6 flex items-center justify-between">
          <h3 class="text-xl font-bold">üè™ ÎèôÎÑ§ Îß§Ïû•</h3>
          <span id="market-store-count" class="text-sm text-gray-400">0Í∞ú Îß§Ïû•</span>
        </div>
        <div id="market-store-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- JSÎ°ú ÎèôÏ†Å Î†åÎçîÎßÅ -->
        </div>

        <!-- ÏÇ¨ÏóÖÏûê Îì±Î°ù Ïú†ÎèÑ Î∞∞ÎÑà -->
        <div class="mt-12 text-center p-8 rounded-2xl border border-dashed border-purple-500/40" style="background:linear-gradient(135deg,rgba(168,85,247,0.05),rgba(34,211,238,0.05));">
          <p class="text-4xl mb-3">üê∞</p>
          <h4 class="text-xl font-bold mb-2 gradient-text">ÎÇ¥ Í∞ÄÍ≤åÎèÑ Íµ¨Î¶ÑÏû•ÌÑ∞Ïóê Îì±Î°ùÌïòÏÑ∏Ïöî!</h4>
          <p class="text-gray-400 mb-4">Ïø†Ìè∞ Î∞úÍ∏â ‚Üí AR Í≤åÏûÑ Î∞∞Ìè¨ ‚Üí Ïã†Í∑ú Í≥†Í∞ù ÌôïÎ≥¥Ïùò ÏÑ†ÏàúÌôò!</p>
          <button onclick="showPage('business')" class="px-6 py-3 rounded-xl font-bold text-white" style="background:linear-gradient(135deg,#a855f7,#22d3ee);">üíº ÏÇ¨ÏóÖÏûê Îì±Î°ùÌïòÍ∏∞</button>
        </div>

      </div>
    </div>

    <!-- Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ -->
    <div id="login-page" class="page">
      <div class="max-w-md mx-auto px-4 py-20">
        <div class="card glow-border">
          <h2 class="text-3xl font-black mb-8 text-center gradient-text">Î°úÍ∑∏Ïù∏</h2>
          
          <!-- ÏÜåÏÖú Î°úÍ∑∏Ïù∏ -->
          <div class="mb-6">
            <!-- Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ -->
            <button onclick="loginWithGoogle()" class="social-btn btn-google">
              <svg width="20" height="20" viewBox="0 0 20 20">
                <path fill="#4285F4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"></path>
                <path fill="#34A853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"></path>
                <path fill="#FBBC05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"></path>
                <path fill="#EA4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"></path>
              </svg>
              Íµ¨Í∏ÄÎ°ú ÏãúÏûëÌïòÍ∏∞
            </button>
            
            <!-- Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏ -->
            <button onclick="loginWithKakao()" class="social-btn btn-kakao">
              <svg width="20" height="20" viewBox="0 0 20 20">
                <path fill="#000000" d="M10 0C4.477 0 0 3.462 0 7.727c0 2.805 1.861 5.26 4.658 6.608-.186.674-.678 2.419-.777 2.806-.122.477.175.47.37.342.15-.099 2.428-1.622 3.368-2.273.437.06.885.09 1.34.09 5.522 0 10-3.462 10-7.727S15.522 0 10 0z"></path>
              </svg>
              Ïπ¥Ïπ¥Ïò§Î°ú ÏãúÏûëÌïòÍ∏∞
            </button>
            
            <!-- ÎÑ§Ïù¥Î≤Ñ Î°úÍ∑∏Ïù∏ -->
            <button onclick="loginWithNaver()" class="social-btn btn-naver">
              <svg width="20" height="20" viewBox="0 0 20 20">
                <path fill="#FFFFFF" d="M13.6 0H6.4L6.4 11.4L13.6 20V8.6L13.6 0Z"></path>
              </svg>
              ÎÑ§Ïù¥Î≤ÑÎ°ú ÏãúÏûëÌïòÍ∏∞
            </button>
          </div>
          
          <div class="divider">
            <span>ÎòêÎäî</span>
          </div>
          
          <!-- Ïù¥Î©îÏùº Î°úÍ∑∏Ïù∏ -->
          <form onsubmit="handleLogin(event)">
            <div class="mb-4">
              <label class="block mb-2">Ïù¥Î©îÏùº</label>
              <input type="email" id="login-email" class="w-full p-3 rounded bg-gray-900 border border-purple-500" required="">
            </div>
            <div class="mb-6">
              <label class="block mb-2">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
              <input type="password" id="login-password" class="w-full p-3 rounded bg-gray-900 border border-purple-500" required="">
            </div>
            <button type="submit" class="btn-primary w-full">Î°úÍ∑∏Ïù∏</button>
          </form>
        </div>
      </div>
    </div>
  

  <!-- Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ ÎπåÎçî ÌéòÏù¥ÏßÄ -->
  <div id="store-builder-page" class="page">
    <div class="max-w-7xl mx-auto px-4 py-20">
      <h2 class="text-4xl font-black mb-4 gradient-text">üé® Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ ÎπåÎçî</h2>
      <p class="text-gray-400 mb-8">ÎÇ¥ Îß§Ïû•ÏùÑ Î©ãÏßÄÍ≤å Íæ∏ÎØ∏Í≥† Í≥†Í∞ùÏóêÍ≤å Î≥¥Ïó¨Ï£ºÏÑ∏Ïöî!</p>

      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
        <div class="card glow-border">
          <h3 class="text-xl font-bold mb-4 text-purple-400">üìù Í∏∞Î≥∏ Ï†ïÎ≥¥</h3>
          <div class="space-y-4">
            <div>
              <label class="block mb-2 text-sm">Îß§Ïû•Î™Ö</label>
              <input type="text" id="builder-name" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="ÏïÑÎØ∏ ÌïúÏ†ïÏãù" onchange="updateStorePreview()">
            </div>
            <div>
              <label class="block mb-2 text-sm">ÏóÖÏ¢Ö</label>
              <select id="builder-category" class="w-full p-3 rounded bg-gray-900 border border-purple-500" onchange="updateStorePreview()">
                <option value="ÌïúÏãù">ÌïúÏãù</option>
                <option value="Ï§ëÏãù">Ï§ëÏãù</option>
                <option value="ÏùºÏãù">ÏùºÏãù</option>
                <option value="ÏñëÏãù">ÏñëÏãù</option>
                <option value="Ïπ¥Ìéò">Ïπ¥Ìéò</option>
                <option value="Î∑∞Ìã∞">Î∑∞Ìã∞</option>
                <option value="Î¨∏Ìôî/Í≥µÏó∞">Î¨∏Ìôî/Í≥µÏó∞</option>
              </select>
            </div>
            <div>
              <label class="block mb-2 text-sm">ÌïúÏ§Ñ ÏÜåÍ∞ú</label>
              <textarea id="builder-description" class="w-full p-3 rounded bg-gray-900 border border-purple-500" rows="2" onchange="updateStorePreview()">Ï†ïÏÑ±ÏùÑ Îã¥ÏïÑ ÎßåÎìúÎäî Í±¥Í∞ïÌïú ÌïúÏ†ïÏãù</textarea>
            </div>
            <div>
              <label class="block mb-2 text-sm">Î°úÍ≥† Ïù¥Î™®ÏßÄ</label>
              <select id="builder-logo" class="w-full p-3 rounded bg-gray-900 border border-purple-500" onchange="updateStorePreview()">
                <option value="üç±">üç± ÌïúÏãù</option>
                <option value="üçú">üçú Ï§ëÏãù</option>
                <option value="üç£">üç£ ÏùºÏãù</option>
                <option value="üçù">üçù ÏñëÏãù</option>
                <option value="‚òï">‚òï Ïπ¥Ìéò</option>
                <option value="üíá">üíá Î∑∞Ìã∞</option>
                <option value="üé≠">üé≠ Í≥µÏó∞</option>
              </select>
            </div>
          </div>
        </div>

        <!-- ÌÖåÎßà & ÎØ∏ÎîîÏñ¥ -->
        <div class="card glow-border">
          <h3 class="text-xl font-bold mb-4 text-cyan-400">üé® ÌÖåÎßà &amp; ÎØ∏ÎîîÏñ¥</h3>
          <div class="space-y-4">
            <div>
              <label class="block mb-2 text-sm">Î©îÏù∏ Ïª¨Îü¨</label>
              <div class="flex gap-2 flex-wrap">
                <button onclick="setBuilderColor('#a855f7')" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-white transition" style="background:#a855f7"></button>
                <button onclick="setBuilderColor('#22d3ee')" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-white transition" style="background:#22d3ee"></button>
                <button onclick="setBuilderColor('#ef4444')" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-white transition" style="background:#ef4444"></button>
                <button onclick="setBuilderColor('#22c55e')" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-white transition" style="background:#22c55e"></button>
                <button onclick="setBuilderColor('#f59e0b')" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-white transition" style="background:#f59e0b"></button>
                <button onclick="setBuilderColor('#ec4899')" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-white transition" style="background:#ec4899"></button>
              </div>
            </div>
            <div>
              <label class="block mb-2 text-sm">üé¨ ÌôçÎ≥¥ ÎèôÏòÅÏÉÅ (YouTube URL)</label>
              <div class="flex gap-2">
                <input type="url" id="builder-video" class="flex-1 p-3 rounded bg-gray-900 border border-purple-500" placeholder="https://youtube.com/watch?v=...">
                <button onclick="previewVideo()" class="px-4 py-2 bg-red-500 rounded hover:bg-red-600 transition" title="ÎØ∏Î¶¨Î≥¥Í∏∞">‚ñ∂Ô∏è</button>
              </div>
            </div>
            <div>
              <label class="block mb-2 text-sm">üì∏ Î∞∞ÎÑà Ïù¥ÎØ∏ÏßÄ URL</label>
              <input type="url" id="builder-banner" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="https://...">
            </div>
          </div>
        </div>

        <!-- SNS & Ïó∞ÎùΩÏ≤ò -->
        <div class="card glow-border">
          <h3 class="text-xl font-bold mb-4 text-amber-400">üîó SNS &amp; Ïó∞ÎùΩÏ≤ò</h3>
          <div class="space-y-4">
            <div>
              <label class="block mb-2 text-sm">üåê ÌôàÌéòÏù¥ÏßÄ</label>
              <input type="url" id="builder-website" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="https://mystore.com">
            </div>
            <div>
              <label class="block mb-2 text-sm">üì∏ Ïù∏Ïä§ÌÉÄÍ∑∏Îû®</label>
              <input type="text" id="builder-instagram" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="@username">
            </div>
            <div>
              <label class="block mb-2 text-sm">üí¨ Ïπ¥Ïπ¥Ïò§ÌÜ° Ï±ÑÎÑê</label>
              <input type="url" id="builder-kakao" class="w-full p-3 rounded bg-gray-900 border border-purple-500" placeholder="https://pf.kakao.com/...">
            </div>
            <div>
              <label class="block mb-2 text-sm">üìû Ï†ÑÌôîÎ≤àÌò∏</label>
              <input type="tel" id="builder-phone" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="02-1234-5678">
            </div>
            <div>
              <label class="block mb-2 text-sm">üìç Ï£ºÏÜå</label>
              <input type="text" id="builder-address" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123">
            </div>
          </div>
        </div>
      </div>

      <!-- ÏòÅÏóÖÏãúÍ∞Ñ -->
      <div class="card glow-border mb-8">
        <h3 class="text-xl font-bold mb-4 text-green-400">üïê ÏòÅÏóÖÏãúÍ∞Ñ</h3>
        <div class="grid md:grid-cols-4 gap-4">
          <div>
            <label class="block mb-2 text-sm">Ïõî~Í∏à</label>
            <input type="text" id="builder-hours-weekday" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="11:00 - 22:00">
          </div>
          <div>
            <label class="block mb-2 text-sm">ÌÜ†ÏöîÏùº</label>
            <input type="text" id="builder-hours-sat" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="11:00 - 22:00">
          </div>
          <div>
            <label class="block mb-2 text-sm">ÏùºÏöîÏùº</label>
            <input type="text" id="builder-hours-sun" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="12:00 - 21:00">
          </div>
          <div>
            <label class="block mb-2 text-sm">Î∏åÎ†àÏù¥ÌÅ¨ÌÉÄÏûÑ</label>
            <input type="text" id="builder-breaktime" class="w-full p-3 rounded bg-gray-900 border border-purple-500" value="15:00 - 17:00">
          </div>
        </div>
      </div>

      <!-- Î©îÎâ¥ Í¥ÄÎ¶¨ -->
      <div class="card glow-border mb-8">
        <h3 class="text-xl font-bold mb-4 text-pink-400">üçΩÔ∏è Î©îÎâ¥ Í¥ÄÎ¶¨</h3>
        <div id="menu-editor-list" class="space-y-4 mb-4">
        <div class="flex gap-4 items-center p-4 bg-gray-900 rounded-lg border border-purple-500/30">
          <div class="flex-1">
            <input type="text" value="ÌïúÏ†ïÏãù ÏΩîÏä§ A" class="w-full p-2 mb-2 rounded bg-gray-800 border border-purple-500/50 text-white" onchange="updateMenuName(1, this.value)">
            <input type="text" value="Ï†ÑÌÜµ ÌïúÏ†ïÏãù 8Ï≤©" class="w-full p-2 rounded bg-gray-800 border border-gray-600 text-gray-300 text-sm" onchange="updateMenuDescription(1, this.value)">
          </div>
          <div class="w-32">
            <input type="number" value="35000" class="w-full p-2 rounded bg-gray-800 border border-cyan-500/50 text-cyan-400 text-right" onchange="updateMenuPrice(1, this.value)">
            <p class="text-xs text-gray-500 text-right mt-1">Ïõê</p>
          </div>
          <button onclick="removeMenuItem(1)" class="w-10 h-10 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/40 transition">
            üóëÔ∏è
          </button>
        </div>
      
        <div class="flex gap-4 items-center p-4 bg-gray-900 rounded-lg border border-purple-500/30">
          <div class="flex-1">
            <input type="text" value="ÌïúÏ†ïÏãù ÏΩîÏä§ B" class="w-full p-2 mb-2 rounded bg-gray-800 border border-purple-500/50 text-white" onchange="updateMenuName(2, this.value)">
            <input type="text" value="ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌïúÏ†ïÏãù 12Ï≤©" class="w-full p-2 rounded bg-gray-800 border border-gray-600 text-gray-300 text-sm" onchange="updateMenuDescription(2, this.value)">
          </div>
          <div class="w-32">
            <input type="number" value="45000" class="w-full p-2 rounded bg-gray-800 border border-cyan-500/50 text-cyan-400 text-right" onchange="updateMenuPrice(2, this.value)">
            <p class="text-xs text-gray-500 text-right mt-1">Ïõê</p>
          </div>
          <button onclick="removeMenuItem(2)" class="w-10 h-10 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/40 transition">
            üóëÔ∏è
          </button>
        </div>
      
        <div class="flex gap-4 items-center p-4 bg-gray-900 rounded-lg border border-purple-500/30">
          <div class="flex-1">
            <input type="text" value="Î∂àÍ≥†Í∏∞ Ï†ïÏãù" class="w-full p-2 mb-2 rounded bg-gray-800 border border-purple-500/50 text-white" onchange="updateMenuName(3, this.value)">
            <input type="text" value="ÌäπÏ†ú ÏñëÎÖê Î∂àÍ≥†Í∏∞" class="w-full p-2 rounded bg-gray-800 border border-gray-600 text-gray-300 text-sm" onchange="updateMenuDescription(3, this.value)">
          </div>
          <div class="w-32">
            <input type="number" value="18000" class="w-full p-2 rounded bg-gray-800 border border-cyan-500/50 text-cyan-400 text-right" onchange="updateMenuPrice(3, this.value)">
            <p class="text-xs text-gray-500 text-right mt-1">Ïõê</p>
          </div>
          <button onclick="removeMenuItem(3)" class="w-10 h-10 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/40 transition">
            üóëÔ∏è
          </button>
        </div>
      </div>
        <button onclick="addNewMenuItem()" class="btn-primary">+ Î©îÎâ¥ Ï∂îÍ∞Ä</button>
      </div>

      <!-- ÎØ∏Î¶¨Î≥¥Í∏∞ & Ï†ÄÏû• -->
      <div class="card glow-border">
        <h3 class="text-xl font-bold mb-4">üì± ÎØ∏Î¶¨Î≥¥Í∏∞</h3>
        <div id="store-preview" class="bg-gray-900 rounded-xl p-6 mb-6 border-2 border-purple-500" style="max-width: 400px; margin: 0 auto; box-shadow: 0 0 30px rgba(168,85,247,0.3);">
          <div class="text-center mb-4">
            <span id="preview-logo" class="text-6xl">üç±</span>
          </div>
          <h4 id="preview-name" class="text-2xl font-bold text-center mb-2">ÏïÑÎØ∏ ÌïúÏ†ïÏãù</h4>
          <p id="preview-category" class="text-gray-400 text-center mb-2">ÌïúÏãù ¬∑ Í∞ïÎÇ®Íµ¨</p>
          <p id="preview-description" class="text-sm text-gray-300 text-center mb-4">Ï†ïÏÑ±ÏùÑ Îã¥ÏïÑ ÎßåÎìúÎäî Í±¥Í∞ïÌïú ÌïúÏ†ïÏãù</p>
          <div class="flex justify-center gap-4 mb-4">
            <span class="text-2xl cursor-pointer hover:scale-110 transition" title="ÌôàÌéòÏù¥ÏßÄ">üåê</span>
            <span class="text-2xl cursor-pointer hover:scale-110 transition" title="Ïù∏Ïä§ÌÉÄÍ∑∏Îû®">üì∏</span>
            <span class="text-2xl cursor-pointer hover:scale-110 transition" title="Ïπ¥Ïπ¥Ïò§ÌÜ°">üí¨</span>
            <span class="text-2xl cursor-pointer hover:scale-110 transition" title="Ï†ÑÌôî">üìû</span>
          </div>
          <div class="text-center text-sm text-gray-400">
            <p>üìç ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123</p>
            <p>üïê 11:00 - 22:00</p>
          </div>
        </div>

        <div class="flex gap-4 justify-center flex-wrap">
          <button onclick="saveStoreSettings()" class="btn-primary">üíæ Ï†ÄÏû•ÌïòÍ∏∞</button>
          <button onclick="openFullPreview()" class="btn-primary" style="background: linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%);">üëÅÔ∏è Ï†ÑÏ≤¥ÌôîÎ©¥ ÎØ∏Î¶¨Î≥¥Í∏∞</button>
          <a href="store_homepage_full.html" target="_blank" class="btn-primary inline-block text-center" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); text-decoration: none;">üöÄ Í≥†Í∏â ÎπåÎçî Ïó¥Í∏∞</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Í≤åÏûÑ Ïª®ÌÖåÏù¥ÎÑà -->
  <div id="game-container" class="">
    <div class="game-hud">
      <div class="hud-item">
        <span class="hud-label">Ï†êÏàò</span>
        <span class="hud-value" id="score">0</span>
      </div>
      <div class="hud-item">
        <span class="hud-label">ÌöçÎìù</span>
        <span class="hud-value" id="caught">0</span>
      </div>
      <div class="hud-item" id="hud-combo-item" style="display:none;">
        <span class="hud-label">ÏΩ§Î≥¥</span>
        <span class="hud-value" id="combo-display" style="color:#fbbf24;">0x</span>
      </div>
    </div>
    <!-- Í≥®Îì† Î≥¥ÎÑàÏä§ Ïø†Ìè∞ ÌëúÏãúÍ∏∞ -->
    <div class="golden-indicator" id="golden-indicator">‚≠ê Í≥®Îì† Î≥¥ÎÑàÏä§ Ïø†Ìè∞ Îì±Ïû•! ‚≠ê</div>
    <!-- ÏΩ§Î≥¥ Í≤åÏù¥ÏßÄ -->
    <div class="combo-gauge-container" id="combo-gauge">
      <div class="combo-gauge-label" id="combo-gauge-label">COMBO 0x</div>
      <div class="combo-gauge-bar">
        <div class="combo-gauge-fill" id="combo-gauge-fill"></div>
      </div>
    </div>
    <!-- ÏΩ§Î≥¥ Î∞∞Ïú® -->
    <div class="combo-multiplier" id="combo-multiplier">x1</div>
    <!-- ÌîºÎ≤Ñ Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="fever-overlay" id="fever-overlay"></div>
    <canvas id="game-canvas" width="921" height="803" style="width: 983px; height: 857px;"></canvas>
    <button onclick="endGame()" class="btn-primary" style="position: absolute; top: 20px; right: 20px; z-index: 1002;">‚ùå Ï¢ÖÎ£å</button>
  </div>

  <!-- Ïø†Ìè∞ ÏÉÅÏÑ∏ Î™®Îã¨ -->
  <div id="coupon-modal" class="modal">
    <div class="modal-content">
      <h3 class="text-2xl font-bold mb-4" id="modal-title"></h3>
      <div id="modal-body"></div>
      <div class="flex gap-4 mt-6">
        <button onclick="useCoupon()" class="btn-primary">ÏÇ¨Ïö©ÌïòÍ∏∞</button>
        <button onclick="closeModal()" class="btn-primary">Îã´Í∏∞</button>
      </div>
    </div>
  </div>

  <!-- ÎÑ§Ïù¥Î≤Ñ Î°úÍ∑∏Ïù∏ Î≤ÑÌäº (Ïà®ÍπÄ) -->
  <div id="naverIdLogin" style="display:none;"></div>

  <script>
    // ============================================
    // CTT Ïä§ÌÇ§Îßà Í∏∞Î∞ò Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞
    // ============================================
    
    // ============================================
    // üîó Supabase ÌÜµÌï© ÏÑ§Ï†ï (Ïã§ DB Ïó∞Îèô)
    // ============================================
    const SUPABASE_PROJECT_URL = 'https://nlsiwrwiyozpiofrmzxa.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sc2l3cndpeW96cGlvZnJtenhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk2MTc0NzcsImV4cCI6MjA0NTE5MzQ3N30.qBQA0FPqSWIkDMpCHdKzPTKvjdTjYFSMbHmi5y-OJhE';
    const API_URL = `${SUPABASE_PROJECT_URL}/rest/v1`;

    // Supabase Í≥µÌÜµ Ìó§Îçî
    function sbHeaders(extraHeaders = {}) {
      return {
        'apikey': SUPABASE_ANON,
        'Authorization': `Bearer ${SUPABASE_ANON}`,
        'Content-Type': 'application/json',
        'Prefer': 'return=representation',
        ...extraHeaders
      };
    }

    // Supabase REST API Ìó¨Ìçº
    async function sbFetch(table, query = '', options = {}) {
      try {
        const url = `${API_URL}/${table}${query ? '?' + query : ''}`;
        const res = await fetch(url, {
          method: options.method || 'GET',
          headers: sbHeaders(options.headers || {}),
          body: options.body ? JSON.stringify(options.body) : undefined
        });
        if (!res.ok) throw new Error(`Supabase ${res.status}: ${res.statusText}`);
        return await res.json();
      } catch (err) {
        console.warn(`‚ö†Ô∏è Supabase Ïó∞Îèô Ïã§Ìå® (${table}):`, err.message);
        return null; // fallback to local data
      }
    }

    // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê (users ÌÖåÏù¥Î∏î Íµ¨Ï°∞)
    let currentUser = null; // { id, email, full_name, contact_no, user_type, profile_image, total_coupons_used, total_savings }
    let authToken = localStorage.getItem('token');
    
    // Ïø†Ìè∞ Í¥ÄÎ†®
    let allCoupons = []; // coupons ÌÖåÏù¥Î∏î Íµ¨Ï°∞
    let userCoupons = []; // user_coupons ÌÖåÏù¥Î∏î Íµ¨Ï°∞
    let selectedCoupon = null;
    let selectedCouponForStore = null;
    
    // Ï£ºÎ¨∏ Í¥ÄÎ†®
    let cart = []; // ordered_products Íµ¨Ï°∞
    let currentOrderType = null; // 'pickup', 'delivery', 'reservation'
    
    // Îß§Ïû• Î∞úÍ∏â Ïø†Ìè∞ (ÏäπÏù∏Îêú Ïø†Ìè∞Îßå Í≤åÏûÑÏóê Î∞∞Ìè¨)
    // üñºÔ∏è 3D Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ URL
    const COUPON_IMAGES = {
      'ami-10': 'coupon-10.png',
      'ami-30': 'coupon-10.png',
      'ami-50': 'coupon-50.png',
      'ami-100': 'coupon-100.png',
      'cafe-50': 'coupon-50.png',
      'cafe-90': 'coupon-90-cafe.png',
      'real-30': 'coupon-50.png'
    };
    
    let gameIssuedCoupons = [
      {
        id: 'store-coupon-001',
        store_id: 'store-001',
        store_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
        store_emoji: 'üçö',
        title: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 30% Ìï†Ïù∏',
        discount_type: 'percentage',
        discount_value: 30,
        rarity: 'epic',
        total_quantity: 100,
        remaining: 55,
        status: 'approved',
        expiry: '2026-05-31',
        image_url: 'coupon-50.png',
        website_url: 'https://smartstore.naver.com/ami_hansik'
      },
      {
        id: 'store-coupon-002',
        store_id: 'store-002',
        store_name: 'ÏïÑÎØ∏ Îã§Î∞©',
        store_emoji: '‚òï',
        title: 'ÏïÑÎØ∏ Îã§Î∞© Ïª§Ìîº 90% Ìï†Ïù∏',
        discount_type: 'percentage',
        discount_value: 90,
        rarity: 'legendary',
        total_quantity: 50,
        remaining: 38,
        status: 'approved',
        expiry: '2026-03-15',
        image_url: 'coupon-90-cafe.png',
        website_url: 'https://smartstore.naver.com/ami_dabang'
      },
      {
        id: 'store-coupon-003',
        store_id: 'store-004',
        store_name: 'ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë',
        store_emoji: 'ü•©',
        title: 'ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë 30% Ìï†Ïù∏',
        discount_type: 'percentage',
        discount_value: 30,
        rarity: 'rare',
        total_quantity: 80,
        remaining: 80,
        status: 'approved',
        expiry: '2026-05-31',
        image_url: 'coupon-50.png',
        website_url: 'https://www.hyunsil.kr'
      },
      {
        id: 'store-coupon-004',
        store_id: 'store-001',
        store_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
        store_emoji: 'üçö',
        title: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 10% Ìï†Ïù∏',
        discount_type: 'percentage',
        discount_value: 10,
        rarity: 'common',
        total_quantity: 200,
        remaining: 120,
        status: 'approved',
        expiry: '2026-12-31',
        image_url: 'coupon-10.png',
        website_url: 'https://smartstore.naver.com/ami_hansik'
      },
      {
        id: 'store-coupon-005',
        store_id: 'store-001',
        store_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
        store_emoji: 'üçö',
        title: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 100% Î¨¥Î£å!',
        discount_type: 'percentage',
        discount_value: 100,
        rarity: 'mythic',
        total_quantity: 5,
        remaining: 2,
        status: 'approved',
        expiry: '2026-01-31',
        image_url: 'coupon-100.png',
        website_url: 'https://smartstore.naver.com/ami_hansik'
      }
    ];
    
    // Îß§Ïû• Îç∞Ïù¥ÌÑ∞
    const STORES = {
      'store-001': { name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù', emoji: 'üçö', category: 'ÌïúÏãù', address: 'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123', status: 'approved', website_url: 'https://smartstore.naver.com/ami_hansik' },
      'store-002': { name: 'ÏïÑÎØ∏ Îã§Î∞©', emoji: '‚òï', category: 'Ïπ¥Ìéò', address: 'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨', status: 'reviewing', website_url: 'https://smartstore.naver.com/ami_dabang' },
      'store-003': { name: 'Ìô©Í∏àÏò¨Î¶¨Î∏å ÏπòÌÇ®', emoji: 'üçó', category: 'ÏπòÌÇ®', address: 'ÏÑúÏö∏Ïãú ÏÜ°ÌååÍµ¨', status: 'pending', website_url: 'https://www.bbq.co.kr' },
      'store-004': { name: 'ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë', emoji: 'ü•©', category: 'ÏñëÏãù', address: 'ÏÑúÏö∏Ïãú Ï§ëÎûëÍµ¨ Î©¥Î™©Îèô', status: 'approved', website_url: 'https://www.hyunsil.kr' }
    };
    
    // CTT products ÌÖåÏù¥Î∏î Ïä§ÌÇ§Îßà Í∏∞Î∞ò
    const MENU_ITEMS = [
      {
        id: 'product-001',
        store_id: 'store-001',
        product_name: 'ÌäπÏÑ† ÌïúÏ†ïÏãù',
        name: 'ÌäπÏÑ† ÌïúÏ†ïÏãù',
        description: 'Ï†úÏ≤† Ïû¨Î£åÎ°ú ÎßåÎì† ÌäπÏÑ† ÌïúÏ†ïÏãù',
        category: 'ÌïúÏ†ïÏãù',
        price: 35000,
        original_price: 38000,
        image: 'üç±',
        stock_quantity: 50,
        is_in_stock: true,
        is_active: true,
        is_featured: true,
        rating: 4.8,
        review_count: 67
      },
      {
        id: 'product-002',
        store_id: 'store-001',
        product_name: 'ÏôïÍ∞àÎπÑÌÉï',
        name: 'ÏôïÍ∞àÎπÑÌÉï',
        description: 'Ìë∏ÏßêÌïú ÏôïÍ∞àÎπÑÌÉï',
        category: 'ÌÉïÎ•ò',
        price: 18000,
        original_price: 20000,
        image: 'üçñ',
        stock_quantity: 30,
        is_in_stock: true,
        is_active: true,
        is_featured: false,
        rating: 4.7,
        review_count: 42
      },
      {
        id: 'product-003',
        store_id: 'store-001',
        product_name: 'Ï†ÑÎ≥µÏ£Ω',
        name: 'Ï†ÑÎ≥µÏ£Ω',
        description: 'Ïã†ÏÑ†Ìïú Ï†ÑÎ≥µÏúºÎ°ú ÎÅìÏù∏ ÏòÅÏñë Ï£Ω',
        category: 'Ï£Ω',
        price: 15000,
        original_price: 16000,
        image: 'ü•£',
        stock_quantity: 20,
        is_in_stock: true,
        is_active: true,
        is_featured: false,
        rating: 4.6,
        review_count: 28
      },
      {
        id: 'product-004',
        store_id: 'store-001',
        product_name: 'Î∂àÍ≥†Í∏∞ Ï†ïÏãù',
        name: 'Î∂àÍ≥†Í∏∞ Ï†ïÏãù',
        description: 'ÌïúÏö∞ Î∂àÍ≥†Í∏∞ Ï†ïÏãù',
        category: 'Ï†ïÏãù',
        price: 25000,
        original_price: 27000,
        image: 'ü•©',
        stock_quantity: 40,
        is_in_stock: true,
        is_active: true,
        is_featured: true,
        rating: 4.9,
        review_count: 87
      },
      {
        id: 'product-005',
        store_id: 'store-001',
        product_name: 'Ìï¥Î¨ºÌååÏ†Ñ',
        name: 'Ìï¥Î¨ºÌååÏ†Ñ',
        description: 'Î∞îÏÇ≠Ìïú Ìï¥Î¨ºÌååÏ†Ñ',
        category: 'Ï†Ñ',
        price: 18000,
        original_price: 19000,
        image: 'ü•û',
        stock_quantity: 25,
        is_in_stock: true,
        is_active: true,
        is_featured: false,
        rating: 4.5,
        review_count: 34
      },
      {
        id: 'product-006',
        store_id: 'store-001',
        product_name: 'LAÍ∞àÎπÑ',
        name: 'LAÍ∞àÎπÑ',
        description: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ LAÍ∞àÎπÑ',
        category: 'Íµ¨Ïù¥',
        price: 45000,
        original_price: 48000,
        image: 'üçó',
        stock_quantity: 15,
        is_in_stock: true,
        is_active: true,
        is_featured: true,
        rating: 5.0,
        review_count: 65
      }
    ];
    
    // ============================================
    // Í¥ÄÎ¶¨Ïûê Í∏∞Îä•
    // ============================================
    
    let pendingCoupons = []; // ÏäπÏù∏ ÎåÄÍ∏∞ Ïø†Ìè∞
    let approvedCoupons = []; // ÏäπÏù∏ ÏôÑÎ£å Ïø†Ìè∞
    let currentAdminTab = 'super'; // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í¥ÄÎ¶¨Ïûê ÌÉ≠
    
    // Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ï†ÑÌôò
    function showAdminTab(tab) {
      currentAdminTab = tab;
      
      // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞
      document.querySelectorAll('.admin-section').forEach(el => el.style.display = 'none');
      
      // ÏÑ†ÌÉùÎêú ÏÑπÏÖò Î≥¥Ïù¥Í∏∞
      const section = document.getElementById('admin-' + tab);
      if (section) section.style.display = 'block';
      
      // ÌÉ≠ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
      const tabs = ['super', 'store', 'users', 'coupons', 'history'];
      tabs.forEach(t => {
        const btn = document.getElementById('tab-' + t);
        if (btn) {
          btn.style.opacity = t === tab ? '1' : '0.5';
        }
      });
      
      // üîÑ Ïø†Ìè∞ ÏäπÏù∏ ÌÉ≠Ïùº Îïå Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ® + Ïã§ÏãúÍ∞Ñ ÌÜµÍ≥Ñ
      if (tab === 'coupons') {
        refreshAdminStats();
        renderPendingCoupons();
        renderAdminApprovedList();
      }
      
      // üìú ÏäπÏù∏ Í∏∞Î°ù ÌÉ≠Ïùº Îïå Í∏∞Î°ù Î†åÎçîÎßÅ
      if (tab === 'history') {
        renderApprovalHistory();
      }
    }
    
    // ===== üîî Í¥ÄÎ¶¨Ïûê ÏïåÎ¶º ÏãúÏä§ÌÖú =====
    let adminNotificationsEnabled = false;
    let notificationAudio = null;
    
    function enableAdminNotifications() {
      adminNotificationsEnabled = true;
      
      // ÏïåÎ¶ºÏùå ÎØ∏Î¶¨ Î°úÎìú (Ï∞®ÏûÑÎ≤® ÏÜåÎ¶¨)
      notificationAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp6WjH13b3R+iJafoJqPgXRqZWx4hpKcoJuQgHJmYWdweoeVn6GZjH5wZGFmbHmIl6Ccl4t8b2NfZGx5iJijop6Qf29gW19qeIqZpKOfjn1tYF1hanuMm6WjoJB/bmBeYGl7jp2mpKCOf2xfXGBpfJCgp6ahkIBtYF5hanySoamooZJ/bGBdYWl8k6OrqaORgGxgXWBpfJOjq6qikYBsYF1ganySoqqqoZGAbWBdYGl8kqKqqqGRgG1gXmFpfJKiqqmgkX9sX11gaXuSoqqpoJF/bF9dYGl7kaGpqKCRf2xfXWBoe5GhqKefkH9sX11faHuRoainn49/bF9dX2h7kaCnp5+Pf2xfXV9oe5CgpqaejX5rXlxeZ3qQn6WlnYx9al1bXWZ5j56kpJyLfGlcWlxld4+dpKObin1oW1lbZHaPnKOimol8Z1pYWmNziZqhn5eGemZYV1hhcoiYn56Vg3hkVlRYX2+GlZ2ckYF1YlRSVV1shZOam5B/c19RUFRaaoKRmJmNfHBdTk5SWGeBj5aXi3ltWk1LT1Vle42TlYh2aVZKSU1SYXmLkJOEdmZUSkdLUF94iI6RgXJiUEdESk5bd4WLjn5wX0tEQkdMV3OBiIp7bVtIQj9ES1Rve4WHd2lXRT49QUdQaniBhHVlUkE7OT5DSmRyfXxyXUo8NjU6P0ddbHV6bl5KPTMwNTpCU2VsdGteSTswLC0yOUJTYmpuX0s7MCgqLTQ+TVljZ1xIPi4oJiktNkFPW2JZRDssJiMmKjM+SlZdVUE4Kh8fIicuN0RNVFI/NScbGh4iKzI7RE1MQDQoGxkaHiUuN0FJSD4yJhkXGR0lLTZARkQ7LyMYFRgcIis0PENBOCwiGBQWGSAqMjpAPjUqHxcTFRkfKDE5PTowJRwVERMXHigwNzo1LCIaExETFx4nLzY4MikeGBIQExccJi41NzAlHBcQDxIXHCUtNDUvIxsVDw8SGRwlLDQzLCEZExAPEhgcJCszMislHBUPDhEWGiMqMTAoIhoTDg4RFRoiKi8wJiAYEg4OEBQZICgsMCYfFxEODRATFx8mKy0kHhYRDQwPExccIygqJB0WEA0MDxIWGiElJiEaFA8MDBATFRYWHR8fGhUQDA0KDA8SFRYXGR0fHBkTDgoJCgsNEBQYHB0cGxkYFBIRDw0LCQoLDREUFhkZGBcXFRUUEhAQDg4NDAsKCwwODxASExUXFxcXFhYVFRQTExIREA8PDg0NCwsLCgoKCwsLDA0ODw==');
      
      // Î∞∞ÎÑà Ïà®Í∏∞Í∏∞
      const banner = document.getElementById('admin-notification-banner');
      if (banner) {
        banner.innerHTML = `
          <div class="flex items-center gap-3">
            <span class="text-3xl">üîî</span>
            <div>
              <p class="font-bold text-green-400">‚úÖ ÏïåÎ¶º ÌôúÏÑ±ÌôîÎê®</p>
              <p class="text-sm text-gray-400">ÏÉà Ïã†Ï≤≠ Ïãú ÏïåÎ¶ºÏùåÏù¥ Ïû¨ÏÉùÎê©ÎãàÎã§.</p>
            </div>
          </div>
          <button onclick="testNotificationSound()" class="px-4 py-2 bg-gray-700 rounded-lg font-bold hover:bg-gray-600 transition">üîä ÌÖåÏä§Ìä∏</button>
        `;
        banner.classList.remove('border-yellow-500/30');
        banner.classList.add('border-green-500/30');
      }
      
      alert('üîî ÏïåÎ¶ºÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!\n\nÏÉàÎ°úÏö¥ Îß§Ïû•/Ïø†Ìè∞ Ïã†Ï≤≠ Ïãú ÏïåÎ¶ºÏùåÏù¥ Ïû¨ÏÉùÎê©ÎãàÎã§.');
    }
    
    function testNotificationSound() {
      playNotificationSound();
    }
    
    function playNotificationSound() {
      if (adminNotificationsEnabled && notificationAudio) {
        notificationAudio.currentTime = 0;
        notificationAudio.play().catch(e => console.log('ÏïåÎ¶ºÏùå Ïû¨ÏÉù Ïã§Ìå®:', e));
      }
    }
    
    function showNewRequestAlert(type, name) {
      const alert = document.getElementById('new-requests-alert');
      const nameEl = document.getElementById('new-request-name');
      const infoEl = document.getElementById('new-request-info');
      
      if (alert && nameEl) {
        nameEl.textContent = name;
        infoEl.textContent = type === 'store' ? `Îß§Ïû• ÏûÖÏ†ê Ïã†Ï≤≠: ${name}` : `Ïø†Ìè∞ Î∞úÍ∏â Ïã†Ï≤≠: ${name}`;
        alert.style.display = 'block';
        playNotificationSound();
      }
    }
    
    function hideNewRequestAlert() {
      const alert = document.getElementById('new-requests-alert');
      if (alert) alert.style.display = 'none';
    }
    
    // ÏäπÏù∏ Í∏∞Î°ù Ï†ÄÏû•
    let approvalHistory = JSON.parse(localStorage.getItem('approvalHistory') || '[]');
    
    function addApprovalRecord(type, name, status, reason = '') {
      const record = {
        id: Date.now(),
        type: type, // 'store' or 'coupon'
        name: name,
        status: status, // 'approved', 'rejected', 'reviewing'
        reason: reason,
        admin: currentUser?.name || 'Í¥ÄÎ¶¨Ïûê',
        timestamp: new Date().toISOString()
      };
      
      approvalHistory.unshift(record);
      localStorage.setItem('approvalHistory', JSON.stringify(approvalHistory));
      
      return record;
    }
    
    function filterHistory(filter) {
      let filtered = [...approvalHistory];
      
      if (filter === 'store') {
        filtered = filtered.filter(r => r.type === 'store');
      } else if (filter === 'coupon') {
        filtered = filtered.filter(r => r.type === 'coupon');
      } else if (filter === 'approved') {
        filtered = filtered.filter(r => r.status === 'approved');
      } else if (filter === 'rejected') {
        filtered = filtered.filter(r => r.status === 'rejected');
      }
      
      renderApprovalHistory(filtered);
    }
    
    function renderApprovalHistory(records = approvalHistory) {
      const container = document.getElementById('approval-history-list');
      if (!container) return;
      
      if (records.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-400 py-8">ÏäπÏù∏/Í±∞Î∂Ä Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
        return;
      }
      
      const formatDate = (isoStr) => {
        const d = new Date(isoStr);
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
      };
      
      container.innerHTML = records.map(record => {
        const statusColors = {
          approved: 'green',
          rejected: 'red',
          reviewing: 'yellow'
        };
        const statusEmojis = {
          approved: '‚úÖ',
          rejected: '‚ùå',
          reviewing: 'üîç'
        };
        const statusLabels = {
          approved: 'ÏäπÏù∏',
          rejected: 'Í±∞Î∂Ä',
          reviewing: 'Í≤ÄÌÜ†Ï§ë'
        };
        const color = statusColors[record.status] || 'gray';
        const emoji = statusEmojis[record.status] || 'üìã';
        const label = statusLabels[record.status] || record.status;
        
        return `
          <div class="bg-${color}-500/10 border border-${color}-500/30 p-4 rounded-lg">
            <div class="flex items-center justify-between flex-wrap gap-2">
              <div class="flex items-center gap-3">
                <span class="text-2xl">${emoji}</span>
                <div>
                  <p class="font-bold">${record.name} - ${record.type === 'store' ? 'Îß§Ïû•' : 'Ïø†Ìè∞'} ${label}</p>
                  <p class="text-sm text-gray-400">Ï≤òÎ¶¨Ïûê: ${record.admin} ${record.reason ? '| ÏÇ¨Ïú†: ' + record.reason : ''}</p>
                </div>
              </div>
              <span class="text-sm text-gray-400">${formatDate(record.timestamp)}</span>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // ===== ÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê Í∏∞Îä• =====
    function approveStore(storeId) {
      if (confirm('Ïù¥ Îß§Ïû•ÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        // ÏäπÏù∏ Í∏∞Î°ù Ï†ÄÏû•
        addApprovalRecord('store', storeId, 'approved', 'ÏÑúÎ•ò ÌôïÏù∏ ÏôÑÎ£å');
        alert('‚úÖ Îß§Ïû•Ïù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§!\n\nÎß§Ïû• ID: ' + storeId);
        playNotificationSound();
        
        // Í∏∞Î°ù ÏÉàÎ°úÍ≥†Ïπ®
        renderApprovalHistory();
      }
    }
    
    function rejectStore(storeId) {
      const reason = prompt('Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:');
      if (reason) {
        // Í±∞Î∂Ä Í∏∞Î°ù Ï†ÄÏû•
        addApprovalRecord('store', storeId, 'rejected', reason);
        alert('‚ùå Îß§Ïû• ÏäπÏù∏Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.\n\nÏÇ¨Ïú†: ' + reason);
        
        // Í∏∞Î°ù ÏÉàÎ°úÍ≥†Ïπ®
        renderApprovalHistory();
      }
    }
    
    function reviewStore(storeId) {
      const memo = prompt('Í≤ÄÌÜ† Î©îÎ™®Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî (ÏÑ†ÌÉù):');
      addApprovalRecord('store', storeId, 'reviewing', memo || 'Ï∂îÍ∞Ä Í≤ÄÌÜ† ÌïÑÏöî');
      alert('üîç Í≤ÄÌÜ†Ï§ëÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.');
      
      // Í∏∞Î°ù ÏÉàÎ°úÍ≥†Ïπ®
      renderApprovalHistory();
    }
    
    function toggleStoreActive(storeId) {
      if (confirm('Îß§Ïû• ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå? (ON ‚Üî OFF)')) {
        alert('‚úÖ Îß§Ïû• ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.');
      }
    }
    
    // ===== ÏÇ¨ÏóÖÏûê ÏûÖÏ†ê ÌîåÎ°úÏö∞ (Ïø†Ìå° Ïä§ÌÉÄÏùº 4Îã®Í≥Ñ) =====
    let currentRegStep = 0;
    let registrationData = {};
    
    function startRegistration() {
      if (!currentUser) {
        alert('‚ö†Ô∏è Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
        showPage('login');
        return;
      }
      
      // ÏßÑÌñâ ÌëúÏãúÍ∏∞ Î≥¥Ïù¥Í∏∞
      document.getElementById('register-progress').style.display = 'block';
      showRegisterStep('basic');
      updateStepIndicator(1);
    }
    
    function showRegisterStep(step) {
      // Î™®Îì† Ïä§ÌÖù Ïà®Í∏∞Í∏∞
      ['welcome', 'basic', 'operation', 'agreement', 'complete'].forEach(s => {
        const el = document.getElementById('register-step-' + s);
        if (el) el.style.display = 'none';
      });
      
      // ÏÑ†ÌÉùÎêú Ïä§ÌÖù ÌëúÏãú
      const targetStep = document.getElementById('register-step-' + step);
      if (targetStep) targetStep.style.display = 'block';
      
      // ÌôòÏòÅ ÌôîÎ©¥Ïù¥Î©¥ ÏßÑÌñâ ÌëúÏãúÍ∏∞ Ïà®Í∏∞Í∏∞
      if (step === 'welcome') {
        document.getElementById('register-progress').style.display = 'none';
      }
    }
    
    function updateStepIndicator(step) {
      currentRegStep = step;
      
      for (let i = 1; i <= 4; i++) {
        const indicator = document.getElementById('step-ind-' + i);
        if (indicator) {
          const circle = indicator.querySelector('div');
          const text = indicator.querySelector('span');
          
          if (i < step) {
            // ÏôÑÎ£åÎêú Îã®Í≥Ñ
            circle.className = 'w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-bold';
            circle.innerHTML = '‚úì';
            text.className = 'text-xs mt-1 text-green-400';
          } else if (i === step) {
            // ÌòÑÏû¨ Îã®Í≥Ñ
            circle.className = 'w-10 h-10 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold';
            circle.innerHTML = i;
            text.className = 'text-xs mt-1 text-purple-400';
          } else {
            // ÎØ∏ÏôÑÎ£å Îã®Í≥Ñ
            circle.className = 'w-10 h-10 rounded-full bg-gray-700 text-gray-400 flex items-center justify-center font-bold';
            circle.innerHTML = i;
            text.className = 'text-xs mt-1 text-gray-400';
          }
        }
      }
    }
    
    function goToStep2() {
      // Step 1 Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
      const storeName = document.getElementById('reg-store-name').value.trim();
      const category = document.getElementById('reg-category').value;
      const bizNumber = document.getElementById('reg-biz-number').value.trim();
      const ownerName = document.getElementById('reg-owner-name').value.trim();
      const ownerPhone = document.getElementById('reg-owner-phone').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      
      if (!storeName || !category || !bizNumber || !ownerName || !ownerPhone || !email) {
        alert('‚ö†Ô∏è Î™®Îì† ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }
      
      // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
      registrationData.storeName = storeName;
      registrationData.category = category;
      registrationData.bizNumber = bizNumber;
      registrationData.ownerName = ownerName;
      registrationData.ownerPhone = ownerPhone;
      registrationData.email = email;
      
      showRegisterStep('operation');
      updateStepIndicator(2);
    }
    
    function goToStep3() {
      // Step 2 Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
      const address = document.getElementById('reg-address').value.trim();
      const storePhone = document.getElementById('reg-store-phone').value.trim();
      
      if (!address || !storePhone) {
        alert('‚ö†Ô∏è Îß§Ïû• Ï£ºÏÜåÏôÄ Ï†ÑÌôîÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }
      
      // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
      registrationData.address = address;
      registrationData.addressDetail = document.getElementById('reg-address-detail').value.trim();
      registrationData.storePhone = storePhone;
      registrationData.hours = document.getElementById('reg-hours').value.trim();
      registrationData.closed = document.getElementById('reg-closed').value.trim();
      registrationData.description = document.getElementById('reg-description').value.trim();
      
      showRegisterStep('agreement');
      updateStepIndicator(3);
    }
    
    function submitFinalRegistration() {
      // ÏïΩÍ¥Ä ÎèôÏùò Í≤ÄÏÇ¨
      const required = ['agree-terms', 'agree-privacy', 'agree-fee', 'agree-operation'];
      const allChecked = required.every(id => {
        const el = document.getElementById(id);
        return el && el.checked;
      });
      
      if (!allChecked) {
        alert('‚ö†Ô∏è Î™®Îì† ÌïÑÏàò ÏïΩÍ¥ÄÏóê ÎèôÏùòÌï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }
      
      // Ïã†Ï≤≠ ÏôÑÎ£å
      registrationData.submittedAt = new Date().toISOString();
      registrationData.status = 'pending';
      
      // localStorageÏóê Ï†ÄÏû•
      const pendingStores = JSON.parse(localStorage.getItem('pendingStores') || '[]');
      pendingStores.push({
        id: 'store-' + Date.now(),
        ...registrationData
      });
      localStorage.setItem('pendingStores', JSON.stringify(pendingStores));
      
      // ÏôÑÎ£å ÌôîÎ©¥ ÌëúÏãú
      document.getElementById('submitted-store-name').textContent = registrationData.storeName;
      document.getElementById('submitted-date').textContent = new Date().toLocaleDateString('ko-KR');
      
      showRegisterStep('complete');
      updateStepIndicator(4);
      
      // Í¥ÄÎ¶¨Ïûê ÏïåÎ¶º (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
      setTimeout(() => {
        showNewRequestAlert('store', registrationData.storeName);
      }, 1000);
      
      alert('üéâ Îß§Ïû• ÏûÖÏ†ê Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\n\nÍ¥ÄÎ¶¨Ïûê Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ ÏïàÎÇ¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.');
    }
    
    function searchAddress() {
      // Ïã§Ï†úÎ°úÎäî Ïπ¥Ïπ¥Ïò§/ÎÑ§Ïù¥Î≤Ñ Ï£ºÏÜå API Ïó∞Îèô
      alert('üîç Ï£ºÏÜå Í≤ÄÏÉâ\n\nÏã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî Ïπ¥Ïπ¥Ïò§/ÎÑ§Ïù¥Î≤Ñ Ï£ºÏÜå APIÍ∞Ä Ïó∞ÎèôÎê©ÎãàÎã§.');
      document.getElementById('reg-zipcode').value = '06234';
      document.getElementById('reg-address').value = 'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123';
    }
    
    function previewRegImage(input) {
      if (input.files && input.files[0]) {
        const preview = document.getElementById('reg-image-preview');
        if (preview) {
          preview.innerHTML = `<img src="${URL.createObjectURL(input.files[0])}" class="w-24 h-24 object-cover rounded-lg mx-auto">`;
        }
      }
    }
    
    function toggleAllAgreements(checkbox) {
      const allChecks = ['agree-terms', 'agree-privacy', 'agree-fee', 'agree-operation'];
      allChecks.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.checked = checkbox.checked;
      });
    }
    
    function validateAgreementsAndProceed() {
      const required = ['agree-terms', 'agree-privacy', 'agree-fee', 'agree-operation'];
      const allChecked = required.every(id => {
        const el = document.getElementById(id);
        return el && el.checked;
      });
      
      if (!allChecked) {
        alert('‚ö†Ô∏è Î™®Îì† ÌïÑÏàò ÏïΩÍ¥ÄÏóê ÎèôÏùòÌï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }
      
      showRegisterStep('form');
    }
    
    function submitStoreRegistration(e) {
      e.preventDefault();
      
      const storeName = document.getElementById('business-name').value;
      const category = document.getElementById('business-category').value;
      const address = document.getElementById('business-address').value;
      
      // Ïã†Ï≤≠ ÏôÑÎ£å ÌëúÏãú
      document.getElementById('submitted-store-name').textContent = storeName;
      document.getElementById('submitted-date').textContent = new Date().toLocaleDateString('ko-KR');
      
      // Í¥ÄÎ¶¨Ïûê ÏïåÎ¶º (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
      setTimeout(() => {
        showNewRequestAlert('store', storeName);
      }, 1000);
      
      showRegisterStep('complete');
      alert('üéâ Îß§Ïû• ÏûÖÏ†ê Ïã†Ï≤≠Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\n\nÍ¥ÄÎ¶¨Ïûê Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ ÏïàÎÇ¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.');
    }
    
    function showTermsModal(type) {
      alert('üìã ' + (type === 'terms' ? 'ÏÑúÎπÑÏä§ Ïù¥Ïö©ÏïΩÍ¥Ä' : 'Í∞úÏù∏Ï†ïÎ≥¥ Ï≤òÎ¶¨Î∞©Ïπ®') + ' Ï†ÑÎ¨∏\n\n(Ïã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî Î™®Îã¨Ï∞ΩÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§)');
    }
    
    // ===== ÎÇ¥ Îß§Ïû• ÎåÄÏãúÎ≥¥Îìú =====
    function showMyStoreDashTab(tab) {
      // Î™®Îì† ÏΩòÌÖêÏ∏† Ïà®Í∏∞Í∏∞
      ['orders', 'sales', 'coupons', 'decorate'].forEach(t => {
        const content = document.getElementById('mystore-content-' + t);
        const btn = document.getElementById('mystore-tab-' + t);
        if (content) content.style.display = 'none';
        if (btn) {
          btn.classList.remove('bg-gradient-to-r', 'from-cyan-500', 'to-purple-500');
          btn.classList.add('bg-gray-700');
        }
      });
      
      // ÏÑ†ÌÉùÎêú ÏΩòÌÖêÏ∏† ÌëúÏãú
      const targetContent = document.getElementById('mystore-content-' + tab);
      const targetBtn = document.getElementById('mystore-tab-' + tab);
      if (targetContent) targetContent.style.display = 'block';
      if (targetBtn) {
        targetBtn.classList.remove('bg-gray-700');
        targetBtn.classList.add('bg-gradient-to-r', 'from-cyan-500', 'to-purple-500');
      }
    }
    
    // ===== üê∞ Golden Rabbit CFO Í∏∞Îä• =====
    function toggleRabbitWidget() {
      const widget = document.getElementById('golden-rabbit-widget');
      if (widget.style.display === 'none') {
        widget.style.display = 'block';
      } else {
        widget.style.display = 'none';
      }
    }
    
    // Î©îÏù∏ Golden Rabbit (ÎÇ¥ Îß§Ïû• ÌÉ≠ ÏµúÏÉÅÎã®)
    function askRabbitMain(topic) {
      const analysisDiv = document.getElementById('rabbit-main-analysis');
      
      // Î°úÎî© ÌëúÏãú
      analysisDiv.innerHTML = `
        <div class="flex items-center gap-3">
          <span class="text-2xl animate-bounce">üê∞</span>
          <span class="text-yellow-400">Î∂ÑÏÑù Ï§ë...</span>
        </div>
      `;
      
      setTimeout(() => {
        let response = '';
        
        if (topic === 'sales') {
          response = `
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üê∞</span>
              <span class="font-bold text-yellow-400">üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑù Í≤∞Í≥º</span>
            </div>
            <ul class="space-y-1 text-sm">
              <li>‚Ä¢ Ï¥ù Îß§Ï∂ú: <span class="text-cyan-400 font-bold">‚Ç©340,000</span> (Ï†ÑÏùº ÎåÄÎπÑ <span class="text-green-400">+12%</span>)</li>
              <li>‚Ä¢ Ï£ºÎ¨∏ Í±¥Ïàò: <span class="text-white font-bold">12Í±¥</span></li>
              <li>‚Ä¢ Í∞ùÎã®Í∞Ä: <span class="text-white font-bold">‚Ç©28,333</span></li>
            </ul>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-sm">üéØ ÌîºÌÅ¨ ÏãúÍ∞ÑÎåÄ: <span class="text-cyan-400">Ïò§ÌõÑ 12Ïãú~1Ïãú (Ï†êÏã¨)</span></p>
              <p class="text-sm text-yellow-300">üí° Ï∂îÏ≤ú: Ï†ÄÎÖÅ ÏãúÍ∞ÑÎåÄ ÌîÑÎ°úÎ™®ÏÖò Í∞ïÌôîÌïòÎ©¥ Îß§Ï∂ú 20% ÏÉÅÏäπ ÏòàÏÉÅÎê©ÎãàÎã§!</p>
            </div>
          `;
        } else if (topic === 'tax') {
          response = `
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üê∞</span>
              <span class="font-bold text-yellow-400">üìã ÏÑ∏Î¨¥ Ïã†Í≥† ÏïàÎÇ¥</span>
            </div>
            <ul class="space-y-2 text-sm">
              <li>üìÖ <span class="text-cyan-400 font-bold">Î∂ÄÍ∞ÄÏÑ∏ Ïã†Í≥† Í∏∞Ìïú:</span> 2026ÎÖÑ 1Ïõî 25Ïùº</li>
              <li>üí∞ <span class="text-white">ÏòàÏÉÅ Î∂ÄÍ∞ÄÏÑ∏:</span> ‚Ç©1,200,000</li>
              <li>üìù <span class="text-white">ÌïÑÏöî ÏÑúÎ•ò:</span> Îß§Ï∂ú/Îß§ÏûÖ ÏÑ∏Í∏àÍ≥ÑÏÇ∞ÏÑú, Ïã†Ïö©Ïπ¥Îìú Îß§Ï∂úÏ†ÑÌëú</li>
            </ul>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-sm text-yellow-300">üí° ÌåÅ: Í∞ÑÏù¥Í≥ºÏÑ∏Ïûê Ï†ÑÌôò Ïãú ÏÑ∏Í∏à ÏïΩ 30% Ï†àÍ∞ê Í∞ÄÎä•Ìï¥Ïöî!</p>
              <p class="text-sm text-green-400">‚úÖ ÏÑ∏Î¨¥ÏÇ¨ Ïó∞Í≤∞ ÏÑúÎπÑÏä§ÎèÑ Ï†úÍ≥µÌï©ÎãàÎã§!</p>
            </div>
          `;
        } else if (topic === 'marketing') {
          response = `
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üê∞</span>
              <span class="font-bold text-yellow-400">üì¢ ÎßàÏºÄÌåÖ Ï†ÑÎûµ Ï†úÏïà</span>
            </div>
            <div class="space-y-3 text-sm">
              <div class="bg-purple-500/20 p-3 rounded-lg">
                <p class="font-bold text-purple-400">üéØ ÌÉÄÍ≤ü Í≥†Í∞ù Î∂ÑÏÑù</p>
                <p>20-30ÎåÄ ÏßÅÏû•Ïù∏Ïù¥ Ï£º Í≥†Í∞ùÏ∏µ (68%)</p>
              </div>
              <div class="bg-cyan-500/20 p-3 rounded-lg">
                <p class="font-bold text-cyan-400">üí° Ï∂îÏ≤ú ÌîÑÎ°úÎ™®ÏÖò</p>
                <ul class="mt-1 space-y-1">
                  <li>‚Ä¢ Ï†êÏã¨ ÌäπÏÑ† ÏÑ∏Ìä∏ 10% Ìï†Ïù∏</li>
                  <li>‚Ä¢ Ïû¨Î∞©Î¨∏ Ïø†Ìè∞ Î∞úÍ∏â (20% Ìï†Ïù∏)</li>
                  <li>‚Ä¢ Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Î¶¨Î∑∞ Ïù¥Î≤§Ìä∏</li>
                </ul>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-sm text-yellow-300">üí° ÏòàÏÉÅ Ìö®Í≥º: Ïõî Îß§Ï∂ú 15~25% Ï¶ùÍ∞Ä!</p>
            </div>
          `;
        }
        
        analysisDiv.innerHTML = response;
      }, 1500);
    }
    
    async function sendToRabbitMain() {
      const input = document.getElementById('rabbit-main-input');
      const query = input.value.trim();

      if (!query) {
        alert('üê∞ ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
        return;
      }

      const analysisDiv = document.getElementById('rabbit-main-analysis');

      analysisDiv.innerHTML = `
        <div class="flex items-center gap-3 mb-4">
          <span class="text-2xl animate-bounce">üê∞</span>
          <span class="text-yellow-400">"${query}"Ïóê ÎåÄÌï¥ Î∂ÑÏÑùÌï¥ÎìúÎ¶¥Í≤åÏöî!</span>
        </div>
        <div class="flex items-center gap-2 text-gray-400">
          <div class="animate-spin w-4 h-4 border-2 border-yellow-500 border-t-transparent rounded-full"></div>
          <span>üü¢ Gemini AI Î∂ÑÏÑù Ï§ë...</span>
        </div>
      `;

      input.value = '';

      // Gemini API Ìò∏Ï∂ú
      const prompt = `ÎÑàÎäî "Golden Rabbit CFO" üê∞ ‚Äî ÏÜåÏÉÅÍ≥µÏù∏ Ï†ÑÏö© AI ÎπÑÏÑúÏïº.
Îß§Ïû•Î™Ö: ÏïÑÎØ∏ ÌïúÏ†ïÏãù | ÏóÖÏ¢Ö: ÌïúÏãù | Ïõî ÌèâÍ∑† Îß§Ï∂ú: ÏïΩ 1,000ÎßåÏõê
ÏÇ¨Ïû•ÎãòÏù¥ "${query}" ÎùºÍ≥† Î¨ºÏñ¥Î¥§Ïñ¥.
ÏπúÍ∑ºÌïòÍ≥† Ïã§Ïö©Ï†ÅÏúºÎ°ú, Ïù¥Î™®ÏßÄ ÏÇ¨Ïö©Ìï¥ÏÑú ÌïúÍµ≠Ïñ¥Î°ú ÏßßÍ≤å (200Ïûê Ïù¥ÎÇ¥) ÎãµÎ≥ÄÌï¥Ï§ò.`;

      let response = await callGeminiAPI(prompt);

      if (!response) {
        response = `ÎÑ§, "${query}"Ïóê ÎåÄÌï¥ Î∂ÑÏÑùÌï¥ÎìúÎ¶¥Í≤åÏöî! üê∞\nÌòÑÏû¨ Îß§Ïû• Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î∞òÏúºÎ°ú ÏµúÏ†ÅÏùò ÏÜîÎ£®ÏÖòÏùÑ Ï∞æÏïòÏñ¥Ïöî.\nÎçî ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©Ïù¥ ÌïÑÏöîÌïòÏãúÎ©¥ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏßàÎ¨∏Ìï¥Ï£ºÏÑ∏Ïöî!`;
      }

      analysisDiv.innerHTML = `
        <div class="flex items-center gap-2 mb-3">
          <span class="text-lg">üê∞</span>
          <span class="font-bold text-yellow-400">üí¨ Golden Rabbit ÎãµÎ≥Ä</span>
          <span class="text-xs px-2 py-0.5 rounded-full" style="background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);">üü¢ Gemini AI</span>
        </div>
        <div class="bg-black/30 p-3 rounded-lg">
          <p class="text-sm" style="white-space:pre-line;">${response}</p>
        </div>
      `;
    }
    
    function askRabbit(topic) {
      const analysisDiv = document.getElementById('rabbit-analysis');
      
      // Î°úÎî© ÌëúÏãú
      analysisDiv.innerHTML = `
        <div class="flex items-center gap-3">
          <span class="text-2xl animate-bounce">üê∞</span>
          <span class="text-yellow-400">Î∂ÑÏÑù Ï§ë...</span>
        </div>
      `;
      
      // ÏãúÎÆ¨Î†àÏù¥ÏÖòÎêú ÏùëÎãµ (Ïã§Ï†úÎ°úÎäî Gemini API Ïó∞Îèô)
      setTimeout(() => {
        let response = '';
        
        if (topic === 'sales') {
          response = `
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üê∞</span>
              <span class="font-bold text-yellow-400">üìä Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑù Í≤∞Í≥º</span>
            </div>
            <ul class="space-y-1 text-sm">
              <li>‚Ä¢ Ï¥ù Îß§Ï∂ú: <span class="text-cyan-400 font-bold">‚Ç©340,000</span> (Ï†ÑÏùº ÎåÄÎπÑ <span class="text-green-400">+12%</span>)</li>
              <li>‚Ä¢ Ï£ºÎ¨∏ Í±¥Ïàò: <span class="text-white font-bold">12Í±¥</span></li>
              <li>‚Ä¢ Í∞ùÎã®Í∞Ä: <span class="text-white font-bold">‚Ç©28,333</span></li>
            </ul>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-sm">üéØ ÌîºÌÅ¨ ÏãúÍ∞ÑÎåÄ: <span class="text-cyan-400">Ïò§ÌõÑ 12Ïãú~1Ïãú (Ï†êÏã¨)</span></p>
              <p class="text-sm text-yellow-300">üí° Ï∂îÏ≤ú: Ï†ÄÎÖÅ ÏãúÍ∞ÑÎåÄ ÌîÑÎ°úÎ™®ÏÖò Í∞ïÌôîÌïòÎ©¥ Îß§Ï∂ú 20% ÏÉÅÏäπ ÏòàÏÉÅÎê©ÎãàÎã§!</p>
            </div>
          `;
        } else if (topic === 'tax') {
          response = `
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üê∞</span>
              <span class="font-bold text-yellow-400">üìã ÏÑ∏Î¨¥ Ïã†Í≥† ÏïàÎÇ¥</span>
            </div>
            <ul class="space-y-2 text-sm">
              <li>üìÖ <span class="text-cyan-400 font-bold">Î∂ÄÍ∞ÄÏÑ∏ Ïã†Í≥† Í∏∞Ìïú:</span> 2026ÎÖÑ 1Ïõî 25Ïùº</li>
              <li>üí∞ <span class="text-white">ÏòàÏÉÅ Î∂ÄÍ∞ÄÏÑ∏:</span> ‚Ç©1,200,000</li>
              <li>üìù <span class="text-white">ÌïÑÏöî ÏÑúÎ•ò:</span> Îß§Ï∂ú/Îß§ÏûÖ ÏÑ∏Í∏àÍ≥ÑÏÇ∞ÏÑú, Ïã†Ïö©Ïπ¥Îìú Îß§Ï∂úÏ†ÑÌëú</li>
            </ul>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-sm text-yellow-300">üí° ÌåÅ: Í∞ÑÏù¥Í≥ºÏÑ∏Ïûê Ï†ÑÌôò Ïãú ÏÑ∏Í∏à ÏïΩ 30% Ï†àÍ∞ê Í∞ÄÎä•Ìï¥Ïöî!</p>
              <p class="text-sm text-green-400">‚úÖ ÏÑ∏Î¨¥ÏÇ¨ Ïó∞Í≤∞ ÏÑúÎπÑÏä§ÎèÑ Ï†úÍ≥µÌï©ÎãàÎã§!</p>
            </div>
          `;
        } else if (topic === 'marketing') {
          response = `
            <div class="flex items-center gap-2 mb-3">
              <span class="text-lg">üê∞</span>
              <span class="font-bold text-yellow-400">üì¢ ÎßàÏºÄÌåÖ Ï†ÑÎûµ Ï†úÏïà</span>
            </div>
            <div class="space-y-3 text-sm">
              <div class="bg-purple-500/20 p-3 rounded-lg">
                <p class="font-bold text-purple-400">üéØ ÌÉÄÍ≤ü Í≥†Í∞ù Î∂ÑÏÑù</p>
                <p>20-30ÎåÄ ÏßÅÏû•Ïù∏Ïù¥ Ï£º Í≥†Í∞ùÏ∏µ (68%)</p>
              </div>
              <div class="bg-cyan-500/20 p-3 rounded-lg">
                <p class="font-bold text-cyan-400">üí° Ï∂îÏ≤ú ÌîÑÎ°úÎ™®ÏÖò</p>
                <ul class="mt-1 space-y-1">
                  <li>‚Ä¢ Ï†êÏã¨ ÌäπÏÑ† ÏÑ∏Ìä∏ 10% Ìï†Ïù∏</li>
                  <li>‚Ä¢ Ïû¨Î∞©Î¨∏ Ïø†Ìè∞ Î∞úÍ∏â (20% Ìï†Ïù∏)</li>
                  <li>‚Ä¢ Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Î¶¨Î∑∞ Ïù¥Î≤§Ìä∏</li>
                </ul>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-sm text-yellow-300">üí° ÏòàÏÉÅ Ìö®Í≥º: Ïõî Îß§Ï∂ú 15~25% Ï¶ùÍ∞Ä!</p>
            </div>
          `;
        }
        
        analysisDiv.innerHTML = response;
      }, 1500);
    }
    
    function sendToRabbit() {
      const input = document.getElementById('rabbit-input');
      const query = input.value.trim();
      
      if (!query) {
        alert('üê∞ ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
        return;
      }
      
      const analysisDiv = document.getElementById('rabbit-analysis');
      
      // ÏÇ¨Ïö©Ïûê ÏûÖÎ†• ÌëúÏãú
      analysisDiv.innerHTML = `
        <div class="flex items-center gap-3 mb-4">
          <span class="text-2xl animate-bounce">üê∞</span>
          <span class="text-yellow-400">"${query}"Ïóê ÎåÄÌï¥ Î∂ÑÏÑùÌï¥ÎìúÎ¶¥Í≤åÏöî!</span>
        </div>
        <div class="flex items-center gap-2 text-gray-400">
          <div class="animate-spin w-4 h-4 border-2 border-yellow-500 border-t-transparent rounded-full"></div>
          <span>AI Î∂ÑÏÑù Ï§ë...</span>
        </div>
      `;
      
      // ÏãúÎÆ¨Î†àÏù¥ÏÖòÎêú ÏùëÎãµ
      setTimeout(() => {
        analysisDiv.innerHTML = `
          <div class="flex items-center gap-2 mb-3">
            <span class="text-lg">üê∞</span>
            <span class="font-bold text-yellow-400">üí¨ Golden Rabbit ÎãµÎ≥Ä</span>
          </div>
          <div class="bg-black/30 p-3 rounded-lg">
            <p class="text-sm mb-2">ÎÑ§, "${query}"Ïóê ÎåÄÌï¥ Î∂ÑÏÑùÌï¥ÎìúÎ¶¥Í≤åÏöî! üê∞</p>
            <p class="text-sm text-gray-300">ÌòÑÏû¨ Îß§Ïû• Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î∞òÏúºÎ°ú Î∂ÑÏÑùÌïú Í≤∞Í≥º, Ìï¥Îãπ ÏßàÎ¨∏Ïóê ÎåÄÌïú ÏµúÏ†ÅÏùò ÏÜîÎ£®ÏÖòÏùÑ Ï∞æÏïòÏñ¥Ïöî.</p>
            <div class="mt-3 p-2 bg-yellow-500/10 rounded border border-yellow-500/30">
              <p class="text-sm text-yellow-300">üí° ÏûêÏÑ∏Ìïú Î∂ÑÏÑùÏùÑ ÏõêÌïòÏãúÎ©¥ Premium ÌîåÎûúÏùÑ Ïù¥Ïö©Ìï¥Î≥¥ÏÑ∏Ïöî!</p>
            </div>
          </div>
        `;
      }, 2000);
      
      input.value = '';
    }
    
    function filterOrders(status) {
      // ÌïÑÌÑ∞ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
      document.querySelectorAll('.order-filter-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-red-500', 'bg-yellow-500', 'bg-green-500');
        btn.classList.add('bg-gray-700');
      });
      
      event.target.classList.remove('bg-gray-700');
      if (status === 'new') event.target.classList.add('bg-red-500');
      else if (status === 'preparing') event.target.classList.add('bg-yellow-500');
      else if (status === 'ready') event.target.classList.add('bg-green-500');
      
      console.log('Filter orders:', status);
    }
    
    function acceptOrder(orderId) {
      if (confirm('Ï£ºÎ¨∏ÏùÑ Ï†ëÏàòÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        alert('‚úÖ Ï£ºÎ¨∏Ïù¥ Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§!\n\nÏ£ºÎ¨∏Î≤àÌò∏: ' + orderId + '\nÏ°∞Î¶¨Î•º ÏãúÏûëÌï¥Ï£ºÏÑ∏Ïöî.');
        playNotificationSound();
      }
    }
    
    function completeOrder(orderId) {
      alert('‚úÖ Ï£ºÎ¨∏ Ï§ÄÎπÑÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!\n\nÍ≥†Í∞ùÏóêÍ≤å ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°Îê©ÎãàÎã§.');
    }
    
    function rejectOrder(orderId) {
      const reason = prompt('Ï£ºÎ¨∏ Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:');
      if (reason) {
        alert('‚ùå Ï£ºÎ¨∏Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§.\n\nÏÇ¨Ïú†: ' + reason + '\nÍ≥†Í∞ùÏóêÍ≤å ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°Îê©ÎãàÎã§.');
      }
    }
    
    function saveStoreDecoration() {
      alert('üíæ Îß§Ïû• Ï†ïÎ≥¥Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
    }
    
    function previewStoreImage(input) {
      if (input.files && input.files[0]) {
        const preview = document.getElementById('store-image-preview');
        if (preview) {
          preview.innerHTML = `<img src="${URL.createObjectURL(input.files[0])}" class="w-32 h-32 object-cover rounded-lg mx-auto">`;
        }
      }
    }
    
    function previewPromoVideo(input) {
      if (input.files && input.files[0]) {
        const preview = document.getElementById('promo-video-preview');
        if (preview) {
          preview.innerHTML = `<video src="${URL.createObjectURL(input.files[0])}" class="w-full max-w-md mx-auto rounded-lg" controls></video>`;
        }
      }
    }
    
    function downloadMenuTemplate() {
      alert('üì• Î©îÎâ¥ ÏóëÏÖÄ ÌÖúÌîåÎ¶ø Îã§Ïö¥Î°úÎìú\n\nÌååÏùºÎ™Ö: menu_template.xlsx');
    }
    
    function showAddMenuForm() {
      const name = prompt('Î©îÎâ¥ Ïù¥Î¶Ñ:');
      if (!name) return;
      
      const price = prompt('Í∞ÄÍ≤© (Ïà´ÏûêÎßå):');
      if (!price) return;
      
      const category = prompt('Ïπ¥ÌÖåÍ≥†Î¶¨ (Ï†ïÏãù/ÌÉïÎ•ò/Ï∞åÍ∞ú/Ï†Ñ Îì±):');
      
      alert('‚úÖ ÏÉà Î©îÎâ¥Í∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!\n\n' + name + ' - ‚Ç©' + parseInt(price).toLocaleString());
    }
    
    function editMenu(menuId) {
      alert('Î©îÎâ¥ ÏàòÏ†ï ÌôîÎ©¥ÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.\n\nÎ©îÎâ¥ ID: ' + menuId);
    }
    
    function deleteMenu(menuId) {
      if (confirm('Ïù¥ Î©îÎâ¥Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        alert('‚úÖ Î©îÎâ¥Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      }
    }
    
    // ===== ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Í∏∞Îä• =====
    function modifyUserActive(userId) {
      if (confirm('ÏÇ¨Ïö©Ïûê ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå? (ON ‚Üî OFF)\n\nÏÇ¨Ïö©Ïûê ID: ' + userId)) {
        alert('‚úÖ ÏÇ¨Ïö©Ïûê ÏÉÅÌÉúÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.');
      }
    }
    
    // üîó ÌôàÌéòÏù¥ÏßÄ/SNS ÎßÅÌÅ¨ Î∞îÎ°ú Ïù¥Îèô
    function openWebsiteLink() {
      let url = document.getElementById('business-website').value.trim();
      
      if (!url) {
        alert('‚ö†Ô∏è URLÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
        return;
      }
      
      // http:// ÎòêÎäî https:// ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
      }
      
      // ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Í∏∞
      window.open(url, '_blank');
    }
    
    function loadAdminPage() {
      // Í∏∞Î≥∏ ÌÉ≠ ÌëúÏãú
      showAdminTab('super');

      // ‚≠ê Ïã§ÏãúÍ∞Ñ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ (couponManagementData + gameIssuedCoupons + wallet ÌÜµÌï©)
      refreshAdminStats();

      // ÎåÄÍ∏∞ Î™©Î°ù Î†åÎçîÎßÅ
      renderPendingCoupons();
      renderAdminApprovedList();
    }

    // ‚≠ê Í¥ÄÎ¶¨Ïûê Ïã§ÏãúÍ∞Ñ ÌÜµÍ≥Ñ Í∞±Ïã†
    function refreshAdminStats() {
      // Îß§Ïû• Î∞úÍ∏â Ïø†Ìè∞ (couponManagementData)
      var mgmtCoupons = (typeof window.couponManagementData !== 'undefined' && window.couponManagementData.coupons) ? window.couponManagementData.coupons : [];
      var pendingCount = pendingCoupons.length + mgmtCoupons.filter(function(c){return c.status === 'pending';}).length;
      var approvedCount = approvedCoupons.length + mgmtCoupons.filter(function(c){return c.status === 'active';}).length;

      // Í≤åÏûÑÏóê Î∞∞Ìè¨Îêú Ïø†Ìè∞ (remaining Í∞êÏÜåÎ∂Ñ = Î∞∞Ìè¨)
      var totalDeployed = 0;
      gameIssuedCoupons.forEach(function(gc) {
        if (gc.status === 'approved') totalDeployed += (gc.total_quantity - gc.remaining);
      });

      // Í≥†Í∞ù ÏßÄÍ∞ëÏóê ÏûàÎäî Ïø†Ìè∞
      var walletAll = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
      var inWallet = walletAll.length;

      // Ï¥ù ÏàòÏùµ
      var totalRevenue = approvedCoupons.reduce(function(sum, c){return sum + (c.issue_cost || 0);}, 0);
      totalRevenue += mgmtCoupons.filter(function(c){return c.status === 'active';}).reduce(function(sum, c){return sum + (c.paymentAmount || c.quantity * 100);}, 0);

      // DOM ÏóÖÎç∞Ïù¥Ìä∏
      var ep = document.getElementById('admin-pending'); if(ep) ep.textContent = pendingCount;
      var ea = document.getElementById('admin-approved'); if(ea) ea.textContent = approvedCount;
      var ed = document.getElementById('admin-deployed'); if(ed) ed.textContent = totalDeployed;
      var ew = document.getElementById('admin-in-wallet'); if(ew) ew.textContent = inWallet;
      var er = document.getElementById('admin-revenue'); if(er) er.textContent = '‚Ç©' + totalRevenue.toLocaleString();
    }

    // ‚≠ê Í¥ÄÎ¶¨Ïûê Ïø†Ìè∞ ÎåÄÍ∏∞ ÌÅê ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº
    window.refreshAdminCouponQueue = function() {
      refreshAdminStats();
      renderPendingCoupons();
      renderAdminApprovedList();
      if (typeof showToast === 'function') showToast('üîÑ Ïø†Ìè∞ ÌòÑÌô© ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å!', 'coupon');
    };
    
    // ===== Îß§Ïû• ÏäπÏù∏ Í¥ÄÎ†® =====
    function reviewStore(storeId) {
      const store = STORES[storeId];
      if (confirm(`"${store?.name || storeId}" Îß§Ïû•ÏùÑ Í≤ÄÌÜ†Ï§ë ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
        alert('üîç Îß§Ïû• ÏÉÅÌÉúÍ∞Ä "Í≤ÄÌÜ†Ï§ë"ÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.\n\nÎã¥ÎãπÏûêÍ∞Ä ÏÑúÎ•òÎ•º ÌôïÏù∏ Ï§ëÏûÖÎãàÎã§.');
      }
    }
    
    // ===== Ïø†Ìè∞ ÏÇ≠Ï†ú =====
    function deleteCoupon(couponId) {
      if (confirm('Ï†ïÎßê Ïù¥ Ïø†Ìè∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚ö†Ô∏è ÏÇ≠Ï†úÎêú Ïø†Ìè∞ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.')) {
        alert('üóëÔ∏è Ïø†Ìè∞Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
        // TODO: API Ìò∏Ï∂úÎ°ú Ïã§Ï†ú ÏÇ≠Ï†ú
      }
    }
    
    // ===== Îß§Ïû• Ïø†Ìè∞ Î∞úÍ∏â =====
    function issueStoreCoupon(e) {
      e.preventDefault();
      
      const name = document.getElementById('store-coupon-name').value;
      const discount = document.getElementById('store-coupon-discount').value;
      const type = document.getElementById('store-coupon-type').value;
      const qty = document.getElementById('store-coupon-qty').value;
      const expiry = document.getElementById('store-coupon-expiry').value;
      const condition = document.getElementById('store-coupon-condition').value;
      
      const totalCost = parseInt(qty) * 50; // Ïû•Îãπ 100Ïõê
      
      // üí≥ Í≤∞Ï†ú ÌôïÏù∏
      if (!confirm(`üí≥ Í≤∞Ï†ú ÌôïÏù∏\n\nÏø†Ìè∞Î™Ö: ${name}\nÎ∞úÍ∏â ÏàòÎüâ: ${qty}Ïû•\nÎã®Í∞Ä: 100Ïõê/Ïû•\n\nüí∞ Ï¥ù Í≤∞Ï†úÍ∏àÏï°: ‚Ç©${totalCost.toLocaleString()}\n\nÍ≤∞Ï†úÎ•º ÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
        return;
      }
      
      // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò Îß§Ïû• Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
      const myStore = Object.values(STORES).find(s => s.status === 'approved') || {
        name: currentUser?.name || 'ÎÇ¥ Îß§Ïû•',
        emoji: 'üè™'
      };
      
      const newCoupon = {
        id: 'store-coupon-' + Date.now(),
        store_id: 'store-001', // ÏÇ¨Ïö©ÏûêÏùò Îß§Ïû• ID (Ïã§Ï†úÎ°úÎäî ÎèôÏ†ÅÏúºÎ°ú)
        store_name: myStore.name,
        store_emoji: myStore.emoji || 'üè™',
        business_name: myStore.name,
        title: name,
        discount_type: type,
        discount_value: parseInt(discount),
        total_quantity: parseInt(qty),
        remaining: parseInt(qty),
        expiry: expiry,
        condition: condition,
        status: 'pending',
        rarity: discount >= 50 ? 'legendary' : discount >= 30 ? 'epic' : discount >= 20 ? 'rare' : 'common',
        issue_cost: totalCost,
        paid_at: new Date().toISOString(),
        image_url: `coupon-${discount}.png`
      };
      
      pendingCoupons.push(newCoupon);
      
      // Í¥ÄÎ¶¨Ïûê ÏïåÎ¶º (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
      setTimeout(() => {
        showNewRequestAlert('coupon', name);
      }, 500);
      
      alert(`‚úÖ Í≤∞Ï†ú ÏôÑÎ£å!\n\nüí∞ Í≤∞Ï†úÍ∏àÏï°: ‚Ç©${totalCost.toLocaleString()}\nüé´ Ïø†Ìè∞ Î∞úÍ∏â Ïã†Ï≤≠ ÏôÑÎ£å\n\nÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Í≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨Îê©ÎãàÎã§.`);
      
      // Ìèº Ï¥àÍ∏∞Ìôî
      e.target.reset();
      document.getElementById('calc-qty').textContent = '0 Ïû•';
      document.getElementById('calc-total').textContent = '‚Ç©0';
    }
    
    // üí∞ Ïø†Ìè∞ ÎπÑÏö© ÏûêÎèô Í≥ÑÏÇ∞
    function calculateCouponCost() {
      const qty = parseInt(document.getElementById('store-coupon-qty').value) || 0;
      const total = qty * 50;
      
      document.getElementById('calc-qty').textContent = qty.toLocaleString() + ' Ïû•';
      document.getElementById('calc-total').textContent = '‚Ç©' + total.toLocaleString();
    }
    
    // ‚≠ê ÏµúÏ¢Ö ÏäπÏù∏ ÏöîÏ≤≠
    function requestFinalApproval() {
      if (!currentUser) {
        alert('‚ùå Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
        showPage('login');
        return;
      }
      
      if (!confirm('Î™®Îì† Ï§ÄÎπÑÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÍπå?\n\n‚úì Îß§Ïû• Ï†ïÎ≥¥\n‚úì Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ\n‚úì ÌôçÎ≥¥ ÏûêÎ£å\n\nÏµúÏ¢Ö Í¥ÄÎ¶¨ÏûêÏóêÍ≤å ÏäπÏù∏ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥ÏãúÍ≤†ÏäµÎãàÍπå?')) {
        return;
      }
      
      alert('‚úÖ ÏäπÏù∏ ÏöîÏ≤≠Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!\n\nÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ÎêòÎ©¥:\n‚Ä¢ Îß§Ïû• ÌéòÏù¥ÏßÄÍ∞Ä ÌôúÏÑ±ÌôîÎê©ÎãàÎã§\n‚Ä¢ Ïø†Ìè∞Ïù¥ Í≤åÏûÑÏóê Î∞∞Ìè¨Îê©ÎãàÎã§\n\nÍ≤ÄÌÜ†Îäî Î≥¥ÌÜµ 1-2Ïùº ÏÜåÏöîÎê©ÎãàÎã§.');
    }
    
    // üìã Îß§Ïû• Îì±Î°ù Ïãú Î°úÍ∑∏Ïù∏ Ï≤¥ÌÅ¨
    function registerBusiness(e) {
      e.preventDefault();
      
      if (!currentUser) {
        alert('‚ùå Îß§Ïû• Îì±Î°ùÏùÑ ÏúÑÌï¥ Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
        showPage('login');
        return;
      }
      
      const name = document.getElementById('business-name').value;
      const category = document.getElementById('business-category').value;
      const address = document.getElementById('business-address').value;
      
      // ÏÉà Îß§Ïû• Îì±Î°ù
      const newStore = {
        id: 'store-' + Date.now(),
        name: name,
        category: category,
        address: address,
        status: 'pending',
        owner: currentUser.name,
        created_at: new Date().toISOString()
      };
      
      alert(`‚úÖ Îß§Ïû• Îì±Î°ù Ïã†Ï≤≠ ÏôÑÎ£å!\n\nÎß§Ïû•Î™Ö: ${name}\nÏóÖÏ¢Ö: ${category}\n\nÏµúÏ¢Ö Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.\nÏäπÏù∏ ÌõÑ Ïø†Ìè∞ Î∞úÍ∏âÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.`);
      
      // Ïø†Ìè∞ Î∞úÍ∏â ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
      showBusinessTab('coupon-issue');
    }
    
    // ===== ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ Í¥ÄÎ¶¨ =====
    let promoPageCount = 3;
    const MAX_PROMO_PAGES = 20;
    
    function addPromoPage() {
      if (promoPageCount >= MAX_PROMO_PAGES) {
        alert('‚ùå ÏµúÎåÄ ' + MAX_PROMO_PAGES + 'ÌéòÏù¥ÏßÄÍπåÏßÄÎßå Îì±Î°ù Í∞ÄÎä•Ìï©ÎãàÎã§.');
        return;
      }
      
      const title = prompt('ÌéòÏù¥ÏßÄ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
      if (!title) return;
      
      promoPageCount++;
      alert('‚úÖ ÏÉà ÌôçÎ≥¥ ÌéòÏù¥ÏßÄÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!\n\nÏ†úÎ™©: ' + title + '\nÌòÑÏû¨: ' + promoPageCount + '/' + MAX_PROMO_PAGES + ' ÌéòÏù¥ÏßÄ');
    }
    
    function editPromoPage(pageNum) {
      alert('üìù ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ ' + pageNum + ' Ìé∏Ïßë Î™®Îìú\n\nÏù¥ÎØ∏ÏßÄ, ÎèôÏòÅÏÉÅ, Î¨∏ÏÑúÎ•º ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò ÌÖçÏä§Ìä∏Î•º ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.');
    }
    
    function deletePromoPage(pageNum) {
      if (confirm('ÌéòÏù¥ÏßÄ ' + pageNum + 'ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        promoPageCount--;
        alert('üóëÔ∏è ÌéòÏù¥ÏßÄÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      }
    }
    
    function uploadPromoFile(input, type) {
      const file = input.files[0];
      if (!file) return;
      
      const typeLabels = {
        'image': 'Ïù¥ÎØ∏ÏßÄ',
        'video': 'ÎèôÏòÅÏÉÅ',
        'document': 'Î¨∏ÏÑú',
        'audio': 'Ïò§ÎîîÏò§'
      };
      
      alert('‚úÖ ' + typeLabels[type] + ' ÏóÖÎ°úÎìú ÏôÑÎ£å!\n\nÌååÏùºÎ™Ö: ' + file.name + '\nÌÅ¨Í∏∞: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB');
    }
    
    // ===== Îß§Ïû• Ïù¥Îèô =====
    function goToStore(storeId) {
      const store = STORES[storeId];
      if (store) {
        alert('üè™ ' + store.name + ' Îß§Ïû•ÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
        showPage('store');
      }
    }
    
    // ===== ÎπÑÏ¶àÎãàÏä§ ÌÉ≠ (Ïø†Ìè∞ Î∞úÍ∏â, ÌôçÎ≥¥ Ìè¨Ìï®) =====
    function showBusinessTab(tab) {
      // Î™®Îì† ÌÉ≠ Ïà®Í∏∞Í∏∞
      document.getElementById('business-list-tab').style.display = 'none';
      document.getElementById('business-register-tab').style.display = 'none';
      document.getElementById('business-mystore-tab').style.display = 'none';
      
      const couponTab = document.getElementById('business-coupon-issue-tab');
      if (couponTab) couponTab.style.display = 'none';
      
      const promoTab = document.getElementById('business-promo-tab');
      if (promoTab) promoTab.style.display = 'none';
      
      // ÏÑ†ÌÉùÎêú ÌÉ≠ Î≥¥Ïù¥Í∏∞
      const targetTab = document.getElementById('business-' + tab + '-tab');
      if (targetTab) targetTab.style.display = 'block';
      
      // üîê Îß§Ïû• Îì±Î°ù ÌÉ≠ - Ï≤òÏùå ÌôòÏòÅ ÌôîÎ©¥ ÌëúÏãú
      if (tab === 'register') {
        showRegisterStep('welcome');
      }
      
      // üçΩÔ∏è ÎÇ¥ Îß§Ïû• ÌÉ≠ - Îß§Ïû• Î™©Î°ù Î°úÎìú
      if (tab === 'mystore') {
        loadMyStores();
      }
      
      // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
      document.querySelectorAll('[id^="btn-business-"]').forEach(btn => {
        btn.style.opacity = '0.6';
      });
      const activeBtn = document.getElementById('btn-business-' + tab);
      if (activeBtn) activeBtn.style.opacity = '1';
    }
    
    // ÎÇ¥ Îß§Ïû• Î™©Î°ù Î°úÎìú
    function loadMyStores() {
      const container = document.getElementById('my-stores-container');
      if (!container) return;
      
      // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò Îß§Ïû• (Mock Îç∞Ïù¥ÌÑ∞ + localStorage ÎåÄÍ∏∞ Îß§Ïû•)
      const pendingStores = JSON.parse(localStorage.getItem('pendingStores') || '[]');
      
      const myStores = [
        {
          id: 'store-001',
          name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
          emoji: 'üç±',
          category: 'ÌïúÏãù',
          status: 'approved',
          todayOrders: 12,
          todaySales: 285000
        },
        // ÎåÄÍ∏∞ Ï§ëÏù∏ Îß§Ïû• Ï∂îÍ∞Ä
        ...pendingStores.map(s => ({
          id: s.id,
          name: s.storeName,
          emoji: 'üè™',
          category: s.category,
          status: 'pending',
          todayOrders: 0,
          todaySales: 0
        }))
      ];
      
      if (myStores.length === 0) {
        container.innerHTML = `
          <div class="col-span-2 text-center py-12">
            <div class="text-6xl mb-4">üè™</div>
            <p class="text-gray-400 mb-4">Îì±Î°ùÎêú Îß§Ïû•Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
            <button onclick="showBusinessTab('register')" class="btn-primary">Îß§Ïû• ÏûÖÏ†êÌïòÍ∏∞ ‚Üí</button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = myStores.map(store => `
        <div class="card glow-border ${store.status === 'pending' ? 'opacity-70' : ''} cursor-pointer hover:scale-105 transition" onclick="selectMyStore('${store.id}', '${store.status}')">
          <div class="flex items-center gap-4 mb-4">
            <span class="text-5xl">${store.emoji}</span>
            <div>
              <h4 class="text-xl font-bold">${store.name}</h4>
              <p class="text-gray-400">${store.category}</p>
            </div>
          </div>
          ${store.status === 'approved' ? `
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-cyan-500/10 p-3 rounded-lg text-center">
                <p class="text-2xl font-bold text-cyan-400">${store.todayOrders}</p>
                <p class="text-xs text-gray-400">Ïò§Îäò Ï£ºÎ¨∏</p>
              </div>
              <div class="bg-green-500/10 p-3 rounded-lg text-center">
                <p class="text-lg font-bold text-green-400">‚Ç©${store.todaySales.toLocaleString()}</p>
                <p class="text-xs text-gray-400">Ïò§Îäò Îß§Ï∂ú</p>
              </div>
            </div>
          ` : `
            <!-- üîí ÏäπÏù∏ Ï†Ñ Lock ÏÉÅÌÉú -->
            <div class="bg-yellow-500/10 border border-yellow-500/30 p-4 rounded-lg text-center">
              <p class="text-yellow-400 font-bold">üîí ÏäπÏù∏ ÎåÄÍ∏∞Ï§ë</p>
              <p class="text-xs text-gray-400 mt-1">Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§</p>
            </div>
          `}
          <div class="mt-4 flex gap-2 flex-wrap">
            <span class="px-2 py-1 ${store.status === 'approved' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'} rounded text-sm">
              ${store.status === 'approved' ? '‚úÖ ÏäπÏù∏Îê®' : '‚è≥ ÎåÄÍ∏∞Ï§ë'}
            </span>
            ${store.status === 'pending' ? '<span class="px-2 py-1 bg-gray-700 text-gray-400 rounded text-sm">üîí Î≥¥Í∏∞Ï†ÑÏö©</span>' : ''}
          </div>
        </div>
      `).join('');
    }
    
    function selectMyStore(storeId, status) {
      // ÏäπÏù∏ Ï†Ñ Lock Ï≤¥ÌÅ¨
      if (status === 'pending') {
        alert('‚è≥ ÏäπÏù∏ ÎåÄÍ∏∞Ï§ëÏù∏ Îß§Ïû•ÏûÖÎãàÎã§.\n\nÍ¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÏôÑÎ£å ÌõÑ:\n‚Ä¢ Îß§Ïû• Íæ∏ÎØ∏Í∏∞\n‚Ä¢ Ïø†Ìè∞ Î∞úÍ∏â\n‚Ä¢ Ï£ºÎ¨∏ Í¥ÄÎ¶¨\n‚Ä¢ ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ\n\nÍ∏∞Îä•Ïù¥ ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.');
        return;
      }
      
      // ÏäπÏù∏Îêú Îß§Ïû• ÎåÄÏãúÎ≥¥Îìú ÌëúÏãú
      document.getElementById('my-store-dashboard').style.display = 'block';
      document.getElementById('selected-store-name').textContent = 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù';
      showMyStoreDashTab('orders');
    }
    
    function renderPendingCoupons() {
      const container = document.getElementById('admin-pending-list');
      if (!container) return;

      // ‚≠ê Îëê ÏÜåÏä§ Î≥ëÌï©: pendingCoupons (Í∏∞Ï°¥) + couponManagementData (ÏÉà Î∞úÍ∏â)
      var mgmtPending = (typeof window.couponManagementData !== 'undefined' && window.couponManagementData.coupons) ?
        window.couponManagementData.coupons.filter(function(c){return c.status === 'pending';}) : [];

      // Í∏∞Ï°¥ pendingCouponsÎ•º ÌÜµÏùº ÌòïÌÉúÎ°ú
      var allPending = pendingCoupons.map(function(c) {
        return {
          id: c.id, source: 'legacy', title: c.title, rarity: (c.rarity || 'common').toUpperCase(),
          discount_type: c.discount_type, discount_value: c.discount_value,
          total_quantity: c.total_quantity, issue_cost: c.issue_cost || 0,
          store_name: c.store_name || c.business_name || 'Îß§Ïû•',
          image: c.image_url || null, imageIsVideo: false,
          createdAt: c.applied_at || c.created_at || ''
        };
      });

      // couponManagementData pendingÏùÑ ÌÜµÏùº ÌòïÌÉúÎ°ú
      mgmtPending.forEach(function(c) {
        allPending.push({
          id: c.id, source: 'mgmt', title: c.name, rarity: (c.rarity || 'COMMON'),
          discount_type: c.discountType === 'percent' ? 'percentage' : 'fixed',
          discount_value: c.discountValue,
          total_quantity: c.quantity, issue_cost: c.paymentAmount || c.quantity * 100,
          store_name: c.name.split(' ')[0] || 'Îß§Ïû•',
          image: c.image || null, imageIsVideo: c.imageIsVideo || false,
          createdAt: c.createdAt || ''
        });
      });

      if (allPending.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">‚úÖ ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ëÏù∏ Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
        return;
      }

      container.innerHTML = allPending.map(function(coupon) {
        var rarityLower = (coupon.rarity || 'common').toLowerCase();
        var rarityUpper = (coupon.rarity || 'COMMON').toUpperCase();
        var discText = coupon.discount_type === 'percentage' ? coupon.discount_value + '%' : '‚Ç©' + (coupon.discount_value || 0).toLocaleString();

        // ‚≠ê Ïù¥ÎØ∏ÏßÄ/ÏòÅÏÉÅ ÎØ∏Î¶¨Î≥¥Í∏∞
        var previewHtml = '';
        if (coupon.image && coupon.imageIsVideo) {
          previewHtml = '<div class="relative w-24 h-24 rounded-lg bg-gray-700 flex-shrink-0 overflow-hidden border-2 border-yellow-500/50">' +
            '<video src="' + coupon.image + '" class="w-full h-full object-cover" autoplay muted loop></video>' +
            '<div class="absolute bottom-0 left-0 right-0 bg-black/70 text-center text-xs py-0.5 text-yellow-300">üé¨ ÏòÅÏÉÅ</div></div>';
        } else if (coupon.image) {
          previewHtml = '<div class="relative w-24 h-24 rounded-lg bg-gray-700 flex-shrink-0 overflow-hidden border-2 border-yellow-500/50">' +
            '<img src="' + coupon.image + '" class="w-full h-full object-cover" alt="' + coupon.title + '">' +
            '<div class="absolute bottom-0 left-0 right-0 bg-black/70 text-center text-xs py-0.5 text-yellow-300">üñºÔ∏è Ïù¥ÎØ∏ÏßÄ</div></div>';
        } else {
          previewHtml = '<div class="w-24 h-24 rounded-lg bg-gray-700 flex-shrink-0 flex items-center justify-center border-2 border-gray-600">' +
            '<span class="text-3xl">üé´</span></div>';
        }

        var approveFn = coupon.source === 'mgmt' ? 'approveManagedCoupon(' + coupon.id + ')' : "approveCoupon('" + coupon.id + "')";
        var rejectFn = coupon.source === 'mgmt' ? 'deleteManagedCoupon(' + coupon.id + ')' : "rejectCoupon('" + coupon.id + "')";

        return '<div class="bg-yellow-500/5 border border-yellow-500/30 rounded-xl p-4 mb-3 hover:border-yellow-500/60 transition">' +
          '<div class="flex items-start gap-4">' +
            previewHtml +
            '<div class="flex-1 min-w-0">' +
              '<div class="flex items-center gap-2 mb-1 flex-wrap">' +
                '<span class="rarity-badge ' + rarityLower + ' text-xs">' + rarityUpper + '</span>' +
                '<h4 class="text-lg font-bold">' + coupon.title + '</h4>' +
              '</div>' +
              '<p class="text-sm text-gray-400">Ìï†Ïù∏: <span class="text-yellow-300 font-bold">' + discText + '</span> | ÏàòÎüâ: ' + coupon.total_quantity + 'Í∞ú | ÎπÑÏö©: ‚Ç©' + (coupon.issue_cost || 0).toLocaleString() + '</p>' +
              '<p class="text-sm text-gray-500 mt-1">Îß§Ïû•: ' + coupon.store_name + (coupon.createdAt ? ' | Ïã†Ï≤≠: ' + new Date(coupon.createdAt).toLocaleString('ko-KR') : '') + '</p>' +
            '</div>' +
            '<div class="flex flex-col gap-2 flex-shrink-0">' +
              '<button onclick="' + approveFn + '" class="px-4 py-2 bg-green-500 hover:bg-green-400 rounded-lg text-white font-bold text-sm transition shadow-lg shadow-green-500/20">‚úÖ ÏµúÏ¢ÖÏäπÏù∏</button>' +
              '<button onclick="reviewCoupon(\'' + coupon.id + '\')" class="px-3 py-1.5 bg-yellow-500/30 hover:bg-yellow-500/50 rounded-lg text-yellow-300 font-bold text-sm transition">üîç Í≤ÄÌÜ†</button>' +
              '<button onclick="' + rejectFn + '" class="px-3 py-1.5 bg-red-500/30 hover:bg-red-500/50 rounded-lg text-red-300 font-bold text-sm transition">‚ùå Í±∞Î∂Ä</button>' +
            '</div>' +
          '</div>' +
        '</div>';
      }).join('');
    }
    
    function reviewCoupon(couponId) {
      alert('üîç Ïø†Ìè∞ÏùÑ Í≤ÄÌÜ†Ï§ë ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÌñàÏäµÎãàÎã§.');
    }
    
    function approveCoupon(couponId) {
      const coupon = pendingCoupons.find(c => c.id === couponId);
      if (!coupon) return;
      
      if (!confirm(`Ïø†Ìè∞ÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n${coupon.title}\nÏàòÎüâ: ${coupon.total_quantity}Í∞ú\nÎπÑÏö©: ‚Ç©${(coupon.issue_cost || 0).toLocaleString()}`)) {
        return;
      }
      
      // ÏäπÏù∏ Ï≤òÎ¶¨
      coupon.status = 'approved';
      coupon.approved_at = new Date().toISOString();
      
      approvedCoupons.push(coupon);
      pendingCoupons = pendingCoupons.filter(c => c.id !== couponId);
      
      // Í≤åÏûÑÏóê Î∞∞Ìè¨
      gameIssuedCoupons.push(coupon);
      
      // ‚úÖ ÏäπÏù∏ Í∏∞Î°ù Ï†ÄÏû•
      addApprovalRecord('coupon', coupon.title, 'approved', `Î∞úÍ∏âÏàòÎüâ: ${coupon.total_quantity}Ïû•`);
      
      alert('‚úÖ Ïø†Ìè∞Ïù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§!\nÍ≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨ÎêòÏóàÏäµÎãàÎã§.');
      
      // ÏïåÎ¶ºÏùå Ïû¨ÏÉù
      playNotificationSound();
      
      loadAdminPage();
      renderApprovalHistory();
    }
    
    function rejectCoupon(couponId) {
      const coupon = pendingCoupons.find(c => c.id === couponId);
      if (!coupon) return;

      const reason = prompt('Í±∞Î∂Ä ÏÇ¨Ïú†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:');
      if (!reason) return;

      // Í±∞Î∂Ä Ï≤òÎ¶¨
      coupon.status = 'rejected';
      coupon.rejected_at = new Date().toISOString();
      coupon.reject_reason = reason;

      pendingCoupons = pendingCoupons.filter(c => c.id !== couponId);

      // ‚ùå Í±∞Î∂Ä Í∏∞Î°ù Ï†ÄÏû•
      addApprovalRecord('coupon', coupon.title, 'rejected', reason);

      alert(`‚ùå Ïø†Ìè∞Ïù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§.\n\nÏÇ¨Ïú†: ${reason}`);

      loadAdminPage();
      renderApprovalHistory();
    }

    // ‚≠ê ÏäπÏù∏ ÏôÑÎ£å Ïø†Ìè∞ Î™©Î°ù (Ïã§ÏãúÍ∞Ñ Î∞∞Ìè¨/ÏßÄÍ∞ë/ÏÇ¨Ïö© ÌòÑÌô©)
    function renderAdminApprovedList() {
      var container = document.getElementById('admin-approved-list');
      if (!container) return;

      // Îëê ÏÜåÏä§ Î≥ëÌï©: approvedCoupons (Í∏∞Ï°¥) + couponManagementData active + gameIssuedCoupons approved
      var allApproved = [];

      // 1) Í∏∞Ï°¥ approvedCoupons
      approvedCoupons.forEach(function(c) {
        allApproved.push({
          id: c.id, title: c.title, rarity: (c.rarity || 'common').toUpperCase(),
          discount_value: c.discount_value, discount_type: c.discount_type,
          total_quantity: c.total_quantity, remaining: c.remaining || c.total_quantity,
          store_name: c.store_name || '', image: c.image_url || null
        });
      });

      // 2) gameIssuedCoupons approved (Ï§ëÎ≥µ Ï†úÍ±∞)
      gameIssuedCoupons.forEach(function(gc) {
        if (gc.status !== 'approved') return;
        if (allApproved.some(function(a){return a.id === gc.id;})) return;
        allApproved.push({
          id: gc.id, title: gc.title, rarity: (gc.rarity || 'common').toUpperCase(),
          discount_value: gc.discount_value, discount_type: gc.discount_type,
          total_quantity: gc.total_quantity, remaining: gc.remaining,
          store_name: gc.store_name || '', image: gc.image_url || null
        });
      });

      // 3) couponManagementData active
      var mgmtCoupons = (typeof window.couponManagementData !== 'undefined' && window.couponManagementData.coupons) ? window.couponManagementData.coupons : [];
      mgmtCoupons.forEach(function(c) {
        if (c.status !== 'active') return;
        var gId = 'new-coupon-' + c.id;
        if (allApproved.some(function(a){return a.id === gId || a.title === c.name;})) return;
        allApproved.push({
          id: gId, title: c.name, rarity: (c.rarity || 'COMMON'),
          discount_value: c.discountValue, discount_type: c.discountType === 'percent' ? 'percentage' : 'fixed',
          total_quantity: c.quantity, remaining: c.quantity - c.used,
          store_name: c.name.split(' ')[0], image: c.image || null
        });
      });

      if (allApproved.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">ÏäπÏù∏Îêú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.</p>';
        return;
      }

      var walletAll = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');

      container.innerHTML = allApproved.map(function(c) {
        var rarityLower = (c.rarity || 'common').toLowerCase();
        var rarityUpper = (c.rarity || 'COMMON').toUpperCase();
        var discText = c.discount_type === 'percentage' ? c.discount_value + '%' : '‚Ç©' + (c.discount_value || 0).toLocaleString();
        var deployed = c.total_quantity - (c.remaining || 0);
        var inWallet = walletAll.filter(function(w){return w.title === c.title || (w.store_name && c.title.indexOf(w.store_name) >= 0);}).length;

        // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
        var imgHtml = c.image ?
          '<img src="' + c.image + '" class="w-14 h-14 rounded-lg object-cover border border-green-500/30">' :
          '<div class="w-14 h-14 rounded-lg bg-gray-700 flex items-center justify-center"><span class="text-xl">üé´</span></div>';

        return '<div class="bg-green-500/5 border border-green-500/20 rounded-xl p-3 mb-3 hover:border-green-500/50 transition">' +
          '<div class="flex items-center gap-3">' +
            imgHtml +
            '<div class="flex-1 min-w-0">' +
              '<div class="flex items-center gap-2 mb-1">' +
                '<span class="rarity-badge ' + rarityLower + ' text-xs">' + rarityUpper + '</span>' +
                '<h4 class="font-bold truncate">' + c.title + '</h4>' +
                '<span class="text-green-400 text-sm ml-auto flex-shrink-0">‚úÖ ÏäπÏù∏</span>' +
              '</div>' +
              '<div class="flex items-center gap-3 text-xs flex-wrap">' +
                '<span class="px-2 py-1 rounded-full bg-blue-500/20 text-blue-300">üéÆ Î∞∞Ìè¨ ' + deployed + '/' + c.total_quantity + '</span>' +
                '<span class="px-2 py-1 rounded-full bg-green-500/20 text-green-300">üëõ ÏßÄÍ∞ë ' + inWallet + '</span>' +
                '<span class="px-2 py-1 rounded-full bg-purple-500/20 text-purple-300">üì¶ ÏûîÏó¨ ' + (c.remaining || 0) + '</span>' +
                '<span class="px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-300">üí∞ ' + discText + ' Ìï†Ïù∏</span>' +
              '</div>' +
            '</div>' +
          '</div>' +
        '</div>';
      }).join('');
    }

    // ============================================
    // Í∏∞Ï°¥ Ìï®ÏàòÎì§
    // ============================================
    function showPage(pageName) {
      try {
        // ÏÇ¨ÏóÖÏûê ÌéòÏù¥ÏßÄÎäî Î°úÍ∑∏Ïù∏ ÌïÑÏàò
        if (pageName === 'business' && !currentUser) {
          alert('‚ö†Ô∏è ÏÇ¨ÏóÖÏûê ÌéòÏù¥ÏßÄÎäî Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.\n\nÎ°úÍ∑∏Ïù∏ ÌõÑ:\n1. Îß§Ïû• Îì±Î°ù\n2. Ïø†Ìè∞ Î∞úÍ∏â (Ïû•Îãπ ‚Ç©50)\n3. Í≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨\n4. Í≥†Í∞ù ÌöçÎìù Î∞è Îß§Ï∂ú Ï¶ùÎåÄ!');
          pageName = 'login';
        }
        
        // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÎäî Í¥ÄÎ¶¨ÏûêÎßå
        if (pageName === 'admin' && !currentUser) {
          alert('üîê Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
          pageName = 'login';
        }
        
        // Î™®Îì† ÌéòÏù¥ÏßÄ Ïà®Í∏∞Í∏∞
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        
        // ÏÑ†ÌÉùÎêú ÌéòÏù¥ÏßÄ ÌëúÏãú
        const targetPage = document.getElementById(`${pageName}-page`);
        if (targetPage) {
          targetPage.classList.add('active');
        } else {
          console.error('ÌéòÏù¥ÏßÄÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', pageName);
          document.getElementById('home-page').classList.add('active');
          return;
        }
        
        // ÌéòÏù¥ÏßÄÎ≥Ñ Î°úÎìú Ìï®Ïàò Ïã§Ìñâ
        if (pageName === 'wallet') {
          loadWalletCoupons();
        } else if (pageName === 'business') {
          loadBusinessStats();
        } else if (pageName === 'store') {
          loadStoreMenu();
        } else if (pageName === 'store-builder') {
          renderMenuEditor();
          updateStorePreview();
        } else if (pageName === 'market') {
          loadMarketPage();
        } else if (pageName === 'admin') {
          loadAdminPage();
        }

        // Ïä§ÌÅ¨Î°§ Îß® ÏúÑÎ°ú
        window.scrollTo(0, 0);
      } catch (error) {
        console.error('showPage Ïò§Î•ò:', error);
        alert('ÌéòÏù¥ÏßÄ Ï†ÑÌôò Ïò§Î•ò: ' + error.message);
      }
    }

    // ============================================
    // ‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞ (Cloud Market) ‚Äî ÏàúÌôòÍµ¨Ï°∞ ÌïµÏã¨ ÌóàÎ∏å
    // ============================================

    // Íµ¨Î¶ÑÏû•ÌÑ∞ Îß§Ïû• Îç∞Ïù¥ÌÑ∞ (Í∏∞Ï°¥ STORES + Ï∂îÍ∞Ä Îß§Ïû•)
    const MARKET_STORES = [
      {
        id: 'ami-hansik',
        name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
        emoji: 'üç±',
        category: 'ÌïúÏãù',
        description: 'Ï†ïÏÑ±ÏùÑ Îã¥ÏïÑ ÎßåÎìúÎäî Í±¥Í∞ïÌïú ÌïúÏ†ïÏãù',
        rating: 4.8,
        reviewCount: 127,
        distance: '350m',
        openTime: '11:00 - 21:00',
        isOpen: true,
        tags: ['ÌïúÏãù', 'Ï†ïÏãù', 'Í±¥Í∞ïÏãù'],
        popularMenu: 'ÌäπÏÑ† ÌïúÏ†ïÏãù ‚Ç©15,000',
        couponCount: 0,  // ÎèôÏ†ÅÏúºÎ°ú Í≥ÑÏÇ∞
        image: null,
        page: 'store',    // ÌÅ¥Î¶≠ Ïãú Ïù¥ÎèôÌï† ÌéòÏù¥ÏßÄ
        externalUrl: 'https://smartstore.naver.com/ami_hansik'
      },
      {
        id: 'ami-dabang',
        name: 'ÏïÑÎØ∏ Îã§Î∞©',
        emoji: '‚òï',
        category: 'Ïπ¥Ìéò',
        description: 'Î†àÌä∏Î°ú Í∞êÏÑ± Ïπ¥Ìéò, ÏàòÏ†ú ÏùåÎ£å Ï†ÑÎ¨∏',
        rating: 4.6,
        reviewCount: 89,
        distance: '200m',
        openTime: '09:00 - 22:00',
        isOpen: true,
        tags: ['Ïπ¥Ìéò', 'ÏàòÏ†úÏùåÎ£å', 'ÎîîÏ†ÄÌä∏'],
        popularMenu: 'ÏïÑÎØ∏ Î∏îÎ†åÎìú ‚Ç©5,500',
        couponCount: 0,
        image: null,
        page: 'store',
        externalUrl: 'https://smartstore.naver.com/ami_dabang'
      },
      {
        id: 'golden-chicken',
        name: 'Ìô©Í∏àÏò¨Î¶¨Î∏å ÏπòÌÇ®',
        emoji: 'üçó',
        category: 'ÏπòÌÇ®',
        description: 'Î∞îÏÇ≠Ìïú Ïò¨Î¶¨Î∏åÏú† ÏπòÌÇ®Ïùò Ï†ïÏÑù',
        rating: 4.7,
        reviewCount: 256,
        distance: '500m',
        openTime: '15:00 - 01:00',
        isOpen: true,
        tags: ['ÏπòÌÇ®', 'Î∞∞Îã¨', 'ÏïºÏãù'],
        popularMenu: 'Ïò¨Î¶¨Î∏å ÏàúÏÇ¥ ‚Ç©18,000',
        couponCount: 0,
        image: null,
        page: 'store',
        externalUrl: 'https://www.bbq.co.kr'
      },
      {
        id: 'hyunsil-restaurant',
        name: 'ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë',
        emoji: 'üçù',
        category: 'ÏñëÏãù',
        description: 'ÌòÑÏã§Ï†ÅÏù∏ Í∞ÄÍ≤©Ïùò Ï†ïÌÜµ Ïù¥ÌÉàÎ¶¨Ïïà',
        rating: 4.5,
        reviewCount: 73,
        distance: '800m',
        openTime: '11:30 - 21:30',
        isOpen: true,
        tags: ['ÏñëÏãù', 'ÌååÏä§ÌÉÄ', 'Ïä§ÌÖåÏù¥ÌÅ¨'],
        popularMenu: 'Ìä∏Îü¨Ìîå ÌååÏä§ÌÉÄ ‚Ç©16,000',
        couponCount: 0,
        image: null,
        page: 'store',
        externalUrl: 'https://www.hyunsil.kr'
      },
      {
        id: 'rounz-glasses',
        name: 'ROUNZ ÏïàÍ≤ΩÏ†ê',
        emoji: 'üëì',
        category: 'Ìå®ÏÖò',
        description: 'AR Í∞ÄÏÉÅ ÌîºÌåÖÏúºÎ°ú ÏïàÍ≤Ω Ï∞æÍ∏∞',
        rating: 4.9,
        reviewCount: 45,
        distance: '1.2km',
        openTime: '10:00 - 20:00',
        isOpen: true,
        tags: ['Ìå®ÏÖò', 'AR', 'ÏïàÍ≤Ω'],
        popularMenu: 'AR Í∞ÄÏÉÅÌîºÌåÖ Î¨¥Î£å',
        couponCount: 0,
        image: null,
        page: null,  // Ïô∏Î∂Ä ÎßÅÌÅ¨
        externalUrl: 'https://rfrounz.com'
      }
    ];

    let marketCurrentCategory = 'all';

    async function loadMarketPage() {
      // Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© ÌëúÏãú
      if (typeof showSkeleton === 'function') showSkeleton('market-store-grid', 3, 'store');

      // SupabaseÏóêÏÑú Ïã§ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ
      await loadMarketFromSupabase();
      // 1. Î≥¥Ïú† Ïø†Ìè∞ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
      updateMarketCouponSummary();
      // 2. Ïù∏Í∏∞ Ïø†Ìè∞ Î†åÎçîÎßÅ
      renderHotCoupons();
      // 3. Îß§Ïû• Í∑∏Î¶¨Îìú Î†åÎçîÎßÅ (Ïä§ÏºàÎ†àÌÜ§ ÍµêÏ≤¥)
      renderMarketStores();

      // Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
      if (typeof updateTabBadges === 'function') updateTabBadges();
    }

    // SupabaseÏóêÏÑú Îß§Ïû•+Ïø†Ìè∞ Ïã§ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    async function loadMarketFromSupabase() {
      try {
        // Îß§Ïû• Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        const dbStores = await sbFetch('stores', 'is_active=eq.true&select=id,name,description,category,address,phone,opening_hours,ar_url,homepage_url,order_url,merchant_id,merchants(name,type,homepage_url)');
        if (dbStores && dbStores.length > 0) {
          console.log(`‚úÖ Supabase Îß§Ïû• ${dbStores.length}Í∞ú Î°úÎìú ÏôÑÎ£å`);
          // DB Îß§Ïû•ÏùÑ MARKET_STORESÏóê Î≥ëÌï©
          const categoryEmoji = { restaurant: 'üç±', cafe: '‚òï', retail: 'üõçÔ∏è', culture: 'üé≠', service: 'üíº', other: 'üè™' };
          const categoryKo = { restaurant: 'ÌïúÏãù', cafe: 'Ïπ¥Ìéò', retail: 'ÏáºÌïë', culture: 'Î¨∏Ìôî', service: 'ÏÑúÎπÑÏä§', other: 'Í∏∞ÌÉÄ' };

          dbStores.forEach(ds => {
            const existing = MARKET_STORES.find(ms => ms.name.includes(ds.name.split(' ')[0]));
            if (existing) {
              existing.dbId = ds.id;
              existing.description = ds.description || existing.description;
              existing.address = ds.address || '';
              existing.phone = ds.phone || '';
              existing.website_url = ds.homepage_url || ds.order_url || ds.merchants?.homepage_url || existing.website_url || null;
              existing.tags = [...new Set([...existing.tags, categoryKo[ds.category] || ds.category])];
            } else {
              // ÏÉà Îß§Ïû• Ï∂îÍ∞Ä
              MARKET_STORES.push({
                id: ds.id,
                dbId: ds.id,
                name: ds.name,
                emoji: categoryEmoji[ds.category] || 'üè™',
                category: categoryKo[ds.category] || ds.category,
                description: ds.description || '',
                rating: 4.5,
                reviewCount: Math.floor(Math.random() * 100) + 10,
                distance: (Math.random() * 2).toFixed(1) + 'km',
                openTime: '10:00 - 22:00',
                isOpen: true,
                tags: [categoryKo[ds.category] || ds.category],
                popularMenu: '',
                couponCount: 0,
                image: null,
                page: 'store',
                externalUrl: ds.ar_url || null,
                website_url: ds.homepage_url || ds.order_url || ds.merchants?.homepage_url || null
              });
            }
          });
        }

        // Ïø†Ìè∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (ÏäπÏù∏Îêú Í≤ÉÎßå)
        const dbCoupons = await sbFetch('coupons', 'is_active=eq.true&approval_status=eq.APPROVED&select=id,title,description,discount_type,discount_value,total_issuable,unit_price,asset_url,store_id,stores(name,homepage_url,order_url),merchant_id,merchants(name,homepage_url)');
        if (dbCoupons && dbCoupons.length > 0) {
          console.log(`‚úÖ Supabase Ïø†Ìè∞ ${dbCoupons.length}Í∞ú Î°úÎìú ÏôÑÎ£å`);

          // Í∏∞Ï°¥ gameIssuedCouponsÏóê DB Ïø†Ìè∞ Î≥ëÌï© (Ï§ëÎ≥µ Î∞©ÏßÄ)
          const rarityByDiscount = (v) => {
            if (v >= 100) return 'mythic';
            if (v >= 80) return 'legendary';
            if (v >= 50) return 'epic';
            if (v >= 20) return 'rare';
            return 'common';
          };

          dbCoupons.forEach(dc => {
            const existingIdx = gameIssuedCoupons.findIndex(g =>
              g.title === dc.title || g.dbId === dc.id
            );
            const couponObj = {
              id: dc.id,
              dbId: dc.id,
              store_id: dc.store_id,
              store_name: dc.stores?.name || dc.merchants?.name || '',
              business_name: dc.merchants?.name || '',
              title: dc.title,
              description: dc.description,
              discount_type: dc.discount_type === 'percent' ? 'percentage' : 'amount',
              discount_value: Number(dc.discount_value),
              rarity: dc.discount_type === 'percent' ? rarityByDiscount(Number(dc.discount_value)) : (Number(dc.discount_value) >= 5000 ? 'epic' : 'rare'),
              total_quantity: dc.total_issuable || 999,
              remaining: dc.total_issuable || 999,
              status: 'approved',
              expiry: '2026-12-31',
              unit_price: Number(dc.unit_price) || 100,
              image_url: dc.asset_url || null,
              website_url: dc.stores?.homepage_url || dc.stores?.order_url || dc.merchants?.homepage_url || null,
              source: 'supabase'
            };
            if (existingIdx >= 0) {
              gameIssuedCoupons[existingIdx] = { ...gameIssuedCoupons[existingIdx], ...couponObj };
            } else {
              gameIssuedCoupons.push(couponObj);
            }
          });

          // DB Ïó∞Îèô Î∞∞ÏßÄ ÌëúÏãú
          const badge = document.getElementById('market-db-badge');
          if (!badge) {
            const header = document.querySelector('#market-page .text-center.mb-10');
            if (header) {
              const b = document.createElement('div');
              b.id = 'market-db-badge';
              b.className = 'inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold mt-2';
              b.style.cssText = 'background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);';
              b.innerHTML = `üü¢ Ïã§ÏãúÍ∞Ñ DB Ïó∞Îèô ¬∑ Îß§Ïû• ${dbStores?.length || 0}Í∞ú ¬∑ Ïø†Ìè∞ ${dbCoupons.length}Í∞ú`;
              header.appendChild(b);
            }
          }
        }
      } catch (err) {
        console.warn('‚ö†Ô∏è Supabase Î°úÎìú Ïã§Ìå®, Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', err.message);
      }
    }

    function updateMarketCouponSummary() {
      const coupons = JSON.parse(localStorage.getItem('allCoupons') || '[]');
      const available = coupons.filter(c => !c.is_used);

      // Ïø†Ìè∞ Ïàò
      const countEl = document.getElementById('market-coupon-count');
      if (countEl) countEl.textContent = available.length;

      // Ïø†Ìè∞ ÎØ∏Îãà Ïä¨ÎùºÏù¥Îçî
      const slider = document.getElementById('market-coupon-slider');
      if (!slider) return;

      if (available.length === 0) {
        slider.innerHTML = `
          <div class="flex items-center gap-3 p-4 rounded-xl bg-gray-800/50 border border-dashed border-gray-600 min-w-[280px]">
            <span class="text-3xl">üéÆ</span>
            <div>
              <p class="font-bold text-sm">ÏïÑÏßÅ Ïø†Ìè∞Ïù¥ ÏóÜÏñ¥Ïöî!</p>
              <p class="text-xs text-gray-400">AR Í≤åÏûÑÏóêÏÑú Ïø†Ìè∞ÏùÑ ÌöçÎìùÌï¥Î≥¥ÏÑ∏Ïöî</p>
              <button onclick="startGame()" class="mt-1 text-xs text-cyan-400 hover:text-cyan-300 font-bold">Í≤åÏûÑ ÏãúÏûë ‚Üí</button>
            </div>
          </div>`;
        return;
      }

      slider.innerHTML = available.slice(0, 8).map(c => `
        <div class="flex-shrink-0 p-3 rounded-xl border ${getRarityBorderClass(c.rarity)} min-w-[180px] cursor-pointer hover:scale-105 transition"
             style="background:rgba(0,0,0,0.3);" onclick="showCouponFromMarket('${c.id}')">
          <div class="flex items-center gap-2 mb-1">
            <span class="rarity-badge ${c.rarity || 'common'}" style="font-size:0.6rem;padding:0.15rem 0.5rem;">${(c.rarity || 'common').toUpperCase()}</span>
          </div>
          <p class="font-bold text-sm truncate">${c.title || c.name || 'Ïø†Ìè∞'}</p>
          <p class="text-xs text-cyan-400 mt-1">${formatCouponDiscount(c)}</p>
        </div>
      `).join('') + (available.length > 8 ? `
        <div class="flex-shrink-0 flex items-center justify-center p-3 rounded-xl border border-gray-600 min-w-[100px] cursor-pointer hover:bg-gray-800"
             onclick="showPage('wallet')">
          <p class="text-sm text-gray-400">+${available.length - 8}Í∞ú Îçî ‚Üí</p>
        </div>` : '');

      // Í∞Å Îß§Ïû•Î≥Ñ Ïø†Ìè∞ Ïàò Í≥ÑÏÇ∞
      MARKET_STORES.forEach(store => {
        store.couponCount = available.filter(c =>
          (c.store_name && c.store_name.includes(store.name)) ||
          (c.business_name && c.business_name.includes(store.name))
        ).length;
      });
    }

    function getRarityBorderClass(rarity) {
      const map = { common: 'border-gray-500', rare: 'border-blue-400', epic: 'border-purple-400', legendary: 'border-yellow-400', mythic: 'border-red-500' };
      return map[rarity] || 'border-gray-500';
    }

    function formatCouponDiscount(c) {
      if (c.discount_type === 'percentage') return `${c.discount_value}% Ìï†Ïù∏`;
      if (c.discount_value) return `‚Ç©${Number(c.discount_value).toLocaleString()} Ìï†Ïù∏`;
      return 'ÌäπÎ≥Ñ ÌòúÌÉù';
    }

    function showCouponFromMarket(couponId) {
      const coupons = JSON.parse(localStorage.getItem('allCoupons') || '[]');
      const coupon = coupons.find(c => c.id === couponId);
      if (coupon) {
        showCouponDetail(coupon);
      }
    }

    function renderHotCoupons() {
      const container = document.getElementById('market-hot-coupons');
      if (!container) return;

      // Í≤åÏûÑÏóêÏÑú ÏäπÏù∏Îêú Ïø†Ìè∞ = Ïù∏Í∏∞ Ïø†Ìè∞
      const hotCoupons = (typeof gameIssuedCoupons !== 'undefined' ? gameIssuedCoupons : [])
        .filter(c => c.status === 'approved')
        .slice(0, 4);

      if (hotCoupons.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-6 text-gray-500">
            <p class="text-2xl mb-2">üì¶</p>
            <p class="text-sm">ÏïÑÏßÅ Îì±Î°ùÎêú Ïù∏Í∏∞ Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§</p>
          </div>`;
        return;
      }

      container.innerHTML = hotCoupons.map(c => `
        <div class="p-4 rounded-xl border ${getRarityBorderClass(c.rarity)} cursor-pointer hover:scale-105 transition"
             style="background:rgba(0,0,0,0.4);" onclick="marketUseCoupon('${c.id}')">
          <div class="flex items-center justify-between mb-2">
            <span class="rarity-badge ${c.rarity}" style="font-size:0.6rem;padding:0.15rem 0.5rem;">${(c.rarity).toUpperCase()}</span>
            <span class="text-xs text-gray-400">${c.store_name || c.business_name || ''}</span>
          </div>
          <p class="font-bold text-sm mb-1 truncate">${c.title}</p>
          <p class="text-cyan-400 text-sm font-bold">
            ${c.discount_type === 'percentage' ? c.discount_value + '% OFF' : '‚Ç©' + Number(c.discount_value).toLocaleString() + ' Ìï†Ïù∏'}
          </p>
          <p class="text-xs text-gray-500 mt-1">ÎÇ®ÏùÄ ÏàòÎüâ: ${c.total_quantity || '‚àû'}Í∞ú</p>
        </div>
      `).join('');
    }

    function marketUseCoupon(couponId) {
      const coupon = gameIssuedCoupons.find(c => c.id === couponId);
      if (!coupon) return;

      const storeName = coupon.store_name || coupon.business_name || 'Îß§Ïû•';
      if (confirm(`"${coupon.title}" Ïø†Ìè∞ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨\n${storeName}ÏóêÏÑú Ï£ºÎ¨∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
        showPage('store');
      }
    }

    function renderMarketStores() {
      const container = document.getElementById('market-store-grid');
      const countEl = document.getElementById('market-store-count');
      if (!container) return;

      let stores = [...MARKET_STORES];

      // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞
      if (marketCurrentCategory !== 'all') {
        stores = stores.filter(s => s.category === marketCurrentCategory || s.tags.includes(marketCurrentCategory));
      }

      // Í≤ÄÏÉâ ÌïÑÌÑ∞
      const search = (document.getElementById('market-search')?.value || '').toLowerCase();
      if (search) {
        stores = stores.filter(s =>
          s.name.toLowerCase().includes(search) ||
          s.category.includes(search) ||
          s.description.includes(search) ||
          s.tags.some(t => t.includes(search))
        );
      }

      // Ï†ïÎ†¨
      const sort = document.getElementById('market-sort')?.value || 'recommend';
      if (sort === 'rating') stores.sort((a, b) => b.rating - a.rating);
      else if (sort === 'distance') stores.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));

      if (countEl) countEl.textContent = `${stores.length}Í∞ú Îß§Ïû•`;

      if (stores.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <p class="text-4xl mb-3">üîç</p>
            <p class="text-gray-400">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</p>
          </div>`;
        return;
      }

      container.innerHTML = stores.map(store => `
        <div class="card glow-border cursor-pointer hover:scale-[1.02] transition-all duration-300"
             onclick="${store.externalUrl ? `window.open('${store.externalUrl}','_blank')` : `goToStoreFromMarket('${store.id}')`}">

          <!-- Îß§Ïû• Ìó§Îçî -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <span class="text-4xl">${store.emoji}</span>
              <div>
                <h4 class="text-lg font-bold">${store.name}</h4>
                <div class="flex items-center gap-2 mt-1">
                  <span class="text-yellow-400 text-sm">‚≠ê ${store.rating}</span>
                  <span class="text-gray-500 text-xs">(${store.reviewCount})</span>
                  <span class="text-gray-600 text-xs">¬∑</span>
                  <span class="text-gray-400 text-xs">üìç ${store.distance}</span>
                </div>
              </div>
            </div>
            <span class="px-2 py-1 rounded-full text-xs font-bold ${store.isOpen ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
              ${store.isOpen ? 'ÏòÅÏóÖÏ§ë' : 'Ï§ÄÎπÑÏ§ë'}
            </span>
          </div>

          <!-- ÏÑ§Î™Ö -->
          <p class="text-sm text-gray-400 mb-3">${store.description}</p>

          <!-- Ïù∏Í∏∞ Î©îÎâ¥ -->
          <div class="flex items-center gap-2 mb-3 p-2 rounded-lg bg-gray-800/50">
            <span class="text-xs text-gray-500">Ïù∏Í∏∞</span>
            <span class="text-sm font-bold text-cyan-300">${store.popularMenu}</span>
          </div>

          <!-- ÌÉúÍ∑∏ -->
          <div class="flex gap-1 flex-wrap mb-3">
            ${store.tags.map(t => `<span class="px-2 py-0.5 bg-gray-800 rounded text-xs text-gray-400">#${t}</span>`).join('')}
          </div>

          <!-- ÌïòÎã®: Ïø†Ìè∞ Ïàò + ÏãúÍ∞Ñ -->
          <div class="flex items-center justify-between pt-3 border-t border-gray-700/50">
            <div class="flex items-center gap-1">
              ${store.couponCount > 0
                ? `<span class="text-sm text-purple-400 font-bold">üéüÔ∏è ÏÇ¨Ïö©Í∞ÄÎä• Ïø†Ìè∞ ${store.couponCount}Ïû•</span>`
                : `<span class="text-xs text-gray-500">üïê ${store.openTime}</span>`}
            </div>
            <span class="text-cyan-400 text-sm font-bold">${store.externalUrl ? 'AR Ï≤¥Ìóò ‚Üí' : 'Ï£ºÎ¨∏ÌïòÍ∏∞ ‚Üí'}</span>
          </div>
        </div>
      `).join('');
    }

    function goToStoreFromMarket(storeId) {
      // Îß§Ïû•Ïùò externalUrlÏù¥ ÏûàÏúºÎ©¥ Ïô∏Î∂Ä ÏÇ¨Ïù¥Ìä∏Î°ú
      const store = MARKET_STORES.find(s => s.id === storeId);
      if (store && store.externalUrl) {
        if (typeof showToast === 'function') showToast(`${store.emoji} ${store.name} ÏÇ¨Ïù¥Ìä∏Î°ú Ïù¥Îèô!`, 'coupon');
        window.open(store.externalUrl, '_blank');
        return;
      }
      // ÏóÜÏúºÎ©¥ ÎÇ¥Î∂Ä Îß§Ïû• ÌéòÏù¥ÏßÄÎ°ú
      showPage('store');
    }

    function filterMarketCategory(category) {
      marketCurrentCategory = category;

      // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
      document.querySelectorAll('.market-cat-btn').forEach(btn => {
        btn.classList.remove('active');
        if (category === 'all') {
          btn.style.background = '';
        } else {
          btn.style.background = '';
        }
      });

      // ÌÅ¥Î¶≠Îêú Î≤ÑÌäº ÌôúÏÑ±Ìôî
      event.target.classList.add('active');
      event.target.style.background = 'linear-gradient(135deg,#22d3ee,#a855f7)';

      renderMarketStores();
    }

    function filterMarket() {
      renderMarketStores();
    }

    // ============================================
    // Î°úÍ∑∏Ïù∏
    // ============================================
    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      currentUser = { email: email, name: 'ÌÖåÏä§Ìä∏ ÏÇ¨Ïö©Ïûê' };
      authToken = 'mock-token';
      localStorage.setItem('token', authToken);
      
      updateUserUI();
      alert('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!');
      showPage('home');
    }
    
    function updateUserUI() {
      const navUser = document.getElementById('nav-user');
      
      if (currentUser) {
        navUser.innerHTML = `
          <div class="user-info">
            <div class="user-avatar">${currentUser.picture ? `<img src="${currentUser.picture}" style="width:32px;height:32px;border-radius:50%;">` : 'üë§'}</div>
            <span>${currentUser.name}</span>
            <button onclick="event.preventDefault(); logout()" class="text-red-400 hover:text-red-300">Î°úÍ∑∏ÏïÑÏõÉ</button>
          </div>
        `;
      } else {
        navUser.innerHTML = '<a href="#" onclick="event.preventDefault(); showPage(\'login\')">üë§ Î°úÍ∑∏Ïù∏</a>';
      }
    }
    
    function logout() {
      currentUser = null;
      authToken = null;
      localStorage.removeItem('token');
      updateUserUI();
      alert('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.');
      showPage('home');
    }
    
    // Ïø†Ìè∞ ÏßÄÍ∞ë
    async function loadWalletCoupons() {
      if (!authToken) {
        if (typeof showEmptyState === 'function') {
          showEmptyState('coupon-list', {
            emoji: 'üîí', title: 'Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï¥Ïöî',
            desc: 'Î°úÍ∑∏Ïù∏ÌïòÎ©¥ Ïø†Ìè∞ ÏßÄÍ∞ëÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏñ¥Ïöî!',
            btnText: 'Î°úÍ∑∏Ïù∏ÌïòÍ∏∞', btnAction: "showPage('login')"
          });
        } else {
          document.getElementById('coupon-list').innerHTML = '<p class="text-center text-gray-400">Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>';
        }
        return;
      }

      // Ïä§ÏºàÎ†àÌÜ§ Î°úÎî©
      if (typeof showSkeleton === 'function') showSkeleton('coupon-list', 3, 'coupon');
      setTimeout(() => { renderMockCoupons(); }, 500);
    }
    
    function renderMockCoupons() {
      // CTT Ïä§ÌÇ§Îßà Í∏∞Î∞ò Mock Ïø†Ìè∞ Îç∞Ïù¥ÌÑ∞
      const mockCoupons = [
        {
          id: 'coupon-001',
          store_id: 'store-001',
          coupon_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 20% Ìï†Ïù∏',
          title: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 20% Ìï†Ïù∏',
          coupon_code: 'AMI_20_PERCENT',
          discount_type: 'percentage',
          discount_value: 20,
          min_purchase_amount: 10000,
          rarity: 'rare',
          business_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
          store_emoji: 'üçö',
          is_used: false,
          is_active: true,
          website_url: 'https://smartstore.naver.com/ami_hansik',
          valid_till: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: 'coupon-002',
          store_id: 'store-001',
          coupon_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 5000Ïõê Ìï†Ïù∏',
          title: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 5000Ïõê Ìï†Ïù∏',
          coupon_code: 'AMI_5000_WON',
          discount_type: 'fixed',
          discount_value: 5000,
          min_purchase_amount: 20000,
          rarity: 'epic',
          business_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
          store_emoji: 'üçö',
          is_used: false,
          is_active: true,
          website_url: 'https://smartstore.naver.com/ami_hansik',
          valid_till: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: 'coupon-003',
          store_id: null,
          coupon_name: 'Í≤åÏûÑ Î≥¥ÏÉÅ Ïø†Ìè∞',
          title: 'Í≤åÏûÑ Î≥¥ÏÉÅ Ïø†Ìè∞',
          coupon_code: 'GAME_REWARD_001',
          discount_type: 'fixed',
          discount_value: 10000,
          min_purchase_amount: 0,
          rarity: 'legendary',
          business_name: 'Í≤åÏûÑ Î≥¥ÏÉÅ',
          store_emoji: 'üéÆ',
          is_used: false,
          is_active: true,
          website_url: null,
          valid_till: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
        }
      ];
      
      // ‚≠ê Í≤åÏûÑÏóêÏÑú ÌöçÎìùÌïú Ïø†Ìè∞ Î∂àÎü¨Ïò§Í∏∞ (ÌÜµÏùºÎêú ÌÇ§: allCoupons)
      const savedCoupons = JSON.parse(localStorage.getItem('allCoupons') || '[]');
      
      // Í∏∞Ï°¥ airctt_couponsÎèÑ Ìò∏ÌôòÏÑ± ÏúÑÌï¥ ÌôïÏù∏
      const legacyCoupons = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
      const convertedLegacy = legacyCoupons.map((gc, idx) => ({
        id: gc.id || ('legacy-coupon-' + idx),
        store_id: gc.store_id || 'store-001',
        coupon_name: gc.name || 'Í≤åÏûÑ Î≥¥ÏÉÅ Ïø†Ìè∞',
        title: gc.name || 'Í≤åÏûÑ Î≥¥ÏÉÅ Ïø†Ìè∞',
        coupon_code: 'GAME_' + (gc.id || idx),
        discount_type: gc.discount_type || 'percentage',
        discount_value: gc.discount_value || parseInt(gc.discount) || 10,
        min_purchase_amount: 0,
        rarity: gc.rarity || 'rare',
        business_name: gc.store || gc.store_name || 'Í≤åÏûÑ Î≥¥ÏÉÅ',
        store_name: gc.store || gc.store_name || 'Í≤åÏûÑ Î≥¥ÏÉÅ',
        store_emoji: gc.store_emoji || 'üé´',
        is_used: gc.used || false,
        is_active: true,
        valid_till: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
        originalId: gc.id
      }));
      
      // üîÑ Ï§ëÎ≥µ Ï†úÍ±∞: ID Í∏∞Ï§ÄÏúºÎ°ú Î≥ëÌï©
      const mergedCoupons = [...mockCoupons];
      const seenIds = new Set(mockCoupons.map(c => c.id));
      
      // savedCoupons (Í≤åÏûÑÏóêÏÑú Ï†ÄÏû•Îêú Ïø†Ìè∞) Ï∂îÍ∞Ä
      savedCoupons.forEach(c => {
        if (!seenIds.has(c.id)) {
          mergedCoupons.push(c);
          seenIds.add(c.id);
        }
      });
      
      // legacy Ïø†Ìè∞ Ï∂îÍ∞Ä
      convertedLegacy.forEach(c => {
        if (!seenIds.has(c.id) && !seenIds.has(c.originalId)) {
          mergedCoupons.push(c);
          seenIds.add(c.id);
        }
      });
      
      allCoupons = mergedCoupons;
      renderCoupons(allCoupons);
    }
    
    function renderCoupons(coupons) {
      const container = document.getElementById('coupon-list');
      
      if (coupons.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-400">ÌöçÎìùÌïú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§. Í≤åÏûÑÏùÑ ÌîåÎ†àÏù¥ÌïòÏÑ∏Ïöî!</p>';
        return;
      }
      
      // ÎÇ†Ïßú Ìè¨Îß∑ Ìï®Ïàò
      const formatDate = (dateStr) => {
        if (!dateStr) return '';
        const d = new Date(dateStr);
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        const day = d.getDate().toString().padStart(2, '0');
        const hour = d.getHours().toString().padStart(2, '0');
        const min = d.getMinutes().toString().padStart(2, '0');
        return `${month}/${day} ${hour}:${min}`;
      };
      
      container.innerHTML = coupons.map(coupon => {
        // ÏÇ¨ÏóÖÏûê ÏõπÏÇ¨Ïù¥Ìä∏ URL Í≤∞Ï†ï (Ïø†Ìè∞ ÏûêÏ≤¥ > STORES Í∞ùÏ≤¥ > Í∏∞Î≥∏)
        const storeData = STORES[coupon.store_id];
        const siteUrl = coupon.website_url || (storeData && storeData.website_url) || null;

        // Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ ÏÜåÏä§ Í≤∞Ï†ï
        const hasImage = coupon.image_url && (coupon.image_url.startsWith('http') || coupon.image_url.startsWith('data:') || coupon.image_url.startsWith('blob:'));

        // Ìù¨Í∑ÄÎèÑÎ≥Ñ Í∑∏ÎùºÎîîÏñ∏Ìä∏ Î∞∞Í≤Ω (Ïù¥ÎØ∏ÏßÄ ÏóÜÏùÑ Îïå ÏÇ¨Ïö©)
        const rarityGradients = {
          common: 'linear-gradient(135deg, #4a5568, #2d3748)',
          rare: 'linear-gradient(135deg, #2563eb, #1e40af)',
          epic: 'linear-gradient(135deg, #9333ea, #6b21a8)',
          legendary: 'linear-gradient(135deg, #f59e0b, #d97706)',
          mythic: 'linear-gradient(135deg, #ef4444, #dc2626, #f59e0b)'
        };
        const bgGradient = rarityGradients[coupon.rarity] || rarityGradients.common;

        return `
        <div class="coupon-card ${coupon.rarity}" style="cursor:pointer; position:relative; overflow:hidden;"
             onclick="${siteUrl ? `openCouponSite('${coupon.id}', '${siteUrl.replace(/'/g, "\\'")}')` : `goToStoreDetail('${coupon.store_id || 'store-001'}')`}">
          <div class="flex gap-4" style="min-height: 120px;">
            <!-- üñºÔ∏è Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ (ÏôºÏ™Ω 2/3) -->
            <div class="relative flex-shrink-0 rounded-xl overflow-hidden" style="width: 55%; min-height: 120px; box-shadow: 0 4px 20px rgba(168,85,247,0.3);">
              ${hasImage ?
                `<img src="${coupon.image_url}" alt="${coupon.title}" class="w-full h-full object-cover" style="min-height:120px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="w-full h-full items-center justify-center" style="display:none; background:${bgGradient}; min-height:120px;">
                   <div class="text-center p-4">
                     <div class="text-5xl mb-2">${coupon.store_emoji || 'üé´'}</div>
                     <div class="text-white font-bold text-lg">${coupon.discount_type === 'percentage' ? coupon.discount_value + '% OFF' : '‚Ç©' + coupon.discount_value.toLocaleString()}</div>
                   </div>
                 </div>` :
                `<div class="w-full h-full flex items-center justify-center" style="background:${bgGradient}; min-height:120px;">
                   <div class="text-center p-4">
                     <div class="text-5xl mb-2">${coupon.store_emoji || 'üé´'}</div>
                     <div class="text-white font-bold text-lg">${coupon.discount_type === 'percentage' ? coupon.discount_value + '% OFF' : '‚Ç©' + coupon.discount_value.toLocaleString()}</div>
                     <div class="text-white/60 text-xs mt-1">${coupon.business_name || coupon.store_name || ''}</div>
                   </div>
                 </div>`
              }
              <!-- Ìù¨Í∑ÄÎèÑ Î∞∞ÏßÄ (Ïù¥ÎØ∏ÏßÄ ÏúÑÏóê Ïò§Î≤ÑÎ†àÏù¥) -->
              <div class="absolute top-2 left-2">
                <span class="rarity-badge ${coupon.rarity}" style="font-size:10px; padding:2px 6px;">${coupon.rarity.toUpperCase()}</span>
              </div>
              ${coupon.is_used ? '<div class="absolute inset-0 bg-black/60 flex items-center justify-center"><span class="text-white font-bold text-lg rotate-[-15deg] border-2 border-white px-3 py-1 rounded">ÏÇ¨Ïö©ÏôÑÎ£å</span></div>' : ''}
            </div>

            <!-- üìã Ïø†Ìè∞ Ï†ïÎ≥¥ (Ïò§Î•∏Ï™Ω 1/3) -->
            <div class="flex-1 flex flex-col justify-between py-1">
              <div>
                <h3 class="text-base font-bold leading-tight mb-1">${coupon.title}</h3>
                <p class="text-gray-400 text-sm">${coupon.store_emoji || 'üè™'} ${coupon.business_name || coupon.store_name || 'Í≤åÏûÑ Î≥¥ÏÉÅ'}</p>
                <p class="text-2xl font-black mt-2" style="color: ${coupon.rarity === 'legendary' || coupon.rarity === 'mythic' ? '#f59e0b' : '#06b6d4'};">
                  ${coupon.discount_type === 'percentage' ? coupon.discount_value + '%' : '‚Ç©' + coupon.discount_value.toLocaleString()}
                </p>
              </div>
              <div>
                <!-- üìÖ ÏãúÍ∞Ñ ÌëúÏãú -->
                <p class="text-xs text-gray-500 mb-2">
                  ${coupon.acquired_at ? `üïê ${formatDate(coupon.acquired_at)}` : ''}
                </p>
                <!-- Î≤ÑÌäº ÏòÅÏó≠ -->
                <div class="flex gap-1.5">
                  ${!coupon.is_used && siteUrl ? `<button onclick="event.stopPropagation(); openCouponSite('${coupon.id}', '${siteUrl.replace(/'/g, "\\'")}')" class="flex-1 px-2 py-1.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg font-bold text-xs hover:opacity-80 transition text-center">üåê ÏÇ¨Ïö©ÌïòÍ∏∞</button>` : ''}
                  ${!coupon.is_used && !siteUrl ? `<button onclick="event.stopPropagation(); useCouponAtStore('${coupon.id}')" class="flex-1 px-2 py-1.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg font-bold text-xs hover:opacity-80 transition text-center">üè™ Îß§Ïû•</button>` : ''}
                  <button onclick="event.stopPropagation(); deleteSingleCoupon('${coupon.id}')" class="px-2 py-1.5 bg-red-600/30 hover:bg-red-600 rounded-lg font-bold text-xs transition" title="ÏÇ≠Ï†ú">üóëÔ∏è</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }
    
    function filterCoupons(status) {
      if (status === 'all') {
        renderCoupons(allCoupons);
      } else {
        const filtered = allCoupons.filter(c => {
          if (status === 'available') return !c.is_used;
          if (status === 'used') return c.is_used;
          return true;
        });
        renderCoupons(filtered);
      }
    }
    
    // ‚≠ê Î™®Îì† Ïø†Ìè∞ ÏÇ≠Ï†ú Ìï®Ïàò
    function deleteAllCoupons() {
      const gameCoupons = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
      const totalCount = allCoupons.length;
      const gameCount = gameCoupons.length;
      
      if (totalCount === 0 && gameCount === 0) {
        alert('ÏÇ≠Ï†úÌï† Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§.');
        return;
      }
      
      const confirmMsg = `Ï†ïÎßê Î™®Îì† Ïø†Ìè∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚Ä¢ Í≤åÏûÑ ÌöçÎìù Ïø†Ìè∞: ${gameCount}Í∞ú\n‚Ä¢ Ï†ÑÏ≤¥ Ïø†Ìè∞: ${totalCount}Í∞ú\n\n‚ö†Ô∏è ÏÇ≠Ï†úÎêú Ïø†Ìè∞ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§!`;
      
      if (confirm(confirmMsg)) {
        // localStorage Ïø†Ìè∞ ÏÇ≠Ï†ú
        localStorage.removeItem('airctt_coupons');
        localStorage.removeItem('airctt_points');
        
        // Î©îÎ™®Î¶¨ Ïø†Ìè∞ Ï¥àÍ∏∞Ìôî
        allCoupons = [];
        
        // UI ÏÉàÎ°úÍ≥†Ïπ®
        renderCoupons([]);
        
        alert('‚úÖ Î™®Îì† Ïø†Ìè∞Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      }
    }
    
    // üóëÔ∏è Í∞úÎ≥Ñ Ïø†Ìè∞ ÏÇ≠Ï†ú Ìï®Ïàò
    function deleteSingleCoupon(couponId) {
      const coupon = allCoupons.find(c => c.id === couponId);
      if (!coupon) return;
      
      if (!confirm(`Ï†ïÎßê Ïù¥ Ïø†Ìè∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏø†Ìè∞: ${coupon.title}\nÎß§Ïû•: ${coupon.store_name || coupon.business_name}\n\n‚ö†Ô∏è ÏÇ≠Ï†úÎêú Ïø†Ìè∞ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§!`)) {
        return;
      }
      
      // Î©îÎ™®Î¶¨ÏóêÏÑú Ï†úÍ±∞
      allCoupons = allCoupons.filter(c => c.id !== couponId);
      
      // localStorageÏóêÏÑúÎèÑ Ï†úÍ±∞
      const gameCoupons = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
      const updatedCoupons = gameCoupons.filter(c => c.id !== couponId);
      localStorage.setItem('airctt_coupons', JSON.stringify(updatedCoupons));
      
      // UI ÏÉàÎ°úÍ≥†Ïπ®
      renderCoupons(allCoupons);
      
      alert('üóëÔ∏è Ïø†Ìè∞Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    }
    
    // üåê Ïø†Ìè∞ ‚Üí ÏÇ¨ÏóÖÏûê ÏÇ¨Ïù¥Ìä∏Î°ú Ïù¥Îèô
    function openCouponSite(couponId, siteUrl) {
      if (!siteUrl) {
        alert('Îß§Ïû• ÏÇ¨Ïù¥Ìä∏ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
        return;
      }

      const coupon = allCoupons.find(c => c.id === couponId);
      const storeName = coupon ? (coupon.business_name || coupon.store_name || 'Îß§Ïû•') : 'Îß§Ïû•';
      const storeEmoji = coupon ? (coupon.store_emoji || 'üè™') : 'üè™';
      const discount = coupon ? (coupon.discount_type === 'percentage' ? coupon.discount_value + '%' : '‚Ç©' + coupon.discount_value.toLocaleString()) : '';

      // üì± ÏÇ¨Ïù¥Ìä∏ Ïù¥Îèô ÏïåÎ¶º (Í∞ÑÎûµÌûà)
      if (typeof showToast === 'function') {
        showToast(`${storeEmoji} ${storeName} ÏÇ¨Ïù¥Ìä∏Î°ú Ïù¥Îèô! ${discount} Ìï†Ïù∏ Ïø†Ìè∞ Ï†ÅÏö©`, 'coupon');
      }

      // üîó ÏÉà ÌÉ≠ÏóêÏÑú ÏÇ¨ÏóÖÏûê ÏÇ¨Ïù¥Ìä∏ Ïó¥Í∏∞
      window.open(siteUrl, '_blank');
    }

    // üè™ Îß§Ïû• ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïù¥Îèô
    function goToStoreDetail(storeId) {
      const store = STORES[storeId];
      if (!store) {
        // Í∏∞Î≥∏ Îß§Ïû• (ÏïÑÎØ∏ ÌïúÏ†ïÏãù)ÏúºÎ°ú Ïù¥Îèô
        showStoreDetailPage('store-001');
        return;
      }
      showStoreDetailPage(storeId);
    }
    
    // Îß§Ïû• ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ ÌëúÏãú
    function showStoreDetailPage(storeId) {
      const store = STORES[storeId];
      currentStoreId = storeId;
      
      // Îß§Ïû• Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
      const storeInfo = document.getElementById('store-detail-info');
      if (storeInfo && store) {
        document.getElementById('detail-store-name').textContent = store.name;
        document.getElementById('detail-store-emoji').textContent = store.emoji;
        document.getElementById('detail-store-address').textContent = store.address;
        document.getElementById('detail-store-category').textContent = store.category;
      }
      
      showPage('store');
      loadMenuItems(storeId);
    }
    
    let currentStoreId = 'store-001';
    
    function useCouponAtStore(couponId) {
      const coupon = allCoupons.find(c => c.id === couponId);
      if (!coupon || coupon.is_used) {
        alert('Ïù¥ÎØ∏ ÏÇ¨Ïö©Îêú Ïø†Ìè∞ÏûÖÎãàÎã§.');
        return;
      }

      // ‚≠ê ÏÇ¨ÏóÖÏûê ÏÇ¨Ïù¥Ìä∏Í∞Ä ÏûàÏúºÎ©¥ Ïô∏Î∂Ä ÏÇ¨Ïù¥Ìä∏Î°ú Ïù¥Îèô
      const storeData = STORES[coupon.store_id];
      const siteUrl = coupon.website_url || (storeData && storeData.website_url) || null;
      if (siteUrl) {
        openCouponSite(couponId, siteUrl);
        return;
      }

      // ‚≠ê Îß§Ïû•Î≥Ñ Î∞îÎ°ú Ïù¥Îèô + Ïø†Ìè∞ Ï†ÅÏö©
      const storeName = coupon.business_name || coupon.store_name || 'Ïïå Ïàò ÏóÜÎäî Îß§Ïû•';
      const storeEmoji = coupon.store_emoji || 'üè™';

      alert(`${storeEmoji} ${storeName} Îß§Ïû•ÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§!\n\nÏ†ÅÏö© Ïø†Ìè∞: ${coupon.title}\nÌï†Ïù∏: ${coupon.discount_type === 'percentage' ? coupon.discount_value + '%' : '‚Ç©' + coupon.discount_value.toLocaleString()}`);
      
      // Îß§Ïû• ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
      showPage('store');
      
      // Ïø†Ìè∞ ÏûêÎèô ÏÑ†ÌÉù
      setTimeout(() => {
        selectCouponForStore(couponId);
        document.getElementById('checkout-section')?.scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }
    
    // Ïø†Ìè∞ÏóêÏÑú Î∞îÎ°ú Îß§Ïû• Ïù¥Îèô (ÏÉà Ìï®Ïàò)
    function goToStoreFromCoupon(storeId, couponId) {
      const store = STORES[storeId];
      if (!store) {
        alert('Îß§Ïû• Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
      }
      
      alert(`${store.emoji} ${store.name} Îß§Ïû•ÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§!`);
      showPage('store');
      
      if (couponId) {
        setTimeout(() => selectCouponForStore(couponId), 100);
      }
    }
    
    function openCouponModal(couponId) {
      selectedCoupon = allCoupons.find(c => c.id === couponId);
      if (!selectedCoupon) return;
      
      document.getElementById('modal-title').textContent = selectedCoupon.title;
      document.getElementById('modal-body').innerHTML = `
        <p class="mb-2"><strong>ÏÉÅÏ†ê:</strong> ${selectedCoupon.business_name}</p>
        <p class="mb-2"><strong>Ìï†Ïù∏:</strong> ${selectedCoupon.discount_type === 'percentage' ? selectedCoupon.discount_value + '%' : '‚Ç©' + selectedCoupon.discount_value.toLocaleString()}</p>
        <p class="mb-2"><strong>Ìù¨Í∑ÄÎèÑ:</strong> <span class="rarity-badge ${selectedCoupon.rarity}">${selectedCoupon.rarity.toUpperCase()}</span></p>
        <p class="mb-2"><strong>ÏÉÅÌÉú:</strong> ${selectedCoupon.is_used ? 'ÏÇ¨Ïö©ÏôÑÎ£å' : 'ÏÇ¨Ïö©Í∞ÄÎä•'}</p>
      `;
      
      document.getElementById('coupon-modal').classList.add('active');
    }
    
    function closeModal() {
      document.getElementById('coupon-modal').classList.remove('active');
    }
    
    function useCoupon() {
      if (!selectedCoupon || selectedCoupon.is_used) {
        alert('Ïù¥ÎØ∏ ÏÇ¨Ïö©Îêú Ïø†Ìè∞ÏûÖÎãàÎã§.');
        return;
      }
      
      selectedCoupon.is_used = true;
      alert('Ïø†Ìè∞Ïù¥ ÏÇ¨Ïö©ÎêòÏóàÏäµÎãàÎã§!');
      closeModal();
      renderCoupons(allCoupons);
    }
    
    // ÏÇ¨ÏóÖÏûê ÌéòÏù¥ÏßÄ
    function registerBusiness(e) {
      e.preventDefault();
      
      if (!currentUser) {
        alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§!');
        showPage('login');
        return;
      }
      
      const name = document.getElementById('business-name').value;
      const category = document.getElementById('business-category').value;
      const address = document.getElementById('business-address').value;
      const phone = document.getElementById('business-phone').value;
      const description = document.getElementById('business-description').value;
      const hours = document.getElementById('business-hours').value;
      const minOrder = document.getElementById('business-min-order').value;
      const imageFile = document.getElementById('business-image').files[0];
      
      // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨
      let logoUrl = 'https://via.placeholder.com/200';
      if (imageFile) {
        // Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤ÑÏóê ÏóÖÎ°úÎìú
        logoUrl = URL.createObjectURL(imageFile);
      }
      
      // CTT stores ÌÖåÏù¥Î∏î Íµ¨Ï°∞Î°ú ÏÉà Îß§Ïû• ÏÉùÏÑ±
      const newStore = {
        id: 'store-' + Date.now(),
        owner_id: currentUser.id || 'user-002',
        business_name: name,
        business_number: 'AUTO-' + Date.now(),
        category: category,
        address: address,
        phone: phone,
        email: currentUser.email,
        description: description || `${name} - ${category} Ï†ÑÎ¨∏Ï†ê`,
        logo_url: logoUrl,
        opening_hours: hours ? { default: hours } : { default: '10:00-22:00' },
        nearby_coupon_range: 500,
        total_coupons_issued: 0,
        total_revenue: 0,
        rating: 5.0,
        review_count: 0,
        is_verified: false,
        is_active: true,
        status: true,
        created_at: new Date().toISOString()
      };
      
      // ÏÉà Îß§Ïû• Ï†ÄÏû• (Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤ÑÏóê)
      console.log('üè™ ÏÉà Îß§Ïû• Îì±Î°ù:', newStore);
      
      alert(`‚úÖ ÏÇ¨ÏóÖÏûê Îì±Î°ù ÏôÑÎ£å!\n\nÏÉÅÌò∏: ${name}\nÏóÖÏ¢Ö: ${category}\nÏ£ºÏÜå: ${address}\nÏ†ÑÌôî: ${phone}\n\nÎß§Ïû• ÌéòÏù¥ÏßÄÍ∞Ä ÏûêÎèô ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!\nÏù¥Ï†ú Ïø†Ìè∞ÏùÑ Î∞úÍ∏âÌï† Ïàò ÏûàÏäµÎãàÎã§!`);
      
      // Î∞úÍ∏âÎπÑÏö© 100Ïõê Ï∞®Í∞ê ÏïàÎÇ¥
      alert(`üí∞ ÏÇ¨ÏóÖÏûê Îì±Î°ùÎπÑ: ‚Ç©0 (Î¨¥Î£å)\n\nÎã§Ïùå Îã®Í≥Ñ:\n1. Ïø†Ìè∞ Î∞úÍ∏â (Ïû•Îãπ ‚Ç©50)\n2. Í≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨\n3. Í≥†Í∞ù ÌöçÎìù Î∞è Îß§Ï∂ú Ï¶ùÎåÄ!`);
      
      showBusinessTab('mystore');
    }
    
    function showCouponIssueForm() {
      document.getElementById('coupon-issue-form').style.display = 'block';
      document.getElementById('coupon-issue-form').scrollIntoView({ behavior: 'smooth' });
    }
    
    function hideCouponIssueForm() {
      document.getElementById('coupon-issue-form').style.display = 'none';
    }
    
    function toggleDiscountInput() {
      const type = document.getElementById('coupon-discount-type').value;
      const input = document.getElementById('coupon-discount-value');
      if (type === 'percentage') {
        input.placeholder = '20';
      } else {
        input.placeholder = '5000';
      }
    }
    
    function issueCoupon(e) {
      e.preventDefault();
      
      if (!currentUser) {
        alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§!');
        showPage('login');
        return;
      }
      
      const title = document.getElementById('coupon-title').value;
      const discountType = document.getElementById('coupon-discount-type').value;
      const discountValue = document.getElementById('coupon-discount-value').value;
      const rarity = document.getElementById('coupon-rarity').value;
      const quantity = document.getElementById('coupon-quantity').value;
      const expiry = document.getElementById('coupon-expiry').value;
      const radius = document.getElementById('coupon-radius').value;
      const description = document.getElementById('coupon-description').value;
      
      // Î∞úÍ∏â ÎπÑÏö© Í≥ÑÏÇ∞ (Ïû•Îãπ 100Ïõê)
      const issueCost = parseInt(quantity) * 50;
      
      // Í≤∞Ï†ú ÌôïÏù∏
      const confirmPayment = confirm(`üí≥ Ïø†Ìè∞ Î∞úÍ∏â ÎπÑÏö©\n\nÏàòÎüâ: ${quantity}Ïû•\nÎã®Í∞Ä: ‚Ç©50/Ïû•\nÏ¥ù ÎπÑÏö©: ‚Ç©${issueCost.toLocaleString()}\n\n‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠:\n‚Ä¢ Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ Í≤åÏûÑÏóê Î∞∞Ìè¨Îê©ÎãàÎã§\n‚Ä¢ ÏäπÏù∏ÍπåÏßÄ 1~2ÏãúÍ∞Ñ ÏÜåÏöîÎê† Ïàò ÏûàÏäµÎãàÎã§\n\nÍ≤∞Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
      
      if (!confirmPayment) {
        return;
      }
      
      // CTT coupons ÌÖåÏù¥Î∏î Íµ¨Ï°∞Î°ú ÏÉùÏÑ±
      const newCoupon = {
        id: 'coupon-' + Date.now(),
        store_id: 'store-001',
        coupon_name: title,
        title: title,
        description: description,
        coupon_code: 'COUPON_' + Date.now(),
        coupon_type: discountType,
        discount_type: discountType,
        discount_value: parseInt(discountValue),
        min_purchase_amount: 0,
        max_discount: discountType === 'percentage' ? 50000 : parseInt(discountValue),
        latitude: 37.5665,
        longitude: 126.9780,
        activation_radius: parseInt(radius),
        rarity: rarity,
        drop_rate: rarity === 'common' ? 0.7 : rarity === 'rare' ? 0.2 : rarity === 'epic' ? 0.1 : rarity === 'legendary' ? 0.05 : 0.01,
        total_coupons: parseInt(quantity),
        total_quantity: parseInt(quantity),
        remaining_coupons: parseInt(quantity),
        issued_count: 0,
        used_count: 0,
        per_user: 1,
        usage_limit_per_user: 1,
        valid_from: new Date().toISOString(),
        valid_till: new Date(expiry).toISOString(),
        is_stackable: false,
        coupon_image: rarity === 'legendary' ? 'üíé' : rarity === 'epic' ? 'üéÅ' : rarity === 'rare' ? 'üé´' : 'üè∑Ô∏è',
        status: 'pending', // ÏäπÏù∏ ÎåÄÍ∏∞
        is_active: false, // ÏäπÏù∏ Ï†ÑÍπåÏßÄ ÎπÑÌôúÏÑ±
        is_deleted: false,
        business_name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
        issue_cost: issueCost, // Î∞úÍ∏â ÎπÑÏö©
        issued_by: currentUser.id,
        created_at: new Date().toISOString()
      };
      
      // Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ùÏóê Ï∂îÍ∞Ä
      pendingCoupons.push(newCoupon);
      
      // Ï†ïÏÇ∞ Í∏∞Î°ù
      console.log('üí∞ Ïø†Ìè∞ Î∞úÍ∏â Ï†ïÏÇ∞:', {
        coupon_id: newCoupon.id,
        quantity: quantity,
        cost_per_coupon: 50,
        total_cost: issueCost,
        business_id: 'store-001',
        status: 'pending_approval',
        timestamp: new Date().toISOString()
      });
      
      alert(`üìù Ïø†Ìè∞ Î∞úÍ∏â Ïã†Ï≤≠ ÏôÑÎ£å!\n\n${title}\nÌï†Ïù∏: ${discountType === 'percentage' ? discountValue + '%' : '‚Ç©' + discountValue}\nÏàòÎüâ: ${quantity}Í∞ú\nÎπÑÏö©: ‚Ç©${issueCost.toLocaleString()}\n\n‚è≥ Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë...\nÏäπÏù∏ ÌõÑ Í≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨Îê©ÎãàÎã§!`);
      
      hideCouponIssueForm();
      loadBusinessStats();
      
      // Ìèº Ï¥àÍ∏∞Ìôî
      document.getElementById('coupon-title').value = '';
      document.getElementById('coupon-discount-value').value = '';
      document.getElementById('coupon-quantity').value = '';
      document.getElementById('coupon-description').value = '';
    }
    
    async function loadBusinessStats() {
      document.getElementById('total-issued').textContent = '127';
      document.getElementById('total-used').textContent = '89';
      document.getElementById('total-revenue').textContent = '‚Ç©2,340,000';
      
      const mockBusinessCoupons = [
        { id: '1', title: '20% Ìï†Ïù∏ Ïø†Ìè∞', issued: 50, used: 38 },
        { id: '2', title: '5000Ïõê Ìï†Ïù∏', issued: 77, used: 51 }
      ];
      
      document.getElementById('business-coupon-list').innerHTML = mockBusinessCoupons.map(c => `
        <div class="border-b border-gray-700 py-3">
          <h4 class="font-bold">${c.title}</h4>
          <p class="text-sm text-gray-400">Î∞úÍ∏â: ${c.issued}Í∞ú | ÏÇ¨Ïö©: ${c.used}Í∞ú</p>
        </div>
      `).join('');
    }
    
    // Ïä§ÌÜ†Ïñ¥ Î©îÎâ¥
    function loadStoreMenu() {
      loadAvailableCoupons();

      // Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© ‚Üí Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞
      const menuContainer = document.getElementById('menu-list');
      if (typeof showSkeleton === 'function') showSkeleton('menu-list', 3, 'card');

      // Î¶¨Î∑∞ Î°úÎìú
      setTimeout(() => { if (typeof renderStoreReviews === 'function') renderStoreReviews('store-reviews-area', 'ami-hansik'); }, 300);

      setTimeout(() => {
      menuContainer.innerHTML = MENU_ITEMS.map(item => `
        <div class="card glow-border">
          <div class="flex items-center gap-4">
            <div class="text-5xl">${item.image}</div>
            <div class="flex-1">
              <h4 class="text-xl font-bold mb-1">${item.name}</h4>
              <p class="text-gray-400 text-sm mb-2">${item.category}</p>
              <p class="text-2xl font-bold text-cyan-400">‚Ç©${item.price.toLocaleString()}</p>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="changeQuantity('${item.id}', -1)" class="w-10 h-10 bg-gray-700 rounded">-</button>
              <span id="qty-${item.id}" class="w-8 text-center">0</span>
              <button onclick="changeQuantity('${item.id}', 1)" class="w-10 h-10 bg-purple-600 rounded">+</button>
            </div>
          </div>
        </div>
      `).join('');

      updateCart();
      }, 600); // end skeleton timeout
    }
    
    function loadAvailableCoupons() {
      const container = document.getElementById('available-coupons-list');
      
      // ‚≠ê ÏïÑÎØ∏ ÌïúÏ†ïÏãù Ìè¨Ìï® Î™®Îì† Îß§Ïû• Ïø†Ìè∞ ÏÇ¨Ïö© Í∞ÄÎä•
      const availableCoupons = allCoupons.filter(c => 
        !c.is_used && (c.business_name === 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù' || c.business_name === 'Í≤åÏûÑ Î≥¥ÏÉÅ' || c.business_name === 'ÏïÑÎØ∏ Îã§Î∞©' || c.id.startsWith('game-coupon'))
      );
      
      if (availableCoupons.length === 0) {
        container.innerHTML = '<p class="text-gray-400">ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§. üéÆ Í≤åÏûÑÏóêÏÑú Ïø†Ìè∞ÏùÑ Î™®ÏïÑÎ≥¥ÏÑ∏Ïöî!</p>';
        return;
      }
      
      container.innerHTML = availableCoupons.map(coupon => `
        <div onclick="selectCouponForStore('${coupon.id}')" 
             id="store-coupon-${coupon.id}"
             class="coupon-card ${coupon.rarity} mb-2 cursor-pointer">
          <div class="flex items-center justify-between">
            <div>
              <span class="rarity-badge ${coupon.rarity}">${coupon.rarity.toUpperCase()}</span>
              <span class="font-bold">${coupon.title}</span>
            </div>
            <div class="text-cyan-400 font-bold">
              ${coupon.discount_type === 'percentage' ? coupon.discount_value + '%' : '‚Ç©' + coupon.discount_value.toLocaleString()}
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function selectCouponForStore(couponId) {
      document.querySelectorAll('[id^="store-coupon-"]').forEach(el => {
        el.style.border = '';
      });
      
      const coupon = allCoupons.find(c => c.id === couponId);
      if (selectedCouponForStore && selectedCouponForStore.id === couponId) {
        selectedCouponForStore = null;
      } else {
        selectedCouponForStore = coupon;
        document.getElementById(`store-coupon-${couponId}`).style.border = '2px solid #22d3ee';
      }
      
      updateCart();
    }
    
    function changeQuantity(itemId, delta) {
      const item = MENU_ITEMS.find(m => m.id === itemId);
      if (!item) return;
      
      const cartItem = cart.find(c => c.id === itemId);
      
      if (cartItem) {
        cartItem.quantity += delta;
        if (cartItem.quantity <= 0) {
          cart = cart.filter(c => c.id !== itemId);
        }
      } else if (delta > 0) {
        cart.push({ ...item, quantity: 1 });
      }
      
      document.getElementById(`qty-${itemId}`).textContent = 
        cart.find(c => c.id === itemId)?.quantity || 0;
      
      updateCart();
    }
    
    function setOrderType(type) {
      currentOrderType = type;
      
      ['delivery', 'pickup', 'reservation'].forEach(t => {
        const btn = document.getElementById(`btn-${t}`);
        if (t === type) {
          btn.style.opacity = '1';
          btn.style.transform = 'scale(1.05)';
        } else {
          btn.style.opacity = '0.6';
          btn.style.transform = 'scale(1)';
        }
      });
      
      ['delivery-form', 'pickup-form', 'reservation-form'].forEach(formId => {
        document.getElementById(formId).style.display = 'none';
      });
      document.getElementById(`${type}-form`).style.display = 'block';
      
      updateCart();
    }
    
    function updateCart() {
      const summaryContainer = document.getElementById('cart-summary');
      
      if (cart.length === 0) {
        summaryContainer.innerHTML = '<p class="text-gray-400">Î©îÎâ¥Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</p>';
        document.getElementById('subtotal').textContent = '‚Ç©0';
        document.getElementById('discount').textContent = '-‚Ç©0';
        document.getElementById('total').textContent = '‚Ç©0';
        return;
      }
      
      summaryContainer.innerHTML = cart.map(item => `
        <div class="flex justify-between mb-2">
          <span>${item.name} x ${item.quantity}</span>
          <span>‚Ç©${(item.price * item.quantity).toLocaleString()}</span>
        </div>
      `).join('');
      
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      let discount = 0;
      
      if (selectedCouponForStore) {
        if (selectedCouponForStore.discount_type === 'percentage') {
          discount = subtotal * (selectedCouponForStore.discount_value / 100);
        } else if (selectedCouponForStore.discount_type === 'fixed') {
          discount = selectedCouponForStore.discount_value;
        }
      }
      
      const deliveryFee = currentOrderType === 'delivery' ? 3000 : 0;
      const total = subtotal - discount + deliveryFee;
      
      document.getElementById('subtotal').textContent = `‚Ç©${subtotal.toLocaleString()}`;
      document.getElementById('discount').textContent = `-‚Ç©${discount.toLocaleString()}`;
      document.getElementById('delivery-fee').textContent = `‚Ç©${deliveryFee.toLocaleString()}`;
      document.getElementById('total').textContent = `‚Ç©${total.toLocaleString()}`;
    }
    
    async function checkout() {
      if (!currentUser) {
        alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§!');
        showPage('login');
        return;
      }
      
      if (cart.length === 0) {
        alert('Î©îÎâ¥Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
        return;
      }
      
      if (!currentOrderType) {
        alert('Ï£ºÎ¨∏ Î∞©Î≤ïÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
        return;
      }
      
      // üí≥ Í≤∞Ï†ú ÏàòÎã® Í∞ÄÏ†∏Ïò§Í∏∞
      const paymentMethod = document.querySelector('input[name="payment-method"]:checked')?.value || 'card';
      const paymentLabels = {
        'card': 'üí≥ Ïπ¥Îìú',
        'cash': 'üíµ ÌòÑÍ∏à',
        'transfer': 'üè¶ Í≥ÑÏ¢åÏù¥Ï≤¥',
        'kakao': 'üü° Ïπ¥Ïπ¥Ïò§ÌéòÏù¥'
      };
      
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const discount = selectedCouponForStore ? calculateDiscount() : 0;
      const deliveryFee = currentOrderType === 'delivery' ? 3000 : 0;
      const total = subtotal - discount + deliveryFee;
      
      const confirmMessage = `
Ï£ºÎ¨∏ ÌôïÏù∏
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${cart.map(item => `${item.name} x ${item.quantity}`).join('\n')}

Ï£ºÎ¨∏Í∏àÏï°: ‚Ç©${subtotal.toLocaleString()}
Ìï†Ïù∏: -‚Ç©${discount.toLocaleString()}
Î∞∞Îã¨Î£å: ‚Ç©${deliveryFee.toLocaleString()}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Ï¥ù Í≤∞Ï†úÍ∏àÏï°: ‚Ç©${total.toLocaleString()}

Í≤∞Ï†ú ÏàòÎã®: ${paymentLabels[paymentMethod]}

Í≤∞Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
      `;
      
      // Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ PG Í≤∞Ï†ú ÏãúÎÆ¨Î†àÏù¥ÏÖò ÌåùÏóÖ
      const pgResult = await showPGPaymentPopup({
        items: cart,
        subtotal, discount, deliveryFee, total,
        paymentMethod, paymentLabel: paymentLabels[paymentMethod]
      });

      if (!pgResult || pgResult.status !== 'approved') {
        if (pgResult?.status === 'cancelled') alert('Í≤∞Ï†úÍ∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
        return;
      }

      // CTT orders ÌÖåÏù¥Î∏î Íµ¨Ï°∞
      const orderData = {
        id: 'order-' + Date.now(),
        user_id: currentUser.id || 'user-001',
        store_id: currentStoreId || 'store-001',
        order_number: 'ORD' + Date.now(),
        order_type: currentOrderType,
        payment_method: paymentMethod, // üí≥ Í≤∞Ï†ú ÏàòÎã® Ï∂îÍ∞Ä
        
        items: cart.map(item => ({
          product_id: item.id,
          product_name: item.name,
          quantity: item.quantity,
          unit_price: item.price
        })),
        
        sub_total: subtotal,
        subtotal: subtotal,
        delivery_fee: deliveryFee,
        coupon_discount: discount,
        discount_amount: discount,
        total: total,
        total_amount: total,
        
        payment_status: 'paid',
        status: 'confirmed',
        pg_transaction_id: pgResult.transactionId,
        pg_provider: 'Îã§Ïö∞Îç∞Ïù¥ÌÑ∞',
        pg_approved_at: pgResult.approvedAt,
        created_at: new Date().toISOString()
      };

      console.log('üì¶ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞:', orderData);

      // SupabaseÏóê Ï£ºÎ¨∏ Ï†ÄÏû• ÏãúÎèÑ
      try {
        const sbOrder = await sbFetch('orders', '', {
          method: 'POST',
          body: {
            store_id: '22222222-2222-2222-2222-222222222222',
            order_type: 'online_order',
            status: 'paid',
            total_amount: subtotal,
            discount_amount: discount,
            final_amount: total
          }
        });
        if (sbOrder) console.log('‚úÖ Supabase Ï£ºÎ¨∏ Ï†ÄÏû• ÏÑ±Í≥µ:', sbOrder);
      } catch (e) {
        console.warn('‚ö†Ô∏è Supabase Ï£ºÎ¨∏ Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨ÏóêÎßå Ï†ÄÏû•:', e.message);
      }

      // üîä Ï†êÏ£ºÏóêÍ≤å Ï£ºÎ¨∏ ÏïåÎ¶º (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
      playOrderNotificationSound();

      // Ï£ºÎ¨∏ Î™©Î°ùÏóê Ï∂îÍ∞Ä (localStorage)
      const orders = JSON.parse(localStorage.getItem('storeOrders') || '[]');
      orders.unshift(orderData);
      localStorage.setItem('storeOrders', JSON.stringify(orders));
      
      // Ïø†Ìè∞ ÏÇ¨Ïö© Ï≤òÎ¶¨
      if (selectedCouponForStore) {
        selectedCouponForStore.is_used = true;
        selectedCouponForStore.used_at = new Date().toISOString();
        
        // ‚≠ê allCouponsÏóêÏÑúÎèÑ ÏÇ¨Ïö© Ï≤òÎ¶¨
        const couponIdx = allCoupons.findIndex(c => c.id === selectedCouponForStore.id);
        if (couponIdx >= 0) {
          allCoupons[couponIdx].is_used = true;
          allCoupons[couponIdx].used_at = new Date().toISOString();
        }
        
        // üì¶ localStorage ÏóÖÎç∞Ïù¥Ìä∏ (ÌÜµÏùºÎêú ÌÇ§: allCoupons)
        localStorage.setItem('allCoupons', JSON.stringify(allCoupons));
        
        // ‚≠ê Î†àÍ±∞Ïãú airctt_couponsÎèÑ Ìò∏ÌôòÏÑ± ÏúÑÌï¥ ÏóÖÎç∞Ïù¥Ìä∏
        if (selectedCouponForStore.originalId) {
          const gameCoupons = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
          const idx = gameCoupons.findIndex(c => c.id === selectedCouponForStore.originalId);
          if (idx >= 0) {
            gameCoupons[idx].used = true;
            gameCoupons[idx].usedDate = new Date().toLocaleDateString('ko-KR');
            localStorage.setItem('airctt_coupons', JSON.stringify(gameCoupons));
          }
        }
        
        console.log('üé´ Ïø†Ìè∞ ÏÇ¨Ïö© ÏôÑÎ£å:', selectedCouponForStore.title);
      }
      
      // üéâ Ï£ºÎ¨∏ ÏôÑÎ£å ‚Äî ÌÜ†Ïä§Ìä∏ + Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏ ÌëúÏãú
      if (typeof showToast === 'function') {
        showToast(`‚úÖ Ï£ºÎ¨∏ ÏôÑÎ£å! PG ÏäπÏù∏: ${pgResult.transactionId}`, 'success', 4000);
      }

      // Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏ ÌëúÏãú
      const timelineArea = document.getElementById('order-timeline-area');
      if (timelineArea && typeof showOrderTimeline === 'function') {
        timelineArea.style.display = 'block';
        showOrderTimeline('order-timeline-area', 0);
        // ÏûêÎèô ÏßÑÌñâ ÏãúÎÆ¨Î†àÏù¥ÏÖò
        setTimeout(() => showOrderTimeline('order-timeline-area', 1), 3000);
        setTimeout(() => showOrderTimeline('order-timeline-area', 2), 6000);
        setTimeout(() => {
          showOrderTimeline('order-timeline-area', 3);
          if (typeof showToast === 'function') showToast('üéâ Ï£ºÎ¨∏Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!', 'success');
        }, 9000);
      }

      // Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
      if (typeof updateTabBadges === 'function') updateTabBadges();

      cart = [];
      selectedCouponForStore = null;
      currentOrderType = null;

      // 10Ï¥à Îí§Ïóê ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ê (ÌÉÄÏûÑÎùºÏù∏ Î≥º ÏãúÍ∞Ñ Ï§å)
      setTimeout(() => { showPage('home'); }, 11000);
    }

    // ============================================
    // üí≥ Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ PG Í≤∞Ï†ú ÏãúÎÆ¨Î†àÏù¥ÏÖò ÌåùÏóÖ
    // ============================================
    function showPGPaymentPopup(data) {
      return new Promise((resolve) => {
        // Í∏∞Ï°¥ ÌåùÏóÖ Ï†úÍ±∞
        const existing = document.getElementById('pg-payment-modal');
        if (existing) existing.remove();

        const modal = document.createElement('div');
        modal.id = 'pg-payment-modal';
        modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;display:flex;align-items:center;justify-content:center;';

        const now = new Date();
        const txId = 'DAOU-' + now.getFullYear() + String(now.getMonth()+1).padStart(2,'0') + String(now.getDate()).padStart(2,'0') + '-' + String(Date.now()).slice(-6);

        modal.innerHTML = `
          <div style="background:#1a1a2e;border:2px solid #0066ff;border-radius:16px;width:90%;max-width:440px;overflow:hidden;font-family:sans-serif;">
            <!-- PG Ìó§Îçî -->
            <div style="background:linear-gradient(135deg,#0044cc,#0066ff);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;">
              <div style="display:flex;align-items:center;gap:10px;">
                <span style="font-size:24px;">üí≥</span>
                <div>
                  <div style="font-size:16px;font-weight:bold;color:white;">Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ PG</div>
                  <div style="font-size:11px;color:rgba(255,255,255,0.7);">DAOU DATA Payment Gateway</div>
                </div>
              </div>
              <div style="background:rgba(255,255,255,0.15);padding:4px 10px;border-radius:20px;font-size:11px;color:white;">VAN ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</div>
            </div>

            <!-- Ï£ºÎ¨∏ ÎÇ¥Ïó≠ -->
            <div style="padding:20px;">
              <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:14px;margin-bottom:16px;">
                <div style="font-size:12px;color:#888;margin-bottom:8px;">Ï£ºÎ¨∏ ÎÇ¥Ïó≠</div>
                ${data.items.map(i => `
                  <div style="display:flex;justify-content:space-between;margin-bottom:4px;font-size:13px;">
                    <span style="color:#ccc;">${i.name} √ó ${i.quantity}</span>
                    <span style="color:white;">‚Ç©${(i.price * i.quantity).toLocaleString()}</span>
                  </div>
                `).join('')}
                <div style="border-top:1px solid rgba(255,255,255,0.1);margin-top:8px;padding-top:8px;">
                  ${data.discount > 0 ? `<div style="display:flex;justify-content:space-between;font-size:12px;color:#22d3ee;"><span>Ïø†Ìè∞ Ìï†Ïù∏</span><span>-‚Ç©${data.discount.toLocaleString()}</span></div>` : ''}
                  ${data.deliveryFee > 0 ? `<div style="display:flex;justify-content:space-between;font-size:12px;color:#888;"><span>Î∞∞Îã¨Î£å</span><span>‚Ç©${data.deliveryFee.toLocaleString()}</span></div>` : ''}
                </div>
              </div>

              <!-- Í≤∞Ï†ú Í∏àÏï° -->
              <div style="text-align:center;margin-bottom:16px;">
                <div style="font-size:12px;color:#888;">Í≤∞Ï†ú Í∏àÏï°</div>
                <div style="font-size:36px;font-weight:900;color:#0088ff;">‚Ç©${data.total.toLocaleString()}</div>
                <div style="font-size:12px;color:#666;">${data.paymentLabel}</div>
              </div>

              <!-- PG Ï†ïÎ≥¥ -->
              <div style="background:rgba(0,102,255,0.08);border:1px solid rgba(0,102,255,0.2);border-radius:8px;padding:12px;margin-bottom:16px;font-size:11px;color:#88aadd;">
                <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span>Í±∞ÎûòÎ≤àÌò∏</span><span style="color:white;font-family:monospace;">${txId}</span></div>
                <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span>Í∞ÄÎßπÏ†ê</span><span style="color:white;">AIRCTT Íµ¨Î¶ÑÏû•ÌÑ∞</span></div>
                <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span>PGÏÇ¨</span><span style="color:white;">Îã§Ïö∞Îç∞Ïù¥ÌÑ∞ (DAOU VAN)</span></div>
                <div style="display:flex;justify-content:space-between;"><span>ÏùºÏãú</span><span style="color:white;">${now.toLocaleString('ko-KR')}</span></div>
              </div>

              <!-- ÏßÑÌñâ Î∞î (ÏãúÎÆ¨Î†àÏù¥ÏÖò) -->
              <div id="pg-progress-area" style="display:none;margin-bottom:16px;">
                <div style="font-size:12px;color:#888;margin-bottom:6px;text-align:center;" id="pg-progress-text">Ïπ¥ÎìúÏÇ¨ ÏäπÏù∏ ÏöîÏ≤≠ Ï§ë...</div>
                <div style="background:rgba(255,255,255,0.1);border-radius:10px;height:6px;overflow:hidden;">
                  <div id="pg-progress-bar" style="background:linear-gradient(90deg,#0066ff,#00ccff);height:100%;width:0%;transition:width 0.3s ease;border-radius:10px;"></div>
                </div>
              </div>

              <!-- Î≤ÑÌäº -->
              <div id="pg-buttons" style="display:flex;gap:10px;">
                <button onclick="document.getElementById('pg-payment-modal').remove();(${resolve.toString().includes('native') ? 'null' : 'null'})" id="pg-cancel-btn"
                  style="flex:1;padding:14px;border-radius:10px;background:rgba(255,255,255,0.1);color:#888;font-weight:bold;border:none;cursor:pointer;font-size:14px;">
                  Ï∑®ÏÜå
                </button>
                <button id="pg-pay-btn"
                  style="flex:2;padding:14px;border-radius:10px;background:linear-gradient(135deg,#0044cc,#0088ff);color:white;font-weight:bold;border:none;cursor:pointer;font-size:16px;">
                  üí≥ Í≤∞Ï†úÌïòÍ∏∞
                </button>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(modal);

        // Ï∑®ÏÜå Î≤ÑÌäº
        document.getElementById('pg-cancel-btn').onclick = () => {
          modal.remove();
          resolve({ status: 'cancelled' });
        };

        // Í≤∞Ï†ú Î≤ÑÌäº
        document.getElementById('pg-pay-btn').onclick = async () => {
          const payBtn = document.getElementById('pg-pay-btn');
          const cancelBtn = document.getElementById('pg-cancel-btn');
          const progressArea = document.getElementById('pg-progress-area');
          const progressBar = document.getElementById('pg-progress-bar');
          const progressText = document.getElementById('pg-progress-text');

          payBtn.disabled = true;
          payBtn.textContent = 'Ï≤òÎ¶¨Ï§ë...';
          payBtn.style.opacity = '0.6';
          cancelBtn.style.display = 'none';
          progressArea.style.display = 'block';

          // ÏãúÎÆ¨Î†àÏù¥ÏÖò: 3Îã®Í≥Ñ ÏßÑÌñâ
          const steps = [
            { pct: 30, text: 'üîê Ïπ¥ÎìúÏÇ¨ ÏäπÏù∏ ÏöîÏ≤≠ Ï§ë...', delay: 800 },
            { pct: 70, text: '‚úÖ Ïπ¥ÎìúÏÇ¨ ÏäπÏù∏ ÏôÑÎ£å', delay: 600 },
            { pct: 100, text: 'üí∞ Í≤∞Ï†ú ÏôÑÎ£å!', delay: 400 }
          ];

          for (const step of steps) {
            await new Promise(r => setTimeout(r, step.delay));
            progressBar.style.width = step.pct + '%';
            progressText.textContent = step.text;
          }

          await new Promise(r => setTimeout(r, 500));

          // ÏäπÏù∏ Í≤∞Í≥º ÌëúÏãú
          payBtn.textContent = '‚úÖ ÏäπÏù∏ ÏôÑÎ£å';
          payBtn.style.background = 'linear-gradient(135deg,#059669,#10b981)';

          await new Promise(r => setTimeout(r, 800));
          modal.remove();

          resolve({
            status: 'approved',
            transactionId: txId,
            approvedAt: new Date().toISOString(),
            amount: data.total
          });
        };
      });
    }

    // üîä Ï£ºÎ¨∏ ÏïåÎ¶º ÏÇ¨Ïö¥Îìú
    let orderNotificationAudio = null;
    
    function playOrderNotificationSound() {
      if (!orderNotificationAudio) {
        // ÎùµÎèô~ Ï∞®ÏûÑÎ≤® ÏÇ¨Ïö¥Îìú (Base64 Ïù∏ÏΩîÎî©)
        orderNotificationAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp6WjH13b3R+iJafoJqPgXRqZWx4hpKcoJuQgHJmYWdweoeVn6GZjH5wZGFmbHmIl6Ccl4t8b2NfZGx5iJijop6Qf29gW19qeIqZpKOfjn1tYF1hanuMm6WjoJB/bmBeYGl7jp2mpKCOf2xfXGBpfJCgp6ahkIBtYF5hanySoamooZJ/bGBdYWl8k6OrqaORgGxgXWBpfJOjq6qikYBsYF1ganySoqqqoZGAbWBdYGl8kqKqqqGRgG1gXmFpfJKiqqmgkX9sX11gaXuSoqqpoJF/bF9dYGl7kaGpqKCRf2xfXWBoe5GhqKefkH9sX11faHuRoainn49/bF9dX2h7kaCnp5+Pf2xfXV9oe5CgpqaejX5rXlxeZ3qQn6WlnYx9al1bXWZ5j56kpJyLfGlcWlxld4+dpKObin1oW1lbZHaPnKOimol8Z1pYWmNziZqhn5eGemZYV1hhcoiYn56Vg3hkVlRYX2+GlZ2ckYF1YlRSVV1shZOam5B/c19RUFRaaoKRmJmNfHBdTk5SWGeBj5aXi3ltWk1LT1Vle42TlYh2aVZKSU1SYXmLkJOEdmZUSkdLUF94iI6RgXJiUEdESk5bd4WLjn5wX0tEQkdMV3OBiIp7bVtIQj9ES1Rve4WHd2lXRT49QUdQaniBhHVlUkE7OT5DSmRyfXxyXUo8NjU6P0ddbHV6bl5KPTMwNTpCU2VsdGteSTswLC0yOUJTYmpuX0s7MCgqLTQ+TVljZ1xIPi4oJiktNkFPW2JZRDssJiMmKjM+SlZdVUE4Kh8fIicuN0RNVFI/NScbGh4iKzI7RE1MQDQoGxkaHiUuN0FJSD4yJhkXGR0lLTZARkQ7LyMYFRgcIis0PENBOCwiGBQWGSAqMjpAPjUqHxcTFRkfKDE5PTowJRwVERMXHigwNzo1LCIaExETFx4nLzY4MikeGBIQExccJi41NzAlHBcQDxIXHCUtNDUvIxsVDw8SGRwlLDQzLCEZExAPEhgcJCszMislHBUPDhEWGiMqMTAoIhoTDg4RFRoiKi8wJiAYEg4OEBQZICgsMCYfFxEODRATFx8mKy0kHhYRDQwPExccIygqJB0WEA0MDxIWGiElJiEaFA8MDBATFRYWHR8fGhUQDA0KDA8SFRYXGR0fHBkTDgoJCgsNEBQYHB0cGxkYFBIRDw0LCQoLDREUFhkZGBcXFRUUEhAQDg4NDAsKCwwODxASExUXFxcXFhYVFRQTExIREA8PDg0NCwsLCgoKCwsLDA0ODw==');
      }
      
      try {
        orderNotificationAudio.currentTime = 0;
        orderNotificationAudio.play().catch(e => console.log('Ï£ºÎ¨∏ ÏïåÎ¶ºÏùå Ïû¨ÏÉù Ïã§Ìå®:', e));
        console.log('üîî Ï†êÏ£ºÏóêÍ≤å Ï£ºÎ¨∏ ÏïåÎ¶º Ï†ÑÏÜ°!');
      } catch (e) {
        console.log('ÏïåÎ¶ºÏùå Ïò§Î•ò:', e);
      }
    }
    
    function calculateDiscount() {
      if (!selectedCouponForStore) return 0;
      
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      if (selectedCouponForStore.discount_type === 'percentage') {
        return subtotal * (selectedCouponForStore.discount_value / 100);
      } else if (selectedCouponForStore.discount_type === 'fixed') {
        return selectedCouponForStore.discount_value;
      }
      
      return 0;
    }
    
    // 3D Î∞∞Í≤Ω (DOM Î°úÎìú ÌõÑ Ïã§Ìñâ)
    let scene, camera, renderer, particles;
    
    function init3DBackground() {
      try {
        const canvas = document.getElementById('canvas-3d');
        if (!canvas) {
          console.log('canvas-3d ÏóÜÏùå, 3D Î∞∞Í≤Ω Ïä§ÌÇµ');
          return;
        }
        
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        camera.position.z = 50;
        
        const particleCount = 5000;
        const positions = new Float32Array(particleCount * 3);
        const colors = new Float32Array(particleCount * 3);
        
        for (let i = 0; i < particleCount; i++) {
          positions[i * 3] = (Math.random() - 0.5) * 200;
          positions[i * 3 + 1] = (Math.random() - 0.5) * 200;
          positions[i * 3 + 2] = (Math.random() - 0.5) * 200;
          
          const color = Math.random() < 0.5 ? new THREE.Color(0xa855f7) : new THREE.Color(0x22d3ee);
          colors[i * 3] = color.r;
          colors[i * 3 + 1] = color.g;
          colors[i * 3 + 2] = color.b;
        }
        
        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        
        const material = new THREE.PointsMaterial({
          size: 0.5,
          vertexColors: true,
          transparent: true,
          opacity: 0.8,
          blending: THREE.AdditiveBlending
        });
        
        particles = new THREE.Points(geometry, material);
        scene.add(particles);
        
        animate3D();
        console.log('3D Î∞∞Í≤Ω Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
      } catch (error) {
        console.error('3D Î∞∞Í≤Ω Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
      }
    }
    
    function animate3D() {
      requestAnimationFrame(animate3D);
      if (particles && renderer && scene && camera) {
        particles.rotation.x += 0.0002;
        particles.rotation.y += 0.0003;
        renderer.render(scene, camera);
      }
    }
    
    // DOM Î°úÎìú ÏôÑÎ£å ÌõÑ 3D Î∞∞Í≤Ω ÏãúÏûë
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init3DBackground);
    } else {
      init3DBackground();
    }
    
    // 3D Í≤åÏûÑ
    let gameScene, gameCamera, gameRenderer, coupons = [];
    let score = 0, timeLeft = 60, caughtCount = 0;
    let gameRunning = false;
    let animationId = null;
    let timerInterval = null;
    let caughtCoupons = [];
    
    const rarities = {
      common: { color: 0xcccccc, score: 10, name: 'ÏùºÎ∞ò Ïø†Ìè∞' },
      rare: { color: 0x4a9eff, score: 50, name: 'Î†àÏñ¥ Ïø†Ìè∞' },
      epic: { color: 0xa855f7, score: 200, name: 'ÏóêÌîΩ Ïø†Ìè∞' },
      legendary: { color: 0xfbbf24, score: 1000, name: 'Ï†ÑÏÑ§ Ïø†Ìè∞' },
      mythic: { color: 0xff0000, score: 5000, name: 'Ïã†Ìôî Ïø†Ìè∞' }
    };
    
    function startGame() {
      if (!currentUser) {
        // Î°úÍ∑∏Ïù∏ Î™®Îã¨ ÌëúÏãú
        if (confirm('Í≤åÏûÑÏùÑ ÌîåÎ†àÏù¥ÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.\nÎ°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
          showPage('login');
        }
        return;
      }
      
      document.getElementById('game-container').classList.add('active');
      
      score = 0;
      timeLeft = 999999; // ‚≠ê Î¨¥Ìïú ÏãúÍ∞Ñ
      caughtCount = 0;
      caughtCoupons = [];
      gameRunning = true;
      comboCount = 0;
      maxCombo = 0;
      goldenCouponsSpawned = 0;
      feverMode = false;
      gameStartRealTime = Date.now();
      rarityCounts = { common: 0, rare: 0, epic: 0, legendary: 0, mythic: 0 };

      updateHUD();
      initGame();
      
      // ‚≠ê ÏãúÍ∞Ñ Ï†úÌïú ÏóÜÏù¥ Í≥ÑÏÜç ÌîåÎ†àÏù¥ (ÌÉÄÏù¥Î®∏ ÌëúÏãúÎßå)
      timerInterval = setInterval(() => {
        // ÏãúÍ∞ÑÏùÄ ÌùêÎ•¥ÏßÄÎßå Í≤åÏûÑ Ï¢ÖÎ£å ÏïàÌï®
        updateHUD();
      }, 1000);
    }
    
    // ‚ïê‚ïê‚ïê üîä Í≤åÏûÑ ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú (Stage 1 ÏûÑÌå©Ìä∏) ‚ïê‚ïê‚ïê
    const gameSounds = {
      catch: null, combo: null, legendary: null, congrats: null
    };
    let audioCtx = null;
    let comboCount = 0;
    let lastCatchTime = 0;

    // ‚ïê‚ïê‚ïê üåü Stage 1 Î≥¥Í∞ï Î≥ÄÏàò ‚ïê‚ïê‚ïê
    let starField = null;
    let dynamicLight1 = null, dynamicLight2 = null;
    let feverMode = false;
    let feverTimer = null;
    let maxCombo = 0;
    let goldenBonusInterval = null;
    let goldenCouponsSpawned = 0;
    let gameStartRealTime = 0;
    let comboGaugeTimer = null;
    let rarityCounts = { common: 0, rare: 0, epic: 0, legendary: 0, mythic: 0 };

    // ‚ïê‚ïê‚ïê üåå Ïö∞Ï£º Î∞∞Í≤Ω Î≥Ñ ÌååÌã∞ÌÅ¥ ‚ïê‚ïê‚ïê
    function createStarField() {
      const starsGeo = new THREE.BufferGeometry();
      const starCount = 250;
      const positions = new Float32Array(starCount * 3);
      const sizes = new Float32Array(starCount);

      for (let i = 0; i < starCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 120;
        positions[i * 3 + 1] = (Math.random() - 0.5) * 80;
        positions[i * 3 + 2] = -20 - Math.random() * 40;
        sizes[i] = Math.random() * 2 + 0.5;
      }

      starsGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      starsGeo.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

      const starsMat = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.3,
        transparent: true,
        opacity: 0.8,
        sizeAttenuation: true
      });

      starField = new THREE.Points(starsGeo, starsMat);
      gameScene.add(starField);
    }

    // ‚ïê‚ïê‚ïê üí° Îã§Ïù¥ÎÇòÎØπ Ïª¨Îü¨ ÎùºÏù¥ÌåÖ ‚ïê‚ïê‚ïê
    function createDynamicLights() {
      dynamicLight1 = new THREE.PointLight(0xff0080, 0.8, 60);
      dynamicLight1.position.set(-15, 10, 5);
      gameScene.add(dynamicLight1);

      dynamicLight2 = new THREE.PointLight(0x00ffff, 0.8, 60);
      dynamicLight2.position.set(15, -10, 5);
      gameScene.add(dynamicLight2);
    }

    function updateDynamicLighting(time) {
      if (dynamicLight1 && dynamicLight2) {
        const hue1 = (time * 0.0003) % 1;
        const hue2 = (time * 0.0003 + 0.5) % 1;
        dynamicLight1.color.setHSL(hue1, 1, 0.5);
        dynamicLight2.color.setHSL(hue2, 1, 0.5);
        dynamicLight1.position.x = Math.sin(time * 0.001) * 20;
        dynamicLight1.position.y = Math.cos(time * 0.0008) * 15;
        dynamicLight2.position.x = Math.cos(time * 0.001) * 20;
        dynamicLight2.position.y = Math.sin(time * 0.0008) * 15;

        // ÌîºÎ≤Ñ Î™®ÎìúÏùº Îïå ÎùºÏù¥Ìä∏ Í∞ïÎèÑ Ï¶ùÍ∞Ä
        if (feverMode) {
          dynamicLight1.intensity = 1.5 + Math.sin(time * 0.01) * 0.5;
          dynamicLight2.intensity = 1.5 + Math.cos(time * 0.01) * 0.5;
        } else {
          dynamicLight1.intensity = 0.8;
          dynamicLight2.intensity = 0.8;
        }
      }
    }

    // ‚ïê‚ïê‚ïê üåå Ïö∞Ï£º Î∞∞Í≤Ω ÌöåÏ†Ñ ‚ïê‚ïê‚ïê
    function updateStarField(time) {
      if (starField) {
        starField.rotation.z = time * 0.00005;
        starField.rotation.x = Math.sin(time * 0.00003) * 0.1;
        // Î≥Ñ Î∞òÏßùÏûÑ Ìö®Í≥º
        starField.material.opacity = 0.6 + Math.sin(time * 0.002) * 0.2;
      }
    }

    // ‚ïê‚ïê‚ïê üìä ÏΩ§Î≥¥ Í≤åÏù¥ÏßÄ UI ‚ïê‚ïê‚ïê
    function updateComboGauge() {
      const gauge = document.getElementById('combo-gauge');
      const fill = document.getElementById('combo-gauge-fill');
      const label = document.getElementById('combo-gauge-label');
      const multiplierEl = document.getElementById('combo-multiplier');
      const comboHud = document.getElementById('hud-combo-item');
      const comboDisplay = document.getElementById('combo-display');

      if (comboCount >= 2) {
        gauge?.classList.add('visible');
        if (comboHud) { comboHud.style.display = ''; }
        if (comboDisplay) { comboDisplay.textContent = comboCount + 'x'; }

        const percent = Math.min((comboCount / 10) * 100, 100);
        if (fill) {
          fill.style.width = percent + '%';
          fill.className = 'combo-gauge-fill' + (comboCount >= 10 ? ' fever' : comboCount >= 7 ? ' hot' : '');
        }
        if (label) { label.textContent = `COMBO ${comboCount}x (${getComboMultiplier()}Î∞∞Ïú®)`; }

        // ÏΩ§Î≥¥ Î∞∞Ïú® ÌëúÏãú
        if (multiplierEl) {
          multiplierEl.textContent = `x${getComboMultiplier()}`;
          multiplierEl.classList.add('visible');
          multiplierEl.classList.toggle('mega', comboCount >= 7);
        }
      } else {
        gauge?.classList.remove('visible');
        multiplierEl?.classList.remove('visible');
        if (comboHud) { comboHud.style.display = 'none'; }
      }

      // ÏΩ§Î≥¥ Ïú†ÏßÄ ÌÉÄÏù¥Î®∏ ‚Äî 1.5Ï¥à ÌõÑ Î¶¨ÏÖã
      clearTimeout(comboGaugeTimer);
      comboGaugeTimer = setTimeout(() => {
        if (gameRunning) {
          comboCount = 0;
          gauge?.classList.remove('visible');
          multiplierEl?.classList.remove('visible');
          if (fill) fill.style.width = '0%';
          if (comboHud) { comboHud.style.display = 'none'; }
        }
      }, 2000);
    }

    function getComboMultiplier() {
      if (comboCount >= 10) return 3.0;
      if (comboCount >= 7) return 2.0;
      if (comboCount >= 5) return 1.5;
      if (comboCount >= 3) return 1.2;
      return 1.0;
    }

    // ‚ïê‚ïê‚ïê üî• ÌîºÎ≤Ñ Î™®Îìú ‚ïê‚ïê‚ïê
    function activateFeverMode() {
      if (feverMode) return;
      feverMode = true;

      // ÌîºÎ≤Ñ Ïò§Î≤ÑÎ†àÏù¥
      document.getElementById('fever-overlay')?.classList.add('active');

      // ÌîºÎ≤Ñ ÌÖçÏä§Ìä∏ Ìå°!
      const feverText = document.createElement('div');
      feverText.className = 'fever-text';
      feverText.textContent = 'üî• FEVER TIME!! üî•';
      document.body.appendChild(feverText);
      setTimeout(() => feverText.remove(), 1200);

      // ÌîºÎ≤Ñ ÏÇ¨Ïö¥Îìú (tada ÏÇ¨Ïö©)
      playGameSound('legendary');

      // ÏßÑÎèô
      if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 400]);

      // ÌÜ†Ïä§Ìä∏
      if (typeof showToast === 'function') {
        showToast('üî• FEVER TIME! 3Ï¥àÍ∞Ñ Î™®Îì† Ïø†Ìè∞Ïù¥ ÏóêÌîΩ Ïù¥ÏÉÅ!!', 'game');
      }

      // 3Ï¥à ÌõÑ Ï¢ÖÎ£å
      clearTimeout(feverTimer);
      feverTimer = setTimeout(() => {
        feverMode = false;
        document.getElementById('fever-overlay')?.classList.remove('active');
      }, 3000);
    }

    function getFeverRarity() {
      // ÌîºÎ≤Ñ Î™®Îìú Ï§ëÏóêÎäî epic+ Îßå ÎÇòÏò¥
      const rand = Math.random();
      if (rand < 0.1) return 'mythic';
      if (rand < 0.35) return 'legendary';
      return 'epic';
    }

    // ‚ïê‚ïê‚ïê ‚≠ê Í≥®Îì† Î≥¥ÎÑàÏä§ Ïø†Ìè∞ ‚ïê‚ïê‚ïê
    function spawnGoldenBonus() {
      if (!gameRunning || !gameScene) return;

      goldenCouponsSpawned++;

      // ÌÅ∞ Ìô©Í∏à Ïø†Ìè∞ ÏÉùÏÑ±
      const shape = new THREE.Shape();
      const w = 4.5, h = 3, r = 0.5;
      shape.moveTo(-w/2 + r, -h/2);
      shape.lineTo(w/2 - r, -h/2);
      shape.quadraticCurveTo(w/2, -h/2, w/2, -h/2 + r);
      shape.lineTo(w/2, h/2 - r);
      shape.quadraticCurveTo(w/2, h/2, w/2 - r, h/2);
      shape.lineTo(-w/2 + r, h/2);
      shape.quadraticCurveTo(-w/2, h/2, -w/2, h/2 - r);
      shape.lineTo(-w/2, -h/2 + r);
      shape.quadraticCurveTo(-w/2, -h/2, -w/2 + r, -h/2);

      const geometry = new THREE.ExtrudeGeometry(shape, { depth: 0.5, bevelEnabled: true, bevelThickness: 0.15, bevelSize: 0.15, bevelSegments: 5 });
      const material = new THREE.MeshStandardMaterial({
        color: 0xfbbf24,
        emissive: 0xfbbf24,
        emissiveIntensity: 0.8,
        metalness: 0.9,
        roughness: 0.1
      });

      const golden = new THREE.Mesh(geometry, material);
      golden.position.set((Math.random() - 0.5) * 30, 25, (Math.random() - 0.5) * 10);
      golden.userData = {
        active: true,
        rarity: 'legendary',
        fallSpeed: 0.02 + Math.random() * 0.02,
        isGolden: true,
        spawnTime: Date.now()
      };

      gameScene.add(golden);
      coupons.push(golden);

      // Í≥®Îì† ÌëúÏãúÍ∏∞
      const indicator = document.getElementById('golden-indicator');
      indicator?.classList.add('visible');
      setTimeout(() => indicator?.classList.remove('visible'), 3000);

      // 8Ï¥à ÌõÑ ÏÇ¨ÎùºÏßê
      setTimeout(() => {
        if (golden.userData.active) {
          golden.userData.active = false;
          golden.visible = false;
        }
      }, 8000);
    }

    // ‚ïê‚ïê‚ïê üèÜ Í≤åÏûÑ Í≤∞Í≥º Îì±Í∏â ÏãúÏä§ÌÖú ‚ïê‚ïê‚ïê
    function getGameGrade(totalScore) {
      if (totalScore >= 10000) return { grade: 'S', title: 'Ï†ÑÏÑ§Ïùò Ïø†Ìè∞ ÌóåÌÑ∞', color: 'grade-S', emoji: 'üëë' };
      if (totalScore >= 5000) return { grade: 'A', title: 'ÎßàÏä§ÌÑ∞ Ïø†Ìè∞ ÌóåÌÑ∞', color: 'grade-A', emoji: 'üåü' };
      if (totalScore >= 2000) return { grade: 'B', title: 'ÏàôÎ†®Îêú Ïø†Ìè∞ ÌóåÌÑ∞', color: 'grade-B', emoji: 'üíú' };
      if (totalScore >= 800) return { grade: 'C', title: 'ÏÑ±Ïû•ÌïòÎäî Ïø†Ìè∞ ÌóåÌÑ∞', color: 'grade-C', emoji: 'üíé' };
      return { grade: 'D', title: 'Ïø†Ìè∞ ÌóåÌÑ∞ ÏûÖÎ¨∏', color: 'grade-D', emoji: 'üéÆ' };
    }

    function showGameResult(totalScore, caughtTotal, newCouponsAdded, duplicatesUpdated) {
      const gradeInfo = getGameGrade(totalScore);
      const elapsed = Math.floor((Date.now() - gameStartRealTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;

      // Ìù¨Í∑ÄÎèÑÎ≥Ñ ÎπÑÏú® Í≥ÑÏÇ∞
      const totalRarity = Object.values(rarityCounts).reduce((a, b) => a + b, 0) || 1;

      const overlay = document.createElement('div');
      overlay.className = 'game-result-overlay';
      overlay.id = 'game-result-overlay';
      overlay.innerHTML = `
        <div class="game-result-card">
          <div style="font-size:1.2rem; color:#94a3b8; margin-bottom:0.3rem;">üéâ Í≤åÏûÑ Ï¢ÖÎ£å!</div>
          <div class="game-result-grade ${gradeInfo.color}">${gradeInfo.emoji} ${gradeInfo.grade}</div>
          <div style="color:#e2e8f0; font-size:0.9rem; margin-bottom:0.5rem;">${gradeInfo.title}</div>
          <div class="game-result-score">${totalScore.toLocaleString()}P</div>

          <div class="game-result-stats">
            <div class="result-stat">
              <div class="result-stat-label">ÌöçÎìù Ïø†Ìè∞</div>
              <div class="result-stat-value">${caughtTotal}Ïû•</div>
            </div>
            <div class="result-stat">
              <div class="result-stat-label">ÏµúÎåÄ ÏΩ§Î≥¥</div>
              <div class="result-stat-value">${maxCombo}x</div>
            </div>
            <div class="result-stat">
              <div class="result-stat-label">ÌîåÎ†àÏù¥ ÏãúÍ∞Ñ</div>
              <div class="result-stat-value">${minutes}Î∂Ñ ${seconds}Ï¥à</div>
            </div>
            <div class="result-stat">
              <div class="result-stat-label">ÏÉà Ïø†Ìè∞</div>
              <div class="result-stat-value">${newCouponsAdded}Ïû•</div>
            </div>
          </div>

          <!-- Ìù¨Í∑ÄÎèÑ Î∞î -->
          <div style="font-size:0.75rem; color:#94a3b8; text-align:left; margin-bottom:4px;">ÌöçÎìù Ïø†Ìè∞ Ìù¨Í∑ÄÎèÑ</div>
          <div class="game-result-rarity-bar">
            <div class="rarity-segment" style="width:${(rarityCounts.common/totalRarity*100)}%; background:#9ca3af;"></div>
            <div class="rarity-segment" style="width:${(rarityCounts.rare/totalRarity*100)}%; background:#3b82f6;"></div>
            <div class="rarity-segment" style="width:${(rarityCounts.epic/totalRarity*100)}%; background:#a855f7;"></div>
            <div class="rarity-segment" style="width:${(rarityCounts.legendary/totalRarity*100)}%; background:#fbbf24;"></div>
            <div class="rarity-segment" style="width:${(rarityCounts.mythic/totalRarity*100)}%; background:#ef4444;"></div>
          </div>
          <div style="display:flex; justify-content:space-between; font-size:0.65rem; color:#94a3b8; margin-bottom:1rem;">
            <span>ÏùºÎ∞ò ${rarityCounts.common}</span>
            <span style="color:#3b82f6;">Î†àÏñ¥ ${rarityCounts.rare}</span>
            <span style="color:#a855f7;">ÏóêÌîΩ ${rarityCounts.epic}</span>
            <span style="color:#fbbf24;">Ï†ÑÏÑ§ ${rarityCounts.legendary}</span>
            <span style="color:#ef4444;">Ïã†Ìôî ${rarityCounts.mythic}</span>
          </div>

          ${duplicatesUpdated > 0 ? `<div style="font-size:0.8rem; color:#94a3b8; margin-bottom:0.5rem;">üîÑ Í∏∞Ï°¥ Ïø†Ìè∞ ${duplicatesUpdated}Ïû• Í∞±Ïã† (Ï§ëÎ≥µ Î∞©ÏßÄ)</div>` : ''}

          <button onclick="document.getElementById('game-result-overlay').remove();"
                  class="btn-primary" style="width:100%; padding:0.8rem; font-size:1rem; border-radius:12px;">
            üëõ Ïø†Ìè∞ ÏßÄÍ∞ëÏúºÎ°ú ÌôïÏù∏ÌïòÍ∏∞
          </button>
        </div>
      `;

      document.body.appendChild(overlay);
    }

    function initGameAudio() {
      if (audioCtx) return;
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        // ÏÇ¨Ïö¥Îìú ÌååÏùº ÌîÑÎ¶¨Î°úÎìú (public/sounds/ Ïóê Ï°¥Ïû¨)
        ['tok', 'pung', 'tada', 'congrats'].forEach((name, i) => {
          fetch(`/sounds/${name}.mp3`).then(r => r.arrayBuffer()).then(buf => {
            audioCtx.decodeAudioData(buf, decoded => {
              const keys = ['catch', 'combo', 'legendary', 'congrats'];
              gameSounds[keys[i]] = decoded;
            });
          }).catch(() => {});
        });
      } catch(e) { console.warn('Audio init failed:', e); }
    }

    function playGameSound(type) {
      if (!audioCtx || !gameSounds[type]) return;
      try {
        const source = audioCtx.createBufferSource();
        source.buffer = gameSounds[type];
        const gain = audioCtx.createGain();
        gain.gain.value = type === 'legendary' ? 0.8 : type === 'congrats' ? 0.7 : 0.5;
        source.connect(gain);
        gain.connect(audioCtx.destination);
        source.start(0);
      } catch(e) {}
    }

    // ‚ïê‚ïê‚ïê ‚ú® ÌååÌã∞ÌÅ¥ Ìè≠Î∞ú ÏãúÏä§ÌÖú ‚ïê‚ïê‚ïê
    const explosionParticles = [];

    function createCatchExplosion(position, rarity) {
      const colors = {
        common: 0x22c55e, rare: 0x3b82f6, epic: 0xa855f7,
        legendary: 0xfbbf24, mythic: 0xef4444
      };
      const color = colors[rarity] || 0xffffff;
      const count = rarity === 'legendary' ? 60 : rarity === 'epic' ? 40 : rarity === 'mythic' ? 80 : 20;

      for (let i = 0; i < count; i++) {
        const size = rarity === 'mythic' ? 0.4 : rarity === 'legendary' ? 0.3 : 0.15;
        const geo = new THREE.SphereGeometry(size, 6, 6);
        const mat = new THREE.MeshBasicMaterial({
          color: Math.random() > 0.3 ? color : 0xffffff,
          transparent: true, opacity: 1
        });
        const particle = new THREE.Mesh(geo, mat);
        particle.position.copy(position);
        // Î∞©ÏÇ¨Ìòï ÏÜçÎèÑ
        const angle = Math.random() * Math.PI * 2;
        const speed = 0.2 + Math.random() * 0.6;
        const upSpeed = 0.1 + Math.random() * 0.4;
        particle.userData = {
          vx: Math.cos(angle) * speed,
          vy: upSpeed,
          vz: Math.sin(angle) * speed * 0.5,
          life: 1.0,
          decay: 0.015 + Math.random() * 0.02
        };
        gameScene.add(particle);
        explosionParticles.push(particle);
      }

      // üåü Ìù¨Í∑ÄÎèÑÎ≥Ñ ÌäπÏàò Ìö®Í≥º: ÎßÅ Ïù¥ÌéôÌä∏
      if (['epic', 'legendary', 'mythic'].includes(rarity)) {
        const ringGeo = new THREE.RingGeometry(0.5, 0.7, 32);
        const ringMat = new THREE.MeshBasicMaterial({
          color: color, side: THREE.DoubleSide, transparent: true, opacity: 0.8
        });
        const ring = new THREE.Mesh(ringGeo, ringMat);
        ring.position.copy(position);
        ring.userData = { vx:0, vy:0, vz:0, life:1.0, decay:0.03, isRing:true, scale:1 };
        gameScene.add(ring);
        explosionParticles.push(ring);
      }
    }

    function updateExplosionParticles() {
      for (let i = explosionParticles.length - 1; i >= 0; i--) {
        const p = explosionParticles[i];
        p.position.x += p.userData.vx;
        p.position.y += p.userData.vy;
        p.position.z += p.userData.vz;
        p.userData.vy -= 0.008; // gravity
        p.userData.life -= p.userData.decay;
        p.material.opacity = Math.max(0, p.userData.life);

        if (p.userData.isRing) {
          p.userData.scale += 0.15;
          p.scale.set(p.userData.scale, p.userData.scale, 1);
        }

        if (p.userData.life <= 0) {
          gameScene.remove(p);
          p.geometry.dispose();
          p.material.dispose();
          explosionParticles.splice(i, 1);
        }
      }
    }

    // ‚ïê‚ïê‚ïê üí¨ ÌöçÎìù ÌÖçÏä§Ìä∏ ÌåùÏóÖ ‚ïê‚ïê‚ïê
    function showCatchPopup(text, x, y, rarity) {
      const popup = document.createElement('div');
      const colors = {
        common: '#22c55e', rare: '#3b82f6', epic: '#a855f7',
        legendary: '#fbbf24', mythic: '#ef4444'
      };
      popup.style.cssText = `
        position:fixed;left:${x}px;top:${y}px;
        font-size:${rarity === 'legendary' || rarity === 'mythic' ? '24px' : '16px'};
        font-weight:900;color:${colors[rarity] || '#fff'};
        text-shadow:0 0 10px ${colors[rarity] || '#fff'}, 0 2px 4px rgba(0,0,0,0.8);
        pointer-events:none;z-index:10000;
        animation:catchPopup 1s ease-out forwards;
        font-family:'Orbitron',sans-serif;
      `;
      popup.textContent = text;
      document.body.appendChild(popup);
      setTimeout(() => popup.remove(), 1000);
    }

    // CSS for catch popup animation
    if (!document.getElementById('catch-popup-style')) {
      const style = document.createElement('style');
      style.id = 'catch-popup-style';
      style.textContent = `
        @keyframes catchPopup {
          0% { transform: translateY(0) scale(0.5); opacity: 1; }
          50% { transform: translateY(-30px) scale(1.3); opacity: 1; }
          100% { transform: translateY(-60px) scale(1); opacity: 0; }
        }
        @keyframes screenFlash {
          0% { opacity: 0.3; } 100% { opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    }

    function initGame() {
      const canvas = document.getElementById('game-canvas');

      // Ïò§ÎîîÏò§ Ï¥àÍ∏∞Ìôî
      initGameAudio();

      gameScene = new THREE.Scene();
      gameScene.background = new THREE.Color(0x050510); // üåå ÍπäÏùÄ Ïö∞Ï£ºÏÉâ

      // ÏïàÍ∞ú Ìö®Í≥ºÎ°ú ÍπäÏù¥Í∞ê
      gameScene.fog = new THREE.FogExp2(0x050510, 0.008);

      gameCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      gameCamera.position.z = 30;

      gameRenderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      gameRenderer.setSize(window.innerWidth, window.innerHeight);
      gameRenderer.setPixelRatio(window.devicePixelRatio);
      gameRenderer.toneMapping = THREE.ACESFilmicToneMapping;
      gameRenderer.toneMappingExposure = 1.2;

      const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
      gameScene.add(ambientLight);

      const pointLight = new THREE.PointLight(0x22d3ee, 1.2, 100);
      pointLight.position.set(10, 10, 10);
      gameScene.add(pointLight);

      // üåå Ïö∞Ï£º Î∞∞Í≤Ω Î≥Ñ ÏÉùÏÑ±
      createStarField();

      // üí° Îã§Ïù¥ÎÇòÎØπ Ïª¨Îü¨ ÎùºÏù¥ÌåÖ
      createDynamicLights();

      createCoupons();

      // ‚≠ê 10Ï¥àÎßàÎã§ Í≥®Îì† Î≥¥ÎÑàÏä§ Ïø†Ìè∞
      clearInterval(goldenBonusInterval);
      goldenBonusInterval = setInterval(() => {
        if (gameRunning) spawnGoldenBonus();
      }, 12000); // Ï≤´ 12Ï¥à ÌõÑÎ∂ÄÌÑ∞

      canvas.addEventListener('click', onCanvasClick);
      canvas.addEventListener('touchstart', onCanvasClick);

      animateGame();
    }
    
    // üñºÔ∏è roundRect Ìè¥Î¶¨ÌïÑ (Íµ¨Ìòï Î∏åÎùºÏö∞Ï†Ä ÎåÄÏùë)
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        if (typeof r === 'number') r = [r, r, r, r];
        const [tl, tr, br, bl] = r;
        this.moveTo(x + tl, y);
        this.lineTo(x + w - tr, y);
        this.quadraticCurveTo(x + w, y, x + w, y + tr);
        this.lineTo(x + w, y + h - br);
        this.quadraticCurveTo(x + w, y + h, x + w - br, y + h);
        this.lineTo(x + bl, y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - bl);
        this.lineTo(x, y + tl);
        this.quadraticCurveTo(x, y, x + tl, y);
        this.closePath();
        return this;
      };
    }

    // üñºÔ∏è Ïø†Ìè∞ Ï∫îÎ≤ÑÏä§ ÌÖçÏä§Ï≤ò ÏÉùÏÑ± (Ïù¥Î™®ÏßÄ+Ìï†Ïù∏+Í∞ÄÍ≤åÎ™Ö)
    function createCouponCanvasTexture(couponData) {
      const canvas = document.createElement('canvas');
      canvas.width = 360;
      canvas.height = 450;
      const ctx = canvas.getContext('2d');

      // Ìù¨Í∑ÄÎèÑÎ≥Ñ Í∑∏ÎùºÎç∞Ïù¥ÏÖò Î∞∞Í≤Ω
      const rarityGrads = {
        common: ['#374151', '#4b5563'],
        rare: ['#1e3a5f', '#2563eb'],
        epic: ['#4c1d95', '#7c3aed'],
        legendary: ['#78350f', '#f59e0b'],
        mythic: ['#7f1d1d', '#ef4444']
      };
      const colors = rarityGrads[couponData.rarity] || rarityGrads.common;
      const grad = ctx.createLinearGradient(0, 0, 0, 450);
      grad.addColorStop(0, colors[0]);
      grad.addColorStop(1, colors[1]);
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.roundRect(0, 0, 360, 450, 20);
      ctx.fill();

      // ÌÖåÎëêÎ¶¨ Î∞úÍ¥ë
      ctx.strokeStyle = colors[1];
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.roundRect(4, 4, 352, 442, 18);
      ctx.stroke();

      // Ïù¥Î™®ÏßÄ
      ctx.font = '80px serif';
      ctx.textAlign = 'center';
      ctx.fillText(couponData.store_emoji || 'üé´', 180, 120);

      // Ìï†Ïù∏ Ï†ïÎ≥¥
      ctx.font = 'bold 60px sans-serif';
      ctx.fillStyle = '#fbbf24';
      ctx.shadowColor = '#000';
      ctx.shadowBlur = 8;
      const discText = couponData.discount_type === 'percentage' ?
        couponData.discount_value + '%' : '‚Ç©' + couponData.discount_value;
      ctx.fillText(discText, 180, 220);
      ctx.shadowBlur = 0;

      // "Ìï†Ïù∏" ÎùºÎ≤®
      ctx.font = 'bold 24px sans-serif';
      ctx.fillStyle = '#fde68a';
      ctx.fillText('Ìï†Ïù∏ Ïø†Ìè∞', 180, 260);

      // Í∞ÄÍ≤åÎ™Ö
      ctx.font = 'bold 28px sans-serif';
      ctx.fillStyle = '#ffffff';
      const storeName = couponData.store_name || couponData.title || 'Îß§Ïû•';
      // Í∏¥ Ïù¥Î¶Ñ ÏûêÎ•¥Í∏∞
      const displayName = storeName.length > 10 ? storeName.substring(0, 10) + '...' : storeName;
      ctx.fillText(displayName, 180, 320);

      // Ïø†Ìè∞ Ï†úÎ™©
      ctx.font = '18px sans-serif';
      ctx.fillStyle = '#d1d5db';
      const title = (couponData.title || '').length > 14 ? couponData.title.substring(0, 14) + '...' : (couponData.title || '');
      ctx.fillText(title, 180, 360);

      // Ìù¨Í∑ÄÎèÑ Î±ÉÏßÄ
      const rarityNames = { common:'COMMON', rare:'RARE', epic:'EPIC', legendary:'LEGENDARY', mythic:'MYTHIC' };
      ctx.font = 'bold 16px sans-serif';
      const badgeW = ctx.measureText(rarityNames[couponData.rarity] || 'COMMON').width + 16;
      ctx.fillStyle = colors[1] + 'cc';
      ctx.beginPath();
      ctx.roundRect(180 - badgeW/2, 385, badgeW, 28, 8);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.fillText(rarityNames[couponData.rarity] || 'COMMON', 180, 405);

      const texture = new THREE.CanvasTexture(canvas);
      texture.encoding = THREE.sRGBEncoding;
      return texture;
    }

    function createCoupons() {
      coupons = [];

      // ‚≠ê ÏäπÏù∏Îêú Îß§Ïû• Ïø†Ìè∞Îßå Í≤åÏûÑÏóê Î∞∞Ìè¨
      const approvedCoupons = gameIssuedCoupons.filter(c => c.status === 'approved' && c.remaining > 0);

      approvedCoupons.forEach((issuedCoupon, index) => {
        const rarityColor = rarities[issuedCoupon.rarity].color;

        // üñºÔ∏è Ï∫îÎ≤ÑÏä§ ÌÖçÏä§Ï≤òÎ°ú Ïø†Ìè∞ Ïπ¥Îìú ÏÉùÏÑ±!
        const canvasTexture = createCouponCanvasTexture(issuedCoupon);

        // Ïπ¥Îìú Î≥∏Ï≤¥ (ÏñáÏùÄ Ìåê ‚Äî ÏòÜÎ©¥ ÏÉâÏÉÅ)
        const cardShape = new THREE.Shape();
        const w = 4, h = 5, r = 0.3;
        cardShape.moveTo(-w/2 + r, -h/2);
        cardShape.lineTo(w/2 - r, -h/2);
        cardShape.quadraticCurveTo(w/2, -h/2, w/2, -h/2 + r);
        cardShape.lineTo(w/2, h/2 - r);
        cardShape.quadraticCurveTo(w/2, h/2, w/2 - r, h/2);
        cardShape.lineTo(-w/2 + r, h/2);
        cardShape.quadraticCurveTo(-w/2, h/2, -w/2, h/2 - r);
        cardShape.lineTo(-w/2, -h/2 + r);
        cardShape.quadraticCurveTo(-w/2, -h/2, -w/2 + r, -h/2);
        const bodyGeo = new THREE.ExtrudeGeometry(cardShape, {
          depth: 0.15, bevelEnabled: true, bevelThickness: 0.05, bevelSize: 0.05, bevelSegments: 2
        });
        const bodyMat = new THREE.MeshStandardMaterial({
          color: rarityColor, emissive: rarityColor,
          emissiveIntensity: 0.5, metalness: 0.7, roughness: 0.2
        });
        const body = new THREE.Mesh(bodyGeo, bodyMat);

        // ÏïûÎ©¥ Ïù¥ÎØ∏ÏßÄ (PlaneGeometryÏóê Ï∫îÎ≤ÑÏä§ ÌÖçÏä§Ï≤ò)
        const faceGeo = new THREE.PlaneGeometry(w - 0.2, h - 0.2);
        const faceMat = new THREE.MeshStandardMaterial({
          map: canvasTexture, transparent: false,
          emissive: rarityColor, emissiveIntensity: 0.1,
          metalness: 0.2, roughness: 0.5
        });
        const face = new THREE.Mesh(faceGeo, faceMat);
        face.position.z = 0.22; // Î≥∏Ï≤¥ ÏïûÏóê ÏÇ¥Ïßù

        // Í∑∏Î£πÏúºÎ°ú Î¨∂Í∏∞
        const coupon = new THREE.Group();
        coupon.add(body);
        coupon.add(face);
        
        coupon.position.x = (Math.random() - 0.5) * 40;
        coupon.position.y = Math.random() * 40 - 10;
        coupon.position.z = (Math.random() - 0.5) * 20;
        
        coupon.userData = {
          rarity: issuedCoupon.rarity,
          fallSpeed: 0.02 + Math.random() * 0.025,
          active: true,
          issuedCoupon: issuedCoupon,
          isRealCoupon: true,
          // üåä ÌùîÎì§Í±∞Î¶º ÌååÎùºÎØ∏ÌÑ∞
          wobbleSpeed: 0.5 + Math.random() * 1.5,
          wobbleAmount: 0.3 + Math.random() * 0.5,
          wobbleOffset: Math.random() * Math.PI * 2,
          spinSpeed: 0.005 + Math.random() * 0.015,
          floatPhase: Math.random() * Math.PI * 2
        };
        
        gameScene.add(coupon);
        coupons.push(coupon);
      });
      
      // ÎÇòÎ®∏ÏßÄÎäî Í∏∞Î≥∏ Ïø†Ìè∞ÏúºÎ°ú Ï±ÑÏö∞Í∏∞ (8~10Í∞ú ‚Äî Ï†ÅÎãπÌûà Îñ®Ïñ¥ÏßÄÍ≤å)
      const minCoupons = 8;
      for (let i = coupons.length; i < minCoupons; i++) {
        const rand = Math.random();
        let rarity, randomCoupon;
        
        if (rand < 0.70) {
          rarity = 'common';
          randomCoupon = { ...gameIssuedCoupons[3] }; // 10% Ìï†Ïù∏
        } else if (rand < 0.90) {
          rarity = 'rare';
          randomCoupon = { ...gameIssuedCoupons[2] }; // ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë
        } else if (rand < 0.97) {
          rarity = 'epic';
          randomCoupon = { ...gameIssuedCoupons[0] }; // ÏïÑÎØ∏ ÌïúÏ†ïÏãù 30%
        } else if (rand < 0.995) {
          rarity = 'legendary';
          randomCoupon = { ...gameIssuedCoupons[1] }; // ÏïÑÎØ∏ Îã§Î∞© 50%
        } else {
          rarity = 'mythic';
          randomCoupon = { ...gameIssuedCoupons[4] }; // 100% Î¨¥Î£å!
        }
        
        // üñºÔ∏è Ï∫îÎ≤ÑÏä§ ÌÖçÏä§Ï≤ò Ïø†Ìè∞ Ïπ¥Îìú
        const fillRarityColor = rarities[rarity].color;
        const fillCouponData = { ...randomCoupon, rarity: rarity };
        const fillTexture = createCouponCanvasTexture(fillCouponData);

        // Î≥∏Ï≤¥
        const fShape = new THREE.Shape();
        const fw = 4, fh = 5, fr = 0.3;
        fShape.moveTo(-fw/2+fr,-fh/2); fShape.lineTo(fw/2-fr,-fh/2);
        fShape.quadraticCurveTo(fw/2,-fh/2,fw/2,-fh/2+fr); fShape.lineTo(fw/2,fh/2-fr);
        fShape.quadraticCurveTo(fw/2,fh/2,fw/2-fr,fh/2); fShape.lineTo(-fw/2+fr,fh/2);
        fShape.quadraticCurveTo(-fw/2,fh/2,-fw/2,fh/2-fr); fShape.lineTo(-fw/2,-fh/2+fr);
        fShape.quadraticCurveTo(-fw/2,-fh/2,-fw/2+fr,-fh/2);
        const fBodyGeo = new THREE.ExtrudeGeometry(fShape, {
          depth: 0.15, bevelEnabled: true, bevelThickness: 0.05, bevelSize: 0.05, bevelSegments: 2
        });
        const fBody = new THREE.Mesh(fBodyGeo, new THREE.MeshStandardMaterial({
          color: fillRarityColor, emissive: fillRarityColor, emissiveIntensity: 0.5, metalness: 0.7, roughness: 0.2
        }));

        // ÏïûÎ©¥ Ïù¥ÎØ∏ÏßÄ
        const fFace = new THREE.Mesh(
          new THREE.PlaneGeometry(fw - 0.2, fh - 0.2),
          new THREE.MeshStandardMaterial({ map: fillTexture, emissive: fillRarityColor, emissiveIntensity: 0.1, metalness: 0.2, roughness: 0.5 })
        );
        fFace.position.z = 0.22;

        const coupon = new THREE.Group();
        coupon.add(fBody);
        coupon.add(fFace);

        coupon.position.x = (Math.random() - 0.5) * 40;
        coupon.position.y = Math.random() * 40 - 10;
        coupon.position.z = (Math.random() - 0.5) * 20;

        coupon.userData = {
          rarity: rarity,
          fallSpeed: 0.02 + Math.random() * 0.025,
          active: true,
          issuedCoupon: randomCoupon,
          isRealCoupon: true,
          // üåä ÌùîÎì§Í±∞Î¶º ÌååÎùºÎØ∏ÌÑ∞
          wobbleSpeed: 0.5 + Math.random() * 1.5,
          wobbleAmount: 0.3 + Math.random() * 0.5,
          wobbleOffset: Math.random() * Math.PI * 2,
          spinSpeed: 0.005 + Math.random() * 0.015,
          floatPhase: Math.random() * Math.PI * 2
        };
        
        gameScene.add(coupon);
        coupons.push(coupon);
      }
    }
    
    function animateGame() {
      if (!gameRunning) return;

      animationId = requestAnimationFrame(animateGame);

      const time = Date.now();

      const elapsed = time * 0.001; // Ï¥à Îã®ÏúÑ

      coupons.forEach((coupon) => {
        if (coupon.userData.active) {
          const ud = coupon.userData;

          // üåä ÎÇòÎ≠áÏûéÏ≤òÎüº ÌùîÎì§Í±∞Î¶¨Î©∞ Îñ®Ïñ¥ÏßÄÍ∏∞!
          coupon.position.y -= ud.fallSpeed;

          // Ï¢åÏö∞ Ïõ®Ïù¥Î∏å (ÏÇ¨Ïù∏Ìåå ‚Äî ÎÇòÎ≠áÏûéÏù¥ Î∞îÎûåÏóê ÎÇ†Î¶¨ÎìØ)
          coupon.position.x += Math.sin(elapsed * ud.wobbleSpeed + ud.wobbleOffset) * ud.wobbleAmount * 0.03;

          // ZÏ∂ï ÎØ∏ÏÑ∏ ÌùîÎì§Î¶º (ÍπäÏù¥Í∞ê)
          coupon.position.z += Math.cos(elapsed * ud.wobbleSpeed * 0.7 + ud.floatPhase) * 0.01;

          // ÌöåÏ†Ñ: Îí§ÏßëÌûàÎ©∞ Îñ®Ïñ¥ÏßÄÎäî ÎäêÎÇå
          coupon.rotation.x += ud.spinSpeed;
          coupon.rotation.y += ud.spinSpeed * 1.5;
          coupon.rotation.z = Math.sin(elapsed * ud.wobbleSpeed + ud.wobbleOffset) * 0.15; // Ï¢åÏö∞ Í∏∞Ïö∏ÏûÑ

          // ‚≠ê Í≥®Îì† Ïø†Ìè∞ ÌäπÏàò Ìö®Í≥º
          if (ud.isGolden) {
            coupon.rotation.y += 0.03;
            const pulse = 0.5 + Math.sin(time * 0.005) * 0.3;
            coupon.material.emissiveIntensity = pulse;
            coupon.scale.setScalar(1 + Math.sin(time * 0.003) * 0.1);
          }

          // üî• Ïû¨Ïä§Ìè∞ (ÌôîÎ©¥ ÏïÑÎûòÎ°ú Îπ†ÏßÄÎ©¥ ÏúÑÏóêÏÑú Îã§Ïãú)
          if (coupon.position.y < -20) {
            coupon.position.y = 22 + Math.random() * 8;
            coupon.position.x = (Math.random() - 0.5) * 40;
            coupon.position.z = (Math.random() - 0.5) * 20;

            // ÌîºÎ≤Ñ Î™®Îìú: Ìù¨Í∑ÄÎèÑ Ïò§Î≤ÑÎùºÏù¥Îìú
            if (feverMode && !ud.isGolden) {
              const newRarity = getFeverRarity();
              ud.rarity = newRarity;
              const rarityColor = rarities[newRarity]?.color || 0xffffff;
              coupon.material.color.setHex(rarityColor);
              coupon.material.emissive.setHex(rarityColor);
              coupon.material.emissiveIntensity = 0.4;
            }

            ud.active = true;
            coupon.visible = true;
          }
        }
      });

      // üåå Ïö∞Ï£º Î∞∞Í≤Ω + Îã§Ïù¥ÎÇòÎØπ ÎùºÏù¥ÌåÖ ÏóÖÎç∞Ïù¥Ìä∏
      updateStarField(time);
      updateDynamicLighting(time);

      // ‚ú® ÌååÌã∞ÌÅ¥ Ìè≠Î∞ú ÏóÖÎç∞Ïù¥Ìä∏
      updateExplosionParticles();

      gameRenderer.render(gameScene, gameCamera);
    }

    function onCanvasClick(event) {
      event.preventDefault();
      
      const canvas = document.getElementById('game-canvas');
      const rect = canvas.getBoundingClientRect();
      
      const x = event.clientX || event.touches[0].clientX;
      const y = event.clientY || event.touches[0].clientY;
      
      const mouse = new THREE.Vector2(
        ((x - rect.left) / rect.width) * 2 - 1,
        -((y - rect.top) / rect.height) * 2 + 1
      );
      
      const raycaster = new THREE.Raycaster();
      raycaster.setFromCamera(mouse, gameCamera);
      
      const intersects = raycaster.intersectObjects(coupons, true);

      if (intersects.length > 0) {
        // Group ÏïàÏùò meshÍ∞Ä ÌûàÌä∏Îê† Ïàò ÏûàÏúºÎØÄÎ°ú Î∂ÄÎ™® Group Ï∞æÍ∏∞
        let hitCoupon = intersects[0].object;
        while (hitCoupon && !hitCoupon.userData.active && hitCoupon.parent && hitCoupon.parent !== gameScene) {
          hitCoupon = hitCoupon.parent;
        }
        if (hitCoupon && hitCoupon.userData && hitCoupon.userData.active) {
          catchCoupon(hitCoupon);
        }
      }
    }
    
    function catchCoupon(coupon) {
      coupon.userData.active = false;
      coupon.visible = false;
      // GroupÏù∏ Í≤ΩÏö∞ ÏûêÏãùÎèÑ Ïà®ÍπÄ
      if (coupon.children) coupon.children.forEach(c => c.visible = false);

      const rarity = coupon.userData.rarity;
      const basePoints = rarities[rarity].score;

      // üîä ÏΩ§Î≥¥ ÏãúÏä§ÌÖú
      const now = Date.now();
      if (now - lastCatchTime < 1500) {
        comboCount++;
      } else {
        comboCount = 1;
      }
      lastCatchTime = now;
      if (comboCount > maxCombo) maxCombo = comboCount;

      // üìä ÏΩ§Î≥¥ Î∞∞Ïú® Ï†êÏàò!
      const multiplier = getComboMultiplier();
      const points = Math.round(basePoints * multiplier);
      score += points;
      caughtCount++;

      // üìä Ìù¨Í∑ÄÎèÑ Ïπ¥Ïö¥Ìä∏
      rarityCounts[rarity] = (rarityCounts[rarity] || 0) + 1;

      // üìä ÏΩ§Î≥¥ Í≤åÏù¥ÏßÄ UI ÏóÖÎç∞Ïù¥Ìä∏
      updateComboGauge();

      // üî• 10ÏΩ§Î≥¥ ‚Üí ÌîºÎ≤Ñ Î™®Îìú Î∞úÎèô!
      if (comboCount >= 10 && !feverMode) {
        activateFeverMode();
      }

      // ‚ú® ÌååÌã∞ÌÅ¥ Ìè≠Î∞ú!
      createCatchExplosion(coupon.position.clone(), rarity);

      // üîä ÏÇ¨Ïö¥Îìú ‚Äî Ìù¨Í∑ÄÎèÑÎ≥Ñ Ï∞®Îì±
      if (rarity === 'legendary' || rarity === 'mythic') {
        playGameSound('legendary'); // tada.mp3
        // ÌôîÎ©¥ ÌîåÎûòÏãú Ìö®Í≥º
        const flash = document.createElement('div');
        flash.style.cssText = `position:fixed;top:0;left:0;width:100%;height:100%;background:${rarity==='mythic'?'rgba(239,68,68,0.3)':'rgba(251,191,36,0.3)'};z-index:9998;pointer-events:none;animation:screenFlash 0.5s ease-out forwards;`;
        document.body.appendChild(flash);
        setTimeout(() => flash.remove(), 500);
      } else if (comboCount >= 3) {
        playGameSound('combo'); // pung.mp3
      } else {
        playGameSound('catch'); // tok.mp3
      }

      // üí¨ ÌöçÎìù ÌÖçÏä§Ìä∏ ÌåùÏóÖ (Î∞∞Ïú® ÌëúÏãú Ìè¨Ìï®)
      const multiplierText = multiplier > 1 ? ` (x${multiplier})` : '';
      const popupTexts = {
        common: `+${points}P${multiplierText}`,
        rare: `‚ú® +${points}P${multiplierText}`,
        epic: `üî• EPIC! +${points}P${multiplierText}`,
        legendary: `üëë LEGENDARY!! +${points}P${multiplierText}`,
        mythic: `üíé MYTHIC!!! +${points}P${multiplierText}`
      };
      const rect = document.getElementById('game-canvas')?.getBoundingClientRect();
      if (rect) {
        const screenX = (coupon.position.x / 20 + 0.5) * rect.width + rect.left;
        const screenY = (-coupon.position.y / 15 + 0.5) * rect.height + rect.top;
        showCatchPopup(popupTexts[rarity] || `+${points}P`, screenX, screenY, rarity);
        if (comboCount >= 3) {
          setTimeout(() => showCatchPopup(`üî• ${comboCount}x COMBO!`, screenX, screenY - 30, 'epic'), 200);
        }
      }

      // ÏÇ¨ÏóÖÏûê Î∞úÍ∏â Ïø†Ìè∞Ïù∏ Í≤ΩÏö∞
      if (coupon.userData.issuedCoupon) {
        // ‚≠ê ÏûîÏó¨ÏàòÎüâ Í∞êÏÜå
        const issuedCoupon = coupon.userData.issuedCoupon;
        if (issuedCoupon.remaining > 0) {
          issuedCoupon.remaining--;

          // gameIssuedCouponsÏóêÏÑúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
          const original = gameIssuedCoupons.find(c => c.id === issuedCoupon.id);
          if (original) {
            original.remaining--;
          }
        }

        caughtCoupons.push({
          ...issuedCoupon,
          score: points
        });
      } else {
        caughtCoupons.push({
          rarity: rarity,
          name: rarities[rarity].name,
          score: points
        });
      }

      updateHUD();

      if (navigator.vibrate) {
        navigator.vibrate(rarity === 'legendary' ? [100, 50, 200] : rarity === 'mythic' ? [100, 50, 100, 50, 300] : 100);
      }

      // ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º (Ìù¨Í∑Ä Ïù¥ÏÉÅ)
      if (['rare', 'epic', 'legendary', 'mythic'].includes(rarity) && typeof showToast === 'function') {
        showToast(`${rarities[rarity].name} Ïø†Ìè∞ ÌöçÎìù! +${points}P`, 'coupon');
      }
    }
    
    function updateHUD() {
      document.getElementById('score').textContent = score.toLocaleString();
      document.getElementById('caught').textContent = caughtCount;
    }
    
    function endGame() {
      gameRunning = false;
      clearInterval(timerInterval);
      clearInterval(goldenBonusInterval);
      clearTimeout(feverTimer);
      clearTimeout(comboGaugeTimer);

      // üîä Í≤åÏûÑ Ï¢ÖÎ£å ÏÇ¨Ïö¥Îìú
      playGameSound('congrats');
      comboCount = 0;
      feverMode = false;

      if (animationId) {
        cancelAnimationFrame(animationId);
      }

      // ÌååÌã∞ÌÅ¥ Ï†ïÎ¶¨
      explosionParticles.forEach(p => { gameScene.remove(p); p.geometry.dispose(); p.material.dispose(); });
      explosionParticles.length = 0;

      // UI Ï†ïÎ¶¨
      document.getElementById('fever-overlay')?.classList.remove('active');
      document.getElementById('combo-gauge')?.classList.remove('visible');
      document.getElementById('combo-multiplier')?.classList.remove('visible');
      document.getElementById('golden-indicator')?.classList.remove('visible');

      document.getElementById('game-container').classList.remove('active');

      // üéØ Ï§ëÎ≥µ Î∞©ÏßÄ: Îß§Ïû•ID + Ìï†Ïù∏ÌÉÄÏûÖ + Ìï†Ïù∏Í∞í Í∏∞Ï§Ä
      let newCouponsAdded = 0;
      let duplicatesUpdated = 0;

      caughtCoupons.forEach((c, i) => {
        const storeId = c.store_id || 'game';
        const discountType = c.discount_type || 'percentage';
        const discountValue = c.discount_value || (c.score / 100);

        // Ï§ëÎ≥µ ÌÇ§ ÏÉùÏÑ±: store_id|discount_type|discount_value
        const uniqueKey = `${storeId}|${discountType}|${discountValue}`;

        // Í∏∞Ï°¥ Ïø†Ìè∞ Ï§ë Í∞ôÏùÄ ÌÇ§Í∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
        const existingIndex = allCoupons.findIndex(coupon => {
          const existingKey = `${coupon.store_id || 'game'}|${coupon.discount_type || 'percentage'}|${coupon.discount_value}`;
          return existingKey === uniqueKey && !coupon.is_used;
        });

        if (existingIndex !== -1) {
          // üîÑ Ï§ëÎ≥µ: ÎÇ†Ïßú/ÏãúÍ∞ÑÎßå ÏóÖÎç∞Ïù¥Ìä∏
          allCoupons[existingIndex].acquired_at = new Date().toISOString();
          allCoupons[existingIndex].updated_at = new Date().toISOString();
          duplicatesUpdated++;
        } else {
          // ‚úÖ ÏÉà Ïø†Ìè∞ Ï∂îÍ∞Ä
          const now = new Date().toISOString();
          if (c.title && (c.business_name || c.store_name)) {
            allCoupons.push({
              id: 'caught-' + Date.now() + '-' + i,
              title: c.title,
              rarity: c.rarity,
              discount_value: discountValue,
              discount_type: discountType,
              business_name: c.business_name || c.store_name,
              store_name: c.store_name,
              store_id: c.store_id,
              store_emoji: c.store_emoji || 'üè™',
              image_url: c.image_url || null,
              website_url: c.website_url || null,
              is_used: false,
              acquired_at: now,
              updated_at: now
            });
          } else {
            allCoupons.push({
              id: 'game-' + Date.now() + '-' + i,
              title: c.name,
              rarity: c.rarity,
              discount_value: discountValue,
              discount_type: 'percentage',
              business_name: 'Í≤åÏûÑ Î≥¥ÏÉÅ',
              store_id: 'game',
              store_emoji: 'üéÆ',
              image_url: null,
              website_url: null,
              is_used: false,
              acquired_at: now,
              updated_at: now
            });
          }
          newCouponsAdded++;
        }
      });

      // üèÜ Îì±Í∏â Í≤∞Í≥º ÌôîÎ©¥! (alert ÎåÄÏã†)
      showGameResult(score, caughtCount, newCouponsAdded, duplicatesUpdated);

      // localStorage Ï†ÄÏû•
      localStorage.setItem('allCoupons', JSON.stringify(allCoupons));
    }
    
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      
      if (gameCamera && gameRenderer) {
        gameCamera.aspect = window.innerWidth / window.innerHeight;
        gameCamera.updateProjectionMatrix();
        gameRenderer.setSize(window.innerWidth, window.innerHeight);
      }
    });
    
    // Ï¥àÍ∏∞Ìôî
    updateUserUI();
    if (authToken && !currentUser) {
      currentUser = { name: 'ÏÇ¨Ïö©Ïûê' };
      updateUserUI();
    }
    
    // ÌÜ†ÎÅº Ïï†ÎãàÎ©îÏù¥ÏÖò
    setInterval(() => {
      const rabbit = document.getElementById('rabbit-emoji');
      rabbit.classList.add('rabbit-animation');
      setTimeout(() => rabbit.classList.remove('rabbit-animation'), 600);
    }, 10000);
    
    // ===== ÏÜåÏÖú Î°úÍ∑∏Ïù∏ =====
    
    // Ïπ¥Ïπ¥Ïò§ Ï¥àÍ∏∞Ìôî
    if (window.Kakao && !window.Kakao.isInitialized()) {
      Kakao.init('83d9c34ecc23c2afbe38942083db7338'); // PetCTT Ïπ¥Ïπ¥Ïò§ ÌÇ§
    }
    
    // ÎÑ§Ïù¥Î≤Ñ Ï¥àÍ∏∞Ìôî
    const naverLogin = new naver.LoginWithNaverId({
      clientId: "Yj5T9606wVLFNlOPBBtR", // PetCTT ÎÑ§Ïù¥Î≤Ñ ÌÇ§
      callbackUrl: window.location.origin + "/callback",
      isPopup: false,
      loginButton: { color: "green", type: 3, height: 50 }
    });
    
    // ‚≠ê Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ (Supabase Auth OAuth Redirect Î∞©Ïãù ‚Äî ÏßÅÏ†ë Î¶¨Îã§Ïù¥Î†âÌä∏)
    async function loginWithGoogle() {
      try {
        console.log('[Google OAuth] Î°úÍ∑∏Ïù∏ ÏãúÏûë...');

        // ÌòÑÏû¨ ÏÉÅÌÉúÎ•º sessionStorageÏóê Ï†ÄÏû• (Î¶¨Îã§Ïù¥Î†âÌä∏ ÌõÑ Î≥µÏõêÏö©)
        sessionStorage.setItem('airctt_auth_pending', 'google');
        sessionStorage.setItem('airctt_auth_time', Date.now().toString());

        // Supabase AuthÏùò OAuth redirect Î∞©Ïãù ÏÇ¨Ïö©
        // redirect_to: Ïù∏Ï¶ù ÏôÑÎ£å ÌõÑ ÎèåÏïÑÏò¨ URL (Ïö∞Î¶¨ ÌéòÏù¥ÏßÄ)
        var currentUrl = window.location.origin + window.location.pathname;
        var redirectTo = currentUrl;

        var authUrl = SUPABASE_PROJECT_URL + '/auth/v1/authorize?provider=google&redirect_to=' + encodeURIComponent(redirectTo);

        console.log('[Google OAuth] Redirect URL:', authUrl);
        console.log('[Google OAuth] ÎèåÏïÑÏò¨ URL:', redirectTo);

        // ÏßÅÏ†ë Î¶¨Îã§Ïù¥Î†âÌä∏ (Í∞ÄÏû• ÏïàÏ†ïÏ†Å)
        window.location.href = authUrl;

      } catch (error) {
        console.error('[Google OAuth] Error:', error);
        sessionStorage.removeItem('airctt_auth_pending');
        showToast('Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ïò§Î•ò: ' + error.message, 'error');
      }
    }

    // Supabase Auth ÏΩúÎ∞± Ìï¥Ïãú ÌååÏã±
    function parseAuthHashAndLogin(hash) {
      try {
        if (!hash || hash.length < 2) return false;
        console.log('[Google OAuth] Ìï¥Ïãú ÌååÏã± ÏãúÏûë:', hash.substring(0, 50) + '...');

        var params = new URLSearchParams(hash.substring(1));
        var accessToken = params.get('access_token');
        var tokenType = params.get('token_type');
        var refreshToken = params.get('refresh_token');

        if (!accessToken) {
          console.log('[Google OAuth] access_token ÏóÜÏùå');
          // ÏóêÎü¨ ÌôïÏù∏
          var error = params.get('error');
          var errorDesc = params.get('error_description');
          if (error) {
            console.error('[Google OAuth] Ïù∏Ï¶ù ÏóêÎü¨:', error, errorDesc);
            showToast('Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + (errorDesc || error), 'error');
          }
          return false;
        }

        console.log('[Google OAuth] access_token ÌôïÏù∏Îê®, ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏöîÏ≤≠...');

        // SupabaseÏóêÏÑú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
        fetch(SUPABASE_PROJECT_URL + '/auth/v1/user', {
          headers: {
            'apikey': SUPABASE_ANON,
            'Authorization': 'Bearer ' + accessToken
          }
        })
        .then(function(r) {
          console.log('[Google OAuth] User API ÏùëÎãµ:', r.status);
          return r.json();
        })
        .then(function(user) {
          console.log('[Google OAuth] ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥:', user.email, user.user_metadata?.full_name);

          // ÏÑ∏ÏÖò ÌÜ†ÌÅ∞ Ï†ÄÏû• (ÎÇòÏ§ëÏóê Supabase Ïó∞ÎèôÏóê ÏÇ¨Ïö©)
          if (accessToken) {
            sessionStorage.setItem('airctt_supabase_token', accessToken);
            if (refreshToken) sessionStorage.setItem('airctt_supabase_refresh', refreshToken);
          }

          handleSocialLoginSuccess({
            provider: 'google',
            email: user.email || 'user@gmail.com',
            name: user.user_metadata?.full_name || user.user_metadata?.name || 'Íµ¨Í∏ÄÏÇ¨Ïö©Ïûê',
            picture: user.user_metadata?.avatar_url || user.user_metadata?.picture
          });

          showToast('üéâ Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ! ' + (user.user_metadata?.full_name || user.email), 'success');
        })
        .catch(function(err) {
          console.error('[Google OAuth] User fetch error:', err);
          // ÌÜ†ÌÅ∞ÏùÄ ÏûàÏßÄÎßå ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ïã§Ìå® Ïãú Í∏∞Î≥∏Í∞íÏúºÎ°ú Î°úÍ∑∏Ïù∏
          handleSocialLoginSuccess({
            provider: 'google',
            email: 'user@gmail.com',
            name: 'Íµ¨Í∏ÄÏÇ¨Ïö©Ïûê'
          });
          showToast('Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ ÏôÑÎ£å (Í∏∞Î≥∏ ÌîÑÎ°úÌïÑ)', 'success');
        });

        return true;
      } catch (error) {
        console.error('[Google OAuth] Parse auth hash error:', error);
        return false;
      }
    }

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú OAuth ÏΩúÎ∞± ÌôïÏù∏ (Î¶¨Îã§Ïù¥Î†âÌä∏ Î∞©ÏãùÏö©)
    function checkSupabaseAuthCallback() {
      try {
        var hash = window.location.hash;
        var search = window.location.search;

        console.log('[OAuth Check] hash:', hash ? hash.substring(0, 60) + '...' : '(ÏóÜÏùå)');
        console.log('[OAuth Check] search:', search || '(ÏóÜÏùå)');
        console.log('[OAuth Check] pending:', sessionStorage.getItem('airctt_auth_pending'));

        // Ìï¥ÏãúÏóê access_tokenÏù¥ ÏûàÏúºÎ©¥ ÌååÏã±
        if (hash && hash.indexOf('access_token') > -1) {
          console.log('[OAuth Check] ‚úÖ access_token Î∞úÍ≤¨! Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ Ï§ë...');
          var success = parseAuthHashAndLogin(hash);
          if (success) {
            // URL Ï†ïÎ¶¨ (Ìï¥Ïãú + ÏøºÎ¶¨ Ï†úÍ±∞)
            history.replaceState(null, '', window.location.pathname);
            sessionStorage.removeItem('airctt_auth_pending');
            sessionStorage.removeItem('airctt_auth_time');
          }
          return;
        }

        // Ìï¥ÏãúÏóê errorÍ∞Ä ÏûàÏúºÎ©¥ ÏóêÎü¨ ÌëúÏãú
        if (hash && hash.indexOf('error') > -1) {
          var errorParams = new URLSearchParams(hash.substring(1));
          var error = errorParams.get('error');
          var errorDesc = errorParams.get('error_description');
          console.error('[OAuth Check] ‚ùå Ïù∏Ï¶ù ÏóêÎü¨:', error, errorDesc);
          showToast('Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + (errorDesc || error), 'error');
          history.replaceState(null, '', window.location.pathname);
          sessionStorage.removeItem('airctt_auth_pending');
          return;
        }

        // pending ÏÉÅÌÉúÏù¥ÏßÄÎßå ÌÜ†ÌÅ∞ ÏóÜÎäî Í≤ΩÏö∞ (ÌÉÄÏûÑÏïÑÏõÉ Ï≤¥ÌÅ¨)
        var pending = sessionStorage.getItem('airctt_auth_pending');
        var authTime = sessionStorage.getItem('airctt_auth_time');
        if (pending && authTime) {
          var elapsed = Date.now() - parseInt(authTime);
          if (elapsed > 120000) { // 2Î∂Ñ ÌÉÄÏûÑÏïÑÏõÉ
            console.log('[OAuth Check] ‚è∞ Ïù∏Ï¶ù ÌÉÄÏûÑÏïÑÏõÉ (2Î∂Ñ Ï¥àÍ≥º)');
            sessionStorage.removeItem('airctt_auth_pending');
            sessionStorage.removeItem('airctt_auth_time');
          }
        }

      } catch(e) {
        console.error('[OAuth Check] Error:', e);
      }
    }
    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏΩúÎ∞± Ï≤¥ÌÅ¨ (Ï¶âÏãú Ïã§Ìñâ)
    checkSupabaseAuthCallback();
    
    // Ïπ¥Ïπ¥Ïò§ Î°úÍ∑∏Ïù∏
    async function loginWithKakao() {
      try {
        Kakao.Auth.login({
          success: async function(authObj) {
            Kakao.API.request({
              url: '/v2/user/me',
              success: async function(response) {
                handleSocialLoginSuccess({
                  provider: 'kakao',
                  email: response.kakao_account?.email || 'user@kakao.com',
                  name: response.properties?.nickname || 'Ïπ¥Ïπ¥Ïò§ÏÇ¨Ïö©Ïûê',
                  picture: response.properties?.profile_image
                });
              },
              fail: function(error) {
                console.error('Kakao user info error:', error);
              }
            });
          },
          fail: function(error) {
            console.error('Kakao login error:', error);
            handleSocialLoginSuccess({
              provider: 'kakao',
              email: 'user@kakao.com',
              name: 'Ïπ¥Ïπ¥Ïò§ÏÇ¨Ïö©Ïûê'
            });
          }
        });
      } catch (error) {
        console.error('Kakao init error:', error);
        handleSocialLoginSuccess({
          provider: 'kakao',
          email: 'user@kakao.com',
          name: 'Ïπ¥Ïπ¥Ïò§ÏÇ¨Ïö©Ïûê'
        });
      }
    }
    
    // ÎÑ§Ïù¥Î≤Ñ Î°úÍ∑∏Ïù∏
    async function loginWithNaver() {
      try {
        const naverLoginBtn = document.getElementById('naverIdLogin')?.firstChild;
        if (naverLoginBtn) {
          naverLoginBtn.click();
        } else {
          handleSocialLoginSuccess({
            provider: 'naver',
            email: 'user@naver.com',
            name: 'ÎÑ§Ïù¥Î≤ÑÏÇ¨Ïö©Ïûê'
          });
        }
      } catch (error) {
        console.error('Naver login error:', error);
        handleSocialLoginSuccess({
          provider: 'naver',
          email: 'user@naver.com',
          name: 'ÎÑ§Ïù¥Î≤ÑÏÇ¨Ïö©Ïûê'
        });
      }
    }
    
    // ÏÜåÏÖú Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ Ï≤òÎ¶¨
    function handleSocialLoginSuccess(data) {
      currentUser = {
        email: data.email,
        name: data.name,
        picture: data.picture,
        provider: data.provider
      };
      
      if (data.token) {
        authToken = data.token;
        localStorage.setItem('token', authToken);
      }
      
      updateUserUI();
      alert(`${data.provider.toUpperCase()} Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!\nÌôòÏòÅÌï©ÎãàÎã§, ${data.name}Îãò!`);
      showPage('home');
    }
    
    // ===== üè™ Îß§Ïû• ÎåÄÏãúÎ≥¥Îìú =====
    function showStoreDashboard(tab) {
      // Î™®Îì† ÎåÄÏãúÎ≥¥Îìú Ïà®Í∏∞Í∏∞
      ['overview', 'reservation', 'sales', 'purchase', 'revenue'].forEach(t => {
        const content = document.getElementById('dash-content-' + t);
        const btn = document.getElementById('dash-tab-' + t);
        if (content) content.style.display = 'none';
        if (btn) btn.className = 'px-4 py-2 bg-gray-700 rounded font-bold';
      });
      
      // ÏÑ†ÌÉùÎêú ÌÉ≠ Î≥¥Ïù¥Í∏∞
      const selectedContent = document.getElementById('dash-content-' + tab);
      const selectedBtn = document.getElementById('dash-tab-' + tab);
      if (selectedContent) selectedContent.style.display = 'block';
      if (selectedBtn) selectedBtn.className = 'px-4 py-2 bg-cyan-500 rounded font-bold';
    }
    
    // ===== üì• Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú =====
    function downloadReport(type) {
      const reportNames = {
        'coupons': 'Ïø†Ìè∞_Î∞úÍ∏â_ÌòÑÌô©',
        'used': 'Ïø†Ìè∞_ÏÇ¨Ïö©_ÎÇ¥Ïó≠',
        'today': 'Ïò§Îäò_Îß§Ï∂ú_Î¶¨Ìè¨Ìä∏',
        'total': 'Ï†ÑÏ≤¥_Îß§Ï∂ú_Î¶¨Ìè¨Ìä∏',
        'reservation': 'ÏòàÏïΩ_ÌòÑÌô©',
        'sales': 'ÌåêÎß§_ÎÇ¥Ïó≠',
        'purchase': 'Îß§ÏûÖ_ÎÇ¥Ïó≠',
        'revenue': 'Îß§Ï∂ú_Î∂ÑÏÑù'
      };
      
      const filename = `${reportNames[type] || 'Î¶¨Ìè¨Ìä∏'}_${new Date().toLocaleDateString('ko-KR')}.csv`;
      
      // CSV Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (ÏòàÏãú)
      let csvContent = 'data:text/csv;charset=utf-8,';
      csvContent += 'ÎÇ†Ïßú,Ìï≠Î™©,Í∏àÏï°,ÎπÑÍ≥†\n';
      csvContent += `${new Date().toLocaleDateString('ko-KR')},ÏÉòÌîåÎç∞Ïù¥ÌÑ∞,100000,ÌÖåÏä§Ìä∏\n`;
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      alert(`üì• ${reportNames[type] || 'Î¶¨Ìè¨Ìä∏'} Îã§Ïö¥Î°úÎìúÍ∞Ä ÏãúÏûëÎê©ÎãàÎã§!`);
    }
    
    // ===== üê∞ Golden Rabbit CFO =====
    function openGoldenRabbitCFO() {
      document.getElementById('golden-rabbit-cfo').style.display = 'block';
    }
    
    function closeGoldenRabbitCFO() {
      document.getElementById('golden-rabbit-cfo').style.display = 'none';
    }
    
    function askCFO(topic) {
      const questions = {
        'sales': 'Ïò§Îäò Îß§Ï∂ú Î∂ÑÏÑùÌï¥Ï§ò',
        'tax': 'ÏÑ∏Î¨¥ Ïã†Í≥† ÎèÑÏôÄÏ§ò',
        'marketing': 'ÎßàÏºÄÌåÖ Ï°∞Ïñ∏Ìï¥Ï§ò'
      };
      
      document.getElementById('cfo-input').value = questions[topic] || '';
      sendToCFO();
    }
    
    // Gemini API ÌÇ§
    const GEMINI_API_KEY = 'AIzaSyDthsgk_0xYT5cTFa0YY2mvLmMIe9LLqKw';

    async function callGeminiAPI(prompt) {
      try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{ text: prompt }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 500
            }
          })
        });
        const data = await res.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || 'ÏùëÎãµÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏóÜÏäµÎãàÎã§.';
      } catch (err) {
        console.warn('Gemini API Ïò§Î•ò:', err);
        return null; // fallback to local
      }
    }

    async function sendToCFO() {
      const input = document.getElementById('cfo-input');
      const question = input.value.trim();
      if (!question) return;

      const messagesDiv = document.getElementById('cfo-chat-messages');

      // ÏÇ¨Ïö©Ïûê Î©îÏãúÏßÄ Ï∂îÍ∞Ä
      messagesDiv.innerHTML += `
        <div class="flex gap-3 mb-4 justify-end">
          <div class="bg-purple-600/50 p-3 rounded-lg max-w-[80%]">
            <p class="text-sm">${question}</p>
          </div>
        </div>
      `;

      input.value = '';

      // Î°úÎî© ÌëúÏãú
      const loadingId = 'cfo-loading-' + Date.now();
      messagesDiv.innerHTML += `
        <div class="flex gap-3 mb-4" id="${loadingId}">
          <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-sm flex-shrink-0 animate-bounce">üê∞</div>
          <div class="flex-1 bg-gray-800 p-3 rounded-lg">
            <p class="text-sm text-gray-400">üü¢ Gemini AI Î∂ÑÏÑù Ï§ë...</p>
          </div>
        </div>
      `;
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      // Gemini API Ìò∏Ï∂ú
      const systemPrompt = `ÎÑàÎäî "Golden Rabbit CFO" üê∞ ‚Äî ÏÜåÏÉÅÍ≥µÏù∏ Ï†ÑÏö© AI ÎπÑÏÑúÏïº.
Îß§Ïû•Î™Ö: ÏïÑÎØ∏ ÌïúÏ†ïÏãù | ÏóÖÏ¢Ö: ÌïúÏãù | Ïõî ÌèâÍ∑† Îß§Ï∂ú: ÏïΩ 1,000ÎßåÏõê
ÏÇ¨Ïû•ÎãòÏù¥ "${question}" ÎùºÍ≥† Î¨ºÏñ¥Î¥§Ïñ¥.
ÏπúÍ∑ºÌïòÍ≥† Ïã§Ïö©Ï†ÅÏúºÎ°ú, Ïù¥Î™®ÏßÄ ÏÇ¨Ïö©Ìï¥ÏÑú ÌïúÍµ≠Ïñ¥Î°ú ÏßßÍ≤å (200Ïûê Ïù¥ÎÇ¥) ÎãµÎ≥ÄÌï¥Ï§ò.
Îß§Ï∂ú Î∂ÑÏÑù, ÏÑ∏Î¨¥, ÎßàÏºÄÌåÖ, Î©îÎâ¥ Ï∂îÏ≤ú, ÏßÅÏõê Í¥ÄÎ¶¨ Îì± ÏÜåÏÉÅÍ≥µÏù∏Ïóê ÎèÑÏõÄÎêòÎäî ÎãµÎ≥ÄÏùÑ Ìï¥Ï§ò.`;

      let response = await callGeminiAPI(systemPrompt);

      // Fallback: Gemini Ïã§Ìå® Ïãú Î°úÏª¨ ÏùëÎãµ
      if (!response) {
        if (question.includes('Îß§Ï∂ú')) {
          response = `üìä Ïò§Îäò Îß§Ï∂ú: ‚Ç©340,000 (Ï†ÑÏùº ÎåÄÎπÑ +12%)\nÏ£ºÎ¨∏ 12Í±¥, Í∞ùÎã®Í∞Ä ‚Ç©28,333\nüí° Ï†ÄÎÖÅ ÌîÑÎ°úÎ™®ÏÖò Í∞ïÌôîÌïòÎ©¥ 20% ÏÉÅÏäπ ÏòàÏÉÅ!`;
        } else if (question.includes('ÏÑ∏Î¨¥')) {
          response = `üìã Îã§Ïùå Î∂ÄÍ∞ÄÏÑ∏ Ïã†Í≥†: 2026ÎÖÑ 1Ïõî 25Ïùº\nÏòàÏÉÅ Î∂ÄÍ∞ÄÏÑ∏: ‚Ç©234,000\nüí° ÌôàÌÉùÏä§ Ï†ÑÏûêÏã†Í≥† Ï∂îÏ≤ú!`;
        } else if (question.includes('ÎßàÏºÄÌåÖ')) {
          response = `üì¢ Ï†êÏã¨ ÌäπÍ∞Ä Ïø†Ìè∞ + Îã®Í≥® Ï†ÅÎ¶Ω + SNS Î¶¨Î∑∞ Ïù¥Î≤§Ìä∏\nüìà Ïã†Í∑ú Í≥†Í∞ù 30% Ï¶ùÍ∞Ä ÏòàÏÉÅ!`;
        } else {
          response = `ÎÑ§, "${question}"Ïóê ÎåÄÌï¥ Î∂ÑÏÑùÌï¥ÎìúÎ¶¥Í≤åÏöî! üê∞\nÎçî Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏßàÎ¨∏Ìï¥Ï£ºÏãúÎ©¥ Ï†ïÌôïÌïú ÎãµÎ≥Ä ÎìúÎ¶¥Í≤åÏöî!`;
        }
      }

      // Î°úÎî© Ï†úÍ±∞ & ÏùëÎãµ ÌëúÏãú
      const loadingEl = document.getElementById(loadingId);
      if (loadingEl) loadingEl.remove();

      messagesDiv.innerHTML += `
        <div class="flex gap-3 mb-4">
          <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-sm flex-shrink-0">üê∞</div>
          <div class="flex-1 bg-gray-800 p-3 rounded-lg">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xs px-2 py-0.5 rounded-full" style="background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);">üü¢ Gemini AI</span>
            </div>
            <p class="text-sm" style="white-space:pre-line;">${response}</p>
          </div>
        </div>
      `;

      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    // ===== üìÅ ÌååÏùº ÏóÖÎ°úÎìú Ìï∏Îì§Îü¨ =====
    function handleBusinessFileUpload(input) {
      const files = input.files;
      if (!files.length) return;
      
      const preview = document.getElementById('uploaded-files-preview');
      preview.style.display = 'grid';
      preview.innerHTML = '';
      
      Array.from(files).forEach((file, idx) => {
        const isImage = file.type.startsWith('image/');
        const isVideo = file.type.startsWith('video/');
        
        let previewContent = '';
        if (isImage) {
          const url = URL.createObjectURL(file);
          previewContent = `<img src="${url}" alt="${file.name}" class="w-full h-24 object-cover rounded">`;
        } else if (isVideo) {
          previewContent = `<div class="w-full h-24 bg-gray-700 rounded flex items-center justify-center"><span class="text-3xl">üé¨</span></div>`;
        } else {
          previewContent = `<div class="w-full h-24 bg-gray-700 rounded flex items-center justify-center"><span class="text-3xl">üìÑ</span></div>`;
        }
        
        preview.innerHTML += `
          <div class="bg-gray-800 p-2 rounded-lg">
            ${previewContent}
            <p class="text-xs text-gray-400 mt-1 truncate">${file.name}</p>
            <button type="button" onclick="removeFile(${idx})" class="text-red-400 text-xs hover:underline">ÏÇ≠Ï†ú</button>
          </div>
        `;
      });
    }
    
    function removeFile(idx) {
      alert('ÌååÏùº ÏÇ≠Ï†ú Í∏∞Îä•ÏùÄ ÏÑúÎ≤Ñ Ïó∞Îèô Ïãú Íµ¨ÌòÑÎê©ÎãàÎã§.');
    }
    
    // ===== üìù ÌÖçÏä§Ìä∏ Ìé∏Ïßë =====
    function formatText(command) {
      const textarea = document.getElementById('business-description');
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const text = textarea.value;
      const selected = text.substring(start, end);
      
      let formatted = selected;
      if (command === 'bold') formatted = `**${selected}**`;
      else if (command === 'italic') formatted = `_${selected}_`;
      else if (command === 'underline') formatted = `<u>${selected}</u>`;
      
      textarea.value = text.substring(0, start) + formatted + text.substring(end);
      textarea.focus();
    }
    
    function insertEmoji(emoji) {
      const textarea = document.getElementById('business-description');
      const pos = textarea.selectionStart;
      const text = textarea.value;
      textarea.value = text.substring(0, pos) + emoji + text.substring(pos);
      textarea.focus();
    }
    
    // ===== üè™ Îß§Ïû• ÏÉÅÏÑ∏ Ïù¥Îèô =====
    function goToStoreDetail(storeId) {
      if (!storeId) {
        alert('Í≤åÏûÑ Î≥¥ÏÉÅ Ïø†Ìè∞ÏùÄ Î™®Îì† Îß§Ïû•ÏóêÏÑú ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.');
        return;
      }
      
      const store = STORES[storeId];
      if (store) {
        alert(`üè™ ${store.emoji} ${store.name}\n\nüìç ${store.address}\nÏóÖÏ¢Ö: ${store.category}\n\nÎß§Ïû• ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§!`);
        showPage('store');
      }
    }
    
    // ===== üóëÔ∏è Í∞úÎ≥Ñ Ïø†Ìè∞ ÏÇ≠Ï†ú =====
    function deleteSingleCoupon(couponId) {
      if (!confirm('Ïù¥ Ïø†Ìè∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
      
      // allCouponsÏóêÏÑú Ï†úÍ±∞
      allCoupons = allCoupons.filter(c => c.id !== couponId);
      
      // localStorageÏóêÏÑúÎèÑ Ï†úÍ±∞
      let savedCoupons = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
      savedCoupons = savedCoupons.filter(c => c.id !== couponId && ('game-' + c.id) !== couponId);
      localStorage.setItem('airctt_coupons', JSON.stringify(savedCoupons));
      
      // UI ÏÉàÎ°úÍ≥†Ïπ®
      renderCoupons(allCoupons);
      
      alert('üóëÔ∏è Ïø†Ìè∞Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    }
    
    // ===== üìÅ ÌååÏùº Í¥ÄÎ¶¨ Í∏∞Îä• =====
    let currentEditingFile = null;
    
    const sampleFiles = {
      'Îß§Ïû•ÏÜåÍ∞ú.txt': `üçö ÏïÑÎØ∏ ÌïúÏ†ïÏãù

ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123Ïóê ÏúÑÏπòÌïú Ï†ïÌÜµ ÌïúÏ†ïÏãù Ï†ÑÎ¨∏Ï†êÏûÖÎãàÎã§.

‚ñ† ÏòÅÏóÖÏãúÍ∞Ñ
- Ï†êÏã¨: 11:30 - 14:30
- Ï†ÄÎÖÅ: 17:30 - 21:30

‚ñ† ÎåÄÌëú Î©îÎâ¥
- ÌäπÏÑ† ÌïúÏ†ïÏãù ‚Ç©35,000
- ÏôïÍ∞àÎπÑÌÉï ‚Ç©18,000
- ÎπÑÎπîÎ∞• Ï†ïÏãù ‚Ç©15,000

‚ñ† ÏòàÏïΩ Î¨∏Ïùò
üìû 02-1234-5678`,
      'Î©îÎâ¥Ìåê.xlsx': '[ÏóëÏÖÄ ÌååÏùºÏûÖÎãàÎã§. Îã§Ïö¥Î°úÎìúÌïòÏó¨ ÌôïÏù∏ÌïòÏÑ∏Ïöî.]',
      'Îß§Ï∂úÎ≥¥Í≥†ÏÑú.pdf': '[PDF ÌååÏùºÏûÖÎãàÎã§. Îã§Ïö¥Î°úÎìúÌïòÏó¨ ÌôïÏù∏ÌïòÏÑ∏Ïöî.]'
    };
    
    function openFileEditor(filename) {
      currentEditingFile = filename;
      const content = sampleFiles[filename] || '';
      
      document.getElementById('editor-filename').textContent = 'üìù ' + filename;
      document.getElementById('file-content').value = content;
      document.getElementById('file-editor').style.display = 'block';
    }
    
    function closeFileEditor() {
      document.getElementById('file-editor').style.display = 'none';
      currentEditingFile = null;
    }
    
    function saveFileContent() {
      if (!currentEditingFile) return;
      
      const content = document.getElementById('file-content').value;
      sampleFiles[currentEditingFile] = content;
      
      alert('üíæ ÌååÏùºÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\n\n' + currentEditingFile);
    }
    
    function uploadFile() {
      const input = document.createElement('input');
      input.type = 'file';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          alert('üì§ ÌååÏùº ÏóÖÎ°úÎìú ÏôÑÎ£å!\n\nÌååÏùºÎ™Ö: ' + file.name + '\nÌÅ¨Í∏∞: ' + (file.size / 1024).toFixed(1) + ' KB');
        }
      };
      input.click();
    }
    
    function createDocument() {
      const filename = prompt('ÏÉà Î¨∏ÏÑú Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', 'ÏÉàÎ¨∏ÏÑú.txt');
      if (filename) {
        sampleFiles[filename] = '';
        openFileEditor(filename);
        alert('üìù ÏÉà Î¨∏ÏÑúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§: ' + filename);
      }
    }
    
    function downloadFile(filename) {
      const content = sampleFiles[filename] || '';
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('üì• Îã§Ïö¥Î°úÎìú ÏãúÏûë: ' + filename);
    }
    
    function downloadReport(type) {
      const reportNames = {
        'coupons': 'Î∞úÍ∏âÏø†Ìè∞_Î™©Î°ù',
        'used': 'ÏÇ¨Ïö©Ïø†Ìè∞_ÎÇ¥Ïó≠',
        'today': 'Ïò§ÎäòÎß§Ï∂ú_Î≥¥Í≥†ÏÑú',
        'total': 'Ï†ÑÏ≤¥Îß§Ï∂ú_Î≥¥Í≥†ÏÑú',
        'reservation': 'ÏòàÏïΩÌòÑÌô©_Î™©Î°ù',
        'sales': 'ÌåêÎß§ÎÇ¥Ïó≠_Î≥¥Í≥†ÏÑú',
        'purchase': 'Îß§ÏûÖÎÇ¥Ïó≠_Î≥¥Í≥†ÏÑú',
        'revenue': 'Îß§Ï∂úÎ∂ÑÏÑù_Î≥¥Í≥†ÏÑú'
      };
      
      const filename = (reportNames[type] || 'Î≥¥Í≥†ÏÑú') + '_' + new Date().toISOString().slice(0,10) + '.xlsx';

      alert('üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú ÏãúÏûë\n\nÌååÏùºÎ™Ö: ' + filename + '\n\nÏ†ÄÏû• ÏúÑÏπòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
    }

    // ========================================
    // üé® Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ ÎπåÎçî Í∏∞Îä•
    // ========================================

    // Supabase ÏÑ§Ï†ï
    const SUPABASE_URL = 'https://qpuabgekedgkdwriskxs.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFwdWFiZ2VrZWRna2R3cmlza3hzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ4NTgzNTcsImV4cCI6MjA1MDQzNDM1N30.Ln6TqJPrZH-gdIU7sgPfroDALFAIGv9wIjFMlGMqsWY';

    // ÎπåÎçî ÏÉÅÌÉú Í¥ÄÎ¶¨
    let builderSettings = {
      name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
      category: 'ÌïúÏãù',
      description: 'Ï†ïÏÑ±ÏùÑ Îã¥ÏïÑ ÎßåÎìúÎäî Í±¥Í∞ïÌïú ÌïúÏ†ïÏãù',
      logo: 'üç±',
      mainColor: '#a855f7',
      videoUrl: '',
      bannerUrl: '',
      website: '',
      instagram: '',
      kakao: '',
      phone: '02-1234-5678',
      address: 'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123',
      hoursWeekday: '11:00 - 22:00',
      hoursSat: '11:00 - 22:00',
      hoursSun: '12:00 - 21:00',
      breaktime: '15:00 - 17:00',
      menus: [
        { id: 1, name: 'ÌïúÏ†ïÏãù ÏΩîÏä§ A', price: 35000, description: 'Ï†ÑÌÜµ ÌïúÏ†ïÏãù 8Ï≤©' },
        { id: 2, name: 'ÌïúÏ†ïÏãù ÏΩîÏä§ B', price: 45000, description: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌïúÏ†ïÏãù 12Ï≤©' },
        { id: 3, name: 'Î∂àÍ≥†Í∏∞ Ï†ïÏãù', price: 18000, description: 'ÌäπÏ†ú ÏñëÎÖê Î∂àÍ≥†Í∏∞' }
      ]
    };

    // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
    function updateStorePreview() {
      const nameEl = document.getElementById('builder-name');
      const categoryEl = document.getElementById('builder-category');
      const descEl = document.getElementById('builder-description');
      const logoEl = document.getElementById('builder-logo');
      const phoneEl = document.getElementById('builder-phone');
      const addressEl = document.getElementById('builder-address');

      if (nameEl) builderSettings.name = nameEl.value;
      if (categoryEl) builderSettings.category = categoryEl.value;
      if (descEl) builderSettings.description = descEl.value;
      if (logoEl) builderSettings.logo = logoEl.value;
      if (phoneEl) builderSettings.phone = phoneEl.value;
      if (addressEl) builderSettings.address = addressEl.value;

      // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
      const previewLogo = document.getElementById('preview-logo');
      const previewName = document.getElementById('preview-name');
      const previewCategory = document.getElementById('preview-category');
      const previewDesc = document.getElementById('preview-description');

      if (previewLogo) previewLogo.textContent = builderSettings.logo;
      if (previewName) previewName.textContent = builderSettings.name;
      if (previewCategory) previewCategory.textContent = `${builderSettings.category} ¬∑ Í∞ïÎÇ®Íµ¨`;
      if (previewDesc) previewDesc.textContent = builderSettings.description;

      console.log('üìù ÎπåÎçî ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏:', builderSettings);
    }

    // Î©îÏù∏ Ïª¨Îü¨ ÏÑ§Ï†ï
    function setBuilderColor(color) {
      builderSettings.mainColor = color;

      // ÎØ∏Î¶¨Î≥¥Í∏∞ Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
      const previewCard = document.getElementById('store-preview');
      if (previewCard) {
        previewCard.style.borderColor = color;
        previewCard.style.boxShadow = `0 0 30px ${color}40`;
      }

      // ÏÉâÏÉÅ Î≤ÑÌäº ÏÑ†ÌÉù ÌëúÏãú
      document.querySelectorAll('#store-builder-page button[onclick^="setBuilderColor"]').forEach(btn => {
        btn.style.transform = 'scale(1)';
        btn.style.borderColor = 'transparent';
      });
      if (event && event.target) {
        event.target.style.transform = 'scale(1.2)';
        event.target.style.borderColor = 'white';
      }

      console.log('üé® Î©îÏù∏ Ïª¨Îü¨ Î≥ÄÍ≤Ω:', color);
    }

    // Î©îÎâ¥ ÏïÑÏù¥ÌÖú Ï∂îÍ∞Ä
    function addNewMenuItem() {
      const newId = Date.now();
      builderSettings.menus.push({
        id: newId,
        name: 'ÏÉà Î©îÎâ¥',
        price: 10000,
        description: 'Î©îÎâ¥ ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî'
      });

      renderMenuEditor();
    }

    // Î©îÎâ¥ ÏÇ≠Ï†ú
    function removeMenuItem(id) {
      builderSettings.menus = builderSettings.menus.filter(m => m.id !== id);
      renderMenuEditor();
    }

    // Î©îÎâ¥ Ìé∏ÏßëÍ∏∞ Î†åÎçîÎßÅ
    function renderMenuEditor() {
      const container = document.getElementById('menu-editor-list');
      if (!container) return;

      container.innerHTML = builderSettings.menus.map(menu => `
        <div class="flex gap-4 items-center p-4 bg-gray-900 rounded-lg border border-purple-500/30">
          <div class="flex-1">
            <input type="text" value="${menu.name}"
              class="w-full p-2 mb-2 rounded bg-gray-800 border border-purple-500/50 text-white"
              onchange="updateMenuName(${menu.id}, this.value)">
            <input type="text" value="${menu.description}"
              class="w-full p-2 rounded bg-gray-800 border border-gray-600 text-gray-300 text-sm"
              onchange="updateMenuDescription(${menu.id}, this.value)">
          </div>
          <div class="w-32">
            <input type="number" value="${menu.price}"
              class="w-full p-2 rounded bg-gray-800 border border-cyan-500/50 text-cyan-400 text-right"
              onchange="updateMenuPrice(${menu.id}, this.value)">
            <p class="text-xs text-gray-500 text-right mt-1">Ïõê</p>
          </div>
          <button onclick="removeMenuItem(${menu.id})"
            class="w-10 h-10 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/40 transition">
            üóëÔ∏è
          </button>
        </div>
      `).join('');
    }

    // Î©îÎâ¥ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÎì§
    function updateMenuName(id, value) {
      const menu = builderSettings.menus.find(m => m.id === id);
      if (menu) menu.name = value;
    }

    function updateMenuDescription(id, value) {
      const menu = builderSettings.menus.find(m => m.id === id);
      if (menu) menu.description = value;
    }

    function updateMenuPrice(id, value) {
      const menu = builderSettings.menus.find(m => m.id === id);
      if (menu) menu.price = parseInt(value) || 0;
    }

    // ÏÑ§Ï†ï Ï†ÄÏû• (Supabase Ïó∞Îèô)
    async function saveStoreSettings() {
      // Î™®Îì† ÏûÖÎ†•Í∞í ÏàòÏßë
      const fields = {
        'builder-name': 'name',
        'builder-category': 'category',
        'builder-description': 'description',
        'builder-logo': 'logo',
        'builder-video': 'videoUrl',
        'builder-banner': 'bannerUrl',
        'builder-website': 'website',
        'builder-instagram': 'instagram',
        'builder-kakao': 'kakao',
        'builder-phone': 'phone',
        'builder-address': 'address',
        'builder-hours-weekday': 'hoursWeekday',
        'builder-hours-sat': 'hoursSat',
        'builder-hours-sun': 'hoursSun',
        'builder-breaktime': 'breaktime'
      };

      for (const [elId, key] of Object.entries(fields)) {
        const el = document.getElementById(elId);
        if (el) builderSettings[key] = el.value;
      }

      console.log('üíæ Ï†ÄÏû•Ìï† ÏÑ§Ï†ï:', builderSettings);

      // SupabaseÏóê Ï†ÄÏû• ÏãúÎèÑ
      try {
        const storeData = {
          name: builderSettings.name,
          category: builderSettings.category,
          description: builderSettings.description,
          logo_emoji: builderSettings.logo,
          main_color: builderSettings.mainColor,
          video_url: builderSettings.videoUrl,
          banner_url: builderSettings.bannerUrl,
          website: builderSettings.website,
          instagram: builderSettings.instagram,
          kakao_channel: builderSettings.kakao,
          phone: builderSettings.phone,
          address: builderSettings.address,
          business_hours: {
            weekday: builderSettings.hoursWeekday,
            saturday: builderSettings.hoursSat,
            sunday: builderSettings.hoursSun,
            breaktime: builderSettings.breaktime
          },
          menus: builderSettings.menus,
          updated_at: new Date().toISOString()
        };

        // LocalStorageÏóê Ï†ÄÏû• (Ïò§ÌîÑÎùºÏù∏ ÏßÄÏõê)
        localStorage.setItem('storeSettings', JSON.stringify(storeData));

        // Supabase API Ìò∏Ï∂ú
        const response = await fetch(`${SUPABASE_URL}/rest/v1/stores`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify(storeData)
        });

        if (response.ok) {
          const result = await response.json();
          console.log('‚úÖ Supabase Ï†ÄÏû• ÏÑ±Í≥µ:', result);
          alert('‚úÖ Îß§Ïû• Ï†ïÎ≥¥Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\n\nSupabaseÏóê ÎèôÍ∏∞Ìôî ÏôÑÎ£å!');
        } else {
          console.log('‚ö†Ô∏è Supabase Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨ÏóêÎßå Ï†ÄÏû•Îê®');
          alert('‚úÖ Îß§Ïû• Ï†ïÎ≥¥Í∞Ä Î°úÏª¨Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\n(ÏÑúÎ≤Ñ ÎèôÍ∏∞ÌôîÎäî ÎÇòÏ§ëÏóê ÏãúÎèÑÎê©ÎãàÎã§)');
        }
      } catch (error) {
        console.error('Ï†ÄÏû• Ïò§Î•ò:', error);
        alert('‚úÖ Îß§Ïû• Ï†ïÎ≥¥Í∞Ä Î°úÏª¨Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
      }
    }

    // Ï†ÑÏ≤¥ÌôîÎ©¥ ÎØ∏Î¶¨Î≥¥Í∏∞ Ïó¥Í∏∞
    function openFullPreview() {
      const params = new URLSearchParams({
        name: builderSettings.name,
        category: builderSettings.category,
        description: builderSettings.description,
        logo: builderSettings.logo,
        color: builderSettings.mainColor,
        video: builderSettings.videoUrl || '',
        phone: builderSettings.phone,
        address: builderSettings.address
      });

      const previewUrl = `store_homepage_full.html?${params.toString()}`;
      window.open(previewUrl, '_blank', 'width=430,height=800');
    }

    // Ï†ÄÏû•Îêú ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
    function loadStoreSettings() {
      const saved = localStorage.getItem('storeSettings');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          builderSettings = {
            ...builderSettings,
            name: data.name || builderSettings.name,
            category: data.category || builderSettings.category,
            description: data.description || builderSettings.description,
            logo: data.logo_emoji || builderSettings.logo,
            mainColor: data.main_color || builderSettings.mainColor,
            videoUrl: data.video_url || '',
            bannerUrl: data.banner_url || '',
            website: data.website || '',
            instagram: data.instagram || '',
            kakao: data.kakao_channel || '',
            phone: data.phone || builderSettings.phone,
            address: data.address || builderSettings.address,
            hoursWeekday: data.business_hours?.weekday || builderSettings.hoursWeekday,
            hoursSat: data.business_hours?.saturday || builderSettings.hoursSat,
            hoursSun: data.business_hours?.sunday || builderSettings.hoursSun,
            breaktime: data.business_hours?.breaktime || builderSettings.breaktime,
            menus: data.menus || builderSettings.menus
          };

          // ÏûÖÎ†• ÌïÑÎìúÏóê Í∞í ÏÑ§Ï†ï
          const fieldMap = {
            'builder-name': builderSettings.name,
            'builder-category': builderSettings.category,
            'builder-description': builderSettings.description,
            'builder-logo': builderSettings.logo,
            'builder-video': builderSettings.videoUrl,
            'builder-banner': builderSettings.bannerUrl,
            'builder-website': builderSettings.website,
            'builder-instagram': builderSettings.instagram,
            'builder-kakao': builderSettings.kakao,
            'builder-phone': builderSettings.phone,
            'builder-address': builderSettings.address,
            'builder-hours-weekday': builderSettings.hoursWeekday,
            'builder-hours-sat': builderSettings.hoursSat,
            'builder-hours-sun': builderSettings.hoursSun,
            'builder-breaktime': builderSettings.breaktime
          };

          for (const [id, value] of Object.entries(fieldMap)) {
            const el = document.getElementById(id);
            if (el) el.value = value;
          }

          updateStorePreview();
          console.log('üìÇ Ï†ÄÏû•Îêú ÏÑ§Ï†ï Î∂àÎü¨Ïò¥:', builderSettings);
        } catch (e) {
          console.error('ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Ïò§Î•ò:', e);
        }
      }

      renderMenuEditor();
    }

    // YouTube ÏûÑÎ≤†Îìú URL Î≥ÄÌôò
    function getYouTubeEmbedUrl(url) {
      if (!url) return null;

      const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
        /youtube\.com\/shorts\/([^&\n?#]+)/
      ];

      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) {
          return `https://www.youtube.com/embed/${match[1]}`;
        }
      }

      return url;
    }

    // ÌôçÎ≥¥ ÎèôÏòÅÏÉÅ ÎØ∏Î¶¨Î≥¥Í∏∞
    function previewVideo() {
      const videoUrl = document.getElementById('builder-video')?.value;
      const embedUrl = getYouTubeEmbedUrl(videoUrl);

      if (embedUrl && videoUrl) {
        const previewHtml = `
          <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50" onclick="this.remove()" style="z-index:9999;">
            <div class="bg-gray-900 p-4 rounded-xl max-w-2xl w-full mx-4" onclick="event.stopPropagation()">
              <div style="aspect-ratio: 16/9;">
                <iframe src="${embedUrl}"
                  style="width:100%; height:100%; border-radius: 8px;"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
              <button onclick="this.parentElement.parentElement.remove()"
                style="margin-top: 16px; width: 100%; padding: 12px; background: #a855f7; border-radius: 8px; font-weight: bold; border: none; color: white; cursor: pointer;">
                Îã´Í∏∞
              </button>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', previewHtml);
      } else {
        alert('YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
      }
    }

    // Í∞ÄÎßπÏ†ê Îì±Î°ù API
    async function registerMerchant(formData) {
      try {
        const merchantData = {
          business_name: formData.businessName,
          business_number: formData.businessNumber,
          owner_name: formData.ownerName,
          phone: formData.phone,
          email: formData.email,
          address: formData.address,
          category: formData.category,
          status: 'pending',
          created_at: new Date().toISOString()
        };

        const response = await fetch(`${SUPABASE_URL}/rest/v1/merchants`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify(merchantData)
        });

        if (response.ok) {
          const result = await response.json();
          console.log('‚úÖ Í∞ÄÎßπÏ†ê Îì±Î°ù ÏÑ±Í≥µ:', result);
          return { success: true, data: result };
        } else {
          const error = await response.json();
          console.error('‚ùå Í∞ÄÎßπÏ†ê Îì±Î°ù Ïã§Ìå®:', error);
          return { success: false, error: error.message };
        }
      } catch (error) {
        console.error('Í∞ÄÎßπÏ†ê Îì±Î°ù Ïò§Î•ò:', error);
        return { success: false, error: error.message };
      }
    }

    // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(loadStoreSettings, 500);
      setTimeout(loadRegisteredVideos, 600);
    });

    // ========================================
    // üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ Îì±Î°ù Í∏∞Îä•
    // ========================================

    // Îì±Î°ùÎêú ÏòÅÏÉÅ Ï†ÄÏû•ÏÜå
    let registeredVideos = JSON.parse(localStorage.getItem('registeredVideos') || '{}');

    // ÏòÅÏÉÅ Îì±Î°ù Î™®Îã¨ Ïó¥Í∏∞ (Îß§Ïû• Î™©Î°ùÏóêÏÑú)
    function openVideoRegister(storeId) {
      const url = prompt('ÌôçÎ≥¥ ÏòÅÏÉÅ YouTube URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:\n\nÏòà: https://youtube.com/watch?v=xxxxx\nÎòêÎäî: https://youtu.be/xxxxx');

      if (url && url.trim()) {
        const embedUrl = getYouTubeEmbedUrl(url.trim());
        if (embedUrl) {
          registeredVideos[storeId] = {
            url: url.trim(),
            embedUrl: embedUrl,
            registeredAt: new Date().toISOString()
          };
          localStorage.setItem('registeredVideos', JSON.stringify(registeredVideos));
          applyVideoToStore(storeId, embedUrl);
          alert('‚úÖ ÌôçÎ≥¥ ÏòÅÏÉÅÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!');
        } else {
          alert('‚ùå Ïò¨Î∞îÎ•∏ YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        }
      }
    }

    // Îß§Ïû•Ïóê ÏòÅÏÉÅ Ï†ÅÏö©
    function applyVideoToStore(storeId, embedUrl) {
      const iframe = document.getElementById(`${storeId}-iframe`);
      const placeholder = document.getElementById(`${storeId}-placeholder`);

      if (iframe && placeholder) {
        iframe.src = embedUrl;
        iframe.style.display = 'block';
        placeholder.style.display = 'none';
      }
    }

    // Ï†ÄÏû•Îêú ÏòÅÏÉÅÎì§ Î∂àÎü¨Ïò§Í∏∞
    function loadRegisteredVideos() {
      registeredVideos = JSON.parse(localStorage.getItem('registeredVideos') || '{}');

      for (const [storeId, data] of Object.entries(registeredVideos)) {
        if (data.embedUrl) {
          applyVideoToStore(storeId, data.embedUrl);
        }
      }

      renderRegisteredVideosList();
    }

    // Îì±Î°ùÎêú ÏòÅÏÉÅ Î™©Î°ù Î†åÎçîÎßÅ
    function renderRegisteredVideosList() {
      const container = document.getElementById('registered-videos-list');
      if (!container) return;

      const storeNames = {
        'store-001': 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù',
        'store-002': 'ÏïÑÎØ∏ Îã§Î∞©',
        'store-003': 'Ìô©Í∏àÏò¨Î¶¨Î∏å ÏπòÌÇ®',
        'store-004': 'ÌòÑÏã§ Î†àÏä§ÌÜ†Îûë'
      };

      const videoEntries = Object.entries(registeredVideos);

      if (videoEntries.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-sm">Îì±Î°ùÎêú ÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
        return;
      }

      container.innerHTML = videoEntries.map(([storeId, data]) => `
        <div class="flex items-center justify-between p-3 bg-gray-800 rounded border border-gray-700">
          <div class="flex items-center gap-3">
            <span class="text-red-400">‚ñ∂Ô∏è</span>
            <div>
              <p class="font-bold text-sm">${storeNames[storeId] || storeId}</p>
              <p class="text-xs text-gray-400 truncate" style="max-width: 200px;">${data.url}</p>
            </div>
          </div>
          <button onclick="removeRegisteredVideo('${storeId}')" class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs hover:bg-red-500/40">ÏÇ≠Ï†ú</button>
        </div>
      `).join('');
    }

    // Îì±Î°ùÎêú ÏòÅÏÉÅ ÏÇ≠Ï†ú
    function removeRegisteredVideo(storeId) {
      if (confirm('Ïù¥ ÏòÅÏÉÅÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        delete registeredVideos[storeId];
        localStorage.setItem('registeredVideos', JSON.stringify(registeredVideos));

        // UI Î≥µÏõê
        const iframe = document.getElementById(`${storeId}-iframe`);
        const placeholder = document.getElementById(`${storeId}-placeholder`);

        if (iframe && placeholder) {
          iframe.src = '';
          iframe.style.display = 'none';
          placeholder.style.display = 'flex';
        }

        renderRegisteredVideosList();
        alert('üóëÔ∏è ÏòÅÏÉÅÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      }
    }

    // ÌôçÎ≥¥ ÏòÅÏÉÅ ÎØ∏Î¶¨Î≥¥Í∏∞ (ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ ÌÉ≠ÏóêÏÑú)
    function previewPromoVideo() {
      const urlInput = document.getElementById('promo-video-url');
      const previewContainer = document.getElementById('promo-video-preview');

      if (!urlInput || !previewContainer) return;

      const url = urlInput.value.trim();
      if (!url) {
        alert('YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      const embedUrl = getYouTubeEmbedUrl(url);
      if (embedUrl) {
        previewContainer.innerHTML = `
          <iframe src="${embedUrl}" class="w-full h-full rounded-lg" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
        `;
      } else {
        alert('‚ùå Ïò¨Î∞îÎ•∏ YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      }
    }

    // ÌôçÎ≥¥ ÏòÅÏÉÅ Îì±Î°ù (ÌôçÎ≥¥ ÌéòÏù¥ÏßÄ ÌÉ≠ÏóêÏÑú)
    function registerPromoVideo() {
      const urlInput = document.getElementById('promo-video-url');
      if (!urlInput) return;

      const url = urlInput.value.trim();
      if (!url) {
        alert('YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      const embedUrl = getYouTubeEmbedUrl(url);
      if (!embedUrl) {
        alert('‚ùå Ïò¨Î∞îÎ•∏ YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏùò Îß§Ïû• (Í∏∞Î≥∏: store-001)
      const currentStoreId = 'store-001';

      registeredVideos[currentStoreId] = {
        url: url,
        embedUrl: embedUrl,
        registeredAt: new Date().toISOString()
      };

      localStorage.setItem('registeredVideos', JSON.stringify(registeredVideos));
      applyVideoToStore(currentStoreId, embedUrl);
      renderRegisteredVideosList();

      // ÎØ∏Î¶¨Î≥¥Í∏∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
      previewPromoVideo();

      alert('‚úÖ ÌôçÎ≥¥ ÏòÅÏÉÅÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!\n\nÎß§Ïû• Î™©Î°ùÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
      urlInput.value = '';
    }

    // ========================================
    // üè™ Ïô∏Î∂Ä ÏûÖÏ†ê Îß§Ïû• (URL Ïó∞Îèô Î∞©Ïãù)
    // ========================================

    const partnerStores = {
      'rounz': {
        name: 'ROUNZ ÏïàÍ≤ΩÏ†ê',
        category: 'Ìå®ÏÖò/ÏùòÎ•ò',
        url: 'https://rounz.com/product.php?productIndex=168902',
        image: 'https://image.rounz.com/_data/product/TARTOPTICAL/ARNEL-HERITAGE-BLACK(45)/ARNEL-HERITAGE-BLACK(45)_03.JPG',
        rating: 4.95,
        reviews: 42,
        badges: ['Ïó∞ÎßêÌäπÍ∞Ä', 'ARÏßÄÏõê', 'Î¨¥Î£åÎ∞∞ÏÜ°']
      }
    };

    // ========================================
    // üîó Ïô∏Î∂Ä Ïó∞Îèô Í∏∞Îä• (URL, ÏòÅÏÉÅ, Ïï± Îã§Ïö¥Î°úÎìú)
    // ========================================

    // ÏòÅÏÉÅ ÎØ∏Î¶¨Î≥¥Í∏∞ (ÏûÖÏ†ê ÌèºÏö©)
    function previewVideoURL() {
      const urlInput = document.getElementById('reg-video-url');
      const container = document.getElementById('video-preview-container');
      const iframe = document.getElementById('video-preview-iframe');

      if (!urlInput || !container || !iframe) return;

      const url = urlInput.value.trim();
      if (!url) {
        alert('ÏòÅÏÉÅ URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      const embedUrl = getYouTubeEmbedUrl(url);
      if (embedUrl) {
        iframe.src = embedUrl;
        container.classList.remove('hidden');
      } else {
        alert('‚ùå Ïò¨Î∞îÎ•∏ YouTube/Vimeo URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      }
    }

    // Îß§Ïû• Îç∞Ïù¥ÌÑ∞Ïóê Ïô∏Î∂Ä Ïó∞Îèô Ï†ïÎ≥¥ Ï†ÄÏû•
    function getExternalLinks() {
      return {
        homepage: document.getElementById('reg-homepage-url')?.value.trim() || '',
        video: document.getElementById('reg-video-url')?.value.trim() || '',
        arUrl: document.getElementById('reg-ar-url')?.value.trim() || '',
        appAndroid: document.getElementById('reg-app-android')?.value.trim() || '',
        appIos: document.getElementById('reg-app-ios')?.value.trim() || '',
        instagram: document.getElementById('reg-sns-instagram')?.value.trim() || '',
        youtube: document.getElementById('reg-sns-youtube')?.value.trim() || '',
        naverBlog: document.getElementById('reg-sns-naver')?.value.trim() || '',
        kakaoChannel: document.getElementById('reg-sns-kakao')?.value.trim() || ''
      };
    }

    // Ïô∏Î∂Ä ÎßÅÌÅ¨ Ïó¥Í∏∞
    function openExternalLink(url) {
      if (url && url.startsWith('http')) {
        window.open(url, '_blank');
      }
    }

    // Îß§Ïû• Ïπ¥ÎìúÏóê Ïó∞Îèô Î≤ÑÌäº ÏÉùÏÑ±
    function createLinkButtons(links) {
      let buttons = [];

      if (links.homepage) {
        buttons.push(`<button onclick="openExternalLink('${links.homepage}')" class="px-3 py-1 bg-cyan-500 text-white text-xs rounded hover:bg-cyan-600">üåê ÌôàÌéòÏù¥ÏßÄ</button>`);
      }
      if (links.video) {
        const embedUrl = getYouTubeEmbedUrl(links.video);
        buttons.push(`<button onclick="showVideoModal('${embedUrl}')" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">üé¨ ÏòÅÏÉÅÎ≥¥Í∏∞</button>`);
      }
      if (links.arUrl) {
        buttons.push(`<button onclick="openExternalLink('${links.arUrl}')" class="px-3 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600">üîÆ ARÏ≤¥Ìóò</button>`);
      }
      if (links.appAndroid || links.appIos) {
        const appUrl = links.appAndroid || links.appIos;
        buttons.push(`<button onclick="openExternalLink('${appUrl}')" class="px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600">üì• Ïï±Îã§Ïö¥</button>`);
      }

      return buttons.join(' ');
    }

    // ÏòÅÏÉÅ Î™®Îã¨ ÌëúÏãú
    function showVideoModal(embedUrl) {
      if (!embedUrl) return;

      const modalHtml = `
        <div id="video-modal" class="fixed inset-0 bg-black/90 flex items-center justify-center z-50" onclick="closeVideoModal(event)">
          <div class="max-w-4xl w-full mx-4" onclick="event.stopPropagation()">
            <div class="flex justify-end mb-2">
              <button onclick="closeVideoModal()" class="text-white text-3xl hover:text-gray-300">&times;</button>
            </div>
            <div class="aspect-video bg-black rounded-lg overflow-hidden">
              <iframe src="${embedUrl}" class="w-full h-full" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }

    function closeVideoModal(event) {
      if (event && event.target.id !== 'video-modal') return;
      const modal = document.getElementById('video-modal');
      if (modal) modal.remove();
    }

    // SNS ÏïÑÏù¥ÏΩò Î≤ÑÌäº ÏÉùÏÑ±
    function createSnsButtons(links) {
      let buttons = [];
      if (links.instagram) buttons.push(`<a href="${links.instagram}" target="_blank" class="text-pink-400 hover:text-pink-300">üì∏</a>`);
      if (links.youtube) buttons.push(`<a href="${links.youtube}" target="_blank" class="text-red-500 hover:text-red-400">‚ñ∂Ô∏è</a>`);
      if (links.naverBlog) buttons.push(`<a href="${links.naverBlog}" target="_blank" class="text-green-400 hover:text-green-300">üìù</a>`);
      if (links.kakaoChannel) buttons.push(`<a href="${links.kakaoChannel}" target="_blank" class="text-yellow-400 hover:text-yellow-300">üí¨</a>`);
      return buttons.length > 0 ? `<div class="flex gap-2 mt-2">${buttons.join('')}</div>` : '';
    }

    // ROUNZ Î∞è Ïô∏Î∂Ä ÏûÖÏ†ê Îß§Ïû•ÏùÄ ÏûêÏ≤¥ AR Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§
    // AIRCTTÎäî Îß§Ïû• Ïπ¥Îìú(Î∞ïÏä§)Îßå Ï†úÍ≥µÌïòÍ≥†, AR/Íµ¨Îß§Îäî ÌååÌä∏ÎÑà ÏÇ¨Ïù¥Ìä∏ÏóêÏÑú Ï≤òÎ¶¨

    // ========================================
    // üé¨ ÌååÏùº Í¥ÄÎ¶¨ - ÏòÅÏÉÅ Îì±Î°ù & ÌååÏùº ÏóÖÎ°úÎìú
    // ========================================

    // ÏòÅÏÉÅ Îì±Î°ù
    function registerFileVideo() {
      const urlInput = document.getElementById('file-video-url');
      const preview = document.getElementById('file-video-preview');
      const list = document.getElementById('file-video-list');

      if (!urlInput || !urlInput.value.trim()) {
        alert('YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      const embedUrl = getYouTubeEmbedUrl(urlInput.value.trim());
      if (!embedUrl) {
        alert('Ïò¨Î∞îÎ•∏ YouTube URLÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      // ÎØ∏Î¶¨Î≥¥Í∏∞
      preview.innerHTML = `
        <div class="aspect-video rounded-lg overflow-hidden">
          <iframe src="${embedUrl}" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
        </div>
      `;

      // Î™©Î°ùÏóê Ï∂îÍ∞Ä
      const videoItem = document.createElement('div');
      videoItem.className = 'flex items-center gap-2 p-2 bg-gray-800 rounded';
      videoItem.innerHTML = `
        <span class="text-red-400">üé¨</span>
        <span class="flex-1 text-sm truncate">${urlInput.value.trim()}</span>
        <button onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300">‚úï</button>
      `;
      list.appendChild(videoItem);

      // Ï†ÄÏû•
      let videos = JSON.parse(localStorage.getItem('store_videos') || '[]');
      videos.push(urlInput.value.trim());
      localStorage.setItem('store_videos', JSON.stringify(videos));

      urlInput.value = '';
      alert('‚úÖ ÏòÅÏÉÅÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!');
    }

    // ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨
    function handleFileUpload(input) {
      const list = document.getElementById('upload-file-list');
      const files = input.files;

      for (let file of files) {
        const fileItem = document.createElement('div');
        fileItem.className = 'flex items-center gap-2 p-2 bg-gray-800 rounded';

        let icon = 'üìÑ';
        if (file.type.includes('video')) icon = 'üé¨';
        else if (file.type.includes('image')) icon = 'üñºÔ∏è';
        else if (file.type.includes('pdf')) icon = 'üìï';
        else if (file.type.includes('sheet') || file.name.endsWith('.xlsx')) icon = 'üìä';

        const size = (file.size / 1024).toFixed(1) + ' KB';

        fileItem.innerHTML = `
          <span>${icon}</span>
          <span class="flex-1 text-sm truncate">${file.name}</span>
          <span class="text-xs text-gray-400">${size}</span>
          <button onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-300">‚úï</button>
        `;
        list.appendChild(fileItem);
      }

      alert(`‚úÖ ${files.length}Í∞ú ÌååÏùºÏù¥ ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§!`);
      input.value = '';
    }
  </script>


<div id="claude-agent-glow-border" style="position: fixed; inset: 0px; pointer-events: none; z-index: 2147483646; opacity: 1; transition: opacity 0.3s ease-in-out; animation: 2s ease-in-out 0s infinite normal none running claude-pulse; box-shadow: rgba(217, 119, 87, 0.5) 0px 0px 10px inset, rgba(217, 119, 87, 0.3) 0px 0px 20px inset, rgba(217, 119, 87, 0.1) 0px 0px 30px inset;"></div><div id="claude-agent-stop-container" style="position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); justify-content: center; align-items: center; pointer-events: none; z-index: 2147483647;"><button id="claude-agent-stop-button" style="position: relative; transform: translateY(0px); padding: 12px 16px; background: rgb(250, 249, 245); color: rgb(20, 20, 19); border: 0.5px solid rgba(31, 30, 29, 0.4); border-radius: 12px; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; box-shadow: rgba(217, 119, 87, 0.24) 0px 40px 80px, rgba(217, 119, 87, 0.24) 0px 4px 14px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); opacity: 1; user-select: none; pointer-events: auto; white-space: nowrap; margin: 0px auto;">
      <svg width="16" height="16" viewBox="0 0 256 256" fill="currentColor" style="margin-right: 12px; vertical-align: middle;">
        <path d="M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm40-112v56a12,12,0,0,1-12,12H100a12,12,0,0,1-12-12V100a12,12,0,0,1,12-12h56A12,12,0,0,1,168,100Z"></path>
      </svg>
      <span style="vertical-align: middle;">Stop Claude</span>
    </button></div><div id="new-coupon-modal" class="fixed inset-0 z-[9999] hidden" style="display: none;">
<div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeNewCouponModal()"></div>
<div class="absolute inset-0 flex items-center justify-center p-4 overflow-y-auto">
  <div class="relative bg-gray-900 border border-purple-500/30 rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()">
    <div class="sticky top-0 bg-gray-900 z-10 p-6 pb-4 border-b border-gray-800">
      <div class="flex justify-between items-center">
        <div>
          <h2 class="text-xl font-bold flex items-center gap-2">‚ú® ÏÉà Ïø†Ìè∞ ÎßåÎì§Í∏∞</h2>
          <p class="text-gray-400 text-sm mt-1">ÏÉàÎ°úÏö¥ Ìï†Ïù∏ Ïø†Ìè∞ÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§</p>
        </div>
        <button onclick="closeNewCouponModal()" class="text-gray-400 hover:text-white text-2xl">√ó</button>
      </div>
      <!-- Step Indicator (4Îã®Í≥Ñ) -->
      <div class="flex items-center gap-1 mt-4">
        <div id="step-dot-1" class="w-7 h-7 rounded-full bg-green-500 flex items-center justify-center text-xs font-bold shrink-0">1</div>
        <div class="flex-1 h-0.5 bg-green-500/50" id="step-line-1"></div>
        <div id="step-dot-2" class="w-7 h-7 rounded-full bg-purple-600 flex items-center justify-center text-xs font-bold shrink-0">2</div>
        <div class="flex-1 h-0.5 bg-gray-700" id="step-line-2"></div>
        <div id="step-dot-3" class="w-7 h-7 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold shrink-0">3</div>
        <div class="flex-1 h-0.5 bg-gray-700" id="step-line-3"></div>
        <div id="step-dot-4" class="w-7 h-7 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold shrink-0">4</div>
      </div>
      <div class="flex justify-between text-[10px] text-gray-400 mt-1 px-0.5">
        <span>Ïø†Ìè∞<br>Ï†ïÎ≥¥</span>
        <span>ÎπÑÍµê<br>ÏÉùÏÑ±</span>
        <span>Í¥ÄÎ¶¨<br>ÌôïÏù∏</span>
        <span>ÏöîÏ≤≠<br>ÏôÑÎ£å</span>
      </div>
    </div>

    <!-- Step 1: Ïø†Ìè∞ Ï†ïÎ≥¥ -->
    <div id="modal-step-1" class="p-6 hidden">
      <!-- AI Auto Generate -->
      <button type="button" onclick="aiAutoFillCoupon()" class="w-full mb-5 p-3 rounded-lg border-2 border-dashed border-purple-500/50 hover:border-purple-400 transition text-center flex items-center justify-center gap-2 text-purple-400 hover:text-purple-300">
        ‚ú® AI ÏûêÎèô ÏÉùÏÑ±
      </button>

      <!-- üñºÔ∏è Ïø†Ìè∞ ÏóÖÎ°úÎìú -->
      <div class="mb-5">
        <label class="block text-sm text-gray-400 mb-2">üé¨ Ïø†Ìè∞ ÏóÖÎ°úÎìú <span class="text-gray-600">JPG, PNG, GIF, MP4, WEBM (ÏµúÎåÄ 500MB)</span></label>
        <!-- ÌîÑÎ¶¨Î∑∞ Ïπ¥Îìú -->
        <div id="modal-coupon-preview-card" class="hidden mb-3 bg-gray-800/80 rounded-xl border border-purple-500/30 overflow-hidden">
          <div class="flex gap-0" style="aspect-ratio:720/450;">
            <div id="modal-preview-media" class="w-2/3 relative bg-gray-900 flex items-center justify-center" onclick="document.getElementById('modal-coupon-image').click()" style="cursor:pointer;">
              <img id="modal-preview-img" class="w-full h-full object-cover" alt="Ïø†Ìè∞ ÌîÑÎ¶¨Î∑∞" style="display:none;">
              <video id="modal-preview-video" class="w-full h-full object-cover" autoplay muted loop style="display:none;"></video>
              <div id="modal-preview-change" class="absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-full" style="display:none;">üì∑ Î≥ÄÍ≤Ω</div>
            </div>
            <div class="w-1/3 bg-gray-800 p-3 flex flex-col items-center justify-center border-l border-gray-700">
              <div class="text-2xl mb-1">üè∑Ô∏è</div>
              <p class="text-[10px] text-gray-400 mb-1">Ìï†Ïù∏ Ï†ïÎ≥¥</p>
              <div id="modal-preview-discount" class="text-2xl font-black text-amber-400">10%</div>
              <p class="text-xs text-gray-400 mt-0.5">OFF</p>
            </div>
          </div>
          <p class="text-center text-[10px] text-gray-500 py-1.5">Í∂åÏû• ÏÇ¨Ïù¥Ï¶à: <span class="text-amber-400 font-bold">720 √ó 900px</span> (Í∞ÄÎ°ú 2/3 Ïù¥ÎØ∏ÏßÄ + 1/3 Ìï†Ïù∏Ï†ïÎ≥¥)</p>
        </div>
        <!-- ÏóÖÎ°úÎìú Î≤ÑÌäº -->
        <div id="modal-image-placeholder" class="border-2 border-dashed border-gray-700 rounded-xl p-6 text-center hover:border-purple-500/50 transition cursor-pointer group" onclick="document.getElementById('modal-coupon-image').click()">
          <div class="w-14 h-14 mx-auto mb-2 rounded-2xl bg-gradient-to-br from-purple-500/20 to-cyan-500/20 flex items-center justify-center group-hover:scale-110 transition"><span class="text-2xl">üì∏</span></div>
          <p class="font-bold text-white mb-1 text-sm">Ïø†Ìè∞ Ïù¥ÎØ∏ÏßÄ/ÏòÅÏÉÅ ÏóÖÎ°úÎìú</p>
          <p class="text-xs text-gray-500">JPG, PNG, GIF, MP4, WEBM</p>
          <p class="text-xs text-gray-500 mt-1">Í∂åÏû•: <span class="text-amber-400">720 √ó 900px</span></p>
          <div class="mt-2 inline-flex items-center gap-1.5 px-3 py-1.5 bg-purple-500/20 text-purple-400 rounded-full text-xs font-medium"><span>üìÅ</span> ÌååÏùº ÏÑ†ÌÉù</div>
        </div>
        <input type="file" id="modal-coupon-image" accept="image/*,video/mp4,video/webm,.gif" class="hidden" onchange="previewCouponImage(this)">
      </div>

      <!-- Ïø†Ìè∞Î™Ö -->
      <div class="mb-4">
        <label class="block text-sm text-gray-400 mb-1">Ïø†Ìè∞Î™Ö *</label>
        <input type="text" id="modal-coupon-name" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition" placeholder="ÏÉà Ïø†Ìè∞" required="">
      </div>
      <!-- ÏÑ§Î™Ö -->
      <div class="mb-4">
        <label class="block text-sm text-gray-400 mb-1">ÏÑ§Î™Ö</label>
        <textarea id="modal-coupon-desc" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition resize-y" rows="2" placeholder="Ïø†Ìè∞ ÏÑ§Î™Ö"></textarea>
      </div>

      <!-- Ìï†Ïù∏ Ïú†Ìòï & Í∞í -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm text-gray-400 mb-1">Ìï†Ïù∏ Ïú†Ìòï</label>
          <select id="modal-discount-type" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition" onchange="updateDiscountLabel()">
            <option value="percent">ÌçºÏÑºÌä∏ (%)</option>
            <option value="fixed">Í∏àÏï° (‚Ç©)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">Ìï†Ïù∏ Í∞í *</label>
          <input type="number" id="modal-discount-value" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition" value="10" min="1" max="100" oninput="updatePreviewDiscount()">
        </div>
      </div>

      <!-- ÏãúÏûëÏùº/Ï¢ÖÎ£åÏùº -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm text-gray-400 mb-1">ÏãúÏûëÏùº *</label>
          <input type="date" id="modal-start-date" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition">
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">Ï¢ÖÎ£åÏùº *</label>
          <input type="date" id="modal-end-date" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition">
        </div>
      </div>

      <!-- ÏµúÏÜå/ÏµúÎåÄ Í∏àÏï° -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label class="block text-sm text-gray-400 mb-1">ÏµúÏÜå Í≤∞Ï†ú Í∏àÏï°</label>
          <input type="number" id="modal-min-payment" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition" value="1000" min="0">
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">ÏµúÎåÄ Ìï†Ïù∏ Í∏àÏï°</label>
          <input type="number" id="modal-max-discount" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition" value="5000" min="0">
        </div>
      </div>

      <!-- Î∞úÍ∏â ÏàòÎüâ -->
      <div class="mb-4">
        <label class="block text-sm text-gray-400 mb-1">Î∞úÍ∏â ÏàòÎüâ</label>
        <input type="number" id="modal-quantity" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition" value="100" min="1" oninput="updateModalCost()">
      </div>

      <!-- Î∞∞Ìè¨ Î∞òÍ≤Ω -->
      <div class="mb-4 bg-gray-800/50 border border-green-500/30 rounded-xl p-4">
        <h4 class="font-bold text-green-400 flex items-center gap-2 mb-3">üìç Î∞∞Ìè¨ Î∞òÍ≤Ω</h4>
        <div class="mb-3">
          <select id="modal-radius-base" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-purple-500 transition">
            <option value="store">Îß§Ïû• Í∏∞Ï§Ä Î∞òÍ≤Ω</option>
            <option value="custom">Ïª§Ïä§ÌÖÄ ÏúÑÏπò</option>
          </select>
        </div>
        <div id="modal-map-container" class="w-full h-[200px] rounded-lg overflow-hidden border border-gray-700 mb-3 relative">
          <div id="coupon-radius-map" style="width: 100%; height: 100%;" tabindex="0"></div>
        </div>
        <div class="flex items-center justify-between text-sm mb-1">
          <span class="text-purple-400 font-bold flex items-center gap-1">üìç Î∞òÍ≤Ω: <span id="radius-display">5.0km</span></span>
          <span class="text-gray-500">50m ~ 20,000km</span>
        </div>
        <input type="range" id="modal-radius-slider" min="0" max="100" value="35" class="w-full accent-purple-500 cursor-pointer" oninput="updateRadiusDisplay(this.value)">
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>50m</span><span>500m</span><span>5km</span><span>50km</span><span>500km</span><span>20,000km</span>
        </div>
      </div>

      <!-- ÎπÑÏö© ÏöîÏïΩ Î∞î -->
      <div class="bg-gradient-to-r from-purple-900/50 to-cyan-900/50 rounded-xl p-4 border border-purple-500/30 mb-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-400">Î∞úÍ∏â ÏàòÎüâ: <span id="cost-bar-qty" class="text-white font-bold">100</span> Ïû•</p>
            <p class="text-xs text-gray-500">Îã®Í∞Ä: 100Ïõê / Ïû•</p>
          </div>
          <div class="text-right">
            <p class="text-xs text-gray-400">üí∞ Ï¥ù Í≤∞Ï†úÍ∏àÏï°</p>
            <p class="text-2xl font-black text-cyan-400" id="cost-bar-total">‚Ç©10,000</p>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="flex justify-end gap-3">
        <button onclick="closeNewCouponModal()" class="px-6 py-3 rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 transition">Ï∑®ÏÜå</button>
        <button onclick="goToPaymentStep()" class="px-6 py-3 rounded-lg bg-gradient-to-r from-purple-600 to-cyan-500 font-bold hover:opacity-90 transition">üí≥ Í≤∞Ï†ú Î∞è Ïø†Ìè∞ Î∞úÍ∏â Ïã†Ï≤≠</button>
      </div>
    </div>

    <!-- Step 2: Í≤∞Ï†ú ÌôïÏù∏ Î∞∞ÎÑà -->
    <div id="modal-step-2" class="p-6 hidden">
      <div class="flex flex-col items-center mb-5">
        <div class="w-14 h-14 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center mb-3"><span class="text-2xl">‚ö°</span></div>
        <h3 class="text-xl font-bold">Í≤∞Ï†ú ÌôïÏù∏</h3>
        <p class="text-gray-400 text-sm">ÏïÑÎûò ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÍ≥† Í≤∞Ï†úÎ•º ÏßÑÌñâÌï©ÎãàÎã§</p>
      </div>

      <div class="bg-gray-800 rounded-xl p-5 mb-5 border border-gray-700">
        <div class="flex justify-between py-2 border-b border-gray-700"><span class="text-gray-400">Ïø†Ìè∞Î™Ö</span><span class="font-bold" id="confirm-coupon-name">ÏÉà Ïø†Ìè∞</span></div>
        <div class="flex justify-between py-2 border-b border-gray-700"><span class="text-gray-400">Ìï†Ïù∏</span><span class="font-bold" id="confirm-discount">10%</span></div>
        <div class="flex justify-between py-2 border-b border-gray-700"><span class="text-gray-400">Î∞úÍ∏â ÏàòÎüâ</span><span class="font-bold" id="confirm-quantity">100Ïû•</span></div>
        <div class="flex justify-between py-2 border-b border-gray-700"><span class="text-gray-400">Îã®Í∞Ä</span><span class="font-bold">100Ïõê/Ïû•</span></div>
        <div class="flex justify-between py-2 border-b border-gray-700"><span class="text-gray-400">Í∏∞Í∞Ñ</span><span class="font-bold text-sm" id="confirm-period">2026-02-24 ~ 2026-03-24</span></div>
        <div class="flex justify-between py-2 border-b border-gray-700"><span class="text-gray-400">Î∞∞Ìè¨ Î∞òÍ≤Ω</span><span class="font-bold" id="confirm-radius">5.0km</span></div>
        <div class="flex justify-between items-center py-3 mt-2 bg-gradient-to-r from-purple-900/30 to-cyan-900/30 rounded-lg px-3 -mx-1">
          <span class="text-lg font-bold">üí∞ Ï¥ù Í≤∞Ï†úÍ∏àÏï°</span>
          <span class="text-2xl font-black text-cyan-400" id="confirm-total-cost">‚Ç©10,000</span>
        </div>
      </div>
      <p class="text-center text-sm text-yellow-400/80 mb-4">Í≤∞Ï†úÎ•º ÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
      <div class="flex justify-end gap-3">
        <button onclick="backToStep1()" class="px-6 py-3 rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 transition">Ï∑®ÏÜå</button>
        <button onclick="goToPaymentMethodStep()" class="px-6 py-3 rounded-lg bg-gradient-to-r from-green-600 to-cyan-500 font-bold hover:opacity-90 transition border border-cyan-400/30">ÌôïÏù∏</button>
      </div>
    </div>

    <!-- Step 3: Í≤∞Ï†ú ÏàòÎã® ÏÑ†ÌÉù -->
    <div id="modal-step-3" class="p-6 hidden">
      <div class="flex flex-col items-center mb-5">
        <div class="w-14 h-14 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center mb-3"><span class="text-2xl">üí≥</span></div>
        <h3 class="text-xl font-bold">Í≤∞Ï†ú ÏàòÎã®</h3>
        <p class="text-gray-400 text-sm">Í≤∞Ï†ú ÏàòÎã®ÏùÑ ÏÑ†ÌÉùÌï¥ Ï£ºÏÑ∏Ïöî</p>
      </div>

      <div class="bg-gradient-to-r from-purple-900/30 to-cyan-900/30 rounded-xl p-4 mb-5 border border-purple-500/20 text-center">
        <p class="text-sm text-gray-400">üí∞ Ï¥ù Í≤∞Ï†úÍ∏àÏï°</p>
        <p class="text-3xl font-black text-cyan-400" id="payment-total">‚Ç©10,000</p>
      </div>

      <!-- Í≤∞Ï†ú ÏàòÎã® Í∑∏Î¶¨Îìú -->
      <div class="grid grid-cols-2 gap-3 mb-5" id="payment-method-grid">
        <button onclick="selectPaymentMethod('card')" class="payment-method-btn p-4 rounded-xl border-2 border-gray-700 bg-gray-800/50 hover:border-purple-500 transition flex flex-col items-center gap-2" data-method="card">
          <span class="text-3xl">üí≥</span><span class="font-bold text-sm">Ïπ¥Îìú</span>
        </button>
        <button onclick="selectPaymentMethod('cash')" class="payment-method-btn p-4 rounded-xl border-2 border-gray-700 bg-gray-800/50 hover:border-purple-500 transition flex flex-col items-center gap-2" data-method="cash">
          <span class="text-3xl">üíµ</span><span class="font-bold text-sm">ÌòÑÍ∏à</span>
        </button>
        <button onclick="selectPaymentMethod('transfer')" class="payment-method-btn p-4 rounded-xl border-2 border-gray-700 bg-gray-800/50 hover:border-purple-500 transition flex flex-col items-center gap-2" data-method="transfer">
          <span class="text-3xl">üè¶</span><span class="font-bold text-sm">Í≥ÑÏ¢åÏù¥Ï≤¥</span>
        </button>
        <button onclick="selectPaymentMethod('kakao')" class="payment-method-btn p-4 rounded-xl border-2 border-gray-700 bg-gray-800/50 hover:border-purple-500 transition flex flex-col items-center gap-2" data-method="kakao">
          <span class="text-3xl">üü°</span><span class="font-bold text-sm">Ïπ¥Ïπ¥Ïò§ÌéòÏù¥</span>
        </button>
      </div>

      <!-- Îß§Ïû•ÏóêÏÑú Ìï†Ïù∏ Ï†ÅÏö© ÏïàÎÇ¥ -->
      <div class="bg-amber-900/20 border border-amber-500/30 rounded-xl p-3 mb-5">
        <p class="text-xs text-amber-400">üí° Í≤∞Ï†ú ÏôÑÎ£å ÌõÑ (Ï£º)Î∞úÎ°úÎ†à Í¥ÄÎ¶¨Ïûê ÏäπÏù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. ÏäπÏù∏ ÌõÑ Ïø†Ìè∞Ïù¥ Í≤åÏûÑÏóê ÏûêÎèô Î∞∞Ìè¨Îê©ÎãàÎã§.</p>
      </div>

      <div class="flex justify-end gap-3">
        <button onclick="backToStep2()" class="px-6 py-3 rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 transition">Ïù¥Ï†Ñ</button>
        <button id="btn-process-payment" onclick="processPayment()" class="px-6 py-3 rounded-lg bg-gradient-to-r from-green-600 to-cyan-500 font-bold hover:opacity-90 transition opacity-50 cursor-not-allowed" disabled>üí≥ Ï¶âÏãú Í≤∞Ï†úÌïòÍ∏∞</button>
      </div>
    </div>

    <!-- Step 4: Î∞úÍ∏â ÏôÑÎ£å (ÏäπÏù∏ ÎåÄÍ∏∞) -->
    <div id="modal-step-4" class="p-6 hidden">
      <div class="flex flex-col items-center mb-6">
        <div class="w-20 h-20 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 flex items-center justify-center mb-4 animate-bounce"><span class="text-4xl">üéâ</span></div>
        <h3 class="text-xl font-bold">Ïø†Ìè∞ Î∞úÍ∏â Ïã†Ï≤≠ ÏôÑÎ£å!</h3>
        <p class="text-gray-400 text-sm mt-1">(Ï£º)Î∞úÎ°úÎ†à Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏäµÎãàÎã§</p>
      </div>

      <div class="bg-gray-800 rounded-xl p-5 mb-5 border border-gray-700">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center"><span class="text-xl">‚è≥</span></div>
          <div>
            <p class="font-bold text-yellow-400">ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë</p>
            <p class="text-xs text-gray-500">Í¥ÄÎ¶¨ÏûêÍ∞Ä ÌôïÏù∏ ÌõÑ ÏäπÏù∏Ìï©ÎãàÎã§ (ÏòÅÏóÖÏùº Í∏∞Ï§Ä 1~2Ïùº)</p>
          </div>
        </div>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between"><span class="text-gray-400">Ïø†Ìè∞Î™Ö</span><span class="font-bold" id="complete-coupon-name"></span></div>
          <div class="flex justify-between"><span class="text-gray-400">Î∞úÍ∏â ÏàòÎüâ</span><span class="font-bold" id="complete-quantity"></span></div>
          <div class="flex justify-between"><span class="text-gray-400">Í≤∞Ï†úÍ∏àÏï°</span><span class="font-bold text-cyan-400" id="complete-amount"></span></div>
          <div class="flex justify-between"><span class="text-gray-400">Í≤∞Ï†úÏàòÎã®</span><span class="font-bold" id="complete-method"></span></div>
        </div>
      </div>

      <!-- ÏàúÌôò Íµ¨Ï°∞ ÏïàÎÇ¥ -->
      <div class="bg-gradient-to-r from-purple-900/30 to-cyan-900/30 rounded-xl p-4 mb-5 border border-purple-500/20">
        <p class="text-xs font-bold text-purple-400 mb-2">üîÑ Ïø†Ìè∞ ÏàúÌôò Íµ¨Ï°∞</p>
        <div class="flex items-center gap-1 text-xs text-gray-300 flex-wrap">
          <span class="bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full">‚úÖ Î∞úÍ∏âÏã†Ï≤≠</span>
          <span>‚Üí</span>
          <span class="bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full">‚è≥ ÏäπÏù∏ÎåÄÍ∏∞</span>
          <span>‚Üí</span>
          <span class="bg-purple-500/20 text-purple-300 px-2 py-0.5 rounded-full">üéÆ Í≤åÏûÑÎ∞∞Ìè¨</span>
          <span>‚Üí</span>
          <span class="bg-cyan-500/20 text-cyan-400 px-2 py-0.5 rounded-full">üí∞ ÏßÄÍ∞ëÏ†ÄÏû•</span>
          <span>‚Üí</span>
          <span class="bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded-full">üè™ Îß§Ïû•ÏÇ¨Ïö©</span>
          <span>‚Üí</span>
          <span class="bg-pink-500/20 text-pink-400 px-2 py-0.5 rounded-full">üíµ ÏàòÏùµÏàúÌôò</span>
        </div>
      </div>

      <button onclick="closeNewCouponModal()" class="w-full py-3 rounded-lg bg-gradient-to-r from-purple-600 to-cyan-500 font-bold hover:opacity-90 transition text-center">‚ú® ÌôïÏù∏</button>
    </div>
  </div>
</div>
</div><a href="blob:null/4731860d-cd34-4203-93fa-fc5a5ba6fe08" download="airctt-interactive-final-COMPLETE.html" style="display: none;"></a><script id="coupon-management-enhanced-v2">
// ========================================
// AIRCTT Enhanced Coupon Management System
// Version 2.0 - Full Feature Integration
// ========================================

document.addEventListener('DOMContentLoaded', function() {
  setTimeout(function() {
    initializeEnhancedCouponSystem();
  }, 1000);
});

function initializeEnhancedCouponSystem() {
  // Global state
  window.couponManagementData = {
    coupons: [
      {
        id: 1, name: 'ÏïÑÎØ∏ ÌïúÏ†ïÏãù 30% Ìï†Ïù∏', description: 'Ï†Ñ Î©îÎâ¥ 30% Ìï†Ïù∏',
        discountType: 'percent', discountValue: 30, quantity: 100, used: 45,
        startDate: '2025-12-01', endDate: '2026-05-31', status: 'active',
        rarity: 'EPIC', radius: 5, minPayment: 20000, maxDiscount: 15000, image: null
      },
      {
        id: 2, name: 'ÏïÑÎØ∏ Îã§Î∞© Ïª§Ìîº 50% Ìï†Ïù∏', description: 'Ïª§Ìîº Î©îÎâ¥ 50% Ìï†Ïù∏',
        discountType: 'percent', discountValue: 50, quantity: 50, used: 12,
        startDate: '2025-11-01', endDate: '2026-03-15', status: 'pending',
        rarity: 'RARE', radius: 3, minPayment: 5000, maxDiscount: 10000, image: null
      }
    ],
    currentFilter: 'all',
    modalStep: 1
  };

  window.couponRadiusMap = null;
  window.couponRadiusCircle = null;

  // ---- Utility Functions ----
  window.sliderToRadius = function(val) {
    var minR = 0.05, maxR = 20000;
    var logMin = Math.log(minR), logMax = Math.log(maxR);
    return Math.exp(logMin + (val / 100) * (logMax - logMin));
  };

  window.formatRadius = function(km) {
    if (km < 1) return (km * 1000).toFixed(0) + 'm';
    if (km < 100) return km.toFixed(1) + 'km';
    return Math.round(km).toLocaleString() + 'km';
  };

  window.updateRadiusDisplay = function(val) {
    var km = sliderToRadius(val);
    document.getElementById('radius-display').textContent = formatRadius(km);
    if (window.couponRadiusCircle && window.couponRadiusMap) {
      var radiusMeters = Math.min(km * 1000, 500000);
      window.couponRadiusCircle.setRadius(radiusMeters);
      try { window.couponRadiusMap.fitBounds(window.couponRadiusCircle.getBounds(), {padding: [20, 20]}); } catch(e) {}
    }
  };

  // ---- Modal Functions ----
  window.openNewCouponModal = function() {
    var modal = document.getElementById('new-coupon-modal');
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
    var today = new Date();
    var future = new Date(today); future.setMonth(future.getMonth() + 1);
    document.getElementById('modal-start-date').value = today.toISOString().split('T')[0];
    document.getElementById('modal-end-date').value = future.toISOString().split('T')[0];
    window.couponManagementData.modalStep = 1;
    document.getElementById('modal-step-1').classList.remove('hidden');
    document.getElementById('modal-step-2').classList.add('hidden');
    var step3 = document.getElementById('modal-step-3'); if (step3) step3.classList.add('hidden');
    var step4 = document.getElementById('modal-step-4'); if (step4) step4.classList.add('hidden');
    updateStepIndicator(1);
    // Reset form
    document.getElementById('modal-coupon-name').value = 'ÏÉà Ïø†Ìè∞';
    document.getElementById('modal-coupon-desc').value = '';
    document.getElementById('modal-discount-value').value = '10';
    document.getElementById('modal-quantity').value = '100';
    document.getElementById('modal-min-payment').value = '1000';
    document.getElementById('modal-max-discount').value = '5000';
    document.getElementById('modal-radius-slider').value = '35';
    document.getElementById('radius-display').textContent = '5.0km';
    // ÌîÑÎ¶¨Î∑∞ Î¶¨ÏÖã
    var previewCard = document.getElementById('modal-coupon-preview-card');
    if (previewCard) previewCard.classList.add('hidden');
    var imgEl = document.getElementById('modal-preview-img');
    var videoEl = document.getElementById('modal-preview-video');
    if (imgEl) { imgEl.style.display = 'none'; imgEl.src = ''; }
    if (videoEl) { videoEl.style.display = 'none'; videoEl.src = ''; }
    var changeBtn = document.getElementById('modal-preview-change');
    if (changeBtn) changeBtn.style.display = 'none';
    document.getElementById('modal-image-placeholder').classList.remove('hidden');
    var previewDiscount = document.getElementById('modal-preview-discount');
    if (previewDiscount) previewDiscount.textContent = '10%';
    setTimeout(initCouponMap, 300);
  };

  window.closeNewCouponModal = function() {
    var modal = document.getElementById('new-coupon-modal');
    modal.classList.add('hidden');
    modal.style.display = 'none';
    if (window.couponRadiusMap) { window.couponRadiusMap.remove(); window.couponRadiusMap = null; window.couponRadiusCircle = null; }
  };

  window.initCouponMap = function() {
    var mapContainer = document.getElementById('coupon-radius-map');
    if (!mapContainer || typeof L === 'undefined') return;
    if (window.couponRadiusMap) { window.couponRadiusMap.remove(); window.couponRadiusMap = null; }
    var center = [37.5065, 127.0536];
    window.couponRadiusMap = L.map('coupon-radius-map', { center: center, zoom: 12, zoomControl: false, attributionControl: false });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(window.couponRadiusMap);
    L.marker(center, {
      icon: L.divIcon({
        className: 'custom-marker',
        html: '<div style="background:linear-gradient(135deg,#8b5cf6,#06b6d4);width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:16px;box-shadow:0 0 15px rgba(139,92,246,0.5);border:2px solid white;">üìç</div>',
        iconSize: [30, 30], iconAnchor: [15, 15]
      })
    }).addTo(window.couponRadiusMap);
    var sliderVal = document.getElementById('modal-radius-slider').value;
    var km = sliderToRadius(sliderVal);
    window.couponRadiusCircle = L.circle(center, {
      radius: Math.min(km * 1000, 500000), color: '#8b5cf6', fillColor: '#8b5cf6',
      fillOpacity: 0.15, weight: 2, dashArray: '5, 5'
    }).addTo(window.couponRadiusMap);
    try { window.couponRadiusMap.fitBounds(window.couponRadiusCircle.getBounds(), {padding: [20, 20]}); } catch(e) {}
    setTimeout(function() { window.couponRadiusMap.invalidateSize(); }, 100);
  };

  window.updateStepIndicator = function(step) {
    for (var i = 1; i <= 4; i++) {
      var dot = document.getElementById('step-dot-' + i);
      var line = document.getElementById('step-line-' + i);
      if (dot) {
        if (i < step) dot.className = 'w-7 h-7 rounded-full bg-green-500 flex items-center justify-center text-xs font-bold shrink-0';
        else if (i === step) dot.className = 'w-7 h-7 rounded-full bg-purple-600 flex items-center justify-center text-xs font-bold shrink-0';
        else dot.className = 'w-7 h-7 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold shrink-0';
      }
      if (line) {
        line.className = i < step ? 'flex-1 h-0.5 bg-green-500/50' : 'flex-1 h-0.5 bg-gray-700';
      }
    }
  };

  // ---- Payment Functions ----
  window.goToPaymentStep = function() {
    var name = document.getElementById('modal-coupon-name').value.trim();
    var startDate = document.getElementById('modal-start-date').value;
    var endDate = document.getElementById('modal-end-date').value;
    var quantity = parseInt(document.getElementById('modal-quantity').value) || 0;
    if (!name) { alert('Ïø†Ìè∞Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
    if (!startDate || !endDate) { alert('ÏãúÏûëÏùºÍ≥º Ï¢ÖÎ£åÏùºÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.'); return; }
    if (quantity < 1) { alert('Î∞úÍ∏â ÏàòÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
    var discType = document.getElementById('modal-discount-type').value;
    var discValue = document.getElementById('modal-discount-value').value;
    var discText = discType === 'percent' ? discValue + '%' : '‚Ç©' + Number(discValue).toLocaleString();
    document.getElementById('confirm-coupon-name').textContent = name;
    document.getElementById('confirm-discount').textContent = discText;
    document.getElementById('confirm-quantity').textContent = quantity + 'Ïû•';
    document.getElementById('confirm-period').textContent = startDate + ' ~ ' + endDate;
    var sliderVal = document.getElementById('modal-radius-slider').value;
    var km = sliderToRadius(sliderVal);
    document.getElementById('confirm-radius').textContent = formatRadius(km);
    document.getElementById('confirm-total-cost').textContent = '‚Ç©' + (quantity * 100).toLocaleString();
    document.getElementById('modal-step-1').classList.add('hidden');
    document.getElementById('modal-step-2').classList.remove('hidden');
    var s3 = document.getElementById('modal-step-3'); if(s3) s3.classList.add('hidden');
    var s4 = document.getElementById('modal-step-4'); if(s4) s4.classList.add('hidden');
    updateStepIndicator(2);
  };

  window.backToStep1 = function() {
    document.getElementById('modal-step-1').classList.remove('hidden');
    document.getElementById('modal-step-2').classList.add('hidden');
    var s3 = document.getElementById('modal-step-3'); if(s3) s3.classList.add('hidden');
    var s4 = document.getElementById('modal-step-4'); if(s4) s4.classList.add('hidden');
    updateStepIndicator(1);
    setTimeout(initCouponMap, 300);
  };

  window.backToStep2 = function() {
    document.getElementById('modal-step-2').classList.remove('hidden');
    var s3 = document.getElementById('modal-step-3'); if(s3) s3.classList.add('hidden');
    updateStepIndicator(2);
  };

  window.goToPaymentMethodStep = function() {
    var quantity = parseInt(document.getElementById('modal-quantity').value) || 100;
    document.getElementById('payment-total').textContent = '‚Ç©' + (quantity * 100).toLocaleString();
    document.getElementById('modal-step-2').classList.add('hidden');
    var s3 = document.getElementById('modal-step-3'); if(s3) s3.classList.remove('hidden');
    // Í≤∞Ï†ú ÏàòÎã® Ï¥àÍ∏∞Ìôî
    window._selectedPayMethod = null;
    document.querySelectorAll('.payment-method-btn').forEach(function(b) { b.classList.remove('border-purple-500', 'bg-purple-500/20'); b.classList.add('border-gray-700'); });
    var btn = document.getElementById('btn-process-payment');
    if (btn) { btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed'); }
    updateStepIndicator(3);
  };

  window.selectPaymentMethod = function(method) {
    window._selectedPayMethod = method;
    document.querySelectorAll('.payment-method-btn').forEach(function(b) {
      if (b.getAttribute('data-method') === method) {
        b.classList.remove('border-gray-700');
        b.classList.add('border-purple-500', 'bg-purple-500/20');
      } else {
        b.classList.remove('border-purple-500', 'bg-purple-500/20');
        b.classList.add('border-gray-700');
      }
    });
    var btn = document.getElementById('btn-process-payment');
    if (btn) { btn.disabled = false; btn.classList.remove('opacity-50', 'cursor-not-allowed'); }
  };

  window.processPayment = function() {
    if (!window._selectedPayMethod) { alert('Í≤∞Ï†ú ÏàòÎã®ÏùÑ ÏÑ†ÌÉùÌï¥ Ï£ºÏÑ∏Ïöî.'); return; }
    var methodNames = { card: 'üí≥ Ïπ¥Îìú', cash: 'üíµ ÌòÑÍ∏à', transfer: 'üè¶ Í≥ÑÏ¢åÏù¥Ï≤¥', kakao: 'üü° Ïπ¥Ïπ¥Ïò§ÌéòÏù¥' };
    var name = document.getElementById('modal-coupon-name').value.trim();
    var desc = document.getElementById('modal-coupon-desc').value.trim();
    var discType = document.getElementById('modal-discount-type').value;
    var discValue = parseInt(document.getElementById('modal-discount-value').value) || 10;
    var startDate = document.getElementById('modal-start-date').value;
    var endDate = document.getElementById('modal-end-date').value;
    var quantity = parseInt(document.getElementById('modal-quantity').value) || 100;
    var minPayment = parseInt(document.getElementById('modal-min-payment').value) || 0;
    var maxDiscount = parseInt(document.getElementById('modal-max-discount').value) || 0;
    var sliderVal = document.getElementById('modal-radius-slider').value;
    var km = sliderToRadius(sliderVal);

    // ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ/ÏòÅÏÉÅ URL Í∞ÄÏ†∏Ïò§Í∏∞
    var uploadedImageUrl = null;
    var isVideo = false;
    var imgEl = document.getElementById('modal-preview-img');
    var videoEl = document.getElementById('modal-preview-video');
    if (imgEl && imgEl.src && imgEl.style.display !== 'none' && imgEl.src.indexOf('blob:') === 0) {
      uploadedImageUrl = imgEl.src;
    } else if (videoEl && videoEl.src && videoEl.style.display !== 'none' && videoEl.src.indexOf('blob:') === 0) {
      uploadedImageUrl = videoEl.src;
      isVideo = true;
    }

    // ÏÉà Ïø†Ìè∞ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (pending ÏÉÅÌÉú ‚Äî Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞)
    var newCoupon = {
      id: Date.now(), name: name,
      description: desc || (discValue + (discType === 'percent' ? '% Ìï†Ïù∏ ' : 'Ïõê Ìï†Ïù∏ ') + name),
      discountType: discType, discountValue: discValue, quantity: quantity, used: 0,
      startDate: startDate, endDate: endDate, status: 'pending',
      rarity: discValue >= 50 ? 'EPIC' : (discValue >= 30 ? 'RARE' : 'COMMON'),
      radius: km, minPayment: minPayment, maxDiscount: maxDiscount,
      image: uploadedImageUrl,
      imageIsVideo: isVideo,
      paymentMethod: window._selectedPayMethod,
      paymentAmount: quantity * 100,
      createdAt: new Date().toISOString()
    };
    window.couponManagementData.coupons.unshift(newCoupon);

    // Step 4: ÏôÑÎ£å ÌôîÎ©¥ÏúºÎ°ú
    document.getElementById('complete-coupon-name').textContent = name;
    document.getElementById('complete-quantity').textContent = quantity + 'Ïû•';
    document.getElementById('complete-amount').textContent = '‚Ç©' + (quantity * 100).toLocaleString();
    document.getElementById('complete-method').textContent = methodNames[window._selectedPayMethod] || 'Ïπ¥Îìú';

    var s3 = document.getElementById('modal-step-3'); if(s3) s3.classList.add('hidden');
    var s4 = document.getElementById('modal-step-4'); if(s4) s4.classList.remove('hidden');
    updateStepIndicator(4);

    renderCouponManagementList();
    updateCouponStats();
    showCouponNotification('Ïø†Ìè∞ Î∞úÍ∏â Ïã†Ï≤≠ ÏôÑÎ£å! (' + quantity + 'Ïû•, ‚Ç©' + (quantity * 100).toLocaleString() + ') ‚Äî Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ë', 'success');

    // ‚≠ê Í≤åÏûÑÏóêÎèÑ pending Ïø†Ìè∞ÏúºÎ°ú Îì±Î°ù (ÏäπÏù∏ ÌõÑ activated)
    if (typeof gameIssuedCoupons !== 'undefined') {
      var storeEmoji = 'üè™';
      var storeId = 'store-001';
      if (typeof currentUser !== 'undefined' && currentUser && currentUser.store_id) {
        storeId = currentUser.store_id;
      }
      gameIssuedCoupons.push({
        id: 'new-coupon-' + newCoupon.id,
        store_id: storeId,
        store_name: name.split(' ')[0],
        store_emoji: storeEmoji,
        title: name,
        discount_type: discType === 'percent' ? 'percentage' : 'fixed',
        discount_value: discValue,
        rarity: newCoupon.rarity.toLowerCase(),
        total_quantity: quantity,
        remaining: quantity,
        status: 'pending',
        expiry: endDate,
        image_url: uploadedImageUrl || null,
        website_url: null
      });
    }
  };

  // ÎπÑÏö© Î∞î ÏóÖÎç∞Ïù¥Ìä∏ (Î∞úÍ∏â ÏàòÎüâ Î≥ÄÍ≤Ω Ïãú)
  window.updateModalCost = function() {
    var qty = parseInt(document.getElementById('modal-quantity').value) || 0;
    var costBarQty = document.getElementById('cost-bar-qty');
    var costBarTotal = document.getElementById('cost-bar-total');
    if (costBarQty) costBarQty.textContent = qty;
    if (costBarTotal) costBarTotal.textContent = '‚Ç©' + (qty * 100).toLocaleString();
  };

  window.showCouponNotification = function(message, type) {
    var noti = document.createElement('div');
    noti.className = 'fixed top-4 right-4 z-[10000] p-4 rounded-xl shadow-2xl border max-w-sm';
    if (type === 'success') {
      noti.style.cssText = 'background:linear-gradient(135deg,#065f46,#064e3b);border-color:#10b981;';
      noti.innerHTML = '<div class="flex items-center gap-3"><span class="text-2xl">‚úÖ</span><div><p class="font-bold text-green-300">ÏÑ±Í≥µ!</p><p class="text-sm text-green-200">' + message + '</p></div></div>';
    } else {
      noti.style.cssText = 'background:linear-gradient(135deg,#7c2d12,#451a03);border-color:#f59e0b;';
      noti.innerHTML = '<div class="flex items-center gap-3"><span class="text-2xl">üí°</span><div><p class="font-bold text-yellow-300">ÏïåÎ¶º</p><p class="text-sm text-yellow-200">' + message + '</p></div></div>';
    }
    document.body.appendChild(noti);
    setTimeout(function() { noti.remove(); }, 4000);
  };

  window.previewCouponImage = function(input) {
    if (input.files && input.files[0]) {
      var file = input.files[0];
      var isVideo = file.type.startsWith('video/');
      var url = URL.createObjectURL(file);

      var previewCard = document.getElementById('modal-coupon-preview-card');
      var placeholder = document.getElementById('modal-image-placeholder');
      var imgEl = document.getElementById('modal-preview-img');
      var videoEl = document.getElementById('modal-preview-video');
      var changeBtn = document.getElementById('modal-preview-change');

      // ÌîÑÎ¶¨Î∑∞ Ïπ¥Îìú ÌëúÏãú, ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî Ïà®ÍπÄ
      if (previewCard) previewCard.classList.remove('hidden');
      if (placeholder) placeholder.classList.add('hidden');
      if (changeBtn) changeBtn.style.display = '';

      if (isVideo) {
        // ÎπÑÎîîÏò§ ÌîÑÎ¶¨Î∑∞
        if (imgEl) imgEl.style.display = 'none';
        if (videoEl) {
          videoEl.src = url;
          videoEl.style.display = 'block';
          videoEl.play().catch(function(){});
        }
      } else {
        // Ïù¥ÎØ∏ÏßÄ ÌîÑÎ¶¨Î∑∞
        if (videoEl) videoEl.style.display = 'none';
        if (imgEl) {
          imgEl.src = url;
          imgEl.style.display = 'block';
        }
      }

      // Ìï†Ïù∏ Ï†ïÎ≥¥ ÎèôÍ∏∞Ìôî
      updatePreviewDiscount();
    }
  };

  // ÌîÑÎ¶¨Î∑∞ Ïπ¥ÎìúÏùò Ìï†Ïù∏ Ï†ïÎ≥¥Î•º ÌòÑÏû¨ ÏûÖÎ†•Í∞íÍ≥º ÎèôÍ∏∞Ìôî
  window.updatePreviewDiscount = function() {
    var typeEl = document.getElementById('modal-discount-type');
    var valueEl = document.getElementById('modal-discount-value');
    var previewEl = document.getElementById('modal-preview-discount');
    if (!previewEl || !typeEl || !valueEl) return;
    var val = valueEl.value || '10';
    var type = typeEl.value;
    if (type === 'percent') {
      previewEl.textContent = val + '%';
    } else {
      previewEl.textContent = '‚Ç©' + Number(val).toLocaleString();
    }
  };

  window.updateDiscountLabel = function() {
    var type = document.getElementById('modal-discount-type').value;
    var input = document.getElementById('modal-discount-value');
    if (type === 'percent') { input.max = 100; input.placeholder = '10'; }
    else { input.max = 999999; input.placeholder = '5000'; }
    // ÌîÑÎ¶¨Î∑∞ Ìï†Ïù∏ Ï†ïÎ≥¥ÎèÑ Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
    updatePreviewDiscount();
  };

  // ---- List Rendering ----
  window.renderCouponManagementList = function() {
    var listEl = document.getElementById('coupon-management-list');
    if (!listEl) return;
    var data = window.couponManagementData;
    var filter = data.currentFilter;
    var search = (document.getElementById('coupon-search') ? document.getElementById('coupon-search').value : '').toLowerCase();
    var filtered = data.coupons.slice();
    if (filter === 'active') filtered = filtered.filter(function(c){return c.status === 'active';});
    else if (filter === 'expired') filtered = filtered.filter(function(c){return c.status === 'expired';});
    else if (filter === 'pending') filtered = filtered.filter(function(c){return c.status === 'pending';});
    if (search) filtered = filtered.filter(function(c){return c.name.toLowerCase().indexOf(search) >= 0 || c.description.toLowerCase().indexOf(search) >= 0;});
    if (filtered.length === 0) { listEl.innerHTML = '<div class="text-center py-12 text-gray-500"><p class="text-4xl mb-3">üé´</p><p>Îì±Î°ùÎêú Ïø†Ìè∞Ïù¥ ÏóÜÏäµÎãàÎã§</p></div>'; return; }
    var rarityColors = {'COMMON':'bg-gray-600','RARE':'bg-blue-600','EPIC':'bg-purple-600','LEGENDARY':'bg-yellow-600','MYTHIC':'bg-red-600'};
    var statusMap = {active:{text:'text-green-400',label:'‚óè ÏßÑÌñâÏ§ë'},pending:{text:'text-yellow-400',label:'‚è≥ ÎåÄÍ∏∞Ï§ë'},expired:{text:'text-red-400',label:'‚óè ÎßåÎ£å'}};
    listEl.innerHTML = filtered.map(function(c) {
      var st = statusMap[c.status] || statusMap.pending;
      var pct = c.quantity > 0 ? Math.round((c.used/c.quantity)*100) : 0;
      var discText = c.discountType==='percent' ? c.discountValue+'%' : c.discountValue.toLocaleString()+'Ïõê';
      // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú, ÏóÜÏúºÎ©¥ Ïù¥Î™®ÏßÄ
      var thumbHtml = c.image ?
        '<img src="' + c.image + '" class="w-full h-full object-cover" alt="' + c.name + '">' :
        (c.imageIsVideo && c.image ? '<video src="' + c.image + '" class="w-full h-full object-cover" autoplay muted loop></video>' :
        '<span class="text-3xl">üé´</span>');
      // ÏäπÏù∏ Î≤ÑÌäº (pending ÏÉÅÌÉúÏùº ÎïåÎßå)
      var approveBtn = c.status === 'pending' ?
        '<button onclick="event.stopPropagation();approveManagedCoupon(' + c.id + ')" class="px-3 py-1.5 bg-green-500 hover:bg-green-400 text-white text-xs font-bold rounded-lg transition whitespace-nowrap">‚úÖ ÏäπÏù∏</button>' : '';
      return '<div class="bg-gray-800/80 border border-gray-700 rounded-xl p-4 flex items-center gap-4 hover:border-purple-500/50 transition">' +
        '<div class="relative w-20 h-20 rounded-lg bg-gray-700 flex-shrink-0 flex items-center justify-center overflow-hidden">' +
          thumbHtml +
          '<span class="absolute top-1 left-1 text-xs font-bold px-1.5 py-0.5 rounded bg-red-500/90 text-white">' + discText + '</span>' +
        '</div>' +
        '<div class="flex-1 min-w-0">' +
          '<div class="flex items-center gap-2 mb-1">' +
            '<span class="text-xs px-2 py-0.5 rounded font-bold ' + (rarityColors[c.rarity]||'bg-gray-600') + '">' + c.rarity + '</span>' +
            '<h4 class="font-bold truncate">' + c.name + '</h4>' +
          '</div>' +
          '<p class="text-sm text-gray-400 truncate">' + c.description + '</p>' +
          '<div class="flex items-center gap-4 text-xs text-gray-500 mt-1">' +
            '<span>üìÖ ' + c.endDate + ' ÍπåÏßÄ</span><span>üë• ' + c.used + ' / ' + c.quantity + ' ÏÇ¨Ïö©</span>' +
          '</div>' +
          (function(){
            // ‚≠ê Ïã§ÏãúÍ∞Ñ Î∞∞Ìè¨/ÏÇ¨Ïö© Ïà´Ïûê Í≥ÑÏÇ∞
            var gameC = (typeof gameIssuedCoupons!=='undefined') ? gameIssuedCoupons.find(function(gc){return gc.id==='new-coupon-'+c.id || gc.title===c.name;}) : null;
            var walletAll = JSON.parse(localStorage.getItem('airctt_coupons')||'[]');
            var inWallet = walletAll.filter(function(w){return w.title===c.name || w.store_name===c.name.split(' ')[0];}).length;
            var deployed = gameC ? (gameC.total_quantity - gameC.remaining) : c.used;
            var remaining = gameC ? gameC.remaining : (c.quantity - c.used);
            var usedAtStore = c.used;
            return '<div class="flex items-center gap-2 mt-2 flex-wrap">' +
              '<span class="text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-300" title="Í≤åÏûÑÏóêÏÑú Î∞∞Ìè¨Îê®">üéÆ Î∞∞Ìè¨ ' + deployed + '</span>' +
              '<span class="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300" title="Í≥†Í∞ù ÏßÄÍ∞ëÏóê Î≥¥Í¥ÄÏ§ë">üëõ ÏßÄÍ∞ë ' + inWallet + '</span>' +
              '<span class="text-xs px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-300" title="Îß§Ïû•ÏóêÏÑú ÏÇ¨Ïö©Îê®">üè™ ÏÇ¨Ïö© ' + usedAtStore + '</span>' +
              '<span class="text-xs px-2 py-1 rounded-full bg-purple-500/20 text-purple-300" title="ÏûîÏó¨ ÏàòÎüâ">üì¶ ÏûîÏó¨ ' + remaining + '</span>' +
            '</div>';
          })() +
          '<div class="mt-2 h-1.5 bg-gray-700 rounded-full overflow-hidden">' +
            '<div class="h-full bg-gradient-to-r from-purple-500 to-cyan-500 rounded-full" style="width:' + pct + '%"></div>' +
          '</div>' +
        '</div>' +
        '<div class="flex flex-col items-end gap-2 flex-shrink-0">' +
          '<span class="' + st.text + ' text-sm font-bold">' + st.label + '</span>' +
          approveBtn +
          '<button onclick="deleteManagedCoupon(' + c.id + ')" class="text-gray-500 hover:text-red-400 transition">üóëÔ∏è</button>' +
        '</div></div>';
    }).join('');
  };

  window.setCouponFilter = function(filter) {
    window.couponManagementData.currentFilter = filter;
    document.querySelectorAll('.coupon-filter-btn').forEach(function(btn) {
      btn.className = btn.getAttribute('data-filter') === filter ?
        'coupon-filter-btn active px-4 py-2 rounded-lg bg-purple-600 text-white font-bold transition' :
        'coupon-filter-btn px-4 py-2 rounded-lg bg-gray-800 text-gray-400 font-bold hover:bg-gray-700 transition';
    });
    renderCouponManagementList();
  };

  window.filterCouponList = function() { renderCouponManagementList(); };

  // ‚≠ê Ïø†Ìè∞ ÏäπÏù∏ ‚Üí Í≤åÏûÑÏóê Î∞∞Ìè¨!
  window.approveManagedCoupon = function(id) {
    var coupon = window.couponManagementData.coupons.find(function(c){ return c.id === id; });
    if (!coupon) return;
    if (coupon.status !== 'pending') { showCouponNotification('Ïù¥ÎØ∏ Ï≤òÎ¶¨Îêú Ïø†Ìè∞ÏûÖÎãàÎã§.', 'info'); return; }

    // 1. Ïø†Ìè∞ Í¥ÄÎ¶¨ Î™©Î°ùÏóêÏÑú ÏÉÅÌÉúÎ•º activeÎ°ú Î≥ÄÍ≤Ω
    coupon.status = 'active';

    // 2. gameIssuedCouponsÏóêÏÑú Ìï¥Îãπ Ïø†Ìè∞ Ï∞æÏïÑÏÑú approvedÎ°ú Î≥ÄÍ≤Ω
    if (typeof gameIssuedCoupons !== 'undefined') {
      var gameC = gameIssuedCoupons.find(function(gc){ return gc.id === 'new-coupon-' + id; });
      if (gameC) {
        gameC.status = 'approved';
      } else {
        // gameIssuedCouponsÏóê ÏóÜÏúºÎ©¥ ÏÉàÎ°ú Ï∂îÍ∞Ä
        var storeId = 'store-001';
        if (typeof currentUser !== 'undefined' && currentUser && currentUser.store_id) storeId = currentUser.store_id;
        gameIssuedCoupons.push({
          id: 'new-coupon-' + id,
          store_id: storeId,
          store_name: coupon.name.split(' ')[0],
          store_emoji: 'üè™',
          title: coupon.name,
          discount_type: coupon.discountType === 'percent' ? 'percentage' : 'fixed',
          discount_value: coupon.discountValue,
          rarity: (coupon.rarity || 'COMMON').toLowerCase(),
          total_quantity: coupon.quantity,
          remaining: coupon.quantity,
          status: 'approved',
          expiry: coupon.endDate,
          image_url: coupon.image || null,
          website_url: null
        });
      }
    }

    renderCouponManagementList();
    updateCouponStats();
    // ‚≠ê Í¥ÄÎ¶¨Ïûê Ìå®ÎÑêÎèÑ Ïã§ÏãúÍ∞Ñ Í∞±Ïã†
    if (typeof refreshAdminStats === 'function') refreshAdminStats();
    if (typeof renderPendingCoupons === 'function') renderPendingCoupons();
    if (typeof renderAdminApprovedList === 'function') renderAdminApprovedList();
    showCouponNotification('‚úÖ "' + coupon.name + '" Ïø†Ìè∞Ïù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§! Í≤åÏûÑÏóê Î∞∞Ìè¨Îê©ÎãàÎã§ üéÆ', 'success');
  };

  window.deleteManagedCoupon = function(id) {
    if (!confirm('Ïù¥ Ïø†Ìè∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
    window.couponManagementData.coupons = window.couponManagementData.coupons.filter(function(c){return c.id !== id;});
    renderCouponManagementList(); updateCouponStats();
    // ‚≠ê Í¥ÄÎ¶¨Ïûê Ìå®ÎÑêÎèÑ Í∞±Ïã†
    if (typeof refreshAdminStats === 'function') refreshAdminStats();
    if (typeof renderPendingCoupons === 'function') renderPendingCoupons();
    showCouponNotification('Ïø†Ìè∞Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'info');
  };

  window.updateCouponStats = function() {
    var data = window.couponManagementData.coupons;
    var total = data.length;
    var active = data.filter(function(c){return c.status === 'active';}).length;
    var totalUsed = data.reduce(function(s,c){return s+c.used;}, 0);
    var totalQty = data.reduce(function(s,c){return s+c.quantity;}, 0);
    var rate = totalQty > 0 ? Math.round((totalUsed/totalQty)*100) : 0;
    var e1=document.getElementById('stat-total-coupons'),e2=document.getElementById('stat-active-coupons'),e3=document.getElementById('stat-total-used'),e4=document.getElementById('stat-usage-rate');
    if(e1)e1.textContent=total;if(e2)e2.textContent=active;if(e3)e3.textContent=totalUsed;if(e4)e4.textContent=rate+'%';
  };

  // ---- AI Generation ----
  window.aiGenerateCoupon = function() {
    showCouponNotification('AIÍ∞Ä ÏµúÏ†ÅÏùò Ïø†Ìè∞ÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'info');
    setTimeout(function() {
      openNewCouponModal();
      setTimeout(function() {
        document.getElementById('modal-coupon-name').value = 'AI Ï∂îÏ≤ú: Í≤®Ïö∏ ÌäπÎ≥Ñ Ìï†Ïù∏';
        document.getElementById('modal-coupon-desc').value = 'AIÍ∞Ä Î∂ÑÏÑùÌïú ÏµúÏ†ÅÏùò Ìï†Ïù∏ Ïø†Ìè∞ÏûÖÎãàÎã§. Îß§Ï∂ú Ï¶ùÎåÄ ÏòàÏÉÅ Ìö®Í≥º: +23%';
        document.getElementById('modal-discount-value').value = '25';
        document.getElementById('modal-quantity').value = '200';
        document.getElementById('modal-min-payment').value = '15000';
        document.getElementById('modal-max-discount').value = '10000';
        showCouponNotification('AIÍ∞Ä ÏµúÏ†ÅÏùò Ïø†Ìè∞ÏùÑ Ï∂îÏ≤úÌñàÏäµÎãàÎã§!', 'success');
      }, 500);
    }, 1500);
  };

  window.aiAutoFillCoupon = function() {
    var names = ['Ï†êÏã¨ ÌäπÏÑ† Ìï†Ïù∏','Ïã†Í∑ú Í≥†Í∞ù ÌôòÏòÅ Ïø†Ìè∞','Ï£ºÎßê ÌäπÍ∞Ä Ïù¥Î≤§Ìä∏','Îã®Í≥® Í∞êÏÇ¨ Ïø†Ìè∞','ÏãúÏ¶å ÌïúÏ†ï Î©îÎâ¥ Ìï†Ïù∏'];
    var name = names[Math.floor(Math.random()*names.length)];
    var disc = [10,15,20,25,30][Math.floor(Math.random()*5)];
    var qty = [50,100,200,300,500][Math.floor(Math.random()*5)];
    document.getElementById('modal-coupon-name').value = name;
    document.getElementById('modal-coupon-desc').value = 'AIÍ∞Ä Îß§Ïû• Î∂ÑÏÑùÏùÑ ÌÜµÌï¥ Ï∂îÏ≤úÌïòÎäî ÏµúÏ†ÅÌôîÎêú Ïø†Ìè∞ÏûÖÎãàÎã§.';
    document.getElementById('modal-discount-value').value = disc;
    document.getElementById('modal-quantity').value = qty;
    showCouponNotification('AIÍ∞Ä Ïø†Ìè∞ Ï†ïÎ≥¥Î•º ÏûêÎèô ÏÉùÏÑ±ÌñàÏäµÎãàÎã§!', 'success');
  };

  // ---- Update cost 50Ïõê ‚Üí 100Ïõê ----
  function walkAndReplace(node) {
    if (node.nodeType === 3) {
      var t = node.textContent;
      if (t.indexOf('50Ïõê') >= 0 || t.indexOf('Ïû•Îãπ 50') >= 0) {
        node.textContent = t.replace(/Ïû•Îãπ 50Ïõê/g, 'Ïû•Îãπ 100Ïõê')
          .replace(/50Ïõê \/ Ïû•/g, '100Ïõê / Ïû•').replace(/50Ïõê\/Ïû•/g, '100Ïõê/Ïû•')
          .replace(/100Ïû• Î∞úÍ∏â Ïãú ‚Üí 5,000Ïõê/g, '100Ïû• Î∞úÍ∏â Ïãú ‚Üí 10,000Ïõê')
          .replace(/1,000Ïû• Î∞úÍ∏â Ïãú ‚Üí 50,000Ïõê/g, '1,000Ïû• Î∞úÍ∏â Ïãú ‚Üí 100,000Ïõê')
          .replace(/1Ïû•Îãπ 50Ïõê/g, '1Ïû•Îãπ 100Ïõê').replace(/50Ïõê/g, '100Ïõê');
      }
    }
    for (var i = 0; i < node.childNodes.length; i++) walkAndReplace(node.childNodes[i]);
  }
  walkAndReplace(document.body);

  // ---- Override old coupon cost calculation ----
  window.calculateCouponCost = function() {
    var qtyInput = document.getElementById('store-coupon-qty');
    var qty = parseInt(qtyInput ? qtyInput.value : 0) || 0;
    var calcQty = document.getElementById('calc-qty');
    var calcTotal = document.getElementById('calc-total');
    if (calcQty) calcQty.textContent = qty + ' Ïû•';
    if (calcTotal) calcTotal.textContent = '‚Ç©' + (qty * 100).toLocaleString();
  };

  // ---- Override old issueStoreCoupon ----
  window.issueStoreCoupon = function(event) {
    event.preventDefault();
    var name = document.getElementById('store-coupon-name') ? document.getElementById('store-coupon-name').value : '';
    var qty = parseInt(document.getElementById('store-coupon-qty') ? document.getElementById('store-coupon-qty').value : 0) || 0;
    var cost = qty * 100;
    if (!name) { alert('Ïø†Ìè∞Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
    if (qty < 1) { alert('Î∞úÍ∏â ÏàòÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
    if (confirm('Ïø†Ìè∞ "'+name+'" '+qty+'Ïû•ÏùÑ Î∞úÍ∏âÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\nÍ≤∞Ï†ú Í∏àÏï°: '+cost.toLocaleString()+'Ïõê (Ïû•Îãπ 100Ïõê)')) {
      showCouponNotification(name+' Ïø†Ìè∞ '+qty+'Ïû• Î∞úÍ∏â Ïã†Ï≤≠ ÏôÑÎ£å! (Í≤∞Ï†ú: '+cost.toLocaleString()+'Ïõê)', 'success');
      var discountVal = parseInt(document.getElementById('store-coupon-discount') ? document.getElementById('store-coupon-discount').value : 10) || 10;
      var discType = document.getElementById('store-coupon-type') ? document.getElementById('store-coupon-type').value : 'percentage';
      window.couponManagementData.coupons.unshift({
        id: Date.now(), name: name, description: discountVal + (discType==='percentage' ? '% Ìï†Ïù∏' : 'Ïõê Ìï†Ïù∏'),
        discountType: discType==='percentage' ? 'percent' : 'fixed', discountValue: discountVal, quantity: qty, used: 0,
        startDate: new Date().toISOString().split('T')[0], endDate: document.getElementById('store-coupon-expiry') ? document.getElementById('store-coupon-expiry').value : '2026-12-31',
        status: 'pending', rarity: discountVal>=50?'EPIC':(discountVal>=30?'RARE':'COMMON'), radius: 5, minPayment: 0, maxDiscount: 0, image: null
      });
      renderCouponManagementList(); updateCouponStats();
    }
  };

  // ---- Override old issueCoupon (Golden Rabbit form) ----
  window.issueCoupon = function() {
    var title = document.getElementById('coupon-title') ? document.getElementById('coupon-title').value : '';
    var qty = parseInt(document.getElementById('coupon-quantity') ? document.getElementById('coupon-quantity').value : 0) || 0;
    if (!title) { alert('Ïø†Ìè∞ Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
    if (qty < 1) { alert('Î∞úÍ∏â ÏàòÎüâÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
    var cost = qty * 100;
    if (confirm('Ïø†Ìè∞ "'+title+'" '+qty+'Ïû•ÏùÑ Î∞úÍ∏âÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\nÍ≤∞Ï†ú Í∏àÏï°: '+cost.toLocaleString()+'Ïõê (Ïû•Îãπ 100Ïõê)')) {
      var discValue = parseInt(document.getElementById('coupon-discount-value') ? document.getElementById('coupon-discount-value').value : 10) || 10;
      var rarity = document.getElementById('coupon-rarity') ? document.getElementById('coupon-rarity').value : 'common';
      window.couponManagementData.coupons.unshift({
        id: Date.now(), name: title, description: discValue + '% Ìï†Ïù∏',
        discountType: 'percent', discountValue: discValue, quantity: qty, used: 0,
        startDate: new Date().toISOString().split('T')[0], endDate: document.getElementById('coupon-expiry') ? document.getElementById('coupon-expiry').value : '2026-12-31',
        status: 'pending', rarity: rarity.toUpperCase(), radius: parseFloat(document.getElementById('coupon-radius') ? document.getElementById('coupon-radius').value : 5) || 5,
        minPayment: 0, maxDiscount: 0, image: null
      });
      renderCouponManagementList(); updateCouponStats();
      showCouponNotification(title+' Ïø†Ìè∞ '+qty+'Ïû• Î∞úÍ∏â ÏôÑÎ£å! (Í≤∞Ï†ú: '+cost.toLocaleString()+'Ïõê)', 'success');
      if (typeof hideCouponIssueForm === 'function') hideCouponIssueForm();
    }
  };

  // ---- Add map to old store coupon form ----
  var condArea = document.getElementById('store-coupon-condition');
  if (condArea && !document.getElementById('store-coupon-map-container')) {
    var mapSec = document.createElement('div');
    mapSec.className = 'mt-4 mb-4';
    mapSec.innerHTML = '<div class="bg-gray-800/50 border border-green-500/30 rounded-xl p-4">' +
      '<h4 class="font-bold text-green-400 flex items-center gap-2 mb-3">üìç Î∞∞Ìè¨ Î∞òÍ≤Ω</h4>' +
      '<div id="store-coupon-map-container" class="w-full h-[200px] rounded-lg overflow-hidden border border-gray-700 mb-3">' +
        '<div id="store-coupon-map" style="width:100%;height:100%;"></div>' +
      '</div>' +
      '<div class="flex items-center justify-between text-sm mb-1">' +
        '<span class="text-purple-400 font-bold">üìç Î∞òÍ≤Ω: <span id="store-radius-display">5.0km</span></span>' +
        '<span class="text-gray-500">50m ~ 20,000km</span>' +
      '</div>' +
      '<input type="range" id="store-radius-slider" min="0" max="100" value="35" class="w-full accent-purple-500 cursor-pointer" oninput="updateStoreRadiusDisplay(this.value)">' +
      '<div class="flex justify-between text-xs text-gray-500 mt-1"><span>50m</span><span>500m</span><span>5km</span><span>50km</span><span>500km</span><span>20,000km</span></div>' +
    '</div>';
    condArea.parentElement.insertAdjacentElement('afterend', mapSec);
  }

  window.storeFormMap = null; window.storeFormCircle = null;
  window.updateStoreRadiusDisplay = function(val) {
    var km = sliderToRadius(val);
    document.getElementById('store-radius-display').textContent = formatRadius(km);
    if (window.storeFormCircle) {
      window.storeFormCircle.setRadius(Math.min(km*1000,500000));
      try { window.storeFormMap.fitBounds(window.storeFormCircle.getBounds(),{padding:[10,10]}); } catch(e) {}
    }
  };
  window.initStoreFormMap = function() {
    if (window.storeFormMap) return;
    var c = document.getElementById('store-coupon-map');
    if (!c || typeof L==='undefined') return;
    var center=[37.5065,127.0536];
    window.storeFormMap = L.map('store-coupon-map',{center:center,zoom:12,zoomControl:false,attributionControl:false});
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(window.storeFormMap);
    L.marker(center,{icon:L.divIcon({className:'custom-marker',html:'<div style="background:linear-gradient(135deg,#8b5cf6,#06b6d4);width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:12px;box-shadow:0 0 10px rgba(139,92,246,0.5);border:2px solid white;">üìç</div>',iconSize:[24,24],iconAnchor:[12,12]})}).addTo(window.storeFormMap);
    var sv=document.getElementById('store-radius-slider').value;
    var km=sliderToRadius(sv);
    window.storeFormCircle=L.circle(center,{radius:Math.min(km*1000,500000),color:'#8b5cf6',fillColor:'#8b5cf6',fillOpacity:0.15,weight:2,dashArray:'5, 5'}).addTo(window.storeFormMap);
    setTimeout(function(){window.storeFormMap.invalidateSize();},100);
  };

  // Initialize lists
  renderCouponManagementList();
  updateCouponStats();
}
// End of initializeEnhancedCouponSystem

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üè¢ ÎåÄÍ∏∞ÏóÖÍ∏â UX ÏãúÏä§ÌÖú ‚Äî Î∞∞ÎØº/ÌÜ†Ïä§/Ïø†Ìå°/ÎãπÍ∑º ÏàòÏ§Ä
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ‚îÄ 1. ÌïòÎã® ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÏãúÏä§ÌÖú ‚îÄ‚îÄ‚îÄ
const TAB_PAGE_MAP = {
  home: 'home',
  game: null, // game starts directly
  market: 'market',
  wallet: 'wallet',
  my: 'login'
};

function switchTab(tabName) {
  // ÌÉ≠ ÌôúÏÑ±Ìôî UI ÏóÖÎç∞Ïù¥Ìä∏
  document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
  const activeTab = document.querySelector(`.tab-item[data-tab="${tabName}"]`);
  if (activeTab) activeTab.classList.add('active');

  // Ìï¥Îãπ ÌÉ≠Ïùò dot Ï†úÍ±∞ (ÏùΩÏùå Ï≤òÎ¶¨)
  const dot = document.getElementById(`tab-dot-${tabName}`);
  if (dot) dot.style.display = 'none';

  // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
  if (tabName === 'game') {
    startGame();
  } else if (tabName === 'my') {
    if (currentUser) {
      showPage('business');
    } else {
      showPage('login');
    }
  } else {
    showPage(TAB_PAGE_MAP[tabName] || tabName);
  }
}

// showPage Ïó∞Îèô ‚Äî ÌéòÏù¥ÏßÄ Ï†ÑÌôò Ïãú ÌÉ≠Î∞î ÎèôÍ∏∞Ìôî
const _origShowPage = showPage;
window.showPage = function(pageName) {
  _origShowPage(pageName);
  syncTabBar(pageName);
};

function syncTabBar(pageName) {
  const reverseMap = { home:'home', market:'market', wallet:'wallet', login:'my', business:'my' };
  const tabName = reverseMap[pageName];
  if (tabName) {
    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
    const tab = document.querySelector(`.tab-item[data-tab="${tabName}"]`);
    if (tab) tab.classList.add('active');
  }
  // Í≤åÏûÑ/Ïä§ÌÜ†Ïñ¥ Îì±ÏóêÏÑúÎäî ÌÉ≠Î∞î Ïà®Í∏∞Í∏∞
  const tabBar = document.getElementById('bottom-tab-bar');
  if (tabBar) {
    const hiddenPages = ['game', 'store', 'store-builder', 'admin'];
    tabBar.style.display = hiddenPages.includes(pageName) ? 'none' : 'flex';
  }
}

// Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
function updateTabBadges() {
  // ÏßÄÍ∞ë Î∞∞ÏßÄ = Ïø†Ìè∞ Í∞úÏàò
  const walletCoupons = JSON.parse(localStorage.getItem('airctt_coupons') || '[]');
  const walletBadge = document.getElementById('tab-badge-wallet');
  if (walletBadge) {
    if (walletCoupons.length > 0) {
      walletBadge.textContent = walletCoupons.length > 99 ? '99+' : walletCoupons.length;
      walletBadge.style.display = 'flex';
    } else {
      walletBadge.style.display = 'none';
    }
  }
  // Ïû•ÌÑ∞ Î∞∞ÏßÄ = Ï¥ù Ïø†Ìè∞ Ïù¥Î≤§Ìä∏ Ïàò
  const marketBadge = document.getElementById('tab-badge-market');
  if (marketBadge) {
    const allCoupons = JSON.parse(localStorage.getItem('allCoupons') || '[]');
    if (allCoupons.length > 0) {
      marketBadge.textContent = allCoupons.length > 99 ? '99+' : allCoupons.length;
      marketBadge.style.display = 'flex';
    } else {
      marketBadge.style.display = 'none';
    }
  }
}

// ‚îÄ‚îÄ‚îÄ 2. ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º ÏãúÏä§ÌÖú (ÌÜ†Ïä§ Ïä§ÌÉÄÏùº) ‚îÄ‚îÄ‚îÄ
function showToast(message, type = 'info', duration = 3000) {
  const container = document.getElementById('toast-container');
  if (!container) return;

  const icons = {
    success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è',
    coupon: 'üéüÔ∏è', coin: 'ü™ô', game: 'üéÆ', wallet: 'üí∞', star: '‚≠ê'
  };

  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.style.animationDuration = `0.3s, 0.3s`;
  toast.style.animationDelay = `0s, ${(duration - 300) / 1000}s`;
  toast.innerHTML = `
    <span class="toast-icon">${icons[type] || icons.info}</span>
    <span class="toast-text">${message}</span>
  `;

  container.appendChild(toast);

  setTimeout(() => {
    if (toast.parentNode) toast.parentNode.removeChild(toast);
  }, duration);
}

// ‚îÄ‚îÄ‚îÄ 3. Ïò®Î≥¥Îî© Ï∫êÎü¨ÏÖÄ (Ï≤´ Î∞©Î¨∏ ÌäúÌÜ†Î¶¨Ïñº) ‚îÄ‚îÄ‚îÄ
const ONBOARDING_SLIDES = [
  {
    emoji: 'üê∞‚ú®',
    title: 'AIRCTTÏóê Ïò§Ïã† Í±∏ ÌôòÏòÅÌï¥Ïöî!',
    desc: 'AR 3D Ïø†Ìè∞ Í≤åÏûÑÏúºÎ°ú Ïã§Ï†ú Ìï†Ïù∏ Ïø†Ìè∞ÏùÑ ÌöçÎìùÌïòÍ≥†,<br>Ïö∞Î¶¨ ÎèôÎÑ§ Îß§Ïû•ÏóêÏÑú Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî!'
  },
  {
    emoji: 'üéÆüéüÔ∏è',
    title: 'Ïø†Ìè∞ Í≤åÏûÑ ‚Üí ÏßÄÍ∞ë ‚Üí Í≤∞Ï†ú',
    desc: 'Í≤åÏûÑÏóêÏÑú ÌöçÎìùÌïú Ïø†Ìè∞ÏùÄ <b>ÏßÄÍ∞ë</b>Ïóê ÏûêÎèô Ï†ÄÏû•!<br>‚òÅÔ∏è Íµ¨Î¶ÑÏû•ÌÑ∞ÏóêÏÑú Îß§Ïû•ÏùÑ Ï∞æÏïÑ Î∞îÎ°ú ÏÇ¨Ïö©Ìï¥Î≥¥ÏÑ∏Ïöî.'
  },
  {
    emoji: '‚òÅÔ∏èüè™',
    title: 'Íµ¨Î¶ÑÏû•ÌÑ∞ÏóêÏÑú Î™®Îì† Îß§Ïû• ÌÉêÏÉâ',
    desc: 'ÎèôÎÑ§ ÎßõÏßëÎ∂ÄÌÑ∞ Ïπ¥Ìéò, Ìé∏ÏùòÏ†êÍπåÏßÄ!<br>ÏÇ¨ÏóÖÏûêÎùºÎ©¥ <b>Îß§Ïû• ÏûÖÏ†ê</b>ÏúºÎ°ú ÎÇ¥ Í∞ÄÍ≤åÎ•º ÌôçÎ≥¥ÌïòÏÑ∏Ïöî.'
  }
];
let onboardingIdx = 0;

function showOnboarding() {
  onboardingIdx = 0;
  renderOnboardingSlide();
  document.getElementById('onboarding-overlay').style.display = 'flex';
}

function closeOnboarding() {
  document.getElementById('onboarding-overlay').style.display = 'none';
  localStorage.setItem('airctt_onboarded', 'true');
  showToast('ÌäúÌÜ†Î¶¨Ïñº ÏôÑÎ£å! Í≤åÏûÑÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî üéÆ', 'success');
}

function renderOnboardingSlide() {
  const slide = ONBOARDING_SLIDES[onboardingIdx];
  document.getElementById('onboarding-slide').innerHTML = `
    <div style="font-size:64px;margin-bottom:16px;">${slide.emoji}</div>
    <h3 style="font-size:18px;font-weight:800;color:white;margin-bottom:10px;">${slide.title}</h3>
    <p style="font-size:13px;color:#aaa;line-height:1.6;">${slide.desc}</p>
  `;
  // dots
  const dotsEl = document.getElementById('onboarding-dots');
  dotsEl.innerHTML = ONBOARDING_SLIDES.map((_, i) =>
    `<span style="width:${i === onboardingIdx ? '24px' : '8px'};height:8px;border-radius:4px;background:${i === onboardingIdx ? '#a855f7' : '#444'};display:inline-block;transition:all 0.3s;"></span>`
  ).join('');
  // Î≤ÑÌäº ÏÉÅÌÉú
  document.getElementById('onboarding-prev').style.visibility = onboardingIdx === 0 ? 'hidden' : 'visible';
  document.getElementById('onboarding-next').textContent = onboardingIdx === ONBOARDING_SLIDES.length - 1 ? 'ÏãúÏûëÌïòÍ∏∞ üöÄ' : 'Îã§Ïùå';
}

function onboardingNext() {
  if (onboardingIdx < ONBOARDING_SLIDES.length - 1) {
    onboardingIdx++;
    renderOnboardingSlide();
  } else {
    closeOnboarding();
  }
}

function onboardingPrev() {
  if (onboardingIdx > 0) {
    onboardingIdx--;
    renderOnboardingSlide();
  }
}

// ‚îÄ‚îÄ‚îÄ 4. Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© ‚îÄ‚îÄ‚îÄ
function showSkeleton(containerId, count = 3, type = 'card') {
  const el = document.getElementById(containerId);
  if (!el) return;
  let html = '';
  if (type === 'card') {
    for (let i = 0; i < count; i++) {
      html += `
        <div style="background:rgba(26,26,46,0.8);border-radius:12px;padding:16px;margin-bottom:12px;">
          <div class="skeleton" style="width:60%;height:18px;margin-bottom:10px;"></div>
          <div class="skeleton" style="width:40%;height:14px;margin-bottom:8px;"></div>
          <div class="skeleton" style="width:80%;height:12px;margin-bottom:6px;"></div>
          <div class="skeleton" style="width:100%;height:80px;margin-top:12px;border-radius:8px;"></div>
        </div>`;
    }
  } else if (type === 'coupon') {
    for (let i = 0; i < count; i++) {
      html += `
        <div style="background:rgba(26,26,46,0.8);border-radius:12px;padding:14px;display:flex;gap:12px;align-items:center;margin-bottom:10px;">
          <div class="skeleton" style="width:48px;height:48px;border-radius:10px;flex-shrink:0;"></div>
          <div style="flex:1;">
            <div class="skeleton" style="width:70%;height:14px;margin-bottom:6px;"></div>
            <div class="skeleton" style="width:50%;height:12px;"></div>
          </div>
          <div class="skeleton" style="width:60px;height:28px;border-radius:6px;"></div>
        </div>`;
    }
  } else if (type === 'store') {
    for (let i = 0; i < count; i++) {
      html += `
        <div style="background:rgba(26,26,46,0.8);border-radius:12px;overflow:hidden;margin-bottom:12px;">
          <div class="skeleton" style="width:100%;height:120px;"></div>
          <div style="padding:12px;">
            <div class="skeleton" style="width:60%;height:16px;margin-bottom:8px;"></div>
            <div class="skeleton" style="width:80%;height:12px;margin-bottom:6px;"></div>
            <div class="skeleton" style="width:40%;height:12px;"></div>
          </div>
        </div>`;
    }
  }
  el.innerHTML = html;
}

function hideSkeleton(containerId) {
  const el = document.getElementById(containerId);
  if (el) el.innerHTML = '';
}

// ‚îÄ‚îÄ‚îÄ 5. Empty State (Îπà ÏÉÅÌÉú) UI ‚îÄ‚îÄ‚îÄ
function showEmptyState(containerId, options = {}) {
  const el = document.getElementById(containerId);
  if (!el) return;
  const emoji = options.emoji || 'üì≠';
  const title = options.title || 'ÏïÑÏßÅ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏñ¥Ïöî';
  const desc = options.desc || 'ÏÉàÎ°úÏö¥ ÌôúÎèôÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!';
  const btnText = options.btnText || '';
  const btnAction = options.btnAction || '';

  el.innerHTML = `
    <div style="text-align:center;padding:48px 20px;">
      <div style="font-size:56px;margin-bottom:16px;opacity:0.7;">${emoji}</div>
      <h4 style="font-size:16px;font-weight:700;color:#ccc;margin-bottom:8px;">${title}</h4>
      <p style="font-size:13px;color:#888;margin-bottom:20px;">${desc}</p>
      ${btnText ? `<button onclick="${btnAction}" style="padding:10px 24px;background:linear-gradient(135deg,#a855f7,#06b6d4);color:white;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;">${btnText}</button>` : ''}
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ 6. Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏ (4Îã®Í≥Ñ) ‚îÄ‚îÄ‚îÄ
function showOrderTimeline(containerId, currentStep = 0) {
  const steps = [
    { icon: 'üìã', label: 'Ï£ºÎ¨∏Ï†ëÏàò', time: '' },
    { icon: 'üë®‚Äçüç≥', label: 'Ï°∞Î¶¨Ï§ë', time: '' },
    { icon: 'üö¥', label: 'Î∞∞Îã¨Ï§ë', time: '' },
    { icon: '‚úÖ', label: 'ÏôÑÎ£å', time: '' }
  ];
  const el = document.getElementById(containerId);
  if (!el) return;

  const now = new Date();
  steps.forEach((s, i) => {
    if (i <= currentStep) {
      const t = new Date(now.getTime() - (currentStep - i) * 5 * 60000);
      s.time = `${t.getHours().toString().padStart(2,'0')}:${t.getMinutes().toString().padStart(2,'0')}`;
    }
  });

  el.innerHTML = `
    <div style="background:rgba(26,26,46,0.9);border:1px solid rgba(168,85,247,0.2);border-radius:16px;padding:20px;">
      <h4 style="font-size:15px;font-weight:800;color:white;margin-bottom:16px;">üì¶ Ï£ºÎ¨∏ ÌòÑÌô©</h4>
      <ul class="order-timeline">
        ${steps.map((s, i) => `
          <li class="${i < currentStep ? 'completed' : i === currentStep ? 'current' : ''}">
            <span style="font-size:11px;color:${i <= currentStep ? '#a855f7' : '#555'};">${s.time}</span>
            <span style="font-size:18px;">${s.icon}</span>
            <span style="font-size:13px;color:${i <= currentStep ? '#fff' : '#666'};font-weight:${i === currentStep ? '700' : '400'};">${s.label}</span>
          </li>
        `).join('')}
      </ul>
      ${currentStep < 3 ? `<p style="text-align:center;font-size:12px;color:#a855f7;margin-top:12px;animation:timelinePulse 2s infinite;">‚è±Ô∏è ÏòàÏÉÅ ${(3 - currentStep) * 5}Î∂Ñ ÌõÑ ÏôÑÎ£å</p>` : `<p style="text-align:center;font-size:13px;color:#22c55e;margin-top:12px;font-weight:700;">üéâ Ï£ºÎ¨∏Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!</p>`}
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ 7. Î¶¨Î∑∞/ÌèâÏ†ê ÏãúÏä§ÌÖú ‚îÄ‚îÄ‚îÄ
function showReviewForm(storeId) {
  const overlay = document.createElement('div');
  overlay.id = 'review-overlay';
  overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:4000;display:flex;align-items:center;justify-content:center;padding:16px;';

  overlay.innerHTML = `
    <div style="background:#1a1a2e;border:1px solid rgba(168,85,247,0.3);border-radius:16px;padding:24px;max-width:360px;width:100%;">
      <h3 style="font-size:16px;font-weight:800;color:white;text-align:center;margin-bottom:16px;">‚≠ê Î¶¨Î∑∞ ÏûëÏÑ±</h3>
      <div id="review-stars" style="display:flex;justify-content:center;gap:8px;margin-bottom:16px;">
        ${[1,2,3,4,5].map(n => `<span onclick="setReviewStar(${n})" style="font-size:32px;cursor:pointer;opacity:0.3;transition:all 0.2s;" data-star="${n}">‚≠ê</span>`).join('')}
      </div>
      <p id="review-star-text" style="text-align:center;font-size:13px;color:#888;margin-bottom:12px;">Î≥ÑÏ†êÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</p>
      <textarea id="review-text" placeholder="ÏùåÏãùÏù¥ Ïñ¥Îñ†ÏÖ®ÎÇòÏöî? ÏÜîÏßÅÌïú Î¶¨Î∑∞Î•º ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî!"
        style="width:100%;height:80px;background:#0d0d1a;border:1px solid #333;border-radius:10px;padding:12px;color:white;font-size:13px;resize:none;outline:none;box-sizing:border-box;"></textarea>
      <div style="display:flex;gap:10px;margin-top:14px;">
        <button onclick="document.getElementById('review-overlay').remove()" style="flex:1;padding:10px;border:1px solid #444;border-radius:10px;background:transparent;color:#ccc;font-size:13px;cursor:pointer;">Ï∑®ÏÜå</button>
        <button onclick="submitReview('${storeId}')" style="flex:1;padding:10px;border:none;border-radius:10px;background:linear-gradient(135deg,#a855f7,#06b6d4);color:white;font-size:13px;font-weight:700;cursor:pointer;">Îì±Î°ùÌïòÍ∏∞</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);
}

let currentReviewStars = 0;
const STAR_LABELS = ['', 'Î≥ÑÎ°úÏòàÏöî üòû', 'Í∑∏Ï†Ä Í∑∏ÎûòÏöî üòê', 'Í¥úÏ∞ÆÏïÑÏöî üôÇ', 'ÎßõÏûàÏñ¥Ïöî üòã', 'ÏµúÍ≥†ÏòàÏöî! ü§©'];

function setReviewStar(n) {
  currentReviewStars = n;
  document.querySelectorAll('#review-stars span').forEach(s => {
    s.style.opacity = parseInt(s.dataset.star) <= n ? '1' : '0.3';
    s.style.transform = parseInt(s.dataset.star) <= n ? 'scale(1.1)' : 'scale(1)';
  });
  document.getElementById('review-star-text').textContent = STAR_LABELS[n];
}

function submitReview(storeId) {
  const text = document.getElementById('review-text').value.trim();
  if (currentReviewStars === 0) { showToast('Î≥ÑÏ†êÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!', 'warning'); return; }

  const reviews = JSON.parse(localStorage.getItem('airctt_reviews') || '[]');
  reviews.push({
    storeId, stars: currentReviewStars, text,
    user: currentUser?.name || 'ÏùµÎ™Ö ÌÜ†ÎÅº',
    date: new Date().toISOString()
  });
  localStorage.setItem('airctt_reviews', JSON.stringify(reviews));

  document.getElementById('review-overlay').remove();
  showToast(`‚≠ê ${currentReviewStars}Ï†ê Î¶¨Î∑∞Í∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!`, 'star');
  currentReviewStars = 0;
}

function getStoreReviews(storeId) {
  const reviews = JSON.parse(localStorage.getItem('airctt_reviews') || '[]');
  return reviews.filter(r => r.storeId === storeId);
}

function renderStoreReviews(containerId, storeId) {
  const reviews = getStoreReviews(storeId);
  const el = document.getElementById(containerId);
  if (!el) return;

  if (reviews.length === 0) {
    el.innerHTML = `<div style="text-align:center;padding:20px;color:#666;font-size:13px;">ÏïÑÏßÅ Î¶¨Î∑∞Í∞Ä ÏóÜÏñ¥Ïöî. Ï≤´ Î¶¨Î∑∞Î•º ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî! ‚úçÔ∏è</div>`;
    return;
  }

  const avg = (reviews.reduce((s, r) => s + r.stars, 0) / reviews.length).toFixed(1);
  el.innerHTML = `
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;">
      <span style="font-size:28px;font-weight:900;color:#fbbf24;">${avg}</span>
      <div>
        <div style="font-size:14px;">${'‚≠ê'.repeat(Math.round(avg))}</div>
        <span style="font-size:11px;color:#888;">Î¶¨Î∑∞ ${reviews.length}Í∞ú</span>
      </div>
    </div>
    ${reviews.slice(-5).reverse().map(r => `
      <div style="background:rgba(26,26,46,0.6);border-radius:10px;padding:12px;margin-bottom:8px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
          <span style="font-size:12px;font-weight:600;color:#ccc;">üê∞ ${r.user}</span>
          <span style="font-size:11px;color:#666;">${new Date(r.date).toLocaleDateString('ko')}</span>
        </div>
        <div style="font-size:12px;margin-bottom:4px;">${'‚≠ê'.repeat(r.stars)}${'‚òÜ'.repeat(5 - r.stars)}</div>
        ${r.text ? `<p style="font-size:12px;color:#aaa;margin:0;">${r.text}</p>` : ''}
      </div>
    `).join('')}`;
}

// ‚îÄ‚îÄ‚îÄ 8. Pull-to-Refresh ‚îÄ‚îÄ‚îÄ
let pullStartY = 0;
let isPulling = false;

function initPullToRefresh() {
  const content = document.querySelector('.content');
  if (!content) return;

  content.addEventListener('touchstart', function(e) {
    if (content.scrollTop === 0) {
      pullStartY = e.touches[0].clientY;
      isPulling = true;
    }
  }, { passive: true });

  content.addEventListener('touchmove', function(e) {
    if (!isPulling) return;
    const pullDistance = e.touches[0].clientY - pullStartY;
    if (pullDistance > 60 && content.scrollTop === 0) {
      // Show pull indicator
      let indicator = document.getElementById('pull-indicator');
      if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'pull-indicator';
        indicator.style.cssText = 'text-align:center;padding:12px;font-size:12px;color:#a855f7;transition:all 0.3s;';
        content.insertBefore(indicator, content.firstChild);
      }
      indicator.textContent = pullDistance > 100 ? 'üîÑ ÎÜìÏïÑÏÑú ÏÉàÎ°úÍ≥†Ïπ®' : '‚¨áÔ∏è ÎãπÍ≤®ÏÑú ÏÉàÎ°úÍ≥†Ïπ®';
    }
  }, { passive: true });

  content.addEventListener('touchend', function(e) {
    if (!isPulling) return;
    isPulling = false;
    const indicator = document.getElementById('pull-indicator');
    if (indicator) {
      indicator.textContent = 'üîÑ ÏÉàÎ°úÍ≥†Ïπ® Ï§ë...';
      setTimeout(() => {
        // Refresh current page
        const activePage = document.querySelector('.page.active');
        if (activePage) {
          const pageId = activePage.id.replace('-page', '');
          showPage(pageId);
        }
        showToast('ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å!', 'success');
        if (indicator.parentNode) indicator.parentNode.removeChild(indicator);
      }, 800);
    }
  }, { passive: true });
}

// ‚îÄ‚îÄ‚îÄ 9. Ïï± Ï¥àÍ∏∞Ìôî Ïãú Ïò®Î≥¥Îî© + ÌÉ≠Î∞î ÏÑ§Ï†ï ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', function() {
  // Ïò®Î≥¥Îî©: Ï≤´ Î∞©Î¨∏ ÏãúÏóêÎßå ÌëúÏãú
  setTimeout(() => {
    if (!localStorage.getItem('airctt_onboarded')) {
      showOnboarding();
    }
  }, 1500);

  // ÌÉ≠ Î∞∞ÏßÄ Ï¥àÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏
  updateTabBadges();

  // Pull-to-Refresh Ï¥àÍ∏∞Ìôî
  initPullToRefresh();

  // ÌôòÏòÅ ÌÜ†Ïä§Ìä∏
  setTimeout(() => {
    showToast('AIRCTTÏóê Ïò§Ïã† Í±∏ ÌôòÏòÅÌï©ÎãàÎã§! üê∞', 'success');
  }, 2000);
});

// Í∏∞Ï°¥ Ìï®Ïàò ÌõÖ: Ïø†Ìè∞ ÌöçÎìù Ïãú Î∞∞ÏßÄ + ÌÜ†Ïä§Ìä∏
const _origAddCouponToWallet = typeof addCouponToWallet === 'function' ? addCouponToWallet : null;
if (_origAddCouponToWallet) {
  window.addCouponToWallet = function(coupon) {
    const result = _origAddCouponToWallet(coupon);
    showToast(`üéüÔ∏è "${coupon.name || coupon.title || 'Ïø†Ìè∞'}" ÌöçÎìù!`, 'coupon');
    updateTabBadges();
    // Í≤åÏûÑ ÌÉ≠Ïóê ÏÉà ÏïåÎ¶º dot
    const gameDot = document.getElementById('tab-dot-game');
    if (gameDot) gameDot.style.display = 'block';
    return result;
  };
}

// ‚ïê‚ïê‚ïê ÎåÄÍ∏∞ÏóÖ ÎπÑÍµêÌëú Ï∂úÎ†• Ìï®Ïàò ‚ïê‚ïê‚ïê
function showComparisonTable() {
  const features = [
    ['ÌïòÎã® ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['ÏÜåÏÖú Î°úÍ∑∏Ïù∏ (Ïπ¥Ïπ¥Ïò§/ÎÑ§Ïù¥Î≤Ñ/Íµ¨Í∏Ä)', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© UI', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º ÏãúÏä§ÌÖú', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['Ïò®Î≥¥Îî© ÌäúÌÜ†Î¶¨Ïñº', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['Ï£ºÎ¨∏ Ï∂îÏ†Å ÌÉÄÏûÑÎùºÏù∏', '‚úÖ', '‚úÖ', '‚ùå', '‚úÖ', '‚úÖ', '‚ùå'],
    ['Î¶¨Î∑∞/ÌèâÏ†ê ÏãúÏä§ÌÖú', '‚úÖ', '‚úÖ', '‚úÖ', '‚ùå', '‚úÖ', '‚ùå'],
    ['Pull-to-Refresh', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['Empty State UI', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['AR 3D Ïø†Ìè∞ Í≤åÏûÑ', '‚úÖ', '‚ùå', '‚ùå', '‚ùå', '‚ùå', '‚ùå'],
    ['AI CFO (Gemini)', '‚úÖ', '‚ùå', '‚ùå', '‚ùå', '‚ùå', '‚ùå'],
    ['Ïã§ÏãúÍ∞Ñ PG Í≤∞Ï†ú ÏãúÎÆ¨', '‚úÖ', '‚úÖ', '‚ùå', '‚úÖ', '‚úÖ', '‚úÖ'],
    ['Îß§Ïû• ÌôàÌéòÏù¥ÏßÄ ÎπåÎçî', '‚úÖ', '‚ùå', '‚ùå', '‚ùå', '‚ùå', '‚ùå'],
    ['Ïø†Ìè∞ ‚Üí ÏßÄÍ∞ë ‚Üí Í≤∞Ï†ú ÏàúÌôò', '‚úÖ', '‚ùå', '‚ùå', '‚ùå', '‚ùå', '‚ùå'],
    ['Supabase Ïã§ÏãúÍ∞Ñ DB', '‚úÖ', 'ÏûêÏ≤¥', 'ÏûêÏ≤¥', 'ÏûêÏ≤¥', 'ÏûêÏ≤¥', 'ÏûêÏ≤¥'],
  ];

  let html = `
    <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:5000;display:flex;align-items:center;justify-content:center;padding:10px;overflow:auto;" onclick="this.remove()">
      <div style="background:#1a1a2e;border:1px solid rgba(168,85,247,0.3);border-radius:16px;padding:20px;max-width:95vw;max-height:90vh;overflow:auto;" onclick="event.stopPropagation()">
        <h3 style="font-size:16px;font-weight:800;color:white;text-align:center;margin-bottom:4px;">üèÜ AIRCTT vs ÎåÄÍ∏∞ÏóÖ ÎπÑÍµê</h3>
        <p style="font-size:11px;color:#888;text-align:center;margin-bottom:14px;">Enterprise-Level Feature Comparison</p>
        <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;font-size:11px;">
          <thead>
            <tr style="background:rgba(168,85,247,0.2);">
              <th style="padding:8px 6px;text-align:left;color:#a855f7;border-bottom:1px solid #333;white-space:nowrap;">Í∏∞Îä•</th>
              <th style="padding:8px 6px;text-align:center;color:#fbbf24;border-bottom:1px solid #333;">AIRCTT</th>
              <th style="padding:8px 4px;text-align:center;color:#ccc;border-bottom:1px solid #333;">Î∞∞ÎØº</th>
              <th style="padding:8px 4px;text-align:center;color:#ccc;border-bottom:1px solid #333;">ÎãπÍ∑º</th>
              <th style="padding:8px 4px;text-align:center;color:#ccc;border-bottom:1px solid #333;">Ïø†Ìå°</th>
              <th style="padding:8px 4px;text-align:center;color:#ccc;border-bottom:1px solid #333;">ÌÜ†Ïä§</th>
              <th style="padding:8px 4px;text-align:center;color:#ccc;border-bottom:1px solid #333;">ÎÑ§Ïù¥Î≤Ñ</th>
            </tr>
          </thead>
          <tbody>
            ${features.map(f => `
              <tr style="border-bottom:1px solid #222;">
                <td style="padding:6px;color:#ddd;white-space:nowrap;">${f[0]}</td>
                ${f.slice(1).map((v, i) => `<td style="padding:6px;text-align:center;${i === 0 ? 'background:rgba(168,85,247,0.08);' : ''}">${v}</td>`).join('')}
              </tr>
            `).join('')}
          </tbody>
        </table>
        </div>
        <div style="text-align:center;margin-top:14px;">
          <p style="font-size:12px;color:#a855f7;font-weight:700;">üê∞ AIRCTT: 15/15 Í∏∞Îä• | ÎåÄÍ∏∞ÏóÖ ÌèâÍ∑†: 9.6/15</p>
          <p style="font-size:11px;color:#666;margin-top:4px;">AR Í≤åÏûÑ + AI CFO + Îß§Ïû• ÎπåÎçîÎäî AIRCTTÎßåÏùò ÎèÖÏûê Í∏∞Îä•</p>
          <button onclick="this.parentElement.parentElement.parentElement.remove()" style="margin-top:12px;padding:8px 24px;background:linear-gradient(135deg,#a855f7,#06b6d4);border:none;border-radius:8px;color:white;font-size:12px;font-weight:700;cursor:pointer;">Îã´Í∏∞</button>
        </div>
      </div>
    </div>`;
  document.body.insertAdjacentHTML('beforeend', html);
}

</script></body></html>